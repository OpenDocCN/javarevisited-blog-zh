<html>
<head>
<title>WebRTC Signaling Server Example Using Spring Boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spring Boot的WebRTC信令服务器示例</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/webrtc-signaling-server-example-using-spring-boot-efd5f067900a?source=collection_archive---------0-----------------------#2022-05-09">https://medium.com/javarevisited/webrtc-signaling-server-example-using-spring-boot-efd5f067900a?source=collection_archive---------0-----------------------#2022-05-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fa6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将解释如何构建一个简单的信令服务器用于WebRTC聊天应用程序。我没有找到很多关于这个主题的文章，所以我希望这篇文章能够帮助您对WebRTC聊天应用程序中的信令操作有一个基本的了解。</p><figure class="jd je jf jg fd jh er es paragraph-image"><a href="https://javarevisited.blogspot.com/2022/01/spring-boot-reactjs-example-for-java.html"><div class="er es ca"><img src="../Images/16f88c1abd36eca243464d47e463e76d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sYzU1XpGpUhFGEwa64f4Hg.png"/></div></a></figure></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="ee0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">问题陈述</strong></p><ul class=""><li id="cc5e" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">用于WebRTC聊天应用程序的信令服务器</li></ul></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="698f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案</strong></p><p id="fa75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的解决方案是使用WebSocket技术。我用Spring Boot在短时间内创建了WebSocket服务器。</p><p id="b177" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<strong class="ih hj">业务流程的角度来看</strong>，我们将实现WebSocket服务器来处理这类信号:</p><ul class=""><li id="ee3d" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">注册</li><li id="d030" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">新成员</li><li id="c113" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">回答</li><li id="774f" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">提供</li><li id="ab6b" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">冰</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><a href="https://www.java67.com/2021/11/5-best-spring-framework-courses-for.html?m=0"><div class="er es kf"><img src="../Images/62e1877eeba20b33ffb2e103df55923f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*AO1dAZP0SDv4CvG1hDA2ww.png"/></div></a><p class="kg kh et er es ki kj bd b be z dx translated">图一。登录活动图</p></figure><p id="0cfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上图中，我们可以看到登录活动主要处理生成userId，并将userId发送回WebSocket客户端。</p><figure class="jd je jf jg fd jh er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/05/top-20-spring-boot-interview-questions-answers.html"><div class="er es kk"><img src="../Images/b61b07ac0c7d432aa252034d217bf166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U3TeSVNdAcL-Fvnf4kUmyQ.png"/></div></a><p class="kg kh et er es ki kj bd b be z dx translated">图二。新成员活动图</p></figure><p id="e528" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上图中，我们可以看到NewMember活动主要处理将新成员的userId广播给其他WebSocket客户端。</p><figure class="jd je jf jg fd jh er es paragraph-image"><a href="https://javarevisited.blogspot.com/2021/10/what-is-spring-data-repository.html"><div class="er es kl"><img src="../Images/3964ed49423a1126e325f423b755ac60.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*k4xKAvBEdncsbI915KvUCQ.png"/></div></a><p class="kg kh et er es ki kj bd b be z dx translated">图3。其他活动图</p></figure><p id="c561" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上图中，我们可以看到ICE/Answer/Offer活动主要处理将信号从发送者转发到其各自的接收者。</p><p id="9945" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从技术角度来看，我们需要在maven中添加这些依赖项:</p><pre class="jd je jf jg fd km kn ko kp aw kq bi"><span id="8801" class="kr ks hi kn b fi kt ku l kv kw">&lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;              <br/>&lt;/dependencies&gt;</span></pre><p id="b4f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与WebSocket客户端交换的信号数据将使用JSON格式。JSON由4个字段组成:</p><ul class=""><li id="ef5b" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">userId:发送数据的用户Id</li><li id="a377" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">类型(强制):信号的类型(登录，新成员，回答，提供，冰，用户Id)</li><li id="dadc" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">数据:要发送的数据，可以是冰包、提供包、应答包等</li><li id="be9d" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">toUid:要发送的数据的用户标识目的地</li></ul><p id="fd3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要为如下信号类型创建枚举:</p><pre class="jd je jf jg fd km kn ko kp aw kq bi"><span id="c4d8" class="kr ks hi kn b fi kt ku l kv kw">public enum SignalType {<br/>    <br/>    Login,<br/>    UserId,<br/>    Offer,<br/>    Answer,<br/>    Ice,<br/>    NewMember,<br/>    <br/>}</span></pre><p id="c91f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要创建一个带有必要注释的<a class="ae kx" href="https://javarevisited.blogspot.com/2021/11/how-to-create-your-first-mvc-application-using-spring-mvc-.html" rel="noopener ugc nofollow" target="_blank"> Spring Boot应用程序</a>:</p><pre class="jd je jf jg fd km kn ko kp aw kq bi"><span id="fc80" class="kr ks hi kn b fi kt ku l kv kw">@SpringBootApplication<br/>public class SignallingServerApplication {<br/><br/>    public static void main(String[] args) {<br/>        SpringApplication.run(SignallingServerApplication.class, args);<br/>    }<br/><br/>}</span></pre><p id="d5ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要实现WebSocket配置器，如下所示。使用allowed-origin来限制可以调用Web套接字服务器的域。</p><pre class="jd je jf jg fd km kn ko kp aw kq bi"><span id="a2a0" class="kr ks hi kn b fi kt ku l kv kw">@Value( "${allowed.origin:*}" )<br/>    private String allowedOrigin;<br/>    <br/>    @Override<br/>    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {<br/><br/>        registry.addHandler(new SignalingHandler(), "/socket1").setAllowedOrigins(allowedOrigin);<br/>    }</span></pre><p id="267a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要实现TextWebSocketHandler，并创建一个与我们之前设计的业务流程相匹配的流程。完整的代码可以在这个<a class="ae kx" href="https://github.com/rsatrio/WebRTC-Signaling-Server" rel="noopener ugc nofollow" target="_blank"> github </a>里看到(请别忘了留个星)。</p><p id="f5de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于浏览器和信令服务器之间通信的完整流程，请参见这篇<a class="ae kx" href="https://mrizkysatrio.medium.com/webrtc-chat-application-772539ae97b7" rel="noopener">文章</a>。</p><p id="a185" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你也可以在这个<a class="ae kx" href="https://glowing-creponne-b62856.netlify.app/" rel="noopener ugc nofollow" target="_blank">链接</a>上查看WebRTC聊天应用的工作示例。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="0549" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献和相关文章</strong></p><ol class=""><li id="e455" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc ky jx jy jz bi translated">https://www.baeldung.com/websockets-spring<a class="ae kx" href="https://www.baeldung.com/websockets-spring" rel="noopener ugc nofollow" target="_blank"/></li><li id="4501" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc ky jx jy jz bi translated"><a class="ae kx" href="https://mrizkysatrio.medium.com/webrtc-chat-application-772539ae97b7" rel="noopener">https://mrizkysatrio . medium . com/webrtc-chat-application-772539 AE 97 b 7</a></li><li id="61e4" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc ky jx jy jz bi translated"><a class="ae kx" href="https://github.com/rsatrio/WebRTC-Signaling-Server" rel="noopener ugc nofollow" target="_blank">https://github.com/rsatrio/WebRTC-Signaling-Server</a></li><li id="4b3b" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc ky jx jy jz bi translated"><a class="ae kx" href="https://glowing-creponne-b62856.netlify.app/" rel="noopener ugc nofollow" target="_blank">https://glowing-creponne-b62856.netlify.app/</a></li></ol></div></div>    
</body>
</html>