<html>
<head>
<title>Springboot App monitoring with Grafana &amp; Prometheus</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Grafana &amp; Prometheus的Springboot应用程序监控</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/springboot-app-monitoring-with-grafana-prometheus-7c723f0dec15?source=collection_archive---------0-----------------------#2021-02-19">https://medium.com/javarevisited/springboot-app-monitoring-with-grafana-prometheus-7c723f0dec15?source=collection_archive---------0-----------------------#2021-02-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6c75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">伴随着微服务的优势，我们也遇到了很多挑战。其中一个挑战是为我们的应用程序建立一个可靠的监控系统。在这里，让我们尝试用Grafana仪表板和Prometheus设置一个基本的Springboot应用程序监控。</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://medium.com/javarevisited/5-best-courses-to-learn-spring-cloud-and-microservices-1ddea1af7012"><div class="er es jd"><img src="../Images/4b6b7ccbb27b76251deeface72e72efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*-goD1ukj6T_seV31apyfYQ.jpeg"/></div></a></figure><h2 id="f491" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">先决条件</h2><ul class=""><li id="ba05" class="kg kh hi ih b ii ki im kj iq kk iu kl iy km jc kn ko kp kq bi translated"><a class="ae kr" rel="noopener" href="/javarevisited/top-5-java-online-courses-for-beginners-best-of-lot-1e1e240a758"> Java </a></li><li id="87f0" class="kg kh hi ih b ii ks im kt iq ku iu kv iy kw jc kn ko kp kq bi translated"><a class="ae kr" rel="noopener" href="/javarevisited/5-best-docker-courses-for-java-and-spring-boot-developers-bbf01c5e6542">码头工人</a></li><li id="c897" class="kg kh hi ih b ii ks im kt iq ku iu kv iy kw jc kn ko kp kq bi translated">Springboot应用程序的基础知识</li></ul><h2 id="5231" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">SpringBoot应用</h2><p id="2df0" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">使用<a class="ae kr" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> Spring Boot的首字母</a>创建一个简单的Springboot Maven应用程序。生成app时添加依赖<em class="la"> Spring Boot执行器</em>和<em class="la"> Spring Boot Web </em>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://www.java67.com/2017/11/top-5-free-core-spring-mvc-courses-learn-online.html"><div class="er es lb"><img src="../Images/10361737d53a485ac2767ad6d2c18694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kptdMf-xEOUqfL8qdlZ4PQ.png"/></div></a></figure><p id="9acc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从Springboot Initializr页面提取使用<em class="la"> Generate </em>创建的zip文件。在<em class="la"> pom.xml </em>文件中添加下面的依赖关系，用于公开普罗米修斯格式的度量数据</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="226b" class="jl jm hi ld b fi lh li l lj lk">&lt;dependency&gt;<br/>   &lt;groupId&gt;io.micrometer&lt;/groupId&gt;<br/>   &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;<br/>   &lt;version&gt;1.6.3&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="338c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终的pom.xml应该如下所示。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="86a5" class="jl jm hi ld b fi lh li l lj lk">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;project  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br/>   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;<br/>   &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br/>   &lt;parent&gt;<br/>      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>      &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;<br/>      &lt;version&gt;2.4.2&lt;/version&gt;<br/>      &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;<br/>   &lt;/parent&gt;<br/>   &lt;groupId&gt;com.sample&lt;/groupId&gt;<br/>   &lt;artifactId&gt;monitoring-demo&lt;/artifactId&gt;<br/>   &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br/>   &lt;name&gt;monitoring-demo&lt;/name&gt;<br/>   &lt;description&gt;Demo project for Spring Boot monitoring with Grafana &amp;amp; Prometheus&lt;/description&gt;<br/>   &lt;properties&gt;<br/>      &lt;java.version&gt;11&lt;/java.version&gt;<br/>   &lt;/properties&gt;<br/>   &lt;dependencies&gt;<br/>      &lt;dependency&gt;<br/>         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>         &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>      &lt;/dependency&gt;<br/>      &lt;dependency&gt;<br/>         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>         &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br/>      &lt;/dependency&gt;<br/>      &lt;dependency&gt;<br/>         &lt;groupId&gt;io.micrometer&lt;/groupId&gt;<br/>         &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;<br/>         &lt;version&gt;1.6.3&lt;/version&gt;<br/>      &lt;/dependency&gt;<br/>      &lt;dependency&gt;<br/>         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>         &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br/>         &lt;scope&gt;test&lt;/scope&gt;<br/>      &lt;/dependency&gt;<br/>   &lt;/dependencies&gt;<br/><br/>   &lt;build&gt;<br/>      &lt;plugins&gt;<br/>         &lt;plugin&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br/>         &lt;/plugin&gt;<br/>      &lt;/plugins&gt;<br/>   &lt;/build&gt;<br/><br/>&lt;/project&gt;</span></pre><p id="2b68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在将下面的配置添加到您的<em class="la"> application.yml </em>文件<em class="la">中。</em>spring<em class="la">initializr</em>创建一个<em class="la"> application.properties </em>文件，我更喜欢YAML因此有了<em class="la"> yml </em>文件，但是如果你是属性文件格式的粉丝。请放心使用。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="2af4" class="jl jm hi ld b fi lh li l lj lk">management:<br/>  endpoint:<br/>    metrics:<br/>      enabled: true<br/>    prometheus:<br/>      enabled: true<br/>  endpoints:<br/>    web:<br/>      exposure:<br/>        include: prometheus</span></pre><p id="165f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将暴露普罗米修斯格式的数据。现在是时候启动你的Springboot应用程序了。一旦应用程序启动，尝试点击下面的网址，看看指标暴露。</p><p id="22ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kr" href="http://localhost:8080/actuator/prometheus" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/actuator/Prometheus</a></p><p id="916f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出应该如下所示，带有关于JVM 的指标。</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://www.java67.com/2020/09/how-to-increasing-heap-size-in-java.html"><div class="er es ll"><img src="../Images/cb8d498fb0de800ee1771b1749ad5a39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z7NsPYXZ6Xl95dk8LAlT7g.png"/></div></a></figure><h2 id="b26d" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">普罗米修斯</h2><p id="d02b" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">既然应用程序公开了度量数据，让我们设置Prometheus来使用它。我们将使用普罗米修斯码头形象提出普罗米修斯。为此，让我们确保我们有所需的配置集。用下面的内容创建一个名为<em class="la"> prometheus.yml </em>的文件。该文件可以在任何地方创建，但我们需要在启动Prometheus时将文件的路径传递给docker。请确保用您的系统IP替换SYSTEM_IP。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="3ef8" class="jl jm hi ld b fi lh li l lj lk">global:<br/>  scrape_interval:     15s <em class="la"># Default scrape interval<br/><br/></em>scrape_configs:<br/>  - job_name: 'prometheus' <em class="la"># Job to scrape Prometheus metrics<br/>    </em>scrape_interval: 5s<br/>    static_configs:<br/>      - targets: ['localhost:9090']<br/><br/>  - job_name: 'spring-actuator'<br/>    metrics_path: '/actuator/prometheus' <em class="la"># Job to scrape application metrics<br/>    </em>scrape_interval: 5s<br/>    static_configs:<br/>      - targets: ['SYSTEM_IP:8080']</span></pre><p id="e213" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从终端使用下面的docker命令打开Prometheus。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="972d" class="jl jm hi ld b fi lh li l lj lk">docker run -d -p 9090:9090 -v \&lt;absolute_path_to_your_prometheus_file&gt;:/etc/prometheus/prometheus.yml prom/prometheus</span><span id="3100" class="jl jm hi ld b fi lm li l lj lk">example: docker run -d -p 9090:9090 -v \ /mydisk/monitoring/src/main/resources/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus</span></pre><p id="59d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦映像启动并运行，尝试点击URL<a class="ae kr" href="http://localhost:9090/" rel="noopener ugc nofollow" target="_blank">http://localhost:9090/</a>。应加载以下页面。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ln"><img src="../Images/2496127fb0e6b472044403660369d546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9phnjMRBfpnhdHq-6A53g.png"/></div></div></figure><p id="9596" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导航到UI标题栏中<em class="la">状态</em>下的<em class="la">目标</em>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ls"><img src="../Images/831c59c57fe27a5c20db0a60de45a547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gsH_HGinuXgTHhoqj1Ck3g.png"/></div></div></figure><p id="9137" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在targets下，我们应该能够看到我们在状态为<code class="du lt lu lv ld b">UP</code>的<em class="la"> prometheus.yml </em>文件中定义的两个端点。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lw"><img src="../Images/f2914dc0a2c088e7912e8dcf162b4482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I86JWM0mhpiKFEAraYeryg.png"/></div></div></figure><p id="57df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Prometheus还有一个<em class="la"> graph </em>选项，可以用来创建一些度量的图形表示。但是这里让我们将Prometheus连接到Grafana，以便创建一些很酷的监控仪表板。</p><h2 id="446b" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">格拉夫纳</h2><p id="3c78" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">现在，系统的最后一部分，让我们打开Grafana并将其连接到我们现在创建的Prometheus实例。这里我们也将使用docker来调出Grafana。使用下面的docker命令来启动Grafana。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="f0ed" class="jl jm hi ld b fi lh li l lj lk">docker run -d -p 3000:3000 grafana/grafana</span></pre><p id="f022" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦映像启动并运行，点击URL<a class="ae kr" href="http://localhost:3000/login" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>访问Garafana。您需要提供用户名和密码才能登录。Grafana的默认用户名和密码是<code class="du lt lu lv ld b">admin</code>。用它登录。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/3df52e438b31052af185285766928b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*JmNJJEqnkVb4wSYuzMWoow.png"/></div></figure><p id="d90c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">登录后，点击配置<em class="la">数据源</em>将普罗米修斯添加为<code class="du lt lu lv ld b">Datasource</code></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ly"><img src="../Images/6e01f98f5785899e59e64000ba870aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mDtYaogbF0NQvOiL5yrgNg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lz"><img src="../Images/c2460417dbf76da1d3bc217e03bbd990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gBKjstkyHd7SECp8n4OkYg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ma"><img src="../Images/3eabbd85d1e342e4891aa22595da37aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vf9FdMXL1FW0U8VSIQFF8A.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mb"><img src="../Images/959cfc870b5bbff5ae9f2b00bcd8459b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*KXomHOghDgRGIerm7ueiug.png"/></div></figure><p id="e740" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在已经添加了数据源。下一步是导入一个仪表板，以深入了解我们从应用程序推送给Prometheus的指标。首先，让我们导入一个由Micrometer提供的现有仪表板。</p><p id="ee30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在Grafana网站<a class="ae kr" href="https://grafana.com/grafana/dashboards/4701" rel="noopener ugc nofollow" target="_blank">https://grafana.com/grafana/dashboards/4701</a>找到关于这个仪表板的更多细节。为了导入仪表板，点击侧边栏中<em class="la">创建</em>下的<em class="la">导入</em>选项。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es mc"><img src="../Images/648327f6b73062861107d37563e4c76d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FikhZmyzdDwlwv_2iSZ2oQ.png"/></div></div></figure><p id="6ac8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后导入带有<em class="la"> </em> Prometheus数据源的千分尺JVM仪表板<em class="la"> 4701 </em>，如下图截图所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es md"><img src="../Images/8c9c22ff7e6cb40364c6d0773a5e9f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*po-7AtpNwAYturxNKvaR-Q.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es me"><img src="../Images/8e1095174a3cef0183a52fb65d256339.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*IJGNcdHscakNPqJskPXukg.png"/></div></figure><p id="5cd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">万岁！您已经启动并运行了JVM仪表板。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es mf"><img src="../Images/7dcdac9868f5ecc848df8747b77be088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aRiqrTpEgtlckGs8Sm7Jdg.png"/></div></div></figure><p id="9756" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我们用Grafana over Prometheus建立了一个基本的仪表板，它与Springboot应用程序相连。这仅仅是个开始，您还可以尝试使用<a class="ae kr" href="https://micrometer.io/docs/concepts" rel="noopener ugc nofollow" target="_blank"> Java Micrometer </a>创建自定义指标，或者使用已经可用的指标在Garafana中创建自定义仪表板。</p><h2 id="646f" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">参考</h2><p id="f9a0" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">如果你需要更多关于我们使用的工具的信息，你可以在下面的链接中找到</p><div class="mg mh ez fb mi mj"><a href="https://prometheus.io/" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab dw"><div class="ml ab mm cl cj mn"><h2 class="bd hj fi z dy mo ea eb mp ed ef hh bi translated">普罗米修斯监测系统和时间序列数据库</h2><div class="mq l"><h3 class="bd b fi z dy mo ea eb mp ed ef dx translated">利用领先的开源监控解决方案增强您的指标和警报能力。普罗米修斯作者2014-2021 |…</h3></div><div class="mr l"><p class="bd b fp z dy mo ea eb mp ed ef dx translated">普罗米修斯</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jj mj"/></div></div></a></div><div class="mg mh ez fb mi mj"><a href="https://grafana.com/" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab dw"><div class="ml ab mm cl cj mn"><h2 class="bd hj fi z dy mo ea eb mp ed ef hh bi translated">Grafana:开放观察平台</h2><div class="mq l"><h3 class="bd b fi z dy mo ea eb mp ed ef dx translated">Grafana是适用于所有数据库的开源分析和监控解决方案。</h3></div><div class="mr l"><p class="bd b fp z dy mo ea eb mp ed ef dx translated">grafana.com</p></div></div><div class="ms l"><div class="my l mu mv mw ms mx jj mj"/></div></div></a></div><blockquote class="mz na nb"><p id="c6bc" class="if ig la ih b ii ij ik il im in io ip nc ir is it nd iv iw ix ne iz ja jb jc hb bi translated">免责声明:这篇博客/文章中提到的观点是我自己的，并不反映我现在工作的组织或我以前工作的组织。</p></blockquote></div></div>    
</body>
</html>