<html>
<head>
<title>Spring Boot secrets encryption using Jasypt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jasypt的Spring Boot秘密加密</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/spring-boot-secrets-encryption-using-jasypt-63e542a12dec?source=collection_archive---------1-----------------------#2022-02-05">https://medium.com/javarevisited/spring-boot-secrets-encryption-using-jasypt-63e542a12dec?source=collection_archive---------1-----------------------#2022-02-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2022/01/spring-boot-reactjs-example-for-java.html"><div class="er es if"><img src="../Images/46cc63c2be0e5d275335b6d0e7d2abe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p9lI3_c8a9sJsqcPxKVX9Q.png"/></div></a><p class="im in et er es io ip bd b be z dx translated">Spring Boot秘密加密/解密使用Jasypt。</p></figure><p id="78f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">保护敏感数据非常重要，将应用程序相关的凭证和机密以纯文本形式存储在源代码存储库中始终是一个安全问题。</p><p id="b00d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇博客中，让我们看看如何使用<strong class="is hj"> Jasypt </strong>库加密Spring Boot应用程序配置文件(即application.properties或application.yml)的敏感信息，例如数据源的用户名和密码、SMTP服务器的用户凭证等。</p><p id="2a97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="http://www.jasypt.org/" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">jas ypt</strong></a><strong class="is hj"/>(Java简化加密)是一个Java库，它允许开发人员用最少的努力将基本的加密功能添加到他们的项目中，并且不需要深入了解加密是如何工作的。</p><h2 id="e52f" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">1.添加maven依赖项</h2><p id="082b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">为了理解用法，让我们创建一个基本的spring boot应用程序，并在下面添加对pom.xml的依赖关系</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5a54" class="jp jq hi ku b fi ky kz l la lb">&lt;dependency&gt;<br/>   &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;<br/>   &lt;artifactId&gt;jasypt-spring-boot-starter&lt;/artifactId&gt;<br/>   &lt;version&gt;3.0.4&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="b728" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lc">我们可以从像</em><a class="ae jo" href="https://www.devglan.com/online-tools/jasypt-online-encryption-decryption" rel="noopener ugc nofollow" target="_blank"><em class="lc">jas ypt-online-encryption-decryption</em></a><em class="lc">这样的在线工具中创建加密值，但是为了简单起见，我们将使用下面的maven插件并生成加密值。</em></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="6d56" class="jp jq hi ku b fi ky kz l la lb">&lt;plugin&gt;<br/>    &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;<br/>    &lt;artifactId&gt;jasypt-maven-plugin&lt;/artifactId&gt;<br/>    &lt;version&gt;3.0.4&lt;/version&gt;<br/>&lt;/plugin&gt;</span></pre><h2 id="9ec4" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated"><strong class="ak"> 2。让我们决定一个用于加密和解密的密钥</strong></h2><p id="9ea8" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">密钥用于加密密码，稍后可用于解密加密值以获得实际密码。您可以选择任何值作为密钥。</p><h2 id="cebb" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">3.生成加密值并运行应用程序</h2><p id="bd38" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们有三个值用户名、密码和令牌，我们将为它们创建加密值。</p><p id="c266" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行以下命令:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5c30" class="jp jq hi ku b fi ky kz l la lb">mvn jasypt:encrypt-value -Djasypt.encryptor.password=masterpassword -Djasypt.encryptor.algorithm=PBEWithMD5AndDES -Djasypt.plugin.value=myusername</span></pre><ul class=""><li id="c0d3" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated"><strong class="is hj">jas ypt . plugin . value</strong>:my username(要加密的实际凭证)</li><li id="f140" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><strong class="is hj">jas ypt . encryptor . password</strong>:主密码(您选择的密钥)</li><li id="570a" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><strong class="is hj">算法</strong> : PBEWithMD5AndDES(使用的算法)</li></ul><p id="bb02" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在该命令后看到，日志打印如下:<br/><em class="lc">ENC(wekfisbtevbdnsi 878s 6 lb/bucy 35 vvb)</em></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="2b92" class="jp jq hi ku b fi ky kz l la lb">[INFO] Started MavenCli in 0.954 seconds (JVM running for 2.84)<br/>[INFO] Active Profiles: Default<br/>[INFO] Encrypting value myusername<br/>[INFO] String Encryptor custom Bean not found with name 'jasyptStringEncryptor'. Initializing Default String Encryptor<br/>[INFO] Encryptor config not found for property jasypt.encryptor.key-obtention-iterations, using default value: 1000<br/>[INFO] Encryptor config not found for property jasypt.encryptor.pool-size, using default value: 1<br/>[INFO] Encryptor config not found for property jasypt.encryptor.provider-name, using default value: null<br/>[INFO] Encryptor config not found for property jasypt.encryptor.provider-class-name, using default value: null<br/>[INFO] Encryptor config not found for property jasypt.encryptor.salt-generator-classname, using default value: org.jasypt.salt.RandomSaltGenerator<br/>[INFO] Encryptor config not found for property jasypt.encryptor.string-output-type, using default value: base64<br/>[INFO] <br/>ENC(wEKFisBteVBDNsi878s6lB/bUCy35Vvb)<br/>[INFO] -------------------------------------------------------------<br/>[INFO] BUILD SUCCESS<br/>[INFO] -------------------------------------------------------------<br/>[INFO] Total time:  1.774 s<br/>[INFO] Finished at: 2022-02-05T14:08:24+05:30<br/>[INFO] -------------------------------------------------------------</span></pre><p id="3c06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们再次运行相同的命令，我们将看到一个不同的加密值，因为默认的加密器使用随机生成器。这意味着一个字符串可以是不同的加密值，尽管私钥是相同的</p><p id="4863" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">算法是双向的，也就是说你可以做解密。键入以下命令:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="9e97" class="jp jq hi ku b fi ky kz l la lb">mvn jasypt:decrypt-value -Djasypt.encryptor.password=masterpassword -Djasypt.plugin.value=wEKFisBteVBDNsi878s6lB/bUCy35Vvb</span></pre><p id="4d12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将在日志末尾获得实际值:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="432f" class="jp jq hi ku b fi ky kz l la lb">[INFO] Started MavenCli in 0.973 seconds (JVM running for 2.871)<br/>[INFO] Active Profiles: Default<br/>[INFO] Decrypting value wEKFisBteVBDNsi878s6lB/bUCy35Vvb<br/>[INFO] String Encryptor custom Bean not found with name 'jasyptStringEncryptor'. Initializing Default String Encryptor<br/>[INFO] Encryptor config not found for property jasypt.encryptor.key-obtention-iterations, using default value: 1000<br/>[INFO] Encryptor config not found for property jasypt.encryptor.pool-size, using default value: 1<br/>[INFO] Encryptor config not found for property jasypt.encryptor.provider-name, using default value: null<br/>[INFO] Encryptor config not found for property jasypt.encryptor.provider-class-name, using default value: null<br/>[INFO] Encryptor config not found for property jasypt.encryptor.salt-generator-classname, using default value: org.jasypt.salt.RandomSaltGenerator<br/>[INFO] Encryptor config not found for property jasypt.encryptor.string-output-type, using default value: base64<br/>[INFO] <br/>myusername<br/>[INFO] -------------------------------------------------------------<br/>[INFO] BUILD SUCCESS<br/>[INFO] -------------------------------------------------------------<br/>[INFO] Total time:  1.798 s<br/>[INFO] Finished at: 2022-02-05T14:12:54+05:30<br/>[INFO] -------------------------------------------------------------</span></pre><p id="64c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我已经使用上面的命令加密了所有三个值，并将它们添加到<em class="lc"> application.properties </em>文件中。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="735e" class="jp jq hi ku b fi ky kz l la lb">demo.props.username=myusername<br/>demo.props.password=password123<br/>demo.props.token=0cc63b93-da6c-4e7d-9529-0e3f8e8eae17</span></pre><p id="eb8d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">加密值到<em class="lc"> application.properties </em>文件如下:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="2282" class="jp jq hi ku b fi ky kz l la lb">demo.props.username=ENC(wEKFisBteVBDNsi878s6lB/bUCy35Vvb)<br/>demo.props.password=ENC(P10CoyaMe1gUAIk2y97H/x/IjjUs9zwI)<br/>demo.props.token=ENC(2sqTkT+GAWGqh3ImnoWNEmtyBRxgfXbm+k1Ls+vu72+aLUbNM4mLp21TkEuQgVG8)</span></pre><p id="0964" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们可以通过在命令提示符下提供主密钥密码作为运行参数来运行Spring Boot应用程序，如下所示:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="858d" class="jp jq hi ku b fi ky kz l la lb">mvn spring-boot:run -Dspring-boot.run.arguments=--jasypt.encryptor.password=masterpassword</span></pre><p id="cc92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者我们可以运行为</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="f046" class="jp jq hi ku b fi ky kz l la lb">java -Djasypt.encryptor.password=masterpassword -jar springboot-jasypt-demo-0.0.1-SNAPSHOT.jar</span></pre><p id="2bb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动日志:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="1a5f" class="jp jq hi ku b fi ky kz l la lb">2022-02-05 14:56:12.683  INFO 39975 --- [           main] c.u.j.EncryptablePropertySourceConverter : Converting PropertySource servletContextInitParams [org.springframework.web.context.support.ServletContextPropertySource] to EncryptableEnumerablePropertySourceWrapper<br/>2022-02-05 14:56:12.690  INFO 39975 --- [           main] c.p.j.example.JasyptDemoApplication      : Started JasyptDemoApplication in 1.465 seconds (JVM running for 1.767)</span></pre><p id="87d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我添加了一个<a class="ae jo" href="https://javarevisited.blogspot.com/2018/02/top-5-restful-web-services-with-spring-courses-for-experienced-java-programmers.html" rel="noopener ugc nofollow" target="_blank"> REST端点</a>来检查解密后的配置值。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="1e2f" class="jp jq hi ku b fi ky kz l la lb">$ curl http://localhost:8080/app-configs</span><span id="f12f" class="jp jq hi ku b fi lr kz l la lb">DemoConfigProperties[username='myusername', password='password123', token='0cc63b93-da6c-4e7d-9529-0e3f8e8eae17']</span></pre><h2 id="419f" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">4.在application.properties文件中生成<strong class="ak">加密凭证</strong></h2><p id="e31b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">在application.props文件本身中也有一个更简单的生成加密值的选项。</p><p id="1ba0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">只需将DEC()中的值包装起来，如下所示:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="e516" class="jp jq hi ku b fi ky kz l la lb">demo.props.username=DEC(myusername)<br/>demo.props.password=DEC(password123)<br/>demo.props.token=DEC(0cc63b93-da6c-4e7d-9529-0e3f8e8eae17)</span></pre><p id="ee6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并运行以下命令</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="34f0" class="jp jq hi ku b fi ky kz l la lb">mvn jasypt:encrypt -Djasypt.encryptor.password=masterpassword -Djasypt.encryptor.algorithm=PBEWithMD5AndDES</span></pre><p id="2965" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它将自动替换application.properties文件中的DEC()占位符，并用加密值填充:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="ede1" class="jp jq hi ku b fi ky kz l la lb">demo.props.username=ENC(cUWN0KrDJo2fcmW5y7Kx0uaPQFkLBFDt)<br/>demo.props.password=ENC(KFcroeSyayy0csUynGGyFiGfHqIye2oK)<br/>demo.props.token=ENC(iZqWOV/Wi8S5iW5WdT0MdY+otWdFVsYtCUeTszHE86yYXXxtUYgIZo6Lpk0AbqqT)</span></pre><p id="6bca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，通过命令行中的VM参数或IDE传递主密钥，如步骤3中所述。</p><p id="4ac0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我还建议编写测试用例来生成加密密钥并测试解密。</p><h2 id="1ec5" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">摘要</h2><p id="e784" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">因此，我们已经看到了如何利用jasypt lib并快速保护我们的凭证免受外部世界的攻击。我们还可以通过覆盖默认值来定制Jasypt Spring bean的属性。你可以从<a class="ae jo" href="https://github.com/ulisesbocchio/jasypt-spring-boot" rel="noopener ugc nofollow" target="_blank">这里</a>得到那些细节。</p><p id="5e45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我还在<a class="ae jo" href="https://github.com/PraveenGNair/spring-boot-jasypt-demo" rel="noopener ugc nofollow" target="_blank"> github repo </a>中推送了示例演示代码。</p><p id="68ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">快乐学习！！</p></div></div>    
</body>
</html>