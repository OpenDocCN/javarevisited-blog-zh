<html>
<head>
<title>Google API Credentials: Practical Guide to Automatic Refresh — in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google API证书:自动刷新实用指南Java语言</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/google-api-credentials-practical-guide-to-automatic-refresh-in-java-3b470bdd6535?source=collection_archive---------1-----------------------#2022-09-07">https://medium.com/javarevisited/google-api-credentials-practical-guide-to-automatic-refresh-in-java-3b470bdd6535?source=collection_archive---------1-----------------------#2022-09-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6e60" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">利用已经提供的GoogleCredentials类</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/64f398adca4ce3c0dbf196a5e1b8de9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cEQZ2Sx3ygfBPCKA"/></div></div><p class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://unsplash.com/@rubaitulazad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rubaitul Azad </a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="8f61" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">简介</strong></h2><p id="f217" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">仅举几个例子，Gmail API、Google Sheets API和Docs API都是需要从开发人员控制台生成凭证才能访问的Google APIs。在后台，这些凭据通常用于获取过期时间为1小时的身份验证令牌。</p><p id="3612" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">在本文中，我们将了解如何利用Google API的客户端——特别是处理自动访问令牌刷新的GoogleCredential类。记住这一点，让我们来看看我们将经历的一些事情:</p><ul class=""><li id="aec6" class="lk ll hi ko b kp lf ks lg jz lm kd ln kh lo le lp lq lr ls bi translated">在Google开发者控制台中创建凭证</li><li id="d158" class="lk ll hi ko b kp lt ks lu jz lv kd lw kh lx le lp lq lr ls bi translated">获取刷新令牌</li><li id="d94b" class="lk ll hi ko b kp lt ks lu jz lv kd lw kh lx le lp lq lr ls bi translated">为凭证准备一个<a class="ae jn" href="https://javarevisited.blogspot.com/2014/12/how-to-read-write-json-string-to-file.html" rel="noopener ugc nofollow" target="_blank"> JSON文件</a></li><li id="7819" class="lk ll hi ko b kp lt ks lu jz lv kd lw kh lx le lp lq lr ls bi translated">利用GoogleCredentials类进行自动刷新</li></ul></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="daa7" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">在Google开发者控制台中创建凭证</h2><p id="cee2" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">让我们前往<a class="ae jn" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/</a>——然后点击侧面导航上的<code class="du mf mg mh mi b">Credentials</code>:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/c333c1bd3cc4fe1af45dde740d0fe602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yibEi0vymSwCUJ2FT_Q5Xg.png"/></div></div></figure><p id="3caf" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">我们可以看到，这个帐户是新创建的；事实上，这是一个虚拟场景——让我们从一开始就模拟这个场景。首先，让我们使用页面左上角的<code class="du mf mg mh mi b">Create Project</code>按钮创建一个项目:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mk"><img src="../Images/51118ec95190cadcf487a4c5bdadce22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*nKZOeaUPPqYe_xcvx1IhIQ.png"/></div></figure><p id="c2fc" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">接下来，让我们创建一个<code class="du mf mg mh mi b">OAuth Client ID</code>凭证:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ml"><img src="../Images/43217d827fe9794aee36ccef5e942e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-UGo1O3PU2s5wpG0X9RBg.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/fde1ba364ebb7b1e017d20f9dcd3e70b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ruu8PtUjO45a4Q6gP0LrA.png"/></div></div></figure><p id="4149" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">看来我们必须先配置<code class="du mf mg mh mi b">OAuth consent screen</code>，所以让我们先这样做:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/38f6bccfcaa3f71983e6b49901d6e939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hD6v1lssmyZaXD1V49qW0A.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/179ea4eeecaaeef7f940a5a317f13118.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uk2G3oLWXZoqp8hcKcnYKw.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/8348d37af7aad90d516f5e1136f96115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PV3BCQDycWGndtGVgZ4KtA.png"/></div></div></figure><p id="8602" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">现在，让我们回到创建一个<code class="du mf mg mh mi b">OAuth Client ID</code>凭证:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/88c5f10d969a9ca7bab5f6a41c0383fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8SOsyLBL0M9vi8YQ3_oadg.png"/></div></div></figure><p id="17dc" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">现在，我们可以下载凭证作为<code class="du mf mg mh mi b">JSON file</code>或者复制<code class="du mf mg mh mi b">Client ID</code>和<code class="du mf mg mh mi b">Client Secret</code>:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/003bff0badd3b80eec342164557da969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ilHSIOXT6OK-iU_Z0zuVQw.png"/></div></div></figure></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="6e3e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">获得刷新令牌</strong></h2><p id="1a2b" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">给定我们的<code class="du mf mg mh mi b">client ID</code>和<code class="du mf mg mh mi b">Secret</code>，现在让我们尝试请求一个刷新令牌。虽然当然可以通过curl/postman请求来实现，但另一种直接的方法是使用Google的API客户端——让我们试试:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="3565" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">运行上述代码后，我们将在控制台上获得一个授权链接:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/9d2cd07b588c7653672d537e7b54e6c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ym0B3RLkfqqvXPQm-16DzQ.png"/></div></div></figure><p id="d817" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">让我们继续吧:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/e7b7a4954a2755d803679c5563e5929f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjKBjs68taF-g4XIVlCx5w.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/f17cd9f629e381b08c2fcb4186447169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hgt8VOplmpMr-V6A6-xoZw.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/3cea960efb02861792f659d310d09ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nY8-Xa2Re6O4RezV3Pb8zg.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/ffc9434be513cf7a6b69fdce7ed421bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhAJXnzcRaLWlgyV574qyQ.png"/></div></div></figure><p id="e4d8" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">现在，让我们再次检查我们的控制台，看看我们是否成功地打印出了刷新令牌——正如预期的那样，这就是:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/cd14a6cd33ccc7a86164fd9c437d2974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*msyRZr2nxS-jeHvIzG66zw.png"/></div></div></figure></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="77ce" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">为凭证准备JSON文件</strong></h2><p id="24c5" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">我们将利用GoogleCredentials类—我们需要它:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="ac36" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">正如我们所看到的，这个文件是不言自明的；所以是的，就是这样。让我们继续实现。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="b7a5" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">利用GoogleCredentials类进行自动刷新</h2><p id="bb71" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">其实现非常简单——就像创建一个JSON凭证文件的输入流，然后使用它创建一个GoogleCredentials对象一样简单。从那里，我们可以实例化一个HttpCredentialsAdapter，并将其用于我们选择的google服务。</p><p id="e52d" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">话虽如此——没有更多的东西，所以我们为什么不在一个实际的用例上尝试一下呢？也许，像用Gmail API发邮件让它更有趣。</p><p id="548c" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">首先，我们不要忘记从Google开发者控制台启用Gmail API:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/076fa261026068d19e2f68246f2b9af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gdg_S7PF9JySP003q4F-2w.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/8b872b3ad8bb489d3fdb5df19d88434e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUpOg1T4gmTlyRI4verztA.png"/></div></div></figure><p id="4c1f" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">接下来，让我们利用GoogleCredentials类，然后使用Gmail类的实例发送一封电子邮件:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="76d1" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">一切就绪后，让我们运行代码并检查我们的收件箱——酷！现在我们知道了:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/3d86a132106284c3e67552643d2ddfd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJty25kVL0iLedwLxZj-6A.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/7acf02acc9d0b28928fbc2c269daa7c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Ery4a2ZsnzIlN6jQWtV2w.png"/></div></div></figure><p id="344e" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">像往常一样，完整的源代码总是可以在<a class="ae jn" href="https://github.com/emyasa/medium-articles/tree/master/google-api" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div></div>    
</body>
</html>