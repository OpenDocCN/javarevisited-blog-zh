<html>
<head>
<title>Map vs. Multimap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地图与多地图</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/map-vs-multimap-6ea2b1b79de5?source=collection_archive---------0-----------------------#2022-04-19">https://medium.com/javarevisited/map-vs-multimap-6ea2b1b79de5?source=collection_archive---------0-----------------------#2022-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5982" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发现一种更安全的方法来代替在Java中将键映射到多个值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/97b376fe77b094cc17e2b5c37c29ce18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*alWmuy1Bnqx8qpve"/></div></div><p class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://unsplash.com/@mullyadii?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mulyadi </a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="6a7d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">我需要一个有多个值的地图</h1><p id="eeed" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在你用Java编码的几年中，你可能需要一个<code class="du kx ky kz la b">Map&lt;K, Collection&lt;V&gt;&gt;</code>。如果你还不需要，给它一些时间…你会需要的。从Java 8开始，有更方便的方法来管理<code class="du kx ky kz la b">Map</code>的<code class="du kx ky kz la b">Collection</code>部分。如果你以前没有用过<code class="du kx ky kz la b">computeIfAbsent</code>，这是一个非常值得学习的方法。下面是一个使用<code class="du kx ky kz la b">computeIfAbsent</code>创建<code class="du kx ky kz la b">Map&lt;String, List&lt;String&gt;&gt;</code>的例子。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/512710bc7194b61676f064711aaa492d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWmVL7u4TD_ljvX5XtQ99g.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">使用computeIfAbsent动态创建映射中的值<string list=""/></p></figure><p id="887a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kx ky kz la b">computeIfAbsent</code>的工作方式很简单。首先，它在映射中查找指定的键(例如“A”)。如果在键上没有找到值，它就评估指定的<code class="du kx ky kz la b">Function</code>，并将结果存储在<code class="du kx ky kz la b">Map</code>中。然后，它返回找到的值或者创建并存储在<code class="du kx ky kz la b">Map</code>中的值。所以基本上，<code class="du kx ky kz la b">computeIfAbsent</code>是一个带有<code class="du kx ky kz la b">put</code>的<code class="du kx ky kz la b">get</code>，其中<code class="du kx ky kz la b">put</code>到<code class="du kx ky kz la b">Map</code>的值由方法返回。这种方法将保证对于任何被查找的键总是存在一个值，但是作为<code class="du kx ky kz la b">get</code>的替代可能是浪费的，因为在你查找一个不存在的键的情况下，它将总是导致一个<code class="du kx ky kz la b">put</code>。</p><h1 id="65ab" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">地图有空问题</h1><p id="689a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">使用<code class="du kx ky kz la b">Map</code>的一个问题是像<code class="du kx ky kz la b">HashMap</code>这样的实现允许<code class="du kx ky kz la b">null</code>键、值和返回值。如果我们暂时忽略空键，那么<code class="du kx ky kz la b">null</code>值和返回的问题是，如果你在<code class="du kx ky kz la b">Map</code>中查找一个不存在的键，你将得到一个<code class="du kx ky kz la b">null</code>返回。您可以尝试保护您的代码，防止在调用<code class="du kx ky kz la b">get</code>时检查到<code class="du kx ky kz la b">Map</code>返回null，或者使用更安全的方法，如<code class="du kx ky kz la b">getOrDefault</code>，在多值<code class="du kx ky kz la b">Map</code>的默认情况下，它可能返回一个空集合。真正的解决方案是创建一个<code class="du kx ky kz la b">Map</code>类型，它知道当调用<code class="du kx ky kz la b">get</code>时，一个丢失的键将导致一个空的<code class="du kx ky kz la b">Collection</code>被返回。这就是a <code class="du kx ky kz la b">Multimap</code>的作用。</p><h1 id="4cda" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">不要拿多值地图开玩笑</h1><p id="e6b0" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">如果你需要多值的<code class="du kx ky kz la b">Map</code>支持，那么考虑使用来自库的<code class="du kx ky kz la b">Multimap</code>类型，比如<a class="ae jt" href="https://github.com/donraab/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> Eclipse Collections </a>、<a class="ae jt" href="https://github.com/google/guava" rel="noopener ugc nofollow" target="_blank"> Google Guava </a>或<a class="ae jt" href="https://commons.apache.org/proper/commons-collections/" rel="noopener ugc nofollow" target="_blank">Apache Commons Collections</a>。<code class="du kx ky kz la b">Multimap</code>上的方法<code class="du kx ky kz la b">put</code>将知道值是多值的，并且应该自动调用值容器上的<code class="du kx ky kz la b">add</code>。<code class="du kx ky kz la b">Multimap</code>上的方法<code class="du kx ky kz la b">get</code>知道什么时候一个键不包含在<code class="du kx ky kz la b">Multimap</code>中，应该返回一个空的<code class="du kx ky kz la b">Collection</code>。重点是a <code class="du kx ky kz la b">Multimap</code>对它管理的值类型有更深入的了解。可以通过泛型向<code class="du kx ky kz la b">Map</code>提供值类型，但是它不知道值类型必须是<code class="du kx ky kz la b">Collection</code>的类型。</p><h1 id="efef" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">在Eclipse集合中使用多重映射</h1><p id="8038" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">下面的代码使用来自<a class="ae jt" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> Eclipse Collections </a>的<code class="du kx ky kz la b">Multimap</code>类型展示了上面地图代码的等价解决方案。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/b1c41b1f6c1553b512fad30e2fdac351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FqODyL9AFyFj4yXkM55bOg.png"/></div></div></figure><p id="8bfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我创建了一个特定类型的<code class="du kx ky kz la b">Multimap</code>，在本例中是一个<code class="du kx ky kz la b">MutableListMultimap</code>。然后我可以简单地用每个键和值调用put。<code class="du kx ky kz la b">Multimap</code>知道为每个新键创建一个后备<code class="du kx ky kz la b">Collection</code>容器(在本例中是一个<code class="du kx ky kz la b">MutableList</code>)。最后，对<code class="du kx ky kz la b">multimap.get(“D”) </code>的调用返回空的<code class="du kx ky kz la b">List</code>。这个<code class="du kx ky kz la b">List</code>没有存储在<code class="du kx ky kz la b">Multimap</code>中，所以Multimap将保持稀疏，只包含具有实际值的键。</p><h1 id="65f4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Eclipse集合中的多映射类型</h1><p id="5a38" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Eclipse集合中有几种具体的多映射类型。有<code class="du kx ky kz la b">Readable</code>、<code class="du kx ky kz la b">Mutable</code>和<code class="du kx ky kz la b">Immutable</code>接口。<code class="du kx ky kz la b">Multimap</code>是父接口。<code class="du kx ky kz la b">MutableListMultimap</code>是一个叶子接口。以下是可通过使用<code class="du kx ky kz la b">Multimaps</code>工厂创建的基本具体<code class="du kx ky kz la b">Multimap</code>类型的示例。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ld"><img src="../Images/1f9464a51221303d721f71d20f814447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4fsXwJS9syQ19gl2aQxpw.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">通过Eclipse集合中的多映射工厂创建多映射类型</p></figure><p id="689d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<code class="du kx ky kz la b">Multimap</code>，根据值容器有具体的类型(如<code class="du kx ky kz la b">List</code>、<code class="du kx ky kz la b">Set</code>、<code class="du kx ky kz la b">Bag</code>)。对于这些类型，可能存在专门化和优化。</p><h1 id="c321" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">GroupBy应该返回一个Multimap</h1><p id="e40a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Eclipse Collections是目前我所知道的唯一一个Java库，它从每个基本的<code class="du kx ky kz la b">Collection</code>类型的<code class="du kx ky kz la b">groupBy</code>方法中返回一个<code class="du kx ky kz la b">Multimap</code>。每个特定的类型，如<code class="du kx ky kz la b">MutableList</code>或<code class="du kx ky kz la b">MutableSet</code>，将根据其类型在其<code class="du kx ky kz la b">groupBy</code>方法中返回适当的<code class="du kx ky kz la b">Multimap</code>类型。<code class="du kx ky kz la b">MutableList</code>从其<code class="du kx ky kz la b">groupBy</code>方法中返回一个<code class="du kx ky kz la b">MutableListMultimap</code>，<code class="du kx ky kz la b">MutableSet</code>返回一个<code class="du kx ky kz la b">MutableSetMultimap</code>。下面是一个在Eclipse集合中使用<code class="du kx ky kz la b">groupBy</code>的例子。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/f2c2a90c172aa6b84d533728196da4d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QlTTxirN-kRY8D4TCh0lWg.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">在Eclipse集合中对可变列表使用groupBy会返回一个可变列表多映射</p></figure><p id="1062" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多<code class="du kx ky kz la b">groupBy</code>的例子，可以参考下面的博客。</p><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/oracledevs/ec-by-example-groupby-7ca219358c3b"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">EC by示例:GroupBy</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">了解如何使用Eclipse集合对集合的元素进行分组。</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw jn li"/></div></div></a></div><h1 id="d886" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">关于Eclipse集合Multimap的更多信息</h1><p id="24cb" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">几年前，Nikhil Nanivadekar写了一篇关于Eclipse集合中多地图的博客。他对实现做了更深入的解释。</p><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/oracledevs/multimap-how-it-works-a3430f549d35"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">多地图——工作原理</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">在我以前的博客中，我解释了Eclipse集合UnifiedMap和UnifiedSet是如何工作的。在这个博客中，我们将采取…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="lz l lt lu lv lr lw jn li"/></div></div></a></div><h1 id="b9a7" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">摘要</h1><p id="b62d" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">您需要一个支持键和多值的映射吗？考虑使用Eclipse集合中的<code class="du kx ky kz la b">Multimap</code>。如果您已经在使用Eclipse集合中的其他<code class="du kx ky kz la b">Collection</code>类型，那么<code class="du kx ky kz la b">groupBy</code>方法将让您轻松地创建合适的<code class="du kx ky kz la b">Multimap</code>类型。</p><p id="3348" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ma">我是</em><a class="ae jt" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"><em class="ma">Eclipse Collections</em></a><em class="ma">OSS项目在</em><a class="ae jt" href="https://projects.eclipse.org/projects/technology.collections" rel="noopener ugc nofollow" target="_blank"><em class="ma">Eclipse Foundation</em></a><em class="ma">的项目负责人。</em> <a class="ae jt" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> <em class="ma">月食收藏</em> </a> <em class="ma">是开投</em> <a class="ae jt" href="https://github.com/eclipse/eclipse-collections/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank"> <em class="ma">投稿</em> </a> <em class="ma">。如果你喜欢这个库，你可以在GitHub上让我们知道。</em></p><h2 id="46f6" class="mb jv hi bd jw mc md me ka mf mg mh ke iq mi mj ki iu mk ml km iy mm mn kq mo bi translated">您可能喜欢的其他Java文章</h2><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/javarevisited/the-java-programmer-roadmap-f9db163ef2c2"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">2022年Java程序员路线图</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">2022年成为Java开发人员的图解指南，包含相关课程的链接</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="mp l lt lu lv lr lw jn li"/></div></div></a></div><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/javarevisited/20-essential-java-libraries-and-apis-every-programmer-should-learn-5ccd41812fc7"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">2022年每个程序员都应该学习的前22个Java库和API</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">成为更好的Java开发人员可以学习的最基本的Java库。它包括用于日志记录的Java库…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="mq l lt lu lv lr lw jn li"/></div></div></a></div><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/javarevisited/21-spring-mvc-rest-interview-questions-answers-for-beginners-and-experienced-developers-21ad3d4c9b82"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">10大春季MVC + REST面试问题解答适合初学者和有经验的开发者</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">大家好。如果你正在准备Java和Spring面试或Spring认证，并经常寻找一些…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="mr l lt lu lv lr lw jn li"/></div></div></a></div></div></div>    
</body>
</html>