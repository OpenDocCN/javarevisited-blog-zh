<html>
<head>
<title>Create Music Bingo cards with iText</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用iText创建音乐宾果卡</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/create-music-bingo-cards-with-itext-37394e4453e4?source=collection_archive---------3-----------------------#2022-05-30">https://medium.com/javarevisited/create-music-bingo-cards-with-itext-37394e4453e4?source=collection_archive---------3-----------------------#2022-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f889" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自从我上次不得不在程序中创建文档已经有一段时间了，现在我已经“在我的雷达上”尝试了一段时间。这个周末我们举行了一次聚会，想组织一次音乐宾果游戏。为此，我们需要为每个人打印出一组随机选择的歌曲。一个小的Java项目似乎是最好的解决方案，否则，这将是一个无聊的、手工的、重复的任务。这不正是我们大部分发展的目标吗？<strong class="ih hj">“把无聊的东西自动化！”</strong></p><h1 id="5f5c" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">关于iText</h1><p id="d351" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">iText是一个用于在Java和。NET，最初由Bruno Lowagie编写。这个项目的历史和<a class="ae jd" href="https://itextpdf.com/en" rel="noopener ugc nofollow" target="_blank">由此发展而来的公司</a>，在《企业家》这本书<a class="ae jd" href="https://entreprenerd.lowagie.com/" rel="noopener ugc nofollow" target="_blank"/>中有描述。这本书解释了当你创办一家公司来产生进一步发展和维护你的技术所必需的资源时，你可以期待什么。</p><p id="617c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">iText 可以在开源(AGPL)和商业许可下获得。由于布鲁诺是比利时人，而且该公司在比利时仍有一个坚实的基础，我不得不承认这里也涉及到一些爱国主义。</p><h1 id="5190" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">项目的目标</h1><p id="7c35" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我们请我们的客人给我们他们最喜欢的两首歌。我们添加了一些额外的“派对歌曲”，最终在Spotify的播放列表中列出了70多首歌曲。每个播放器得到一个16首歌曲的打印输出，当然，这个值可以在代码中配置。</p><p id="ba33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每份打印出来的文件都有玩家的名字，并包含玩家选择的歌曲。卡片上写满了其他随机的歌曲，所以每个玩家都有不同的卡片。</p><div class="kh ki kj kk fd ab cb"><figure class="kl km kn ko kp kq kr paragraph-image"><a href="https://javarevisited.blogspot.com/2020/04/how-to-create-pdf-file-in-java-itext.html"><img src="../Images/8bc267944d366e442c1b68e2cf0e91de.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*plmqGzrT5LlCfRFXSHBeug.png"/></a></figure><figure class="kl km ku ko kp kq kr paragraph-image"><a href="https://www.java67.com/2018/04/10-tools-java-developers-should-learn.html"><img src="../Images/ba2e45912b2102b2ad654e64de5495ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*GkYBuq4euHSWDKrgxaKX-g.png"/></a><p class="kv kw et er es kx ky bd b be z dx kz di la lb translated">宾果卡示例</p></figure></div><p id="57da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">游戏的第一个目标是有一条完整的水平线，在我们有了三个赢家之后，我们转而拥有一张完整的宾果卡。一些歌曲只播放了10-15秒，其他的需要更多的时间，因为有些舞蹈和歌唱需要参与。最后一部分，我想向我们的邻居道歉…</p><h1 id="42f0" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">从Spotify导出</h1><p id="9448" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">播放列表不能从Spotify本身导出。有一个“Spotify Web API”可以用于此(见<a class="ae jd" href="https://developer.spotify.com/documentation/web-api/libraries/" rel="noopener ugc nofollow" target="_blank">Spotify开发者文档</a>)。我在这里走了一条捷径，使用了<a class="ae jd" href="https://github.com/watsonbox/exportify" rel="noopener ugc nofollow" target="_blank"> Exportify </a>，它实际上是建立在API之上的。它向您显示您所有的播放列表，并且只需点击一个按钮就可以将其导出到<a class="ae jd" href="https://www.java67.com/2019/05/how-to-read-csv-file-in-java-using-jackson-library.html" rel="noopener ugc nofollow" target="_blank"> CSV </a>。</p><figure class="kh ki kj kk fd km er es paragraph-image"><a href="https://javarevisited.blogspot.com/2015/06/2-ways-to-parse-csv-files-in-java-example.html"><div class="er es lc"><img src="../Images/062a3fc07f6144db5164f999b93d5d40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GEpDmIsuUiVqWMjA.png"/></div></a></figure><p id="0932" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导出的文件包含很多信息，但我们只需要三列Bingo卡，所以在电子表格编辑器中打开文件，删除不需要的列，并添加一列带有选择歌曲的人的名字的列，这样您最终会得到:</p><ul class=""><li id="0201" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">歌曲名称</li><li id="76c9" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">艺术家</li><li id="11b1" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">选择歌曲的人的姓名(可以为空)</li></ul><p id="b43e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:</p><pre class="kh ki kj kk fd lr ls lt lu aw lv bi"><span id="4533" class="lw jf hi ls b fi lx ly l lz ma">The Greatest Show,Hugh Jackman - The Greatest Showman Ensemble,Vik<br/>Rode rozen in de sneeuw,Marva,Omer <br/>Macarena,Los Del Rio,</span></pre><h1 id="1b58" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">源代码</h1><p id="4c5b" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">最后一个项目是一个非常简单的Java Maven程序。这些资源可以在<a class="ae jd" href="https://github.com/FDelporte/SpotifyBingoCardGenerator" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><h1 id="a2c2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">数据模型</h1><p id="c82d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">由于这个项目是基于Java 17的，我们可以对导入的歌曲使用<a class="ae jd" href="https://www.java67.com/2021/08/how-to-use-record-in-java-example.html" rel="noopener ugc nofollow" target="_blank">记录</a></p><pre class="kh ki kj kk fd lr ls lt lu aw lv bi"><span id="4626" class="lw jf hi ls b fi lx ly l lz ma">public record ImportedSong (String title, String artist, String selectedBy) {</span><span id="2701" class="lw jf hi ls b fi mb ly l lz ma">}</span></pre><p id="78a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以及为每人生成的带有歌曲列表的宾果卡</p><pre class="kh ki kj kk fd lr ls lt lu aw lv bi"><span id="d59a" class="lw jf hi ls b fi lx ly l lz ma">import java.util.List;</span><span id="37f2" class="lw jf hi ls b fi mb ly l lz ma">public record BingoCard(String forName, List&lt;ImportedSong&gt; songs) {</span><span id="3314" class="lw jf hi ls b fi mb ly l lz ma">}</span></pre><h1 id="62d4" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">读取CSV文件</h1><p id="0411" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">使用文件阅读器从CSV文件中逐行读取歌曲列表<a class="ae jd" href="https://www.java67.com/2015/08/how-to-load-data-from-csv-file-in-java.html" rel="noopener ugc nofollow" target="_blank"/></p><pre class="kh ki kj kk fd lr ls lt lu aw lv bi"><span id="d218" class="lw jf hi ls b fi lx ly l lz ma">public static List&lt;ImportedSong&gt; loadFromFile(String fileName) {<br/>   List&lt;ImportedSong&gt; list = new ArrayList&lt;&gt;();<br/><br/>   ClassLoader classLoader = SongLoader.class.getClassLoader();<br/>   URL resource = classLoader.getResource(fileName);<br/>   if (resource == null) {<br/>      throw new IllegalArgumentException("File " + fileName <br/>         + " not found!");<br/>   }<br/><br/>   try {<br/>      File f = new File(resource.getFile());<br/>      try (BufferedReader b = new BufferedReader(new FileReader(f,<br/>         StandardCharsets.<em class="mc">UTF_8</em>))) {<br/>         String line;<br/>         while ((line = b.readLine()) != null) {<br/>            var song = <em class="mc">processLine</em>(line);<br/>            if (song != null) {<br/>               list.add(song);<br/>               <em class="mc">logger</em>.info("Added {}", song);<br/>            }<br/>         }<br/>      }<br/>   } catch (Exception ex) {<br/>      <em class="mc">logger</em>.error("Error while importing song list: {}", <br/>         ex.getMessage());<br/>   }<br/>   return list;<br/>}</span><span id="fade" class="lw jf hi ls b fi mb ly l lz ma">private static ImportedSong processLine(String data) {<br/>   if (data == null || data.isEmpty()) {<br/>      <em class="mc">logger</em>.warn("Data is empty");<br/>      return null;<br/>   }<br/>   String[] csvLine = data.split(",");<br/>   return new ImportedSong(csvLine[0], csvLine[1], <br/>      csvLine.length &gt;= 3 ? csvLine[2] : "");<br/>}</span></pre><h1 id="fda0" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">为每个用户随机生成一张卡片</h1><p id="c089" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这些卡片是由</p><ul class=""><li id="ff74" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">获取玩家姓名列表(不同于<a class="ae jd" href="https://www.java67.com/2019/05/how-to-read-csv-file-in-java-using-jackson-library.html" rel="noopener ugc nofollow" target="_blank"> CSV </a>第3列的值)</li><li id="777f" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">为每个人生成16首歌曲的列表</li><li id="91f3" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">首先，人们选择的那些</li><li id="c953" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">添加一首不在列表中的歌曲，直到达到16首</li><li id="bd3e" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated"><a class="ae jd" href="https://javarevisited.blogspot.com/2021/05/3-examples-to-generate-random-alphanumeric-string-in-java0.html" rel="noopener ugc nofollow" target="_blank">用<code class="du md me mf ls b">Collections.shuffle(songsForPerson);</code>随机化</a>列表的顺序</li></ul><h1 id="748c" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建PDF</h1><p id="7c47" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">最后一步，为每个用户生成一个PDF页面。通过使用iText和我在Lars Vogel的这篇文章中找到的示例代码，这是一个非常快速简单的步骤。</p><p id="8fab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">依赖项被添加到pom.xml文件中</p><pre class="kh ki kj kk fd lr ls lt lu aw lv bi"><span id="056c" class="lw jf hi ls b fi lx ly l lz ma">&lt;dependency&gt;<br/>    &lt;groupId&gt;com.itextpdf&lt;/groupId&gt;<br/>    &lt;artifactId&gt;itextpdf&lt;/artifactId&gt;<br/>    &lt;version&gt;${itext.version}&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="fea9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际的代码非常容易阅读和理解:</p><pre class="kh ki kj kk fd lr ls lt lu aw lv bi"><span id="3d38" class="lw jf hi ls b fi lx ly l lz ma">public static void createPdfWithBingoCards(List&lt;BingoCard&gt; cards) {<br/>    try {<br/>        var desktop = System.<em class="mc">getProperty</em>("user.home") + "/Desktop";<br/>        var pdfFile = Paths.<em class="mc">get</em>(desktop, "bingo_" + <br/>            System.<em class="mc">currentTimeMillis</em>() + ".pdf").toFile();<br/>        Document document = new Document();<br/>        PdfWriter.<em class="mc">getInstance</em>(document, <br/>            new FileOutputStream(pdfFile));<br/>        document.open();<br/>        for (BingoCard card : cards) {<br/>            <em class="mc">addBingoCard</em>(document, card);<br/>        }<br/>        document.close();<br/>    } catch (Exception e) {<br/>        e.printStackTrace();<br/>    }<br/>}<br/><br/>private static void addBingoCard(Document document, BingoCard bingoCard) throws DocumentException {<br/>    // Start a new page<br/>    document.newPage();<br/><br/>    Paragraph paragraph = new Paragraph();<br/>    paragraph.setAlignment(Element.<em class="mc">ALIGN_CENTER</em>);<br/><br/>    // We add one empty line<br/>    <em class="mc">addEmptyLine</em>(paragraph, 1);<br/><br/>    // Name of the person for this card<br/>    var personName =new Paragraph(bingoCard.forName(), <em class="mc">FONT_TITLE</em>);<br/>    personName.setAlignment(Element.<em class="mc">ALIGN_CENTER</em>);<br/>    paragraph.add(personName);<br/><br/>    // We add two empty lines<br/>    <em class="mc">addEmptyLine</em>(paragraph, 2);<br/><br/>    // Add a table with the songs<br/>    PdfPTable table = new PdfPTable(<em class="mc">NUMBER_OF_COLUMNS</em>);<br/><br/>    for (ImportedSong song : bingoCard.songs()) {<br/>        PdfPCell tableCell = new PdfPCell(new Phrase(song.title()<br/>                + System.<em class="mc">lineSeparator</em>()<br/>                + System.<em class="mc">lineSeparator</em>()<br/>                + song.artist()<br/>                + System.<em class="mc">lineSeparator</em>()<br/>                + System.<em class="mc">lineSeparator</em>()<br/>                + (song.selectedBy().equals(bingoCard.forName()) ?<br/>                     "" : song.selectedBy()), <em class="mc">FONT_SMALL</em>));<br/>        tableCell.setHorizontalAlignment(Element.<em class="mc">ALIGN_CENTER</em>);<br/>        tableCell.setVerticalAlignment(Element.<em class="mc">ALIGN_TOP</em>);<br/>        tableCell.setMinimumHeight(120);<br/>        if (song.selectedBy().equals(bingoCard.forName())) {<br/>            tableCell.setBackgroundColor(BaseColor.<em class="mc">LIGHT_GRAY</em>);<br/>        }<br/>        table.addCell(tableCell);<br/>    }<br/><br/>    paragraph.add(table);<br/><br/>    // Add paragraph to document<br/>    document.add(paragraph);<br/>}<br/><br/>private static void addEmptyLine(Paragraph paragraph, int number) {<br/>    for (int i = 0; i &lt; number; i++) {<br/>        paragraph.add(new Paragraph(" "));<br/>    }<br/>}</span></pre><h1 id="a8bd" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">结论</h1><p id="e7e1" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这是生产就绪代码吗？不，当然不是，没有单元测试；-)</p><p id="4bf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但它证明iText非常容易理解，开源版本允许你快速创建一个自定义布局的PDF。使用<code class="du md me mf ls b">PdfPTable</code>方法，您可以创建一个非常基本的网格布局，其中包含您想要包含在文档中的任何文本信息。</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="3a28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mc">原载于</em><a class="ae jd" href="https://webtechie.be/post/2022-05-30-pdf-bingo-card-with-itext/" rel="noopener ugc nofollow" target="_blank"><em class="mc">https://web techie . be</em></a><em class="mc">。</em></p></div></div>    
</body>
</html>