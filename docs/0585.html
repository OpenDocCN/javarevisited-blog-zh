<html>
<head>
<title>A Spring REST and H2 database application on the Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring REST和H2数据库在树莓Pi上的应用</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/a-spring-rest-and-h2-database-application-on-the-raspberry-pi-8e4587d57c4f?source=collection_archive---------2-----------------------#2020-07-14">https://medium.com/javarevisited/a-spring-rest-and-h2-database-application-on-the-raspberry-pi-8e4587d57c4f?source=collection_archive---------2-----------------------#2020-07-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="f964" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">树莓派上的Java</h1><p id="6425" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Raspberry Pi名称中的“Pi”指的是Python，但是作为一名Java开发人员，我喜欢了解和试验我在工作中使用的各种Java框架。Spring是主要的一个，我想开发一个概念验证的应用程序，它提供REST API，通过Raspberry Pi上的数据库后端来存储和检索传感器数据。</p><p id="3182" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这是从我的书<a class="ae kg" href="https://webtechie.be/books" rel="noopener ugc nofollow" target="_blank">“Raspberry Pi上的Java入门”</a>中摘录的一个示例应用程序，在这本书中，你可以找到更多关于Java、Raspberry Pi、<a class="ae kg" href="https://pi4j.com" rel="noopener ugc nofollow" target="_blank"> Pi4J </a> …</p><div class="kh ki kj kk fd ab cb"><figure class="kl km kn ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/4fc8a9c5cf715f4cba8cfbe46a30754e.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*DDlTB6fnZoGagA-sl_cEVA.jpeg"/></div></figure><figure class="kl km ky ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/efdac2f27a8819f024705e132caab45d.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*MCc9xcydt97Rp6f6tcNMAw.png"/></div></figure><figure class="kl km kz ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/5da680670454517ade6e904e0111cafd.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*XQCIydA9UtEjgSuxdM4sIA.png"/></div><p class="la lb et er es lc ld bd b be z dx le di lf lg translated">书中的几个例子<a class="ae kg" href="https://webtechie.be/books" rel="noopener ugc nofollow" target="_blank">“Raspberry Pi上的Java入门”</a></p></figure></div><h1 id="eca1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">代码</h1><p id="9c1b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这个应用程序的源代码可以在GitHub JavaOnRaspberryPi资源库中找到，这个资源库包含了所有的例子、链接、方案等等。从我的书里。</p><p id="566c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我们将使用的<a class="ae kg" href="https://www.h2database.com" rel="noopener ugc nofollow" target="_blank"> H2数据库</a>是一个完整的Java解决方案，它不需要任何额外的安装，但完全是应用程序本身的一部分。</p><p id="60c2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">有很多“讨论”是应该将H2仅用于测试还是可以用于生产。近年来，它已经发展成为一个非常稳定的数据库解决方案，在我看来，这是嵌入式项目的一个非常好的选择。</p><p id="c662" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><a class="ae kg" href="https://en.wikipedia.org/wiki/Jakarta_Persistence" rel="noopener ugc nofollow" target="_blank"> JPA是用于与数据库“通信”的持久性规范</a>。它帮助您定义哪些对象(实体)可以存储在数据库的哪些结构(表)中。</p><h1 id="11fc" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">弹簧初始化r</h1><p id="9ced" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">多亏了Spring Initializr网站，我们可以很容易地开始一个Spring Boot项目。为最新的Java应用程序选择所有选项并添加</p><ul class=""><li id="3f5d" class="lh li hi jf b jg kb jk kc jo lj js lk jw ll ka lm ln lo lp bi translated">弹簧网</li><li id="f21d" class="lh li hi jf b jg lq jk lr jo ls js lt jw lu ka lm ln lo lp bi translated">春季数据JPA</li><li id="1adf" class="lh li hi jf b jg lq jk lr jo ls js lt jw lu ka lm ln lo lp bi translated">Rest存储库</li><li id="2ad3" class="lh li hi jf b jg lq jk lr jo ls js lt jw lu ka lm ln lo lp bi translated">H2数据库</li></ul><p id="9eef" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这将为您创建一个ZIP下载，其中包含一个完整的Maven项目，您可以在IDE中打开并进一步扩展。</p><figure class="kh ki kj kk fd km er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lv"><img src="../Images/26dfea990f50a2ba746764135e6626a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tAHtfreGj-avlNA0Jl_NsA.png"/></div></div></figure><h1 id="0b1c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">创建数据库实体</h1><p id="a7b2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">JPA的主要优势是我们可以用代码定义数据库结构。我们不需要创建和定义表；代码会处理好这个问题。</p><p id="f927" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这是我们希望在示例中使用的模型:</p><ul class=""><li id="ebe8" class="lh li hi jf b jg kb jk kc jo lj js lk jw ll ka lm ln lo lp bi translated">传感器</li><li id="0728" class="lh li hi jf b jg lq jk lr jo ls js lt jw lu ka lm ln lo lp bi translated">每个传感器的测量次数不受限制</li></ul><p id="b1ac" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在图表中是这样的:</p><figure class="kh ki kj kk fd km er es paragraph-image"><div class="er es lw"><img src="../Images/7d5f639801a12166f50bccdee1bc8c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/0*NtodzlNpMx5i0kAP.jpg"/></div></figure><p id="1683" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这可以通过在一个包(目录)“entity”中向我们的项目添加两个类来实现。首先，我们为传感器创建一个名为“SensorEntity.java”的文件。正如你所看到的，这段代码包含了很多“注释”(以@)来帮助框架将代码映射到数据库。</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="e6c5" class="mc ig hi ly b fi md me l mf mg">/**<br/> * Maps a database entity from the table SENSORS to a Java object.<br/> * The ID is marked as the unique identifier.<br/> */<br/>@Entity<br/>@Table(name = "SENSORS", <br/>    uniqueConstraints={@UniqueConstraint(<br/>        name="UN_SENSOR_ID", <br/>        columnNames={"ID"})})<br/>public class SensorEntity {<br/>    /**<br/>     * Auto-generated identifier to have a unique key for<br/>     * this sensor.<br/>     */<br/>    @Id<br/>    @GeneratedValue<br/>    private Long id;<br/><br/>    /**<br/>     * Name of the sensor, a required value.<br/>     */<br/>    @Column(nullable = false)<br/>    private String name;<br/><br/>    /**<br/>     * Relationship between the sensor and a list of measurements.<br/>     */<br/>    @OneToMany(<br/>            mappedBy = "sensorEntity",<br/>            cascade = {CascadeType.MERGE},<br/>            fetch = FetchType.LAZY<br/>    )<br/>    private Set&lt;MeasurementEntity&gt; measurements = new HashSet&lt;&gt;();<br/><br/>    ...<br/>}</span></pre><p id="025d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">同样，我们添加一个类“MeasurementEntity.java”</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="d6b9" class="mc ig hi ly b fi md me l mf mg">/**<br/> * Maps a database entity from the table MEASUREMENTS to a Java<br/> * object. The ID is marked as the unique identifier.<br/> */<br/>@Entity<br/>@Table(name = "MEASUREMENTS", <br/>    uniqueConstraints={@UniqueConstraint(<br/>        name="UN_MEASUREMENT_ID", <br/>        columnNames={"ID"})})<br/>public class MeasurementEntity {<br/><br/>    /**<br/>     * Auto-generated identifier to have a unique key for <br/>     * this sensor.<br/>     */<br/>    @Id<br/>    @GeneratedValue<br/>    private Long id;<br/><br/>    /**<br/>     * Relationship between the measurement and its sensor.<br/>     */<br/>    @ManyToOne<br/>    @JoinColumn(<br/>        name = "SENSOR_ID", <br/>        nullable = false, <br/>        foreignKey = @ForeignKey(name="FK_MEASUREMENT_SENSOR"))<br/>    private SensorEntity sensorEntity;<br/><br/>    /**<br/>     * Timestamp of the measurement.<br/>     */<br/>    @Column(nullable = false)<br/>    private long timestamp;<br/><br/>    /**<br/>     * Key for the type of measurement, e.g. "temperature", <br/>     * "distance"...<br/>     */<br/>    @Column(nullable = false)<br/>    private String key;<br/><br/>    /**<br/>     * Value of the measurement<br/>     */<br/>    @Column(nullable = false)<br/>    private double value;<br/><br/>    ...<br/>}</span></pre><p id="fb6c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这两个类是我们定义数据库表和数据存储方式所需要的！</p><h1 id="353c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">在数据库中存储数据</h1><p id="aa56" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将用两个存储库类和最少的代码做到这一点！让我们从传感器开始，创建一个包“repository”和一个文件“SensorRepository.java”。通过扩展“JpaRepository ”,我们可以免费获得大多数CRUD功能(创建、读取、更新和删除),并且只需要定义我们需要的额外方法。通过使用与实体中的值相同的参数名，Spring将为我们处理功能！</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="460d" class="mc ig hi ly b fi md me l mf mg">@Repository<br/>public interface SensorRepository extends   <br/>       JpaRepository&lt;SensorEntity, Long&gt; {<br/>    Page&lt;SensorEntity&gt; findAll(Pageable pageable);<br/><br/>    List&lt;SensorEntity&gt; findAllByName(String name);<br/><br/>    SensorEntity findById(@Param("id") long id);<br/>}</span></pre><p id="a43f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">“MeasurementRepository.java”甚至更小:</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="3652" class="mc ig hi ly b fi md me l mf mg">@Repository<br/>public interface MeasurementRepository extends <br/>    JpaRepository&lt;MeasurementEntity, Long&gt;{<br/>    Page&lt;MeasurementEntity&gt; findAll(Pageable pageable);<br/>}</span></pre><h1 id="56f3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">添加其他服务</h1><p id="94da" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在让我们用REST-services来公开我们的数据库功能，这样任何人都可以从数据库中读取数据和向数据库中写入数据！</p><p id="4735" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">创建包“resource”和文件“SensorResource.java”。在这里，我们定义了URL上可用的三个服务:</p><ul class=""><li id="2dd3" class="lh li hi jf b jg kb jk kc jo lj js lk jw ll ka lm ln lo lp bi translated">从数据库中获取localhost:8080/sensor:所有传感器</li><li id="5e24" class="lh li hi jf b jg lq jk lr jo ls js lt jw lu ka lm ln lo lp bi translated">从数据库中获取localhost:8080/sensor/id: one传感器</li><li id="209b" class="lh li hi jf b jg lq jk lr jo ls js lt jw lu ka lm ln lo lp bi translated">POST localhost:8080/sensor:添加一个具有给定名称的传感器，检查该名称是否尚未使用</li></ul><p id="cf7e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">所有这些都是通过我们之前创建的SensorRepository完成的:</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="c5fd" class="mc ig hi ly b fi md me l mf mg">@RestController<br/>public class SensorResource {<br/>    @Autowired<br/>    private SensorRepository sensorRepository;<br/><br/>    @GetMapping("/sensor")<br/>    public List&lt;SensorEntity&gt; retrieveAllSensors() {<br/>        return sensorRepository.findAll();<br/>    }<br/><br/>    @GetMapping("/sensor/{id}")<br/>    public SensorEntity retrieveSensor(@RequestParam long id) {<br/>        return sensorRepository.findById(id);<br/>    }<br/><br/>    @PostMapping("/sensor")<br/>    public ResponseEntity createSensor(@RequestParam String name) {<br/>        List&lt;SensorEntity&gt; sensorEntities = sensorRepository<br/>            .findAllByName(name);<br/><br/>        if (sensorEntities.size() &gt; 0) {<br/>            return ResponseEntity.status(HttpStatus.BAD_REQUEST)<br/>                .body("There is already a sensor with the name: " <br/>                        + name);<br/>        }<br/><br/>        SensorEntity sensorEntity = new SensorEntity(name);<br/>        sensorRepository.save(sensorEntity);<br/>        return ResponseEntity.ok(sensorEntity);<br/>    }<br/>}</span></pre><p id="6a8c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我们需要对测量进行同样的操作，以提供这些URL:</p><ul class=""><li id="e24a" class="lh li hi jf b jg kb jk kc jo lj js lk jw ll ka lm ln lo lp bi translated">获取localhost:8080/measurement:数据库中的所有测量值</li><li id="b2aa" class="lh li hi jf b jg lq jk lr jo ls js lt jw lu ka lm ln lo lp bi translated">POST localhost:8080/measurement:在检查给定的传感器ID是否在数据库中定义后，为给定的传感器ID、键和值添加测量:</li></ul><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="90cb" class="mc ig hi ly b fi md me l mf mg">@RestController<br/>public class MeasurementResource {<br/>    @Autowired<br/>    private SensorRepository sensorRepository;<br/><br/>    @Autowired<br/>    private MeasurementRepository measurementRepository;<br/><br/>    @GetMapping("/measurement")<br/>    public List&lt;MeasurementEntity&gt; retrieveAllMeasurements() {<br/>        return measurementRepository.findAll();<br/>    }<br/><br/>    @PostMapping("/measurement")<br/>    public ResponseEntity createMeasurement(<br/>        @RequestParam long sensorId, <br/>        @RequestParam String key, <br/>        @RequestParam double value) {<br/><br/>        SensorEntity sensorEntity = sensorRepository<br/>            .findById(sensorId);<br/><br/>        if (sensorEntity == null) {<br/>            return ResponseEntity.status(HttpStatus.BAD_REQUEST)<br/>                .body("No sensor defined with the ID: " + sensorId);<br/>        }<br/><br/>        MeasurementEntity measurementEntity = new MeasurementEntity(<br/>            sensorEntity, System.currentTimeMillis(), key, value);<br/>        measurementRepository.save(measurementEntity);<br/><br/>        return ResponseEntity.ok().build();<br/>    }<br/>}</span></pre><h1 id="6317" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">在PC上测试</h1><p id="194f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们来试试吧！在“javaspringrestdbapplication . Java”中的main函数上点击run，并浏览到<a class="ae kg" href="http://localhost:8080/swagger-ui.html." rel="noopener ugc nofollow" target="_blank">http://localhost:8080/swagger-ui . html .</a>通过使用Swagger界面，我们可以通过点击“POST /sensor”和“试用”来创建一些传感器。您可以通过尝试“/sensor”和“/sensor/{id}”的GET来查看创建的记录，也可以直接浏览到<a class="ae kg" href="http://localhost:8080/sensor." rel="noopener ugc nofollow" target="_blank">http://localhost:8080/sensor。</a>查看截图，了解存储数据的示例。</p><div class="kh ki kj kk fd ab cb"><figure class="kl km mh ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/786c85113b8e27b9913d920dbccff64f.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*1TEECbvP71Mv3Z443dct4w.png"/></div></figure><figure class="kl km mi ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/6980b8feea1a25096688f166a765e0ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*1ic2FxamJ9dz9_gwGT8oXg.png"/></div></figure><figure class="kl km mh ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/8e6baee7af87b02cd3fa25ea0b9f412e.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*Ya1EyfnXDhLNV0YnEuzCTw.png"/></div></figure></div><div class="ab cb"><figure class="kl km mj ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/417f10fb091fa536c90977c253eba894.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*OUXx7IW9XNU71rWsn1ahYA.png"/></div></figure><figure class="kl km mk ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/42817f338dec76ee3ce35cf3dca130c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*ZiS2yeZQRSdjGNhxrzON3w.png"/></div></figure><figure class="kl km ml ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/2fcd03250e36c7ac2b5359aa9cf52034.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/format:webp/1*PywXfMvBxeU_Rq9ReTxnFQ.png"/></div><p class="la lb et er es lc ld bd b be z dx mm di mn lg translated">允许测试REST API的Swagger接口的屏幕截图</p></figure></div><h1 id="de26" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">检查H2控制台中的数据</h1><p id="0b68" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果你在“src &gt; main &gt; resources &gt; application . properties”中添加一个额外的设置，神奇的事情就会发生。出乎意料的是，我们的应用程序扩展了一个完整的数据库浏览器！</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="b121" class="mc ig hi ly b fi md me l mf mg">spring.h2.console.enabled=true</span></pre><p id="3385" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">重新启动应用程序，以便应用新设置。因为默认情况下，H2将所有内容都存储在内存中，所以我们的测试数据已经没有了，我们需要像前面描述的那样，首先使用Swagger再次生成一些数据。现在浏览到<a class="ae kg" href="http://localhost:8080/h2-console" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/H2-console</a>并确保“jdbc:h2:mem:testdb”被用作“JDBC URL”。在下面的截图中，您可以看到我们在代码中为两个表定义的数据库结构，并检查数据。</p><div class="kh ki kj kk fd ab cb"><figure class="kl km mo ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/6d3b70b95f60c18b4fb1c5bcc7baa045.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/format:webp/1*hclMz2t39zGOuj5kFnEqXw.png"/></div></figure><figure class="kl km mp ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/744dda7b4898478291be6cb5820601e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*8hAywMeCETx3nHkuvlUmkg.png"/></div></figure><figure class="kl km mq ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/cd1dd6596106b9b66ea09e8523b3b648.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*TyAlDISs5ovimS9XXddPRA.png"/></div><p class="la lb et er es lc ld bd b be z dx mr di ms lg translated">允许您浏览数据库的H2网络界面的屏幕截图</p></figure></div><h1 id="3d1e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">在Raspberry Pi上运行的配置</h1><p id="8ab7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们的应用程序可以在PC上运行，现在让我们准备树莓派。Spring将在启动时在config目录中查找application.properties文件，如果找到，将使用该文件而不是jar中包含的文件。让我们使用这个功能来重新配置应用程序，使用文件数据库而不是内存数据库，这样在重新启动时数据就不会丢失。</p><p id="70ae" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我们将为应用程序创建一个目录，并添加如下属性:</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="6a64" class="mc ig hi ly b fi md me l mf mg">$ mkdir /home/pi/dbapp $ cd /home/pi/dbapp $ mkdir config $ nano config/application.properties spring.datasource.url=jdbc:h2:file:/home/pi/dbapp/spring-boot-h2-db spring.datasource.username=sa spring.datasource.password= spring.datasource.driver-class-name=org.h2.Driver spring.jpa.hibernate.ddl-auto=update</span></pre><p id="9794" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">将PC上的应用程序构建到带有“mvn clean package”的jar中，并将“Java-spring-rest-d b-0 . 0 . 1-snapshot . jar”从“target”目录复制到您的Pi的“/home/pi/dbapp”目录中。</p><p id="6b6b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在这个屏幕截图中，您还可以看到创建的数据库文件“spring-boot-h2-db.mv.db ”,如属性文件中所定义的。当通过Swagger添加数据时，您会看到这个文件的大小在增长。</p><div class="kh ki kj kk fd ab cb"><figure class="kl km mt ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/df611fc078a31a3dca56e5d09b6194b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1498/format:webp/1*-tEZhrvsldvfYB8OyJhYhw.png"/></div></figure><figure class="kl km mu ko kp kq kr paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><img src="../Images/a3d628be9cd05e66c4ca9835bff2ecff.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*Lz2upasixgGK_1YldExgUA.png"/></div><p class="la lb et er es lc ld bd b be z dx mv di mw lg translated">在Raspberry Pi上配置使用H2数据库文件so数据</p></figure></div><p id="d005" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">运行该应用程序会得到类似于PC上的预期输出:</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="8e6d" class="mc ig hi ly b fi md me l mf mg">$ java -jar java-spring-rest-db-0.0.1-SNAPSHOT.jar<br/><br/>  .   ____          _            __ _ _<br/> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \<br/>( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \<br/> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )<br/>  '  |____| .__|_| |_|_| |_\__, | / / / /<br/> =========|_|==============|___/=/_/_/_/<br/> :: Spring Boot ::        (v2.1.8.RELEASE)<br/><br/>Starting JavaSpringRestDbApplication v0.0.1-SNAPSHOT on raspberrypi with PID 4557 <br/>    (/home/pi/dbapp/java-spring-rest-db-0.0.1-SNAPSHOT.jar<br/>    started by pi in /home/pi/dbapp)<br/>No active profile set, falling back to default profiles: default<br/>Bootstrapping Spring Data repositories in DEFAULT mode.<br/>Finished Spring Data repository scanning in 465ms. Found 2 repository interfaces.<br/>...<br/>Tomcat started on port(s): 8080 (http) with context path ''<br/>Started JavaSpringRestDbApplication in 63.416 seconds (JVM running for 67.637)</span></pre><p id="a98d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">与我的开发电脑相比，最大的区别在于最后一行:</p><pre class="kh ki kj kk fd lx ly lz ma aw mb bi"><span id="6d8a" class="mc ig hi ly b fi md me l mf mg">Started JavaSpringRestDbApplication in 5.452 seconds (JVM running for 7.338)</span></pre><p id="0691" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">事实上，您需要考虑到这个应用程序需要在Pi上有较长的启动时间。但是一旦它运行，你就可以通过你的Pi的IP地址，在你的网络中的任何一台PC上访问Swagger和其他服务，在我的例子中是192.168.0.223。</p><h1 id="f9cb" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="4fa5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这只是一个包含两个表的基本示例，但它向您展示了如何用最少的代码快速构建一个数据库应用程序。REST-服务适用于所有通过网络连接到您的Raspberry Pi的设备，因此它们可以在一个中心位置存储数据和/或读取数据。</p><p id="6559" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">REST-services提供的JSON数据可以被所有不同类型的设备或应用程序用来可视化结果。在<a class="ae kg" href="https://www.elektormagazine.com/labs/9292-dutch-public-transport-monitor" rel="noopener ugc nofollow" target="_blank"> Elektor网站上，你可以找到一个微控制器在屏幕上显示JSON数据的好例子</a>。</p><p id="9797" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在Raspberry Pi上运行Java和Spring只是这种小巧、廉价但非常强大的机器的多功能性的一个例子！想了解#JavaOnRaspberryPi的更多乐趣，请查看我的书<a class="ae kg" href="https://webtechie.be/books" rel="noopener ugc nofollow" target="_blank">“Raspberry Pi上的Java入门”</a>。</p></div><div class="ab cl mx my gp mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="hb hc hd he hf"><p id="79e3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="ne">原载于</em><a class="ae kg" href="https://webtechie.be/post/2020-07-13-spring-rest-h2-raspberry-pi/" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://web techie . be</em></a><em class="ne">。</em></p></div></div>    
</body>
</html>