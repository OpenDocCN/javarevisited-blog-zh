<html>
<head>
<title>Argument Capturing: A must know unit testing technique.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个必须知道的单元测试技术。</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/argument-capturing-a-must-know-unit-testing-technique-e88b3a6a6af1?source=collection_archive---------3-----------------------#2020-06-22">https://medium.com/javarevisited/argument-capturing-a-must-know-unit-testing-technique-e88b3a6a6af1?source=collection_archive---------3-----------------------#2020-06-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e291af2e601167574eff33738438a657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QTJj_q7zBUN5DsnE_Wf0JA.jpeg"/></div></div></figure><p id="17ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated"><strong class="is hj"> @Captor </strong>是<a class="ae jp" href="https://site.mockito.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> mockito库</strong> </a>中的一个注释，它与<strong class="is hj"> <em class="jq"> ArumentCaptor </em> </strong>类一起使用，用于捕获传递给被模仿对象的方法的参数。它总是与<strong class="is hj"> <em class="jq"> verify() </em> </strong>一起使用，以检索调用模拟依赖关系中的方法时传递的参数。它是一个有用的工具，可以让我们为测试创建额外的断言，从而使我们的单元测试更加准确。</p><p id="f825" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们有一个<strong class="is hj"> <em class="jq">留言簿</em> </strong> <em class="jq"> </em>类，它将把一个<strong class="is hj"> <em class="jq">的留言簿</em> </strong>保存到<strong class="is hj"> <em class="jq">的留言簿库</em> </strong>。<strong class="is hj"><em class="jq">guestsBookRepository</em></strong>是该类的一个依赖项，如果我们要编写一个单元测试，我们必须模拟它。你认为模拟将足以准确地测试这个类吗？</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jv jw l"/></div></figure><p id="e7c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们要模仿这个类的依赖性并试着测试它。我们唯一能做的就是验证与<strong class="is hj"><em class="jq">guest book repository</em></strong>对象的交互，但是我们不能检查准确传递的数据。</p><p id="4e86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">原因是我们没有控制用于生成<strong class="is hj"> <em class="jq"> guestEntry </em> </strong>的<strong class="is hj"><em class="jq">guest bookutils</em></strong>类。这种约束在<a class="ae jp" rel="noopener" href="/javarevisited/top-10-courses-to-learn-eclipse-junit-and-mockito-for-java-developers-4de1e8d62b96">单元测试</a>术语中称为<strong class="is hj"> <em class="jq">硬连线依赖</em> </strong>。我们说这是硬连线的，因为这个类目前没有注入它的机制。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jv jw l"/></div><p class="jx jy et er es jz ka bd b be z dx translated">这个测试不准确，因为我们没有检查传递给save()方法的值</p></figure><p id="2b40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果在这一点上，我们要花一些时间来考虑OOD( <a class="ae jp" rel="noopener" href="/javarevisited/my-favorite-courses-to-learn-object-oriented-programming-and-design-in-2019-197bab351733?source=collection_home---4------0-----------------------">面向对象设计</a>)，也许我们会得出这样的结论:需要用<strong class="is hj"><em class="jq">guest bookutils</em></strong>做一些事情来允许我们自己更准确地测试这个类。</p><p id="69fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是否应该去掉<a class="ae jp" href="https://javarevisited.blogspot.com/2011/11/static-keyword-method-variable-java.html" rel="noopener ugc nofollow" target="_blank">静态方法</a>调用？要不要注入一个工厂？可能有很多事情我们可以让这个类更易测试。但是很可能需要重构。</p><p id="1dd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重构没有错，我支持重构，我相信我们应该一直努力提高我们代码库的质量。不幸的是，在现实生活中，有时我们不得不推迟这种决定，特别是在非常大和复杂的代码库中，或者当我们需要满足紧迫的期限时。</p><p id="7bec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，推迟重构的副作用会是技术债的产生。也许我们会在另一个故事中更多地讨论<a class="ae jp" href="https://javarevisited.blogspot.com/2020/12/top-5-course-to-improve-coding-skills.html#axzz6k4XBgTw4" rel="noopener ugc nofollow" target="_blank">重构</a>，但现在让我们看看<strong class="is hj"> <em class="jq"> @Captor </em> </strong>如何在不改变我们的生产代码的情况下帮助我们。</p><blockquote class="kb kc kd"><p id="2691" class="iq ir jq is b it iu iv iw ix iy iz ja ke jc jd je kf jg jh ji kg jk jl jm jn hb bi translated"><strong class="is hj">也许是正确的做法，但不是合适的时机。</strong></p></blockquote><p id="0437" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个单元测试的替代实现中，我们将使用<strong class="is hj"> <em class="jq"> @Captor </em> </strong>来创建一个更精确的测试版本。请注意，我们现在有了额外的断言。这是可能的，因为我们的<strong class="is hj"><em class="jq">guest entrycaptor</em></strong>正在记录传递给<strong class="is hj"> <em class="jq"> save() </em> </strong>方法的值。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jv jw l"/></div><p class="jx jy et er es jz ka bd b be z dx translated">多亏了@Captor注释，更精确的测试成为可能</p></figure><p id="8b92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">机制非常简单，以下是步骤总结:</p><ol class=""><li id="11da" class="kh ki hi is b it iu ix iy jb kj jf kk jj kl jn km kn ko kp bi translated">创建一个类型为<strong class="is hj"><em class="jq">ArgumentCaptor</em></strong>的对象，使用通用参数指定要捕捉的对象的类型。</li><li id="2120" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">用<strong class="is hj"> <em class="jq"> @Captor </em> </strong>注释注释该对象。</li><li id="685e" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">在您通常的模拟验证中，调用<strong class="is hj"> <em class="jq"> capture() </em> </strong>方法来启用捕获</li><li id="dc3a" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">使用captor对象的<strong class="is hj"> <em class="jq"> getValue() </em> </strong>方法获取记录的值，并将它们赋给一个变量。</li><li id="927e" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">添加附加断言</li></ol><blockquote class="kb kc kd"><p id="ba59" class="iq ir jq is b it iu iv iw ix iy iz ja ke jc jd je kf jg jh ji kg jk jl jm jn hb bi translated"><strong class="is hj">记住，要掌握</strong> <a class="ae jp" rel="noopener" href="/javarevisited/5-courses-to-learn-junit-and-mockito-in-2019-best-of-lot-f217d8b93688"> <strong class="is hj">单元测试的技巧</strong> </a> <strong class="is hj">你需要了解如何使用你的工具以及何时使用它们。</strong></p></blockquote></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><p id="b924" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢这个故事，请给我们一些掌声👏<a class="ae jp" rel="noopener" href="/@javing.uk"><strong class="is hj">跟随我们简介</strong></a><strong class="is hj"><br/></strong><a class="ae jp" href="http://www.javing.uk" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Javing</strong></a>是一家总部位于伦敦的敏捷Java软件咨询公司。</p></div></div>    
</body>
</html>