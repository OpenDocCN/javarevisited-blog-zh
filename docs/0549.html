<html>
<head>
<title>From Eager to Fused to Lazy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从渴望到融合到懒惰</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/from-eager-to-fused-to-lazy-66450e290002?source=collection_archive---------2-----------------------#2020-06-25">https://medium.com/javarevisited/from-eager-to-fused-to-lazy-66450e290002?source=collection_archive---------2-----------------------#2020-06-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="38e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Eclipse集合中迭代方法的演变</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a095d1af29d0ace465a7b62925db4248.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V5YsvZQ5s6gR5LuEPiLSOA.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">实现同一目标的三种方式——渴望、融合和懒惰</p></figure><h1 id="9192" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">在开始的时候有渴望</h1><p id="49bd" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">当第一个迭代方法在<a class="ae kw" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> Eclipse集合</a>中实现时，他们都很渴望。Eager是Eclipse集合中集合接口和实现的默认行为。</p><p id="0ad5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当以流畅的方式使用带有多个操作的eager方法时，您可以创建中间集合。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/2f03f7a8ead01a132f02651622c1a1ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ozB_x9QYUkJ0rCLBxaknTQ.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">选择和收集都是渴望的方法</p></figure><p id="7ffb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对上面的<code class="du ky kz la lb b">select</code>的调用将创建一个<code class="du ky kz la lb b">MutableList&lt;Integer&gt;</code>。对<code class="du ky kz la lb b">collect</code>的调用然后创建了一个<code class="du ky kz la lb b">MutableList&lt;String&gt;</code>。下面的代码明确显示了对<code class="du ky kz la lb b">select</code>和<code class="du ky kz la lb b">collect</code>的调用的返回类型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/5851aa8f93d4515115b87708cf5a3160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I5oHcZ-ky5HPg09TzHUH_w.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">使用Eager，每个调用都强制执行并返回一个列表</p></figure><p id="aadb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">select</code>和<code class="du ky kz la lb b">collect</code>的命令式代码如下所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ld"><img src="../Images/163b82804819f9c52189698968b67bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auuMj2aUwrzkeCM9OYzmVA.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">首先我们选择，然后我们收集</p></figure><h1 id="edb7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">用融合方法优化</h1><p id="0f19" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">当我们开始用更高层次的迭代模式替换强制性的<code class="du ky kz la lb b">for</code>循环时，我们偶尔会看到做多件事的<code class="du ky kz la lb b">for</code>循环。这些<code class="du ky kz la lb b">for</code>循环可以被分解成单独的步骤，如<code class="du ky kz la lb b">select</code>和<code class="du ky kz la lb b">collect</code>，但是很明显会产生更多的临时垃圾。这时我们引入了第一个名为<code class="du ky kz la lb b">collectIf</code>的融合方法。方法<code class="du ky kz la lb b">collectIf</code>是<code class="du ky kz la lb b">selectAndCollect</code>的简称。</p><p id="ceaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">融合方法<code class="du ky kz la lb b">collectIf</code>包括一次过滤和转换列表所需的<code class="du ky kz la lb b">Predicate</code>和<code class="du ky kz la lb b">Function</code>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/29f02b63e24c0042df52b7d8f9abea0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31MA1y5fUmUsLj8A9bcSFg.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">取所有的偶数并用toString变换它们</p></figure><p id="78d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是命令式<code class="du ky kz la lb b">for</code>循环在执行<code class="du ky kz la lb b">collectIf</code>操作时的样子。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/1b0207ec68f9626659b50341dfbc84e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tpYB5GXhl9yl0mlakZbY-A.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">列表的经典命令式过滤和转换</p></figure><p id="bc13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">融合操作<code class="du ky kz la lb b">collectIf</code>尽可能接近命令式<code class="du ky kz la lb b">for</code>循环，只有在没有列表创建、<code class="du ky kz la lb b">for</code>循环、<code class="du ky kz la lb b">if</code>语句和对集合的<code class="du ky kz la lb b">add</code>调用的情况下才能实现。</p><h1 id="61f1" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">该偷懒了</h1><p id="259d" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">在eager和fused API之后，我们将lazy API添加到Eclipse集合中。Eclipse集合中的lazy API可以通过调用<code class="du ky kz la lb b">asLazy</code>获得。惰性API将延迟执行，直到调用一个终端操作(如<code class="du ky kz la lb b">forEach</code>或<code class="du ky kz la lb b">toList</code>)。Eclipse集合中的惰性API返回一个名为<code class="du ky kz la lb b">LazyIterable</code>的<code class="du ky kz la lb b">Iterable</code>类型。与Java 8中增加的<code class="du ky kz la lb b">Stream</code>不同，<code class="du ky kz la lb b">LazyIterable</code>可以重用。下面的博客有更多关于<code class="du ky kz la lb b">LazyIterable</code>的内容，以及它是如何永不枯竭的。</p><div class="lg lh ez fb li lj"><a rel="noopener follow" target="_blank" href="/@donraab/lazy-and-inexhaustible-f41ffda857dc"><div class="lk ab dw"><div class="ll ab lm cl cj ln"><h2 class="bd hj fi z dy lo ea eb lp ed ef hh bi translated">懒而不尽</h2><div class="lq l"><h3 class="bd b fi z dy lo ea eb lp ed ef dx translated">懒惰是一种美德。有时你希望它是可重复的。</h3></div><div class="lr l"><p class="bd b fp z dy lo ea eb lp ed ef dx translated">medium.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx jn lj"/></div></div></a></div><p id="85cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">惰性API的好处是不会创建中间集合。对<code class="du ky kz la lb b">asLazy</code>、<code class="du ky kz la lb b">select</code>和<code class="du ky kz la lb b">collect</code>的调用都创建了<code class="du ky kz la lb b">LazyIterable</code>实例，这些实例什么都不做。对<code class="du ky kz la lb b">toList</code>的最后一次调用强制执行并创建目标列表。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/29f33a5b14c616981a72173c11ea8a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m6sXIG_xpUqxsPoPEF6tTQ.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">懒惰在流畅的风格中很有效</p></figure><p id="e9ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码显示了每个操作的结果。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/17facaa7bb60c4219e2a4cfd5b3d68c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ru8r5RjeUYJpUndIvBsb6Q.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">对toList的最后一次调用强制执行，并创建结果列表</p></figure><p id="2967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的命令式代码展示了如何将两个<code class="du ky kz la lb b">Iterables</code>组合在一起，然后使用一个<code class="du ky kz la lb b">for</code>循环进行迭代，以获得相同的结果。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/7815466a54d2078d6c209eafc2fdf3b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lPMKUZGB8jSh22dG8LMSww.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">创建一个可选择的对象，在可选择的对象上构建一个可集合的对象，然后迭代添加到列表中</p></figure><h1 id="1ada" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">推荐</h1><p id="3e45" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">有时候用急切，融合或者懒惰更好。以下是我推荐的Eclipse集合规则。</p><ol class=""><li id="2f2d" class="mb mc hi ih b ii ij im in iq md iu me iy mf jc mg mh mi mj bi translated">对于单个操作，或者如果您正在处理小型集合，请使用eager方法。</li><li id="c6ba" class="mb mc hi ih b ii mk im ml iq mm iu mn iy mo jc mg mh mi mj bi translated">使用融合方法，如果它与您的场景完全匹配，如<code class="du ky kz la lb b">collectIf</code>。</li><li id="d263" class="mb mc hi ih b ii mk im ml iq mm iu mn iy mo jc mg mh mi mj bi translated">如果有多个操作会导致创建更多临时集合，请使用lazy。</li></ol><p id="12ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mp">我是</em><a class="ae kw" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"><em class="mp">Eclipse Collections</em></a><em class="mp">OSS项目在</em><a class="ae kw" href="https://projects.eclipse.org/projects/technology.collections" rel="noopener ugc nofollow" target="_blank"><em class="mp">Eclipse Foundation</em></a><em class="mp">的项目负责人。</em> <a class="ae kw" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> <em class="mp">月食收藏</em> </a> <em class="mp">是开投</em> <a class="ae kw" href="https://github.com/eclipse/eclipse-collections/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank"> <em class="mp">投稿</em> </a> <em class="mp">。如果你喜欢这个库，你可以在GitHub上让我们知道。</em></p></div></div>    
</body>
</html>