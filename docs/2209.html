<html>
<head>
<title>How I handle Veracode Issue (CWE 117) Improper Output Neutralization for Logs | Java | Veracode Fixes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何处理Veracode问题(CWE 117)不正确的日志输出中和| Java | Veracode修复</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/how-i-handle-veracode-issue-cwe-117-improper-output-neutralization-for-logs-java-veracode-2c55df32245a?source=collection_archive---------2-----------------------#2022-06-24">https://medium.com/javarevisited/how-i-handle-veracode-issue-cwe-117-improper-output-neutralization-for-logs-java-veracode-2c55df32245a?source=collection_archive---------2-----------------------#2022-06-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a562458c3f3abab732bdb23ca2794a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GNFX0r_14_ckRQF2eblLA.jpeg"/></div></div></figure><blockquote class="iq"><p id="daf4" class="ir is hi bd it iu iv iw ix iy iz ja dx translated">Veracode scanner能够发现日志伪造攻击。我建议您在投入生产之前用Veracode扫描仪扫描您的应用程序，以确保您的应用程序安全。</p></blockquote><h2 id="99d6" class="jb jc hi bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy bi translated">为什么这是一个问题</h2><p id="74be" class="pw-post-body-paragraph jz ka hi kb b kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks ja hb bi translated">将不受信任的数据写入日志文件，使得攻击者能够伪造日志<br/>条目或将恶意内容注入日志文件。损坏的日志文件可用于掩盖攻击者的踪迹，或作为攻击日志查看或处理实用程序的传递机制。</p><h2 id="7af8" class="jb jc hi bd jd je kt jg jh ji ku jk jl jm kv jo jp jq kw js jt ju kx jw jx jy bi translated">Veracode解决方案</h2><p id="31d1" class="pw-post-body-paragraph jz ka hi kb b kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks ja hb bi translated">Veracode建议尽可能避免在日志文件中直接嵌入用户输入，或者对用于构建日志条目的不可信数据进行消毒。</p><p id="da6d" class="pw-post-body-paragraph jz ka hi kb b kc ky ke kf kg kz ki kj jm la kl km jq lb ko kp ju lc kr ks ja hb bi translated">这可以通过使用ESAPI库中的encodeForHtml()编码方法来实现。但是，这个库需要一些额外的配置(ESAPI.properties ),如果您只是想对记录的值进行转义，这是多余的。</p><h2 id="e091" class="jb jc hi bd jd je kt jg jh ji ku jk jl jm kv jo jp jq kw js jt ju kx jw jx jy bi translated">我如何处理这个问题</h2><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="ff05" class="pw-post-body-paragraph jz ka hi kb b kc ky ke kf kg kz ki kj jm la kl km jq lb ko kp ju lc kr ks ja hb bi translated"><strong class="kb hj">我拥有的日志样本</strong></p><pre class="ld le lf lg fd lj lk ll lm aw ln bi"><span id="c713" class="jb jc hi lk b fi lo lp l lq lr">log.info("test user :{}", user);<br/>log.info("test user :{} test name : {}", user, name);<br/>log.info("test user: {} "test name : {} test mail : {} ", user, name, mail);<br/>log.error("Exception occurred for test user :{} test name : {}", user, name, ex);<br/></span></pre><p id="7fe7" class="pw-post-body-paragraph jz ka hi kb b kc ky ke kf kg kz ki kj jm la kl km jq lb ko kp ju lc kr ks ja hb bi translated"><strong class="kb hj">我写的解决这个问题的代码</strong></p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="b0d1" class="pw-post-body-paragraph jz ka hi kb b kc ky ke kf kg kz ki kj jm la kl km jq lb ko kp ju lc kr ks ja hb bi translated">写完这些<a class="ae ls" href="https://www.java67.com/2014/10/difference-between-static-and-non-static-method-java-programming.html" rel="noopener ugc nofollow" target="_blank">静态方法</a>后，我们可以直接在logger方法中使用它们，如下所示。</p><pre class="ld le lf lg fd lj lk ll lm aw ln bi"><span id="3964" class="jb jc hi lk b fi lo lp l lq lr">import utils.VeracodeUtil.<em class="lt">secureArguments;<br/></em></span><span id="8ae7" class="jb jc hi lk b fi lu lp l lq lr">public class Test{<br/>   public void testMethod(){<br/>     log.info("test user :{}", secureArguments(user));<br/>     log.info("test user :{} test name : {}", secureArguments(user,    name));<br/>     log.info("test user: {} "test name : {} test mail : {} ", secureArguments(user, name, mail));<br/>     log.error("Exception occurred for test user :{} test name : {}", secureArguments(user, name, ex));<br/>  }<br/>}</span></pre><h2 id="7177" class="jb jc hi bd jd je kt jg jh ji ku jk jl jm kv jo jp jq kw js jt ju kx jw jx jy bi translated">参考</h2><div class="lv lw ez fb lx ly"><a href="https://community.veracode.com/s/article/How-to-Fix-CWE-117-Improper-Output-Neutralization-for-Logs" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hj fi z dy md ea eb me ed ef hh bi translated">社区</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">编辑描述</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">community.veracode.com</p></div></div></div></a></div><div class="lv lw ez fb lx ly"><a href="https://stackoverflow.com/questions/46564555/pass-veracode-cwe-117-improper-output-neutralization-for-logs-only-with-replac" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hj fi z dy md ea eb me ed ef hh bi translated">仅使用replaceAll("\r"…)传递Veracode CWE 117(日志的不正确输出中和)</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">感谢贡献一个堆栈溢出的答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">stackoverflow.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm io ly"/></div></div></a></div><p id="2bfa" class="pw-post-body-paragraph jz ka hi kb b kc ky ke kf kg kz ki kj jm la kl km jq lb ko kp ju lc kr ks ja hb bi translated"><a class="ae ls" href="https://stackoverflow.com/questions/16225935/security-flaw-veracode-report-crlf-injection/49804999#49804999" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/16225935/security-flaw-vera code-report-crlf-injection/49804999 # 49804999</a></p></div></div>    
</body>
</html>