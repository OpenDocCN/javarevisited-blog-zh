<html>
<head>
<title>Configure Multiple Data Sources — Postgres &amp; Oracle in a Spring Boot Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在一个Spring Boot应用程序中配置多个数据源— Postgres和Oracle</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/configure-multiple-data-sources-postgres-oracle-in-a-spring-boot-application-72b28a9e6ea9?source=collection_archive---------0-----------------------#2021-08-27">https://medium.com/javarevisited/configure-multiple-data-sources-postgres-oracle-in-a-spring-boot-application-72b28a9e6ea9?source=collection_archive---------0-----------------------#2021-08-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1378" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近，我需要将一个spring boot应用程序连接到两个不同的数据库。详情如下</p><ol class=""><li id="9f56" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">Postgresql 13.1，主机服务器1，端口5432，数据库— mydb1</li><li id="48e6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">Oracle 12c，主机—服务器2，端口1521，数据库— mydb2，服务名— mydbservice</li></ol><p id="7a1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤-</p><ol class=""><li id="145e" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">将以下依赖项添加到pom.xml</li></ol><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="eb32" class="ka kb hi jw b fi kc kd l ke kf">&lt;dependency&gt;<br/>   &lt;groupId&gt;com.oracle.database.jdbc&lt;/groupId&gt;<br/>   &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;<br/>   &lt;scope&gt;runtime&lt;/scope&gt;<br/>  &lt;/dependency&gt;</span><span id="1a84" class="ka kb hi jw b fi kg kd l ke kf">&lt;dependency&gt;<br/>   &lt;groupId&gt;org.postgresql&lt;/groupId&gt;<br/>   &lt;artifactId&gt;postgresql&lt;/artifactId&gt;<br/>   &lt;scope&gt;runtime&lt;/scope&gt;<br/>  &lt;/dependency&gt;</span><span id="63a0" class="ka kb hi jw b fi kg kd l ke kf">&lt;dependency&gt;<br/>   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>   &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;<br/>  &lt;/dependency&gt;</span></pre><p id="ba9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.修改应用程序.属性文件</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="5762" class="ka kb hi jw b fi kc kd l ke kf">spring.jpa.show-sql = true<br/>spring.jpa.generate-ddl=false //ddl disabled</span><span id="8305" class="ka kb hi jw b fi kg kd l ke kf">spring.db1.datasource.username=pguser<br/>spring.db1.datasource.password=pguser<br/>spring.db1.datasource.jdbc-url=jdbc:postgresql://server1:5432/mydb1<br/>spring.db1.datasource.driver-class-name=org.postgresql.Driver</span><span id="639f" class="ka kb hi jw b fi kg kd l ke kf">spring.db2.datasource.username=orauser<br/>spring.db2.datasource.password=orauser<br/>spring.db2.datasource.jdbc-url=jdbc:oracle:thin:<a class="ae kh" href="http://twitter.com/server1" rel="noopener ugc nofollow" target="_blank">@server</a>2:1521:mydbservice<br/>spring.db2.datasource.driver-class-name=oracle.jdbc.OracleDriver</span><span id="0435" class="ka kb hi jw b fi kg kd l ke kf"><strong class="jw hj">## Note : For oracle, we specify database name in entity class<br/>## using annotatiton @Table(schema="mydb2", name="mytable")</strong></span></pre><p id="d231" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。确保连接到mydb1或mydb2的存储库类应该属于不同的包。</strong>模型、<a class="ae kh" href="https://javarevisited.blogspot.com/2017/11/difference-between-component-service.html" rel="noopener ugc nofollow" target="_blank">服务</a>和<a class="ae kh" href="https://javarevisited.blogspot.com/2017/08/difference-between-restcontroller-and-controller-annotations-spring-mvc-rest.html#ixzz6OYNB9oii" rel="noopener ugc nofollow" target="_blank">控制器</a>类可以在同一个包中。</p><p id="f105" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我的文件夹详细信息如下:</p><ul class=""><li id="b7b2" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ki jj jk jl bi translated">应用程序名称— myapp</li><li id="e412" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ki jj jk jl bi translated">GroupId — com.example</li><li id="b433" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ki jj jk jl bi translated">ArtifactId- myapp</li><li id="84fe" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ki jj jk jl bi translated">包含main()方法的基础包— com.example.myapp</li><li id="459b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ki jj jk jl bi translated">每个数据库的存储库类的单独包-<br/><strong class="ih hj">com . example . myapp . db 1 repo，<br/>com . example . myapp . db 2 repo</strong></li><li id="98bc" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ki jj jk jl bi translated">模型类的包— com.example.myapp.domain</li><li id="4af2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ki jj jk jl bi translated">控制器类包— com.example.myapp.rest</li><li id="f02f" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ki jj jk jl bi translated">服务类包-com . example . myapp . Service</li><li id="f073" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ki jj jk jl bi translated">配置类包— com.example.myapp.config</li></ul><p id="4e32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.创建两个配置类，为每个数据库源配置一个配置。<br/>在config类中，我们将把域和存储库包配置到特定的数据源。</p><p id="8eaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Db1Config.class</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="3e6d" class="ka kb hi jw b fi kc kd l ke kf">// db1 is our primary database</span><span id="255b" class="ka kb hi jw b fi kg kd l ke kf">package com.example.myapp.config;<br/></span><span id="55d0" class="ka kb hi jw b fi kg kd l ke kf"><a class="ae kh" href="http://twitter.com/Configuration" rel="noopener ugc nofollow" target="_blank">@Configuration</a><br/><a class="ae kh" href="http://twitter.com/EnableJpaRepositorie" rel="noopener ugc nofollow" target="_blank">@EnableJpaRepositorie</a>s(<br/>entityManagerFactoryRef = "db1EntityMgrFactory", <br/>transactionManagerRef = "db1TransactionMgr", <br/><strong class="jw hj">basePackages = "com.example.myapp.db1repo")<br/></strong><a class="ae kh" href="http://twitter.com/EnableTransactionMan" rel="noopener ugc nofollow" target="_blank">@EnableTransactionMan</a>agement<br/>public class Db1Config {</span><span id="a584" class="ka kb hi jw b fi kg kd l ke kf"><a class="ae kh" href="http://twitter.com/Bean" rel="noopener ugc nofollow" target="_blank"><br/>@Bean</a>(name = "datasource1")<br/><a class="ae kh" href="http://twitter.com/ConfigurationPropert" rel="noopener ugc nofollow" target="_blank">@ConfigurationPropert</a>ies(prefix = "spring.db1.datasource")<br/><a class="ae kh" href="http://twitter.com/Primary" rel="noopener ugc nofollow" target="_blank">@Primary</a><br/>public DataSource dataSource() {<br/>  return DataSourceBuilder.create().build();<br/> }</span><span id="d3e7" class="ka kb hi jw b fi kg kd l ke kf"><a class="ae kh" href="http://twitter.com/Bean" rel="noopener ugc nofollow" target="_blank">@Bean</a>(name = "db1EntityMgrFactory")<br/><a class="ae kh" href="http://twitter.com/Primary" rel="noopener ugc nofollow" target="_blank">@Primary</a><br/>public LocalContainerEntityManagerFactoryBean db1EntityMgrFactory(<br/>   final EntityManagerFactoryBuilder builder,<br/>   <a class="ae kh" href="http://twitter.com/Qualifier" rel="noopener ugc nofollow" target="_blank">@Qualifier</a>("datasource1") final DataSource dataSource) {<br/>  return builder<br/>    .dataSource(dataSource)<br/>   <strong class="jw hj"> </strong>.packages("com.example.myapp.domain")<br/>    .persistenceUnit("db1")<br/>    .build();<br/> }<br/></span><span id="b83a" class="ka kb hi jw b fi kg kd l ke kf"><a class="ae kh" href="http://twitter.com/Bean" rel="noopener ugc nofollow" target="_blank">@Bean</a>(name = "db1TransactionMgr")<br/><a class="ae kh" href="http://twitter.com/Primary" rel="noopener ugc nofollow" target="_blank">@Primary</a><br/>public PlatformTransactionManager db1TransactionMgr(<br/>   <a class="ae kh" href="http://twitter.com/Qualifier" rel="noopener ugc nofollow" target="_blank">@Qualifier</a>("db1EntityMgrFactory") final EntityManagerFactory entityManagerFactory) {<br/>  return new JpaTransactionManager(entityManagerFactory);<br/> }</span><span id="8594" class="ka kb hi jw b fi kg kd l ke kf">}</span></pre><p id="03a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Db2Config.class</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="0e87" class="ka kb hi jw b fi kc kd l ke kf">package com.example.myapp.config;<br/></span><span id="ffb3" class="ka kb hi jw b fi kg kd l ke kf">@<a class="ae kh" href="http://twitter.com/Configuration" rel="noopener ugc nofollow" target="_blank">Configuration</a><br/>@<a class="ae kh" href="http://twitter.com/EnableJpaRepositorie" rel="noopener ugc nofollow" target="_blank">EnableJpaRepositorie</a>s(<br/>entityManagerFactoryRef = "db2EntityMgrFactory", transactionManagerRef = "db2TransactionMgr", <br/><strong class="jw hj">basePackages = "com.example.myapp.db2repo")<br/></strong>@<a class="ae kh" href="http://twitter.com/EnableTransactionMan" rel="noopener ugc nofollow" target="_blank">EnableTransactionMan</a>agement<br/>public class EpinetConfig {<br/></span><span id="2895" class="ka kb hi jw b fi kg kd l ke kf">@<a class="ae kh" href="http://twitter.com/Bean" rel="noopener ugc nofollow" target="_blank">Bean</a>(name = "datasource2")<br/>@<a class="ae kh" href="http://twitter.com/ConfigurationPropert" rel="noopener ugc nofollow" target="_blank">ConfigurationPropert</a>ies(prefix = "spring.db2.datasource")<br/>public DataSource dataSource() {<br/>  return DataSourceBuilder.create().build();<br/> }<br/></span><span id="7933" class="ka kb hi jw b fi kg kd l ke kf">@<a class="ae kh" href="http://twitter.com/Bean" rel="noopener ugc nofollow" target="_blank">Bean</a>(name = "db2EntityMgrFactory")<br/>public LocalContainerEntityManagerFactoryBean db2EntityMgrFactory ( <br/>  final EntityManagerFactoryBuilder builder,<br/>  @<a class="ae kh" href="http://twitter.com/Qualifier" rel="noopener ugc nofollow" target="_blank">Qualifier</a>("datasource2") final DataSource dataSource) {</span><span id="2af4" class="ka kb hi jw b fi kg kd l ke kf">final Map&lt;String, String&gt; properties = new HashMap&lt;&gt;();<br/>properties.put("hibernate.physical_naming_strategy",<br/>    "org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy");</span><span id="1325" class="ka kb hi jw b fi kg kd l ke kf">return builder<br/>    .dataSource(dataSource)<br/>    .properties(properties)<br/>    .packages("com.example.domain")<br/>    .persistenceUnit("db2")<br/>    .build();<br/> }</span><span id="2c84" class="ka kb hi jw b fi kg kd l ke kf">@<a class="ae kh" href="http://twitter.com/Bean" rel="noopener ugc nofollow" target="_blank">Bean</a>(name = "db2TransactionMgr")<br/> public PlatformTransactionManager db2TransactionMgr(   @Q<a class="ae kh" href="http://twitter.com/Qualifier" rel="noopener ugc nofollow" target="_blank">ualifier</a>("db2EntityMgrFactory") final EntityManagerFactory entityManagerFactory) {<br/>  return new JpaTransactionManager(entityManagerFactory);<br/> }</span><span id="084d" class="ka kb hi jw b fi kg kd l ke kf">}</span></pre><blockquote class="kj kk kl"><p id="0ebc" class="if ig km ih b ii ij ik il im in io ip kn ir is it ko iv iw ix kp iz ja jb jc hb bi translated">注意:</p><p id="d2a5" class="if ig km ih b ii ij ik il im in io ip kn ir is it ko iv iw ix kp iz ja jb jc hb bi translated">在Db2Config类中，我们已经明确指定了<strong class="ih hj">hibernate . physical _ naming _ strategy</strong>的属性值。这样做是因为在jpa hibernate查询到<a class="ae kh" rel="noopener" href="/javarevisited/8-free-oracle-database-and-sql-courses-for-beginners-f4e9b25b33c4"> <strong class="ih hj"> oracle </strong>数据库</a>的过程中，实体类属性名称不会自动从camelcase转换到snakecase。</p><p id="a55b" class="if ig km ih b ii ij ik il im in io ip kn ir is it ko iv iw ix kp iz ja jb jc hb bi translated">对于<a class="ae kh" rel="noopener" href="/javarevisited/7-best-free-postgresql-courses-for-beginners-to-learn-in-2021-3bf369d73794"> postgresql </a>，属性名从camelcase到snakecase的默认转换工作正常，因此没有添加到Db1Config类中。如果在实体类中使用@Column(name="first_name ")这样的注释显式指定了列名，则可以忽略这一点。</p></blockquote><p id="63b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.连接到<a class="ae kh" href="https://javarevisited.blogspot.com/2020/02/top-5-courses-to-learn-postgresql-in.html" rel="noopener ugc nofollow" target="_blank"> Postgresql数据库的示例域类。</a></p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="098f" class="ka kb hi jw b fi kc kd l ke kf">package com.example.myapp.domain;</span><span id="63ba" class="ka kb hi jw b fi kg kd l ke kf">@Entity<br/>public class Student {<br/><br/>    @Id<br/>    private Long id;<br/>    private String firstName;<br/>    private String lastName;<br/>    // constructors and getter setter methods<br/>}</span></pre><p id="5b52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.连接到<a class="ae kh" href="https://javarevisited.blogspot.com/2021/05/top-5-oracle-database-and-plsql-online-courses.html" rel="noopener ugc nofollow" target="_blank"> Oracle数据库</a>的示例域类</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="3fe9" class="ka kb hi jw b fi kc kd l ke kf">package com.example.myapp.domain;</span><span id="522c" class="ka kb hi jw b fi kg kd l ke kf">@Entity<br/>@Table(schema = "mydb2", name = "teacher")<br/>public class Teacher {<br/><br/>    @Id<br/>    private Long id;<br/>    private String firstName;<br/>    private String lastName;<br/>    // constructors and getter setter methods<br/>}</span></pre><p id="42a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样。</p><p id="51ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">资源:</p><div class="kq kr ez fb ks kt"><a href="https://examples.javacodegeeks.com/how-to-configure-multiple-data-sources-in-a-spring-boot-application/" rel="noopener  ugc nofollow" target="_blank"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">如何在Spring Boot应用程序中配置多个数据源</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">欢迎，在本教程中，我们将看到如何在单个引导应用程序中配置多个数据源。在这里我们…</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">examples.javacodegeeks.com</p></div></div><div class="lc l"><div class="ld l le lf lg lc lh li kt"/></div></div></a></div><div class="kq kr ez fb ks kt"><a href="https://stackoverflow.com/questions/39001044/hibernate-improvednamingstrategy-doesnt-work" rel="noopener  ugc nofollow" target="_blank"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">休眠改进命名策略不起作用</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">我有一个用snakecase命名的列和用camelcase命名的列的实体的数据库。</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">stackoverflow.com</p></div></div><div class="lc l"><div class="lj l le lf lg lc lh li kt"/></div></div></a></div><div class="kq kr ez fb ks kt"><a rel="noopener follow" target="_blank" href="/javarevisited/top-10-courses-to-learn-spring-boot-in-2020-best-of-lot-6ffce88a1b6e"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">我最喜欢的2021年学习Spring Boot的课程——最好的</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">大家好，如果你有兴趣学习Spring Boot并寻找一些很棒的资源，如书籍，教程…</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">medium.com</p></div></div><div class="lc l"><div class="lk l le lf lg lc lh li kt"/></div></div></a></div></div></div>    
</body>
</html>