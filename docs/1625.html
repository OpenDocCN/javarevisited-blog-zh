<html>
<head>
<title>Events, coffee and software architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">事件、咖啡和软件架构</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/events-coffee-and-software-architecture-25eb81ac3e68?source=collection_archive---------3-----------------------#2021-10-07">https://medium.com/javarevisited/events-coffee-and-software-architecture-25eb81ac3e68?source=collection_archive---------3-----------------------#2021-10-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6f27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好，我决定写这篇文章是为了整理我在处理微服务事件、队列和主题时学到的一些概念。这些概念帮助我理解了一点我所涉及的背景，并能够实际工作。</p><p id="4a44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果对某个人有帮助，我会很开心。</p><h2 id="363b" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">但首先，什么是事件？</h2><p id="a1dc" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">事件可以理解为由于某个实体的状态发生变化而在应用程序内部触发的触发器。</p><p id="275c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该实体可能已被创建、更改、删除等。如果打开此示例:</p><p id="1fde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">"我拿到工资后，就去海滩。"</p><p id="a8d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里发生了什么事？</p><p id="5a61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你问任何人，这件事就是去那个海滩旅行。但是如果你问任何一个开发者，他会说这个事件就是工资收据。</p><p id="428a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">把它带到大多数人都在使用的现有业务类型:网上购物。</p><p id="d811" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设启动了“付款批准”事件，由于该事件，可以执行其他操作。例如:分类库存商品，生成发票和更新订单状态。</p><p id="ec09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的主要任务是通知由x个<a class="ae kd" rel="noopener" href="/javarevisited/8-best-online-courses-to-learn-service-oriented-soa-and-microservices-architecture-94c01d6b94e6">微服务</a>组成的整个系统，某个事件已经发生，以便可以采取其他行动来响应它。</p><p id="dfbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦定义了事件的概念，就该考虑面向事件的架构了。</p><h2 id="8ab2" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">面向事件的架构</h2><blockquote class="ke kf kg"><p id="dfd4" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">“面向事件的架构是一种用于应用程序设计的<a class="ae kd" rel="noopener" href="/javarevisited/top-5-courses-to-learn-software-architecture-in-2020-best-of-lot-5d34ebc52e9">软件架构</a>模型。在事件驱动的系统中，事件捕获、通信、处理和持久性组件构成了解决方案的基本结构。这与传统的请求驱动模式不同。”<em class="hi"/><a class="ae kd" href="https://www.redhat.com/pt-br/topics/integration/what-is-event-driven-architecture" rel="noopener ugc nofollow" target="_blank"><em class="hi">摘自红帽网站，链接</em></a><em class="hi"/></p></blockquote><p id="80c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种类型的架构有一些优点，例如:</p><ul class=""><li id="e893" class="kl km hi ih b ii ij im in iq kn iu ko iy kp jc kq kr ks kt bi translated">系统组件之间的松散耦合，因为事件的生产者不关心谁在期待该事件。</li><li id="d059" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">它可以在任何<a class="ae kd" rel="noopener" href="/javarevisited/5-best-programming-languages-to-get-a-sofware-developer-job-in-google-3d8c83c444d6?source=---------17------------------">编程语言</a>中使用；</li><li id="9ddc" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">更强的抗破损能力。由于每个组件都有其运行所需的一切，因此即使与外界的通信中断，它也可以继续运行；</li><li id="4ced" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">新服务可以添加到解决方案中，而不需要现有服务知道它们，只需要新服务知道正在广播的事件。</li></ul><p id="d83f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在有一些<a class="ae kd" rel="noopener" href="/javarevisited/7-free-microservices-courses-for-java-programmers-c9b2f3a2ea7d">微服务</a>的环境中，我们可以有一个类似这样的设计:</p><figure class="la lb lc ld fd le er es paragraph-image"><a href="https://javarevisited.blogspot.com/2021/09/microservices-design-patterns-principles.html"><div class="er es kz"><img src="../Images/e7554ab0236d81d352104acdf0d8926d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OcL6R8tfu6CtTqXQi9MEYg.png"/></div></a></figure><p id="19ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个粗略的草案，没有详细说明这些事件的产生和接收在实践中是如何工作的。</p><p id="8e4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个架构的理想是使用中间件，在这个例子中，我将使用<a class="ae kd" rel="noopener" href="/javarevisited/top-10-apache-kafka-online-training-courses-and-certifications-621f3c13b38c">卡夫卡</a>。</p><p id="8503" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我放入一个中间件时，这种设计稍有改变，您可以看到耦合度有多低，此外还可以意识到，由于这一特性，可以将新系统放入解决方案中而影响很小，如果您打开:</p><figure class="la lb lc ld fd le er es paragraph-image"><a href="https://www.java67.com/2021/04/5-free-microservice-courses-for-java.html"><div class="er es lh"><img src="../Images/302f775c536e8f1a1ed23fe712ae4c54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l18iVFF1ECv-QFr2XCvoHg.png"/></div></a></figure><h2 id="d8b7" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">有趣的事情:</h2><ul class=""><li id="52f8" class="kl km hi ih b ii jy im jz iq li iu lj iy lk jc kq kr ks kt bi translated">这不是一个完整的流程，只是一部分。但是它已经可以给你一个主题的好主意；</li><li id="9338" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">如果需要执行反欺诈流程之外的一些事情，只需创建<a class="ae kd" rel="noopener" href="/javarevisited/10-best-java-microservices-courses-with-spring-boot-and-spring-cloud-6d04556bdfed">微服务</a>并监听事件。没有必要在创建购买事件的服务中做任何事情；</li><li id="5fb4" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">服务之间的耦合性非常低，能够同时在多个服务中生成维护的少数几件事情之一是表示所创建事件的消息格式；</li><li id="fb81" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">如果幂等性使用得好，应该没有重复的风险，因为事件消费者将准备好处理任何重复；</li></ul><h2 id="b0d2" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">可能发生的问题:</h2><ul class=""><li id="b408" class="kl km hi ih b ii jy im jz iq li iu lj iy lk jc kq kr ks kt bi translated">重复事件处理。想象一下向同一个客户收费两次？幂等性在这方面对我们帮助很大。</li><li id="3253" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">事件级联(更容易谷歌事件级联)。当一系列事件触发其他事件形成连接时，就会发生这种情况，这种连接可以用一种简单的方式来表示:事件A →生成事件B →生成事件C →生成事件d。理解一个事件可能是另一个事件的结果是可以的，但想象一下，一些程序员只处理事件C的消费，这里的大问题是他必须关心事件A的生成，这是不好的，因为它可能会生成不可预见的行为。理想的情况是确保服务是独立的，只有当您必须对与某个实体相关的某个事件的发布做出反应时，才更改该实体；</li></ul><h2 id="ddd3" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">要避免的要点:</h2><ul class=""><li id="0592" class="kl km hi ih b ii jy im jz iq li iu lj iy lk jc kq kr ks kt bi translated">尽可能避免使用通用事件。我们处理的实体必须在业务环境中有明确定义的含义。把解读类型当成消费者的责任，将来会产生很多令人头疼的问题；</li><li id="805d" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">期待消费者的回应；</li><li id="84ef" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">停止使用标题。报头携带用于事件处理的宝贵信息，例如事件类型、id、相关id、时间戳等；<br/>忘记实现幂等；</li><li id="dc1d" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">还有其他几点，现在只记得这些了。</li></ul></div></div>    
</body>
</html>