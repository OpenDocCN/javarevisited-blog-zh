<html>
<head>
<title>How to use Cloud Firestore in Spring Boot.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Spring Boot使用云Firestore？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/how-to-use-cloud-firestore-in-spring-boot-9a2e3bb0adca?source=collection_archive---------1-----------------------#2020-12-31">https://medium.com/javarevisited/how-to-use-cloud-firestore-in-spring-boot-9a2e3bb0adca?source=collection_archive---------1-----------------------#2020-12-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b3c70eeff6edd10f1d0b5bbc851de0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qGLkdPhUSNgT362GXvTdiw.jpeg"/></div></div><p class="iq ir et er es is it bd b be z dx translated">美国国家海洋和大气管理局在<a class="ae iu" href="https://unsplash.com/s/photos/fire-cloud?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="f79a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Firestore是Firebase platform中提供的可管理、可扩展的文档存储。我为什么喜欢它？你可以开始使用它，每天获得20K的读写次数，而不用支付一分钱，也不用分享你的信用卡信息。20K的读写对于试验和创建中小型应用程序来说绰绰有余。</p><p id="b66a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Firebase已经为不同的编程语言提供了一些功能丰富的客户端包。也有一个针对Java的，它的文档写得很好，可以开始使用。在这篇文章中，我想分享我是如何在我的项目中使用一些moden java和spring goodies来配置和访问firestore的。</p><p id="8006" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我在firebase控制台中创建了一个firestore项目，并获取了在我的应用程序中使用的访问密钥。然后我在我的spring boot项目中添加了依赖项<a class="ae iu" href="https://mvnrepository.com/artifact/com.google.firebase/firebase-admin/7.1.0" rel="noopener ugc nofollow" target="_blank"> firebase-admin </a>。</p><p id="ef4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我在我的项目中创建了一个名为<strong class="ix hj"> firestore </strong>的包，并在里面创建了一些文件。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="77e8" class="kc kd hi jy b fi ke kf l kg kh">├── firestore<br/>│   ├── AbstractFirestoreRepository.java<br/>│   ├── DocumentId.java<br/>│   └── FireStoreConfig.java</span></pre><p id="5b42" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">FireStoreConfig.java包含一个Bean，它读取和使用凭证并返回一个FireStore实例，该实例可用于访问集合和文档。这是我的FireStoreConfig类的样子:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="e692" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里，我采用了从<strong class="ix hj"> application.properties. </strong>下载的凭证JSON的路径，尽管我更喜欢从环境变量中保存和检索凭证相关的内容，但在这种情况下，我无法找到这样的方法。</p><p id="77f2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们存储在Firestore中的每个文档都包含一个唯一的Id。我创建了一个注释，这样我就可以注释我的实体类中的一个字段，它将被用作这个Id。我将此命名为<strong class="ix hj"> DocumentId </strong>，它看起来像:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="a05c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我写了AbstractFirestoreRepository，这是一个抽象的泛型类。从这个类中，我可以创建任意数量的提供类型的具体存储库。这个抽象存储库通过以通用方式实现firestore apis来包含CRUD方法。因此，我不必为我为项目创建的每个集合编写相同的样板代码。看起来是这样的:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="3e52" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我试图让大多数方法不言自明。所有的公共方法只是我们如何在firestore中保存、获取或删除文档的反映。但是我想补充几句关于其他方法的话，这会帮助你更好地理解我在做什么。</p><p id="49e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">getParameterizedType: 因为这是一个泛型类，这意味着我可以用它指定一个类型。比如我可以做一个这样的用户存储库:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="30d7" class="kc kd hi jy b fi ke kf l kg kh">public class UserRepo extends AbstractFirestoreRepository&lt;User&gt; {}</span></pre><p id="6dae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在一些像<em class="kk"> get </em>和<em class="kk"> retrieveAll </em>的方法中，我实际上需要<strong class="ix hj"> User.class </strong>对象。这个getParameterizedType有助于获取指定为&lt; T &gt;的类型。</p><p id="ccf4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> getDocumentId: </strong>我之前提到过，要在firestore中存储一个文档，我们需要一个惟一的Id，这个方法检查它接收到的对象中的每个字段的DocumentId注释。如果找到，它返回这个，如果没有，它返回一个UUID。由于这个方法有<em class="kk"> protected </em>修饰符，所以可以根据需要在子类中覆盖它。</p><p id="0d0c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，通过扩展这个方法，我可以在我的项目中创建尽可能多的库。示例存储库将如下所示:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="c0d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里是超级方法，第一个参数是FireStoreConfiguration中用Bean实例化的Firestore实例，第二个参数是集合的名称。</p><p id="2d5e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用户类如下所示:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="1745" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看，这里的id属性是用DocumentId注释的，在firestore中创建文档时，使用该字段的值作为Id会有所帮助。</p><p id="cb50" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">今天到此为止。我真的想为自定义查询编写一个通用方法。但是考虑到查询的语法及其异构性，它认为每个具体的存储库应该自己处理它们。但是如果你对此有任何想法，或者在springboot中集成firestore的更好的结构，请随时与我们分享。</p></div></div>    
</body>
</html>