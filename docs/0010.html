<html>
<head>
<title>By yourself some time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个人呆一会儿</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/by-yourself-some-time-e16c0f488847?source=collection_archive---------6-----------------------#2017-12-03">https://medium.com/javarevisited/by-yourself-some-time-e16c0f488847?source=collection_archive---------6-----------------------#2017-12-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f8b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">介词<code class="du jd je jf jg b">By</code>，及其对生产力的积极贡献。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/189e22a8ab589321aed11af2071049cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cx67KsARmh6AAYoxTnEDbw.png"/></div></div><p class="jt ju et er es jv jw bd b be z dx translated">阿鲁巴岛的棕榈岛——一个我想多呆些时间的地方</p></figure><h2 id="9d55" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">通过利用揭示意图的Java APIs实现智能工作</h2><p id="d8f5" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我们都有有限的时间。任何能节省我们编码时间、提高代码可读性的东西都是非常棒的。可读性是关键，因为我们读代码比写代码多得多。许多人可能不得不在整个生命周期中阅读一段代码，因此为他们节省时间是一个真正的好处。</p><h2 id="0e73" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">使用Eclipse集合可以节省时间吗？</h2><p id="4540" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">通过应用一些<code class="du jd je jf jg b">Function</code>，可以将<code class="du jd je jf jg b"><strong class="ih hj">aggregate</strong></code>、<code class="du jd je jf jg b"><strong class="ih hj">group</strong></code>、<code class="du jd je jf jg b"><strong class="ih hj">sum</strong></code>、<code class="du jd je jf jg b"><strong class="ih hj">count</strong></code>、<code class="du jd je jf jg b"><strong class="ih hj">min</strong></code>、<code class="du jd je jf jg b"><strong class="ih hj">max</strong></code>和<strong class="ih hj">的</strong>、<strong class="ih hj">转换为</strong>其他排序集合<em class="kx">。下面的<code class="du jd je jf jg b">By</code>方法在<a class="ae ky" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> Eclipse集合</a>中的每个<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/RichIterable.html" rel="noopener ugc nofollow" target="_blank">RichIterable</a></code>子类型上都可用。</em></p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es kz"><img src="../Images/410b8b827d689154f8a393e007ce854d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*skysRa74Cp9fTMgsUrj3pw.png"/></div></div><p class="jt ju et er es jv jw bd b be z dx translated">通过RichIterable中的方法(忽略collectByte方法)</p></figure><p id="3218" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将展示来自<a class="ae ky" href="https://github.com/eclipse/eclipse-collections-kata" rel="noopener ugc nofollow" target="_blank"> Eclipse集合Pet Kata </a>的三个例子，说明这些方法如何节省您阅读和编写代码的时间。</p><h2 id="facd" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">CountBy</h2><p id="55d0" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">如果你想通过属性或对那些东西应用一个<code class="du jd je jf jg b">Function</code>的结果来计数一个东西的集合，使用<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/RichIterable.html#countBy-org.eclipse.collections.api.block.function.Function-" rel="noopener ugc nofollow" target="_blank">countBy</a></code>。该方法将类型<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/block/function/Function.html" rel="noopener ugc nofollow" target="_blank">Function</a></code>作为参数，并返回一个<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/bag/Bag.html" rel="noopener ugc nofollow" target="_blank">Bag</a></code>。这个方法是在<a class="ae ky" rel="noopener" href="/@donraab/nine-features-in-eclipse-collections-9-0-a2ca97dfdf74"> Eclipse集合9.0 </a>中添加的。</p><p id="48bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码是一个强制性的Java解决方案，通过使用一个<code class="du jd je jf jg b">Map</code>，获取一个<code class="du jd je jf jg b">PetType</code>的<code class="du jd je jf jg b">List</code>，并对每个<code class="du jd je jf jg b">PetType</code>进行计数。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="7f88" class="le jy hi jg b be lf lg l lh li">List&lt;PetType&gt; petTypes =<br/>    this.people.flatCollect(Person::getPets).collect(Pet::getType);<br/><br/>Map&lt;PetType, Integer&gt; counts = Maps.mutable.empty();<br/>for (PetType petType : petTypes)<br/>{<br/>    Integer count = petTypeCounts.get(petType);<br/>    if (count == null)<br/>    {<br/>        count = 0;<br/>    }<br/>    petTypeCounts.put(petType, count + 1);<br/>}<br/><br/>Assert.assertEquals(Integer.valueOf(2), counts.get(PetType.CAT));<br/>Assert.assertEquals(Integer.valueOf(2), counts.get(PetType.DOG));<br/><br/>// The following test would fail as the Map would return null<br/>Assert.assertEquals(Integer.valueOf(0), counts.get(PetType.CONDOR));</span></pre><p id="0b35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Java 8流和<code class="du jd je jf jg b">groupingBy</code>和<code class="du jd je jf jg b">counting</code>收集器可以简化这些代码。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="099b" class="le jy hi jg b be lf lg l lh li">Map&lt;PetType, Long&gt; counts =<br/>    this.people.stream()<br/>        .flatMap(person -&gt; person.getPets().stream())<br/>        .collect(Collectors.groupingBy(Pet::getType,<br/>                                       Collectors.counting()));<br/><br/>Assert.assertEquals(Long.valueOf(2), counts.get(PetType.CAT));<br/>Assert.assertEquals(Long.valueOf(2), counts.get(PetType.DOG));<br/><br/>// The following test would fail as the Map would still return null<br/>Assert.assertEquals(Long.valueOf(0), counts.get(PetType.CONDOR));</span></pre><p id="5858" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的解决方案将使用Eclipse集合<code class="du jd je jf jg b">Bag</code>类型，而不是<code class="du jd je jf jg b">Map</code>。一个<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/bag/Bag.html" rel="noopener ugc nofollow" target="_blank">Bag</a></code>是计数键的一个<code class="du jd je jf jg b">Map</code>。Eclipse集合中的<code class="du jd je jf jg b">HashBag</code>实现使用一个<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/impl/map/mutable/primitive/ObjectIntHashMap.html" rel="noopener ugc nofollow" target="_blank">ObjectIntHashMap</a></code>进行存储，因此不需要将计数装箱为<code class="du jd je jf jg b">Integer</code>或<code class="du jd je jf jg b">Long</code>。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="5e99" class="le jy hi jg b be lf lg l lh li">Bag&lt;PetType&gt; counts =<br/>    this.people.asLazy()<br/>        .flatCollect(Person::getPets)<br/>        .collect(Pet::getType)<br/>        .toBag();<br/><br/>Assert.assertEquals(2, counts.occurrencesOf(PetType.CAT));<br/>Assert.assertEquals(2, counts.occurrencesOf(PetType.DOG));<br/>Assert.assertEquals(0, counts.occurrencesOf(PetType.CONDOR));</span></pre><p id="cd2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这段代码需要更少的时间来阅读，因为有更少的字符，但是如果你已经知道什么是<code class="du jd je jf jg b">Bag</code>的话，方法<code class="du jd je jf jg b">toBag</code>只会向你传达它的意图。</p><p id="27d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里使用<code class="du jd je jf jg b">countBy</code>对这个解决方案做了一个小小的修改。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="36d3" class="le jy hi jg b be lf lg l lh li">Bag&lt;PetType&gt; counts =<br/>    this.people.asLazy()<br/>        .flatCollect(Person::getPets)<br/>        .countBy(Pet::getType);<br/><br/>Assert.assertEquals(2, counts.occurrencesOf(PetType.CAT));<br/>Assert.assertEquals(2, counts.occurrencesOf(PetType.DOG));<br/>Assert.assertEquals(0, counts.occurrencesOf(PetType.CONDOR));</span></pre><p id="4eb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">减少代码，更好地传达意图。我们正在按它们的<code class="du jd je jf jg b">PetType</code>数所有的宠物。结果仍然是一个<code class="du jd je jf jg b">Bag</code>，因为这是返回的最佳数据结构。</p><h2 id="1848" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">分组依据</h2><p id="9846" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">如果您想使用一个函数为每个元素计算一个键来对集合的元素进行分组，请使用<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/RichIterable.html#groupBy-org.eclipse.collections.api.block.function.Function-" rel="noopener ugc nofollow" target="_blank">groupBy</a></code>。该方法将类型<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/block/function/Function.html" rel="noopener ugc nofollow" target="_blank">Function</a></code>作为参数，并返回一个<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/multimap/Multimap.html" rel="noopener ugc nofollow" target="_blank">Multimap</a></code>。</p><p id="09c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码是一个强制性的Java解决方案，用于获取一个<code class="du jd je jf jg b">Person</code>的<code class="du jd je jf jg b">List</code>并按照它们的姓氏对它们进行分组。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="9273" class="le jy hi jg b be lf lg l lh li">Map&lt;String, List&lt;Person&gt;&gt; lastNamesToPeople = Maps.mutable.empty();<br/>for (Person person : this.people)<br/>{<br/>    String lastName = person.getLastName();<br/>    List&lt;Person&gt; peopleWithLastName =<br/>        lastNamesToPeople.get(lastName);<br/>    if (peopleWithLastName == null)<br/>    {<br/>        peopleWithLastName = Lists.mutable.empty();<br/>        lastNamesToPeople.put(lastName, peopleWithLastName);<br/>    }<br/>    peopleWithLastName.add(person);<br/>}<br/><br/>Assert.assertEquals(3, lastNamesToPeople.get("Smith").size());</span></pre><p id="ca9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Java 8 Streams和<code class="du jd je jf jg b">Collectors</code>上的<code class="du jd je jf jg b">groupingBy</code>方法可以简化这段代码。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="c174" class="le jy hi jg b be lf lg l lh li">Map&lt;String, List&lt;Person&gt;&gt; lastNamesToPeople = <br/>    this.people.stream()<br/>        .collect(Collectors.groupingBy(Person::getLastName));<br/><br/>Assert.assertEquals(3, lastNamesToPeople.get("Smith").size());<br/>// This code will throw a NullPointerException<br/>Assert.assertEquals(0, lastNamesToPeople.get("Smith1").size());</span></pre><p id="c761" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Eclipse集合中的<code class="du jd je jf jg b">groupBy</code>可以进一步简化这段代码。与<code class="du jd je jf jg b">Collectors</code>上的<code class="du jd je jf jg b">groupingBy</code>返回一个<code class="du jd je jf jg b">Map</code>并将为丢失的键返回null不同，<code class="du jd je jf jg b">groupBy</code> <em class="kx"> </em>返回一个<code class="du jd je jf jg b">Multimap</code>。一个<code class="du jd je jf jg b">Multimap</code>将为丢失的键返回空集合。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="2168" class="le jy hi jg b be lf lg l lh li">Multimap&lt;String, Person&gt; lastNamesToPeople =<br/>    this.people.groupBy(Person::getLastName);<br/><br/>Assert.assertEquals(3, lastNamesToPeople.get("Smith").size());<br/>// This assertion passes, as a Multimap will return an empty list<br/>Assert.assertEquals(0, lastNamesToPeople.get("Smith1").size());</span></pre><h2 id="b869" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">GroupByEach</h2><p id="7162" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">如果您想使用一个为每个元素计算多个键的函数将集合中的元素组合在一起，请使用<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/RichIterable.html#groupByEach-org.eclipse.collections.api.block.function.Function-" rel="noopener ugc nofollow" target="_blank">groupByEach</a></code>。该方法将类型<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/block/function/Function.html" rel="noopener ugc nofollow" target="_blank">Function</a></code>作为参数，并返回一个<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/multimap/Multimap.html" rel="noopener ugc nofollow" target="_blank">Multimap</a></code>。<code class="du jd je jf jg b">Function</code>必须返回<code class="du jd je jf jg b">Iterable</code>的子类型。</p><p id="3bda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个命令式的Java例子，获取人员列表，并根据他们拥有的<code class="du jd je jf jg b">PetType</code>对他们进行分组，确保<code class="du jd je jf jg b">PetType</code>是唯一的。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="400b" class="le jy hi jg b be lf lg l lh li">Map&lt;PetType, Set&lt;Person&gt;&gt; peopleByPetType = Maps.mutable.empty();<br/><br/>for (Person person : this.people)<br/>{<br/>    MutableList&lt;Pet&gt; pets = person.getPets();<br/>    for (Pet pet : pets)<br/>    {<br/>        PetType petType = pet.getType();<br/>        Set&lt;Person&gt; peopleWithPetType = <br/>            peopleByPetType.get(petType);<br/>        if (peopleWithPetType == null)<br/>        {<br/>            peopleWithPetType = Sets.mutable.empty();<br/>            peopleByPetType.put(petType, peopleWithPetType);<br/>        }<br/>        peopleWithPetType.add(person);<br/>    }<br/>}<br/><br/>Assert.assertEquals(2, peopleByPetType.get(PetType.CAT).size());<br/>Assert.assertEquals(2, peopleByPetType.get(PetType.DOG).size());</span></pre><p id="50a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不知道有什么方法可以在不构建自己的<code class="du jd je jf jg b">Collector</code>的情况下，使用Java 8 Streams和<code class="du jd je jf jg b">Collectors</code>来做到这一点。下面是使用Eclipse Collections <code class="du jd je jf jg b">groupByEach</code>方法的解决方案。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="846e" class="le jy hi jg b be lf lg l lh li">Multimap&lt;PetType, Person&gt; multimap =<br/>    this.people.groupByEach(<br/>         Person::getPetTypes,<br/>         Multimaps.mutable.set.empty());<br/><br/>Assert.assertEquals(2, multimap.get(PetType.CAT).size());<br/>Assert.assertEquals(2, multimap.get(PetType.DOG).size());</span></pre><p id="b509" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，我需要传递一个空的<code class="du jd je jf jg b">MutableSetMultimap</code>作为要填充的目标集合，因为默认情况下会返回一个<code class="du jd je jf jg b">MutableListMultimap</code>。这是因为<em class="kx">这个人</em>是一个<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/list/MutableList.html" rel="noopener ugc nofollow" target="_blank">MutableList</a></code>。如果字段<code class="du jd je jf jg b">this.people</code>是一个<code class="du jd je jf jg b"><a class="ae ky" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/set/SetIterable.html" rel="noopener ugc nofollow" target="_blank">SetIterable</a></code>或子类，下面的将会工作。</p><pre class="ji jj jk jl fd la jg lb bn lc ld bi"><span id="5b90" class="le jy hi jg b be lf lg l lh li">Multimap&lt;PetType, Person&gt; multimap =<br/>    this.people.groupByEach(Person::getPetTypes);<br/><br/>Assert.assertEquals(2, multimap.get(PetType.CAT).size());<br/>Assert.assertEquals(2, multimap.get(PetType.DOG).size());</span></pre><h2 id="e9ea" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">不要错过节省时间的机会</h2><p id="dfe9" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">像<code class="du jd je jf jg b">countBy</code>、<code class="du jd je jf jg b">groupBy</code>和<code class="du jd je jf jg b">groupByEach</code>这样的高级方法可以对你的代码进行定量和定性的改进。通过使用更高级的API，比如Eclipse集合中的<code class="du jd je jf jg b">By</code>方法，您可以在项目生命周期中为自己和您的团队节省大量时间。</p><p id="ab85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">顺便说一句，有时生活中的小事和API会造成很大的不同。</p><p id="e004" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ky" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> <em class="kx">月食收藏</em> </a> <em class="kx">为</em> <a class="ae ky" href="https://github.com/eclipse/eclipse-collections/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank"> <em class="kx">投稿</em> </a> <em class="kx">。如果你喜欢这个库，你可以在GitHub上让我们知道。</em></p></div></div>    
</body>
</html>