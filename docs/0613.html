<html>
<head>
<title>Comparing a REST H2 Spring versus Quarkus application on Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">树莓Pi上REST H2弹簧与Quarkus应用的比较</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/comparing-a-rest-h2-spring-versus-quarkus-application-on-raspberry-pi-13013603fda8?source=collection_archive---------2-----------------------#2020-07-29">https://medium.com/javarevisited/comparing-a-rest-h2-spring-versus-quarkus-application-on-raspberry-pi-13013603fda8?source=collection_archive---------2-----------------------#2020-07-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8b9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的文章<a class="ae jd" rel="noopener" href="/javarevisited/a-spring-rest-and-h2-database-application-on-the-raspberry-pi-8e4587d57c4f">“Raspberry Pi上的Spring REST和H2数据库应用”</a>中，描述了一个通过REST API和Raspberry Pi上的Spring应用在H2数据库中存储传感器和测量值的例子。这个应用程序需要一些时间来启动树莓Pi，制作<a class="ae jd" href="https://airhacks.com/" rel="noopener ugc nofollow" target="_blank"> airhacks.fm播客</a>的<a class="ae jd" href="https://twitter.com/AdamBien" rel="noopener ugc nofollow" target="_blank">亚当·比恩</a>问我是否可以将它与类似的Quarkus应用程序进行比较。</p><p id="504f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接受挑战，以下是结果…；-)</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/19662bc88d1701a570a1e0972a085345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*01e35uyu6EYWdHZH.png"/></div></div></figure><h1 id="7ba8" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">用过的工具</h1><p id="eff6" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我使用AdoptOpenJDK 11和IntelliJ IDEA在PC上构建应用程序。Spring应用程序的<a class="ae jd" href="https://github.com/FDelporte/JavaOnRaspberryPi/tree/master/Chapter_10_Spring/java-spring-rest-db" rel="noopener ugc nofollow" target="_blank">源代码是我的书</a><a class="ae jd" href="https://webtechie.be/books" rel="noopener ugc nofollow" target="_blank">“在Raspberry Pi上开始使用Java”</a>中所有例子的一部分。在这篇文章中，使用Quarkus和Panache制作了一个类似的应用程序，完整的代码也可以在GitHub 上找到。</p><h1 id="4ddf" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">关于夸库斯</h1><p id="aa3d" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated"><a class="ae jd" href="https://quarkus.io/" rel="noopener ugc nofollow" target="_blank"> Quarkus </a>是开源的，最初由<a class="ae jd" href="https://www.redhat.com" rel="noopener ugc nofollow" target="_blank">红帽</a>开发，提供“超音速亚原子Java”。这是一个Kubernetes原生Java栈，为OpenJDK HotSpot和GraalVM量身定制，使用最好的Java库和标准。与其他云原生堆栈相比，它承诺使用更少的内存，启动更快。</p><h1 id="270d" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">关于派头</h1><p id="1603" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Panache允许你用Quarkus简化你的数据库代码，完整的描述见<a class="ae jd" href="https://quarkus.io/guides/hibernate-orm-panache" rel="noopener ugc nofollow" target="_blank">“quar kus——简化的Hibernate ORM with Panache”</a>。它构建在Hibernate ORM之上，将Java对象映射到关系数据库记录。</p><h1 id="73f2" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">应用程序是做什么的？</h1><p id="7204" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">这个示例Quarkus应用程序的目标与Spring概念验证应用程序完全相同:将数据存储在H2数据库中，并提供REST API来添加和读取该数据库中的数据。所以我们使用相同的图表:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kt"><img src="../Images/8ea89210727576ca256765b8945957c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/0*-7WEgHS55uyyle4L.jpg"/></div></figure><p id="08fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过集成Swagger UI，我们可以轻松测试API:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ku"><img src="../Images/3233d8ffbd2532d926a75978e00132a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8t00b8_tkiHY7D_A.png"/></div></div></figure><h1 id="2f17" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">一些代码示例</h1><p id="428c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">由于Quarkus和Panache扩展了Java EE，代码看起来非常类似于<a class="ae jd" rel="noopener" href="/javarevisited/10-free-spring-boot-tutorials-and-courses-for-java-developers-53dfe084587e?source=collection_home---4------7-----------------------"> Spring代码</a>，例如，对于一个测量实体:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="160c" class="la jr hi kw b fi lb lc l ld le">@Entity<br/>public class MeasurementEntity extends PanacheEntity {<br/><br/>    public String key;<br/>    public Double value;<br/>    public LocalDateTime timestamp;<br/><br/>    @ManyToOne<br/>    @JoinColumn(name = "sensor_id", nullable = false)<br/>    @JsonbTransient<br/>    public SensorEntity sensorEntity;<br/><br/>    public MeasurementEntity() {<br/>        // Required for mapping<br/>    }<br/><br/>    public MeasurementEntity(SensorEntity sensorEntity, <br/>        String key, Double value) {<br/>        this.sensorEntity = sensorEntity;<br/>        this.key = key;<br/>        this.value = value;<br/>        this.timestamp = LocalDateTime.now();<br/>    }<br/>}</span></pre><p id="e888" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">rest控制器还需要最少的代码，例如从数据库中获取所有测量值:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="1ac2" class="la jr hi kw b fi lb lc l ld le">@ApplicationScoped<br/>@Path("/measurement")<br/>public class MeasurementRepository implements<br/>        PanacheRepository&lt;MeasurementEntity&gt; {<br/><br/>    @GET<br/>    @Produces(MediaType.APPLICATION_JSON)<br/>    public List&lt;MeasurementEntity&gt; get() {<br/>        return this.findAll().list();<br/>    }<br/>}</span></pre><h1 id="55b3" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">现场编码和测试</h1><p id="e970" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在开发Quarkus应用程序时，dev-mode确实很吸引人。一旦有了可以运行的东西，就用以下命令启动应用程序:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="ac40" class="la jr hi kw b fi lb lc l ld le">$ mvn quarkus:dev</span></pre><p id="741e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码中的任何更改都将立即被重新编译，并准备好进行使用和测试。这意味着您可以在这个示例应用程序中添加额外的REST服务，并在Swagger UI中试用它们，而无需编译或重启应用程序。</p><p id="c2dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了比较<a class="ae jd" rel="noopener" href="/javarevisited/10-best-online-courses-to-learn-spring-framework-in-2020-f7f73599c2fd"> Spring </a>和Quarkus应用程序的启动速度，我使用了Spring JAR、Quarkus JAR和Quarkus本地应用程序。</p><h1 id="0e32" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">作为JAR文件</h1><p id="a90b" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">JAR文件可以用Maven在两个项目中创建，也可以像其他项目一样用java启动:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="d2ed" class="la jr hi kw b fi lb lc l ld le">$ mvn clean package<br/>$ java -jar target/java-spring-rest-db-0.0.1-SNAPSHOT.jar<br/>$ java -jar target/javaquarkusrestdb-1.0-SNAPSHOT-runner.jar</span></pre><h1 id="cfed" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">作为本机应用程序</h1><h1 id="5cd3" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">在Linux PC上</h1><p id="b062" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">使用提供的Docker文件，应用程序可以通过一个单独的<a class="ae jd" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-maven-jenkins-and-docker-for-java-developers-51fa7a1e66f6?source=collection_home---4------3-----------------------"> Maven命令</a>使用<a class="ae jd" href="https://www.graalvm.org/" rel="noopener ugc nofollow" target="_blank"> GraalVM </a>转换为本地应用程序。请记住，H2不能作为应用程序中的集成数据库，您需要独立运行它并调整应用程序。</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="cb2c" class="la jr hi kw b fi lb lc l ld le">$ mvn package -Pnative -Dquarkus.native.container-build=true<br/>$ target/javaquarkusrestdb-1.0-SNAPSHOT-runner<br/>__  ____  __  _____   ___  __ ____  ______ <br/> --/ __ \/ / / / _ | / _ \/ //_/ / / / __/ <br/> -/ /_/ / /_/ / __ |/ , _/ ,&lt; / /_/ /\ \   <br/>--\___\_\____/_/ |_/_/|_/_/|_|\____/___/   <br/>22:10:15 INFO  [io.ag.pool]] (main) Datasource '&lt;default&gt;': Initial size smaller than min. Connections will be created when necessary<br/>22:10:15 INFO  [io.quarkus]] (main) javaquarkusrestdb 1.0-SNAPSHOT native (powered by Quarkus 1.6.0.Final) started in 0.062s. Listening on: http://0.0.0.0:8080<br/>22:10:15 INFO  [io.quarkus]] (main) Profile prod activated. <br/>22:10:15 INFO  [io.quarkus]] (main) Installed features: [agroal, cdi, hibernate-orm, hibernate-orm-panache, jdbc-h2, mutiny, narayana-jta, resteasy, resteasy-jsonb, smallrye-context-propagation, smallrye-openapi, swagger-ui]</span></pre><p id="e011" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请看上面几行，确实<strong class="ih hj">启动时间是0.062s </strong>！！！我试了几次，得到的<strong class="ih hj">在0.040s到0.078s </strong>之间。比光还快:-)</p><h1 id="105a" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">为了树莓派</h1><p id="fa40" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Raspberry Pi 3和4有64位芯片，但Raspbian OS目前是32位系统。</p><h2 id="7e1c" class="la jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">运行在32位Raspbian操作系统上</h2><p id="c96c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">还没有GraalVM(还没有？)用于32位系统，所以不可能将Quarkus编译成Raspbian OS的本机应用程序。</p><p id="6874" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用的是JAR版本。启动<a class="ae jd" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-spring-framework-for-java-developers-639db9348d25">弹簧作用</a>:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="9828" class="la jr hi kw b fi lb lc l ld le">$ java -jar target/java-spring-rest-db-0.0.1-SNAPSHOT.jar<br/><br/>  .   ____          _            __ _ _<br/> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \<br/>( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \<br/> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )<br/>  '  |____| .__|_| |_|_| |_\__, | / / / /<br/> =========|_|==============|___/=/_/_/_/<br/> :: Spring Boot ::        (v2.1.8.RELEASE)<br/><br/>22:49:42.131  INFO 1702 --- [           main] b.w.j.JavaSpringRestDbApplication        : Starting JavaSpringRestDbApplication v0.0.1-SNAPSHOT on ubuntu with PID 1702 (/home/ubuntu/JavaOnRaspberryPi/Chapter_10_Spring/java-spring-rest-db/target/java-spring-rest-db-0.0.1-SNAPSHOT.jar started by ubuntu in /home/ubuntu)<br/>22:49:42.148  INFO 1702 --- [           main] b.w.j.JavaSpringRestDbApplication        : No active profile set, falling back to default profiles: default<br/>...<br/>22:50:16.205  INFO 1702 --- [           main] b.w.j.JavaSpringRestDbApplication        : Started JavaSpringRestDbApplication in 36.606 seconds (JVM running for 39.212)</span></pre><p id="b997" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动Quarkus应用程序:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="cbc9" class="la jr hi kw b fi lb lc l ld le">$ java -jar target/javaquarkusrestdb-1.0-SNAPSHOT-runner.jar<br/>__  ____  __  _____   ___  __ ____  ______ <br/> --/ __ \/ / / / _ | / _ \/ //_/ / / / __/ <br/> -/ /_/ / /_/ / __ |/ , _/ ,&lt; / /_/ /\ \   <br/>--\___\_\____/_/ |_/_/|_/_/|_|\____/___/   <br/>22:20:46 INFO  [io.ag.pool]] (main) Datasource '&lt;default&gt;': Initial size smaller than min. Connections will be created when necessary<br/>22:20:50 INFO  [io.quarkus]] (main) javaquarkusrestdb 1.0-SNAPSHOT on JVM (powered by Quarkus 1.6.0.Final) started in 9.259s. Listening on: http://0.0.0.0:8080</span></pre><h2 id="c3e4" class="la jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">在64位Ubuntu上运行</h2><p id="4351" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在Raspberry，他们正在开发Raspbian操作系统的64位预发布版本，但在这次测试中，我使用带有“Ubuntu 20.04 LTS (Raspberry Pi 3/4/，用于arm64架构的64位服务器操作系统)”的Raspberry Imager工具闪存了一个新的SD卡。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ls"><img src="../Images/38f24282cf8e87cf02d25ca9bbeedf88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/0*wT13BKJJO4ON12IY.png"/></div></figure><p id="a682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了能够在新的SD卡上运行和编译测试应用程序，需要一些额外的步骤，完整的步骤见本文底部。</p><p id="1c82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的概览表使用了与32位系统相同的JAR。</p><p id="a811" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不幸的是，我没能在Pi上创建一个本地应用程序。本机构建过程花费了很多时间，并且在该过程中的某个地方由于内存不足异常而不断失败。Docker构建过程也不能在Pi上工作。也许可以在PC上的<a class="ae jd" rel="noopener" href="/javarevisited/top-5-free-courses-to-learn-docker-for-beginners-best-of-lot-b2b1ad2b98ad?source=collection_home---4------2-----------------------"> Docker </a>中交叉编译aarch64的Raspberry Pi，但目前这已经超出了我的“舒适区”,所以我没有继续走这条路。</p><p id="edb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">“惊人的快速启动时间”——正如Quarkus网站上承诺的——已经被证实，至少在PC上是这样。而且在树莓派上，启动速度也快了很多。</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lt"><img src="../Images/29785bd61af0f9304461293a29335ed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*shtanNVYgxQV22YJFMMxuQ.png"/></div></figure><p id="f18c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">原生的速度非常快，但我只在我的电脑上安装了它…</p><ul class=""><li id="c383" class="lu lv hi ih b ii ij im in iq lw iu lx iy ly jc lz ma mb mc bi translated">(1个):戴尔i7，16 Gb内存，64位Ubuntu 20.04</li><li id="75d1" class="lu lv hi ih b ii md im me iq mf iu mg iy mh jc lz ma mb mc bi translated">(2):树莓派3B+ 1GB内存，博通BCM2837B0，Cortex-A53 (ARMv8) 64位SoC @ 1.4GHz</li><li id="cd55" class="lu lv hi ih b ii md im me iq mf iu mg iy mh jc lz ma mb mc bi translated">(3): Raspberry Pi 4B 4GB RAM、Broadcom BCM2711、四核Cortex-A72 (ARM v8) 64位SoC @ 1.5GHz</li><li id="b972" class="lu lv hi ih b ii md im me iq mf iu mg iy mh jc lz ma mb mc bi translated">(32b):32位Raspbian操作系统</li><li id="955a" class="lu lv hi ih b ii md im me iq mf iu mg iy mh jc lz ma mb mc bi translated">(64b): Ubuntu服务器操作系统20.04 LTS 64位</li></ul><h1 id="aa04" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">更多详细信息</h1><h1 id="6ad8" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">使用独立的H2数据库</h1><p id="8259" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">参见<a class="ae jd" href="https://o7planning.org/en/11895/installing-h2-database-and-using-h2-console" rel="noopener ugc nofollow" target="_blank">https://o7 planning . org/en/11895/installing-H2-database-and-use-H2-console</a></p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="82c0" class="la jr hi kw b fi lb lc l ld le">$ wget https://h2database.com/h2-2019-10-14.zip<br/>$ unzip h2-2019-10-14.zip<br/>$ cd h2/bin<br/>$ chmod +x h2.sh<br/>$ ./h2.sh</span></pre><p id="6731" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要能够从网络中的任何其他PC连接到web控制台，请参见<a class="ae jd" href="https://www.h2database.com/html/tutorial.html:" rel="noopener ugc nofollow" target="_blank">https://www.h2database.com/html/tutorial.html:</a></p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="88b7" class="la jr hi kw b fi lb lc l ld le">$ nano /home/ubuntu/.h2.server.properties </span><span id="0d8c" class="la jr hi kw b fi mi lc l ld le">webAllowOthers=true</span></pre><p id="10d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在web控制台中使用的连接设置:</p><p id="a288" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">driver Class:org . H2 . driver JDBC URL:JDBC:H2:TCP://localhost/~/H2 . db用户名:sa密码:{empty}</p><p id="8b95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将Quarkus应用程序与独立的H2数据库一起使用，需要将application.properties更改为:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="ceac" class="la jr hi kw b fi lb lc l ld le"># H2 database<br/>quarkus.datasource.url=jdbc:h2:tcp://localhost/~/test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE<br/>quarkus.datasource.driver=org.h2.Driver<br/>quarkus.datasource.username=sa<br/>quarkus.datasource.password=</span></pre><h1 id="6e13" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">在树莓Pi上编译Quarkus本地应用程序</h1><p id="f791" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">为了完整起见，这是我用来尝试从Quarkus应用程序的源代码构建本机应用程序的一步一步的步骤。</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="1d12" class="la jr hi kw b fi lb lc l ld le"># Install Maven<br/>$ sudo apt install maven<br/><br/>$ mvn -v<br/>Apache Maven 3.6.3<br/>Maven home: /usr/share/maven<br/>Java version: 11.0.8, vendor: Ubuntu, runtime: /usr/lib/jvm/java-11-openjdk-arm64<br/>Default locale: en, platform encoding: UTF-8<br/>OS name: "linux", version: "5.4.0-1013-raspi", arch: "aarch64", family: "unix"<br/><br/>$ java -version<br/>openjdk version "11.0.8" 2020-07-14<br/>OpenJDK Runtime Environment (build 11.0.8+10-post-Ubuntu-0ubuntu120.04)<br/>OpenJDK 64-Bit Server VM (build 11.0.8+10-post-Ubuntu-0ubuntu120.04, mixed mode)<br/><br/># Spring DB application<br/>$ git clone https://github.com/FDelporte/JavaOnRaspberryPi.git<br/>$ cd JavaOnRaspberryPi/Chapter_10_Spring/java-spring-rest-db/<br/>$ mvn clean package<br/>$ java -jar target/java-spring-rest-db-0.0.1-SNAPSHOT.jar<br/><br/># Quarkus DB application (first as JAR)<br/>$ git clone https://github.com/FDelporte/JavaQuarkusRestDb.git<br/>$ cd JavaQuarkusRestDb<br/>$ nano src/main/resources/application.properties<br/>quarkus.datasource.url=jdbc:h2:file:/home/ubuntu/database.db;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE<br/>$ java -jar target/javaquarkusrestdb-1.0-SNAPSHOT-runner.jar<br/><br/># Quarkus DB application (then as native)<br/># Building with Docker doesn't seem to work, so install GraalVM first<br/># https://www.graalvm.org/docs/getting-started/linux<br/>$ cd /home/ubuntu<br/>$ wget https://github.com/graalvm/graalvm-ce-builds/releases/download/vm-20.1.0/graalvm-ce-java11-linux-aarch64-20.1.0.tar.gz<br/>$ tar -xzf graalvm-ce-java11-linux-aarch64-20.1.0.tar.gz<br/>$ export PATH=/home/ubuntu/graalvm-ce-java11-20.1.0/bin:$PATH<br/>$ which java<br/>/home/ubuntu/graalvm-ce-java11-20.1.0/bin/java<br/>$ export GRAALVM_HOME=/home/ubuntu/graalvm-ce-java11-20.1.0/<br/>$ export JAVA_HOME=/home/ubuntu/graalvm-ce-java11-20.1.0/<br/># Make sure GRAALVM_HOME and JAVA_HOME are set as part of PATH<br/>$ echo $PATH<br/>$ echo GRAALVM_HOME<br/>$ echo JAVA_HOME<br/># Or use gu to install correctly<br/>$ /home/ubuntu/graalvm-ce-java11-20.1.0/bin/gu install native-image<br/><br/># You will will also need GCC, and the glibc and zlib headers<br/># https://quarkus.io/guides/building-native-image<br/>$ sudo apt-get install build-essential libz-dev zlib1g-dev<br/><br/># Tried to compile to native up to 4g xmx but each with out of memory exception<br/>$ mvn package -Pnative -Dquarkus.native.native-image-xmx=2g<br/><br/>$ mvn package -Pnative -DskipTests -Dquarkus.native.native-image-xmx=4g<br/>WARNING: An illegal reflective access operation has occurred<br/>WARNING: Illegal reflective access by com.google.inject.internal.cglib.core.$ReflectUtils$1 (file:/usr/share/maven/lib/guice.jar) to method java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int,java.security.ProtectionDomain)<br/>WARNING: Please consider reporting this to the maintainers of com.google.inject.internal.cglib.core.$ReflectUtils$1<br/>WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations<br/>WARNING: All illegal access operations will be denied in a future release<br/>[INFO] Scanning for projects...<br/>[INFO] <br/>[INFO] -------------------&lt; be.webtechie:javaquarkusrestdb &gt;-------------------<br/>[INFO] Building javaquarkusrestdb 1.0-SNAPSHOT<br/>[INFO] --------------------------------[ jar ]---------------------------------<br/>[INFO] <br/>[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ javaquarkusrestdb ---<br/>[INFO] Using 'UTF-8' encoding to copy filtered resources.<br/>[INFO] Copying 2 resources<br/>[INFO] <br/>[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ javaquarkusrestdb ---<br/>[INFO] Nothing to compile - all classes are up to date<br/>[INFO] <br/>[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ javaquarkusrestdb ---<br/>[INFO] Using 'UTF-8' encoding to copy filtered resources.<br/>[INFO] skip non existing resourceDirectory /home/ubuntu/JavaQuarkusRestDb/src/test/resources<br/>[INFO] <br/>[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ javaquarkusrestdb ---<br/>[INFO] Nothing to compile - all classes are up to date<br/>[INFO] <br/>[INFO] --- maven-surefire-plugin:2.22.1:test (default-test) @ javaquarkusrestdb ---<br/>[INFO] Tests are skipped.<br/>[INFO] <br/>[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ javaquarkusrestdb ---<br/>[INFO] <br/>[INFO] --- quarkus-maven-plugin:1.6.0.Final:build (default) @ javaquarkusrestdb ---<br/>[INFO] [org.jboss.threads] JBoss Threads version 3.1.1.Final<br/>[INFO] [org.hibernate.Version] HHH000412: Hibernate ORM core version 5.4.18.Final<br/>[INFO] [io.quarkus.deployment.pkg.steps.JarResultBuildStep] Building native image source jar: /home/ubuntu/JavaQuarkusRestDb/target/javaquarkusrestdb-1.0-SNAPSHOT-native-image-source-jar/javaquarkusrestdb-1.0-SNAPSHOT-runner.jar<br/>[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Building native image from /home/ubuntu/JavaQuarkusRestDb/target/javaquarkusrestdb-1.0-SNAPSHOT-native-image-source-jar/javaquarkusrestdb-1.0-SNAPSHOT-runner.jar<br/>[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Running Quarkus native-image plugin on GraalVM Version 20.1.0 (Java Version 11.0.7)<br/>[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] /home/ubuntu/graalvm-ce-java11-20.1.0/bin/native-image -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-DCoordinatorEnvironmentBean.transactionStatusManagerEnable=false -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=1 -J-Duser.language=en -J-Dfile.encoding=UTF-8 --initialize-at-build-time= -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy$BySpaceAndTime -H:+JNI -jar javaquarkusrestdb-1.0-SNAPSHOT-runner.jar -H:FallbackThreshold=0 -H:+ReportExceptionStackTraces -J-Xmx4g -H:-AddAllCharsets -H:-IncludeAllTimeZones -H:EnableURLProtocols=http,https --enable-all-security-services -H:NativeLinkerOption=-no-pie --no-server -H:-UseServiceLoaderFeature -H:+StackTrace javaquarkusrestdb-1.0-SNAPSHOT-runner<br/>-H:IncludeAllTimeZones and -H:IncludeTimeZones are now deprecated. Native-image includes all timezonesby default.<br/>[javaquarkusrestdb-1.0-SNAPSHOT-runner:31956]    classlist:  37,726.34 ms,  1.18 GB<br/>[javaquarkusrestdb-1.0-SNAPSHOT-runner:31956]        (cap):   3,495.30 ms,  1.18 GB<br/>[javaquarkusrestdb-1.0-SNAPSHOT-runner:31956]        setup:  13,476.39 ms,  1.18 GB<br/>04:55:45,582 INFO  [org.hib.Version] HHH000412: Hibernate ORM core version 5.4.18.Final<br/>04:55:45,631 INFO  [org.hib.ann.com.Version] HCANN000001: Hibernate Commons Annotations {5.1.0.Final}<br/>04:55:45,948 INFO  [org.hib.dia.Dialect] HHH000400: Using dialect: io.quarkus.hibernate.orm.runtime.dialect.QuarkusH2Dialect<br/>04:57:24,391 INFO  [org.jbo.threads] JBoss Threads version 3.1.1.Final<br/>Error: Image build request failed with exit status 137<br/>[INFO] ------------------------------------------------------------------------<br/>[INFO] BUILD FAILURE<br/>[INFO] ------------------------------------------------------------------------<br/>[INFO] Total time:  04:24 min<br/>[INFO] Finished at: 2020-07-28T04:58:44Z<br/>[INFO] ------------------------------------------------------------------------<br/>[ERROR] Failed to execute goal io.quarkus:quarkus-maven-plugin:1.6.0.Final:build (default) on project javaquarkusrestdb: Failed to build quarkus application: io.quarkus.builder.BuildException: Build failure: Build failed due to errors<br/>[ERROR]         [error]: Build step io.quarkus.deployment.pkg.steps.NativeImageBuildStep#build threw an exception: java.lang.RuntimeException: Failed to build native image<br/>[ERROR]         at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.build(NativeImageBuildStep.java:366)<br/>[ERROR]         at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br/>[ERROR]         at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br/>[ERROR]         at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br/>[ERROR]         at java.base/java.lang.reflect.Method.invoke(Method.java:566)<br/>[ERROR]         at io.quarkus.deployment.ExtensionLoader$2.execute(ExtensionLoader.java:932)<br/>[ERROR]         at io.quarkus.builder.BuildContext.run(BuildContext.java:277)<br/>[ERROR]         at org.jboss.threads.ContextClassLoaderSavingRunnable.run(ContextClassLoaderSavingRunnable.java:35)<br/>[ERROR]         at org.jboss.threads.EnhancedQueueExecutor.safeRun(EnhancedQueueExecutor.java:2046)<br/>[ERROR]         at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.doRunTask(EnhancedQueueExecutor.java:1578)<br/>[ERROR]         at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1452)<br/>[ERROR]         at java.base/java.lang.Thread.run(Thread.java:834)<br/>[ERROR]         at org.jboss.threads.JBossThread.run(JBossThread.java:479)<br/>[ERROR] Caused by: java.lang.RuntimeException: Image generation failed. Exit code was 137 which indicates an out of memory error. Consider increasing the Xmx value for native image generation by setting the "quarkus.native.native-image-xmx" property<br/>[ERROR]         at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.imageGenerationFailed(NativeImageBuildStep.java:411)<br/>[ERROR]         at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.build(NativeImageBuildStep.java:344)<br/>[ERROR]         ... 12 more<br/>[ERROR] -&gt; [Help 1]<br/>[ERROR] <br/>[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.<br/>[ERROR] Re-run Maven using the -X switch to enable full debug logging.<br/>[ERROR] <br/>[ERROR] For more information about the errors and possible solutions, please read the following articles:<br/>[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException</span></pre><p id="e26d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在PC上，我还成功地用<a class="ae jd" rel="noopener" href="/javarevisited/top-15-online-courses-to-learn-docker-kubernetes-and-aws-for-fullstack-developers-and-devops-d8cc4f16e773"> Docker </a>创建了一个原生应用程序，但在Raspberry Pi上却完全没有成功…</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="484c" class="la jr hi kw b fi lb lc l ld le"># Build native Quarkus appplication with Docker (skipping tests to speed up a bit...)<br/>$ sudo apt install docker.io<br/>$ sudo gpasswd -a ubuntu docker<br/>$ newgrp docker<br/>$ mvn package -Pnative -Dquarkus.native.container-build=true -DskipTests</span></pre></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><p id="97bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mq">最初发布于</em><a class="ae jd" href="https://webtechie.be/post/2020-07-28-spring-versus-quarkus-rest-h2-db-on-raspberry-pi/" rel="noopener ugc nofollow" target="_blank"><em class="mq">https://web techie . be</em></a><em class="mq">。</em></p></div></div>    
</body>
</html>