<html>
<head>
<title>Avoid this wrong usage of a method reference in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">避免 Java 中方法引用的这种错误用法</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/a-case-of-a-wrong-method-reference-6705c299a7ce?source=collection_archive---------5-----------------------#2019-03-28">https://medium.com/javarevisited/a-case-of-a-wrong-method-reference-6705c299a7ce?source=collection_archive---------5-----------------------#2019-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/af5145b11fc9585e1df7e9b6f4f16068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mzc9WVWe8SORYUa5"/></div></div><p class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae iu" href="https://unsplash.com/@neonbrand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>拍摄的照片</p></figure><p id="3d0a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看看这个。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="1769" class="kc kd hi jy b fi ke kf l kg kh">// returns an array of given length with random values.<br/>int[] randomArray(@Min(1) final int length) {<br/>    return range(0, length).map(current()::nextInt).toArray();<br/>}</span></pre><p id="1d5c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我看到下面的堆栈跟踪时，我简直惊呆了。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="54c9" class="kc kd hi jy b fi ke kf l kg kh">java.lang.IllegalArgumentException: bound must be positive<br/>at java.base/java.util.concurrent.ThreadLocalRandom.nextInt(ThreadLocalRandom.java:310)<br/>...</span></pre><p id="6adc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那么，怎么了？</p><p id="b092" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最初的意图是用<a class="ae iu" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadLocalRandom.html#nextInt--" rel="noopener ugc nofollow" target="_blank">threadlocalrrandom # nextInt()</a>映射每个索引。但是，通过使用方法引用，它实际上调用了<a class="ae iu" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadLocalRandom.html#nextInt-int-" rel="noopener ugc nofollow" target="_blank">threadlocalrrandom # nextInt(int bound)</a>。</p><p id="3622" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">代码实际上是这样工作的，</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="dae3" class="kc kd hi jy b fi ke kf l kg kh">map(i -&gt; current().nextInt(i))</span></pre><p id="6573" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我不得不像这样修理。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="72b3" class="kc kd hi jy b fi ke kf l kg kh">map(i -&gt; current().nextInt())</span></pre></div></div>    
</body>
</html>