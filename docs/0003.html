<html>
<head>
<title>As a matter of Factory — Part 1 (Mutable)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为工厂事务—第 1 部分(可变)</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/as-a-matter-of-factory-part-1-mutable-75cc2c5d72d9?source=collection_archive---------4-----------------------#2017-08-18">https://medium.com/javarevisited/as-a-matter-of-factory-part-1-mutable-75cc2c5d72d9?source=collection_archive---------4-----------------------#2017-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7acdf2b1a87963e6e2e854ea00864d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*053GOPYx3ptu6txdcP93Lw.png"/></div></div><p class="iq ir et er es is it bd b be z dx translated">黄色——JDK，蓝色——Eclipse 系列</p></figure><p id="7b50" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在过去的一年里，我阅读了一些关于 Java 9 即将推出的新特性的博客、文章和推文。有些文章的标题是“Java 9 中的不可变集合”。Java 集合接口(List、Set、Map)上将有新的工厂方法，这些方法将创建<strong class="iw hj">“紧凑的、不可修改的集合实例”</strong>。该功能在 http://openjdk.java.net/jeps/269 的 JEP 269—<a class="ae js" href="http://openjdk.java.net/jeps/269" rel="noopener ugc nofollow" target="_blank"/>中有描述。对于许多 Java 开发人员来说，这个特性将是一个受欢迎的新增功能，尤其是在像单元测试这样的地方，在那里创建小的集合可能是一个频繁且可能很麻烦的活动。</p><p id="72be" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是……我们在 Java 9 中没有得到“契约式”的不可变集合，JEP 269 也没有声称提供它们。如果我们在 Java 9 中获得“契约式”不可变集合，我希望看到名为<code class="du jt ju jv jw b">ImmutableCollection</code>、<code class="du jt ju jv jw b">ImmutableSet</code>、<code class="du jt ju jv jw b">ImmutableList</code>和<code class="du jt ju jv jw b">ImmutableMap</code>的新接口。然后，这些接口可以拥有“of”工厂方法来产生编译时安全的不可变集合实例。<code class="du jt ju jv jw b">ImmutableCollection</code>接口上不应该有<code class="du jt ju jv jw b">add</code> / <code class="du jt ju jv jw b">addAll</code>、<code class="du jt ju jv jw b">remove</code> / <code class="du jt ju jv jw b">removeAll</code>这样的方法，因为这些方法是不安全的，只能抛出<code class="du jt ju jv jw b">UnsupportedOperationException</code>。</p><p id="8c31" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您正在寻找 Java 的契约式不可变集合，现在有一些开源库可以提供它们。<a class="ae js" href="https://www.eclipse.org/collections/" rel="noopener ugc nofollow" target="_blank"> Eclipse Collections </a>提供了可变和不可变集合，并为它们提供了集合工厂。在这篇博客的第 1 部分中，我将比较 Eclipse 集合中可用的可变工厂方法和 Java 9 中将添加的新工厂方法。在第 2 部分中，我将探索可用于不可变集合的工厂。</p><p id="a1fe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Eclipse 集合中的所有可变容器实现都有静态工厂方法。这些方法仍然可用，因此您可以编写以下代码来使用 Eclipse 集合创建可变列表、集合和映射。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="3d19" class="kf kg hi jw b fi kh ki l kj kk">MutableList&lt;String&gt; list = <br/>    FastList.<strong class="jw hj"><em class="kl">newListWith</em></strong>("1", "2", "3");</span><span id="8bb5" class="kf kg hi jw b fi km ki l kj kk">MutableSet&lt;String&gt; set = <br/>    UnifiedSet.<strong class="jw hj"><em class="kl">newSetWith</em></strong>("1", "2", "3");</span><span id="5136" class="kf kg hi jw b fi km ki l kj kk">MutableMap&lt;Integer, String&gt; map = <br/>    UnifiedMap.<strong class="jw hj"><em class="kl">newWithKeysValues</em></strong>(1, "1", 2, "2", 3, "3");</span></pre><p id="92b9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于库的新开发人员来说，这些方法可能很难发现，因为开发人员首先需要知道适当的实现类的名称。</p><p id="8453" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当库中引入不可变集合时，我们必须决定如何创建它们。我们需要一种一致的方法来创建可变和不可变的集合，这种方法将遵循一种一致的约定，并且易于开发人员学习。我们的解决方案是创建专用的集合工厂类。我们决定在工厂类中使用的约定是将容器类型与以“s”结尾的相应类型相匹配。所以<code class="du jt ju jv jw b">List</code>(s)<code class="du jt ju jv jw b">Set</code>(s)<code class="du jt ju jv jw b">Map</code>(s)等等。我们的目标是这里有好的<a class="ae js" rel="noopener" href="/@donraab/symmetric-sympathy-2c59d4541d60">对称性</a>，这样我们就能满足开发者的期望。下面是使用工厂类创建可变集合实例的等效代码。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="c53b" class="kf kg hi jw b fi kh ki l kj kk">MutableList&lt;String&gt; list = <br/>    Lists.<strong class="jw hj"><em class="kl">mutable</em></strong>.with("1", "2", "3");</span><span id="a6a9" class="kf kg hi jw b fi km ki l kj kk">MutableSet&lt;String&gt; set = <br/>    Sets.<strong class="jw hj"><em class="kl">mutable</em></strong>.with("1", "2", "3");</span><span id="2bd6" class="kf kg hi jw b fi km ki l kj kk">MutableMap&lt;Integer, String&gt; map = <br/>    Maps.<strong class="jw hj"><em class="kl">mutable</em></strong>.with(1, "1", 2, "2");</span></pre><p id="58d5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果想创建空的可变集合，只需使用<code class="du jt ju jv jw b">empty()</code>方法。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="9f35" class="kf kg hi jw b fi kh ki l kj kk">MutableList&lt;String&gt; list = <br/>    Lists.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="a659" class="kf kg hi jw b fi km ki l kj kk">MutableSet&lt;String&gt; set = <br/>    Sets.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="2ea9" class="kf kg hi jw b fi km ki l kj kk">MutableMap&lt;Integer, String&gt; map = <br/>    Maps.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span></pre><p id="b09e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您想要一个更简洁的创建集合的选项，您可以使用带有静态导入的<a class="ae js" href="https://www.eclipse.org/collections/javadoc/8.2.0/org/eclipse/collections/impl/factory/Iterables.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> Iterables </strong> </a>类。那你可以写下面。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="5052" class="kf kg hi jw b fi kh ki l kj kk">MutableList&lt;String&gt; list = <br/>    <strong class="jw hj"><em class="kl">mList</em></strong>("1", "2", "3");</span><span id="9ad2" class="kf kg hi jw b fi km ki l kj kk">MutableSet&lt;String&gt; set = <br/>    <strong class="jw hj"><em class="kl">mSet</em></strong>("1", "2", "3");</span><span id="0c50" class="kf kg hi jw b fi km ki l kj kk">MutableMap&lt;Integer, String&gt; map = <br/>    <strong class="jw hj"><em class="kl">mMap</em></strong>(1, "1", 2, "2", 3, "3");</span></pre><p id="378c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">【m】</strong>方法是<strong class="iw hj">【可变】</strong>的简称，还有<strong class="iw hj">【I】</strong>方法是<strong class="iw hj">【不可变】</strong>的简称。</p><p id="8d88" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Eclipse 集合中的所有可变接口都扩展了 JDK 中相应的可变接口。所以<code class="du jt ju jv jw b"><a class="ae js" href="https://www.eclipse.org/collections/javadoc/8.2.0/org/eclipse/collections/api/list/MutableList.html" rel="noopener ugc nofollow" target="_blank">MutableList</a></code>是一个<code class="du jt ju jv jw b">java.util.List</code>，<code class="du jt ju jv jw b"><a class="ae js" href="https://www.eclipse.org/collections/javadoc/8.2.0/org/eclipse/collections/api/set/MutableSet.html" rel="noopener ugc nofollow" target="_blank">MutableSet</a></code>是一个<code class="du jt ju jv jw b">java.util.Set</code>等等。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7acdf2b1a87963e6e2e854ea00864d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*053GOPYx3ptu6txdcP93Lw.png"/></div></div><p class="iq ir et er es is it bd b be z dx translated">黄色——JDK，蓝色——Eclipse 系列</p></figure><p id="2d3c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">可变工厂将返回最具体的类型(例如<code class="du jt ju jv jw b">MutableList</code>)，但是您可以选择使用更抽象的类型(例如<code class="du jt ju jv jw b">java.util.List</code>)。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="59c2" class="kf kg hi jw b fi kh ki l kj kk">List&lt;String&gt; list = <br/>    Lists.<strong class="jw hj"><em class="kl">mutable</em></strong>.with("1", "2", "3");</span><span id="e4c0" class="kf kg hi jw b fi km ki l kj kk">Set&lt;String&gt; set = <br/>    Sets.<strong class="jw hj"><em class="kl">mutable</em></strong>.with("1", "2", "3");</span><span id="7ed1" class="kf kg hi jw b fi km ki l kj kk">Map&lt;Integer, String&gt; map = <br/>    Maps.<strong class="jw hj"><em class="kl">mutable</em></strong>.with(1, "1", 2, "2", 3, "3");</span></pre><p id="a744" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Java 9 中添加的工厂方法如下所示。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="da72" class="kf kg hi jw b fi kh ki l kj kk">List&lt;String&gt; list = <br/>    List.of("1", "2", "3");</span><span id="6b23" class="kf kg hi jw b fi km ki l kj kk">Set&lt;String&gt; set = <br/>    Set.of("1", "2", "3");</span><span id="3554" class="kf kg hi jw b fi km ki l kj kk">Map&lt;Integer, String&gt; map = <br/>    Map.of(1, "1", 2, "2", 3, "3");</span></pre><p id="8a6c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">不同的是，上面的方法返回不可修改的实例，这些实例有可变的接口。</p><p id="a414" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您希望使用 java.util.Collection 接口，并且希望返回的实例像上面的 Java 9 工厂方法一样不可修改，那么您可以使用 Eclipse 集合中所有可变集合上可用的<code class="du jt ju jv jw b">asUnmodifiable()</code>方法。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="8286" class="kf kg hi jw b fi kh ki l kj kk">List&lt;String&gt; list = <br/>    Lists.<strong class="jw hj"><em class="kl">mutable</em></strong>.with("1", "2", "3").<strong class="jw hj">asUnmodifiable</strong>();</span><span id="10ff" class="kf kg hi jw b fi km ki l kj kk">Set&lt;String&gt; set = <br/>    Sets.<strong class="jw hj"><em class="kl">mutable</em></strong>.with("1", "2", "3").<strong class="jw hj">asUnmodifiable</strong>();</span><span id="8145" class="kf kg hi jw b fi km ki l kj kk">Map&lt;Integer, String&gt; map = <br/>    Maps.<strong class="jw hj"><em class="kl">mutable</em></strong>.with(1, "1", 2, "2", 3, "3").<strong class="jw hj">asUnmodifiable</strong>();</span></pre><p id="973c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果想让它们同步，可以用<code class="du jt ju jv jw b">asSynchronized()</code>。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="aeb6" class="kf kg hi jw b fi kh ki l kj kk">List&lt;String&gt; list = <br/>    Lists.<strong class="jw hj"><em class="kl">mutable</em></strong>.with("1", "2", "3").<strong class="jw hj">asSynchronized</strong>();</span><span id="c872" class="kf kg hi jw b fi km ki l kj kk">Set&lt;String&gt; set = <br/>    Sets.<strong class="jw hj"><em class="kl">mutable</em></strong>.with("1", "2", "3").<strong class="jw hj">asSynchronized</strong>();</span><span id="c050" class="kf kg hi jw b fi km ki l kj kk">Map&lt;Integer, String&gt; map = <br/>    Maps.<strong class="jw hj"><em class="kl">mutable</em></strong>.with(1, "1", 2, "2", 3, "3").<strong class="jw hj">asSynchronized</strong>();</span></pre><p id="13a5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面显示了 Eclipse 集合中可用的可变对象集合的所有工厂。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="675a" class="kf kg hi jw b fi kh ki l kj kk">MutableList&lt;T&gt; list = Lists.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="636d" class="kf kg hi jw b fi km ki l kj kk">MutableSet&lt;T&gt; set = Sets.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();<br/>MutableSortedSet&lt;T&gt; sortedSet = SortedSets.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="01fc" class="kf kg hi jw b fi km ki l kj kk">MutableMap&lt;K, V&gt; map = Maps.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();<br/>MutableSortedMap&lt;K, V&gt; sortedMap = SortedMaps.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="9e57" class="kf kg hi jw b fi km ki l kj kk">MutableStack&lt;T&gt; stack = Stacks.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="d21c" class="kf kg hi jw b fi km ki l kj kk">MutableBag&lt;T&gt; bag = Bags.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();<br/>MutableSortedBag&lt;T&gt; sortedBag = SortedBags.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="4819" class="kf kg hi jw b fi km ki l kj kk">MutableBiMap&lt;K, V&gt; biMap = BiMaps.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="0eb4" class="kf kg hi jw b fi km ki l kj kk">MutableListMultimap&lt;K, V&gt; multimap = Multimaps.<strong class="jw hj"><em class="kl">mutable</em></strong>.list.empty();<br/>MutableSetMultimap&lt;K, V&gt; multimap = Multimaps.<strong class="jw hj"><em class="kl">mutable</em></strong>.set.empty();<br/>MutableBagMultimap&lt;K, V&gt; multimap = Multimaps.<strong class="jw hj"><em class="kl">mutable</em></strong>.bag.empty();</span></pre><p id="db0c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Eclipse 集合也支持所有八种 Java 原语类型的容器。为了提供与对应对象的良好对称，所有可变原始容器类型都有<a class="ae js" href="https://github.com/eclipse/eclipse-collections/blob/master/docs/guide.md#-creating-primitive-collections" rel="noopener ugc nofollow" target="_blank">工厂类。</a></p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="61f9" class="kf kg hi jw b fi kh ki l kj kk">MutableIntList list = <br/>    IntLists.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();<br/>MutableIntSet set = <br/>    IntSets.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();<br/>MutableIntBag bag = <br/>    IntBags.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();<br/>MutableIntStack stack = <br/>    IntStacks.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span><span id="b7bd" class="kf kg hi jw b fi km ki l kj kk">// supports all combinations for all 8 primitives<br/>MutableIntIntMap map = <br/>    IntIntMaps.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();  <br/>MutableIntObjectMap&lt;V&gt; map = <br/>    IntObjectMaps.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();<br/>MutableObjectIntMap&lt;K&gt; map = <br/>    ObjectIntMaps.<strong class="jw hj"><em class="kl">mutable</em></strong>.empty();</span></pre><p id="4c1f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所有容器类型的所有基本类型都有工厂。可变原语容器也有不可修改的和同步的版本，以提供与其对象对应物的良好对称性。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="b8eb" class="kf kg hi jw b fi kh ki l kj kk">MutableIntList list = <br/>    IntLists.<strong class="jw hj"><em class="kl">mutable</em></strong>.with(1, 2, 3).<strong class="jw hj">asUnmodifiable</strong>();</span><span id="2ebf" class="kf kg hi jw b fi km ki l kj kk">MutableIntList list = <br/>    IntLists.<strong class="jw hj"><em class="kl">mutable</em></strong>.with(1, 2, 3).<strong class="jw hj">asSynchronized</strong>();</span></pre><p id="4f2a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Eclipse 集合中的集合工厂可以与所有版本的 Java 一起工作，一直到版本 5。如果您想在 Java 8 之前的 Java 版本中使用集合工厂，您需要使用 Eclipse Collections 7 . x。Eclipse Collections 8 . x 只与 Java 8+兼容。Eclipse 集合 7.x 和 8.x 都支持<a class="ae js" rel="noopener" href="/javarevisited/top-5-java-online-courses-for-beginners-best-of-lot-1e1e240a758"> Java 8 </a>。</p><p id="9fa6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">同</strong>同<em class="kl">或</em>同</p><p id="5a5c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">到目前为止，我展示的所有使用“<strong class="iw hj">和</strong>”的例子也可以使用“<strong class="iw hj"> of </strong>”来编写。在“with”和“of”的命名战中，有两个赢家。所以如果你喜欢用而不是用，你可以这样写。FWIW，“with”方式更符合 Smalltalk 风格。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="fb8f" class="kf kg hi jw b fi kh ki l kj kk">List&lt;String&gt; list = <br/>    Lists.<strong class="jw hj"><em class="kl">mutable</em></strong>.of("1", "2", "3");</span><span id="64e7" class="kf kg hi jw b fi km ki l kj kk">Set&lt;String&gt; set = <br/>    Sets.<strong class="jw hj"><em class="kl">mutable</em></strong>.of("1", "2", "3");</span><span id="2f21" class="kf kg hi jw b fi km ki l kj kk">Map&lt;Integer, String&gt; map = <br/>    Maps.<strong class="jw hj"><em class="kl">mutable</em></strong>.of(1, "1", 2, "2", 3, "3");</span></pre><p id="4393" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我认为这是暂时停下来的好地方。在本博客系列的第 2 部分中，我将概述可用于 Eclipse 集合的不可变工厂。</p><p id="7a53" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> <em class="kl">月食收藏</em> </a> <em class="kl">是开给</em> <a class="ae js" href="https://github.com/eclipse/eclipse-collections/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank"> <em class="kl">投稿</em> </a> <em class="kl">的。如果你喜欢这个库，你可以在 GitHub 上让我们知道。</em></p></div></div>    
</body>
</html>