<html>
<head>
<title>Microservices with Spring Boot — Part 4 — Load Balancing Example — Using Ribbon</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot微服务—第4部分—负载平衡示例—使用Ribbon</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/microservices-with-spring-boot-part-4-load-balancing-example-using-ribbon-dd41f3217f47?source=collection_archive---------0-----------------------#2020-01-15">https://medium.com/javarevisited/microservices-with-spring-boot-part-4-load-balancing-example-using-ribbon-dd41f3217f47?source=collection_archive---------0-----------------------#2020-01-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1d53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们来学习一下微服务和微服务架构的基础知识。我们还将开始研究Spring Boot微服务的基本实现。我们将创建几个微服务，并让它们使用Eureka命名服务器和Ribbon进行客户端负载平衡。</p><p id="69cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是微服务系列大纲:Spring Boot微服务</p><ul class=""><li id="3665" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">第1部分— <a class="ae jm" href="https://www.springboottutorial.com/creating-microservices-with-spring-boot-part-1-getting-started" rel="noopener ugc nofollow" target="_blank">微服务架构入门</a></li><li id="9d63" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">第二部分— <a class="ae jm" href="https://www.springboottutorial.com/creating-microservices-with-spring-boot-part-2-forex-microservice" rel="noopener ugc nofollow" target="_blank">打造外汇微服务</a></li><li id="3c00" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">第3部分— <a class="ae jm" href="https://www.springboottutorial.com/creating-microservices-with-spring-boot-part-3-currency-conversion-microservice" rel="noopener ugc nofollow" target="_blank">创建货币兑换微服务</a></li><li id="6e8c" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">当前零件-零件4-使用Ribbon进行负载平衡</li><li id="2d7f" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">第5部分— <a class="ae jm" href="https://www.springboottutorial.com/microservices-with-spring-boot-part-5-eureka-naming-server" rel="noopener ugc nofollow" target="_blank">使用Eureka命名服务器</a></li></ul><p id="aae8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是本系列的第4部分。在这一部分中，我们将重点介绍如何使用Ribbon进行负载平衡。</p><h1 id="e67d" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">你会学到的</h1><ul class=""><li id="4a12" class="jd je hi ih b ii kq im kr iq ks iu kt iy ku jc ji jj jk jl bi translated">负载平衡的需求是什么？</li><li id="5b98" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">什么是丝带？</li><li id="24a2" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">你是如何给你的Spring Boot项目添加彩带的？</li><li id="96a7" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">如何启用和配置Ribbon来实现负载平衡？</li></ul><h1 id="b42a" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">免费课程—10步学会</h1><ul class=""><li id="afbd" class="jd je hi ih b ii kq im kr iq ks iu kt iy ku jc ji jj jk jl bi translated"><a class="ae jm" href="https://links.in28minutes.com/SBT-Page-Top-LearningChallenge-SpringBoot" rel="noopener ugc nofollow" target="_blank">免费5天挑战——学习春天和Spring Boot </a></li><li id="4130" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://links.in28minutes.com/in28minutes-10steps-springboot" rel="noopener ugc nofollow" target="_blank">用10个步骤学习Spring Boot</a></li><li id="fa11" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://links.in28minutes.com/in28minutes-10steps-docker" rel="noopener ugc nofollow" target="_blank">10步学会Docker</a></li><li id="125f" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://links.in28minutes.com/in28minutes-10steps-k8s" rel="noopener ugc nofollow" target="_blank">十步学会Kubernetes</a></li><li id="0e7d" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://links.in28minutes.com/in28minutes-10steps-aws-beanstalk" rel="noopener ugc nofollow" target="_blank">用10个步骤学习AWS</a></li></ul><h1 id="c3ba" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">微服务概述</h1><p id="ff0d" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在前两部分中，我们创建了微服务，并在它们之间建立了通信。</p><p id="d85c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到<a class="ae jm" href="http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000" rel="noopener ugc nofollow" target="_blank">http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000</a></p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="7a29" class="lh jt hi ld b fi li lj l lk ll">{<br/>  id: 10002,<br/>  from: "EUR",<br/>  to: "INR",<br/>  conversionMultiple: 75,<br/>  quantity: 10000,<br/>  totalCalculatedAmount: 750000,<br/>  port: 8000,<br/>}</span></pre><blockquote class="lm ln lo"><p id="a43b" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">当我们执行上述服务时，您会看到一个请求也被发送到外汇服务。</p></blockquote><p id="6652" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太酷了！</p><p id="4453" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在已经创建了两个微服务，并在它们之间建立了通信。</p><figure class="ky kz la lb fd lu er es paragraph-image"><div class="er es lt"><img src="../Images/34a0aab24f4e5308a62629e8e9b2aca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/0*qmBkKy9hEq6oqCgj.png"/></div></figure><p id="7cd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我们在CCS组件<code class="du lx ly lz ld b">CurrencyExchangeServiceProxy</code>中硬编码FS的url。</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="8c5d" class="lh jt hi ld b fi li lj l lk ll">@FeignClient(name="forex-service" url="localhost:8000")<br/>public interface CurrencyExchangeServiceProxy {<br/>  @GetMapping("/currency-exchange/from/{from}/to/{to}")<br/>  public CurrencyConversionBean retrieveExchangeValue<br/>    (@PathVariable("from") String from, @PathVariable("to") String to);<br/>}</span></pre><p id="c8dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着当外汇服务的新实例启动时，我们没有办法向它们分配负载。</p><p id="8eb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一部分中，现在让我们使用Ribbon来启用客户端负载分布。</p><h1 id="836d" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">您将需要的工具</h1><ul class=""><li id="ff68" class="jd je hi ih b ii kq im kr iq ks iu kt iy ku jc ji jj jk jl bi translated">Maven 3.0+是您的构建工具</li><li id="0bf4" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">你最喜欢的IDE。我们使用Eclipse。</li><li id="6b49" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">JDK 1.8以上</li></ul><h1 id="fb78" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">用代码示例完成Maven项目</h1><blockquote class="lm ln lo"><p id="e99f" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">我们的Github存储库中有所有的代码示例—<a class="ae jm" href="https://github.com/in28minutes/spring-boot-examples/tree/master/spring-boot-basic-microservice" rel="noopener ugc nofollow" target="_blank">https://Github . com/in28 minutes/spring-boot-examples/tree/master/spring-boot-basic-microservice</a></p></blockquote><h1 id="40b3" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">启用功能区</h1><p id="752a" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">向pom.xml添加功能区依赖项</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="7b94" class="lh jt hi ld b fi li lj l lk ll">&lt;dependency&gt;<br/>      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>      &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;</span></pre><p id="9ee2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在CurrencyExchangeServiceProxy中启用RibbonClient</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="6502" class="lh jt hi ld b fi li lj l lk ll">@FeignClient(name="forex-service")<br/>@RibbonClient(name="forex-service")<br/>public interface CurrencyExchangeServiceProxy {</span></pre><p id="9059" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在application.properties中配置实例</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="5985" class="lh jt hi ld b fi li lj l lk ll">forex-service.ribbon.listOfServers=localhost:8000,localhost:8001</span></pre><h1 id="fa95" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">在8001上推出外汇服务</h1><p id="7e0e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在上面的步骤中，我们配置了ribbon来将负载分配给实例。但是，我们没有在8001上运行外汇服务的任何实例。</p><p id="b7d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过配置启动配置来启动它，如下图所示。</p><figure class="ky kz la lb fd lu er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es ma"><img src="../Images/300c67f25635ad7edad7f5bb81577652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zr7KYuogxKWHpmiR.png"/></div></div></figure><h1 id="924f" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">丝带在行动</h1><p id="f83d" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">目前，我们已经启动并运行了以下服务</p><ul class=""><li id="00a8" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">8100上的货币兑换微服务(CCS)</li><li id="f8aa" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">8000和8001上的两个Forex微服务实例</li></ul><p id="d8dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您会看到对CCS的请求将通过Ribbon在Forex微服务的两个实例之间分发</p><h1 id="75ab" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">请求1</h1><p id="9098" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">转到<a class="ae jm" href="http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000" rel="noopener ugc nofollow" target="_blank">http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000</a></p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="6ee0" class="lh jt hi ld b fi li lj l lk ll">{<br/>  id: 10002,<br/>  from: "EUR",<br/>  to: "INR",<br/>  conversionMultiple: 75,<br/>  quantity: 10000,<br/>  totalCalculatedAmount: 750000,<br/>  port: 8000,<br/>}</span></pre><h1 id="9d62" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">请求2</h1><p id="7027" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">转到<a class="ae jm" href="http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000" rel="noopener ugc nofollow" target="_blank">http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000</a></p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="4475" class="lh jt hi ld b fi li lj l lk ll">{<br/>  id: 10002,<br/>  from: "EUR",<br/>  to: "INR",<br/>  conversionMultiple: 75,<br/>  quantity: 10000,<br/>  totalCalculatedAmount: 750000,<br/>  port: 8001,<br/>}</span></pre><p id="cc7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到两个响应中的端口号是不同的。</p><h1 id="a56a" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">摘要</h1><p id="c83d" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">我们现在已经创建了两个微服务，并在它们之间建立了通信。</p><figure class="ky kz la lb fd lu er es paragraph-image"><div class="er es lt"><img src="../Images/f1b0be73b713f163222faff0aaf9e60b.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/0*dhj_Q-XlyYUVT0MH.png"/></div></figure><p id="3fe2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用Ribbon在Forex服务的两个实例之间分配负载。</p><p id="b270" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我们在CCS中硬编码了FS的两个实例的URL。这意味着每当有一个新的FS实例时，我们都需要更改CCS的配置。那不酷。</p><p id="a4ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一部分中，我们将使用Eureka命名服务器来解决这个问题。</p><h1 id="35fb" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">后续步骤</h1><p id="b43e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">继续微服务系列—Spring Boot微服务</p><ul class=""><li id="b561" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">第1部分— <a class="ae jm" href="https://www.springboottutorial.com/creating-microservices-with-spring-boot-part-1-getting-started" rel="noopener ugc nofollow" target="_blank">微服务架构入门</a></li><li id="390e" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">第2部分-<a class="ae jm" href="https://www.springboottutorial.com/creating-microservices-with-spring-boot-part-2-forex-microservice" rel="noopener ugc nofollow" target="_blank">创建外汇微服务</a></li><li id="ac98" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">第3部分-<a class="ae jm" href="https://www.springboottutorial.com/creating-microservices-with-spring-boot-part-3-currency-conversion-microservice" rel="noopener ugc nofollow" target="_blank">创建货币兑换微服务</a></li><li id="0243" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">当前部分—第4部分—使用功能区进行负载平衡</li><li id="f784" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">第5部分— <a class="ae jm" href="https://www.springboottutorial.com/microservices-with-spring-boot-part-5-eureka-naming-server" rel="noopener ugc nofollow" target="_blank">使用尤里卡命名服务器</a></li></ul></div></div>    
</body>
</html>