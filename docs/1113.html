<html>
<head>
<title>Replacing Wrapper classes with Java Records in Stream processing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在流处理中用Java记录替换包装类</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/replacing-wrapper-classes-with-java-records-in-stream-processing-6cc0e89b8f64?source=collection_archive---------0-----------------------#2021-03-31">https://medium.com/javarevisited/replacing-wrapper-classes-with-java-records-in-stream-processing-6cc0e89b8f64?source=collection_archive---------0-----------------------#2021-03-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ecc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带有代码片段的简单案例研究</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1f4a73cbe6959591258a58bbdb5141d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZJt0rtAETBXpsDxaptHjA.png"/></div></div></figure><p id="e4f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">承认吧，一旦深入Java流处理，就没有回头路了。</p><p id="dee8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的旧代码中，看到循环的<em class="jp">时，您会退缩。流处理的一切都很好，除了一点。包装类。</em></p><p id="e90c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的数据处理很复杂，并且涉及多个数据转换步骤，那么您需要创建占用大量空间的包装类。</p><p id="2d58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">即使包装类是<a class="ae jq" rel="noopener" href="/javarevisited/how-to-create-an-immutable-list-list-and-map-in-java-5ac1254c128?source=---------31------------------">不可变的</a>(没有设置器)，您仍然需要在您的服务类中创建一个内部类。</p><p id="ee3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是其中一个地方，<a class="ae jq" href="https://openjdk.java.net/jeps/395" rel="noopener ugc nofollow" target="_blank">战绩</a>班成绩最好。</p><p id="21cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过一个案例来研究这个问题，我举了一个很久以前的雇员-雇主用例。假设我们正在实现一个人事管理软件的一部分。让我们称我们的软件为EmployeeSoft)</p><p id="c7b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设EmployeeSoft是一个SaaS，有一个集中的处理线。</p><p id="b0af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在EmployeeSoft中实现一个部分，系统将在其中更新员工的工资。对于一个财政年度末的雇主列表，我们需要根据加薪百分比更新相应雇员的工资。</p><p id="e6ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的数据类将会是这样的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/02/java-9-example-factory-methods-for-collections-immutable-list-set-map.html"><div class="er es jr"><img src="../Images/69cba92ccfdb23394f658ff203cbb6b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*4Szc6qtphvfIhyaM40o1SQ.jpeg"/></div></a></figure><p id="e0e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在三月底，我们的EmployeeSoft已经收集了想要更新员工工资的雇主列表。现在，我们的服务(我们将实现它)将获得这个带有employerId和hike percentage的数据类列表。</p><p id="2bdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于每个雇员的Id，我们需要查询数据库并获得雇主的雇员数据列表。对于每个雇员，我们根据从<em class="jp"> EmployerSalaryUpdate </em>类获得的加薪百分比来计算新的薪水。</p><p id="cc5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你在for-loops中想到这一点，就会有两个<em class="jp"> for-loops，</em>外层的<em class="jp"> for-loop </em>将是<strong class="ih hj"><em class="jp">employearsalyuupdate</em></strong><em class="jp"/>的列表，内层的<em class="jp"> for-loop </em>将是<em class="jp"/><strong class="ih hj"><em class="jp">Employee</em></strong>的列表。下面是一个更简单的实现。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="4867" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果我们想利用<a class="ae jq" href="https://www.java67.com/2014/04/java-8-stream-examples-and-tutorial.html" rel="noopener ugc nofollow" target="_blank"> Java streams的便利方法</a>，这也使这有点花哨，我们去Java流处理。</p><p id="fc6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等效的流处理代码如下所示。我们可以使用一个<a class="ae jq" href="https://javarevisited.blogspot.com/2016/03/difference-between-map-and-flatmap-in-java8.html" rel="noopener ugc nofollow" target="_blank"> flatMap </a>或mapToMulti(有点花哨)来扩展管道1-n。</p><p id="7f57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，一个雇主有n个雇员。这也是我们经常需要包装类的地方，因为后续的数据转换步骤需要来自EmployerSalaryUpdate类和Employee类的数据。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="1f80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，我们只是用<strong class="ih hj"> <em class="jp"> final </em> </strong>成员和getter<a class="ae jq" href="http://javarevisited.blogspot.sg/2013/03/how-to-create-immutable-class-object-java-example-tutorial.html" rel="noopener ugc nofollow" target="_blank">创建了一个不可变的类</a>，从简单的for循环到流处理的代码转换仍然需要30行额外的代码。没有伤害在这里，仍然是不愉快的有这样的锅炉板代码。</p><p id="6fdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们可以使用Java 16中引入的记录类的地方。</p><p id="1144" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">什么是记录类？</p><p id="69bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记录类是不可变的<a class="ae jq" href="https://docs.oracle.com/javase/tutorial/essential/concurrency/immutable.html" rel="noopener ugc nofollow" target="_blank">类的替代品。它不像lombok那样是所有样板代码的替代品。但是我们可以用lombok模拟记录类的行为。</a></p><p id="75d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于您创建的每个记录类，Java都会创建所需的<a class="ae jq" href="http://www.java67.com/2013/04/example-of-overriding-equals-hashcode-compareTo-java-method.html" rel="noopener ugc nofollow" target="_blank"> hashcode() </a>，<a class="ae jq" href="https://javarevisited.blogspot.com/2012/12/difference-between-equals-method-and-equality-operator-java.html#axzz5Y4Kd7uK1" rel="noopener ugc nofollow" target="_blank"> equals() </a>，这是一个规范的构造函数，就像在记录头和getter方法内部一样。</p><p id="31b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例记录类别:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="73f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在第9行看到的，您也可以像通常使用<a class="ae jq" href="https://javarevisited.blogspot.com/2012/01/what-is-constructor-overloading-in-java.html#axzz6j8KhisSX" rel="noopener ugc nofollow" target="_blank">构造函数</a>一样操作这些值。</p><p id="5e2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里要注意的重要一点是，如果你的对象在它的生命周期中会改变它的状态，这意味着如果你需要setters，那么Record类对你来说就没有用了。</p><p id="f0c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到我们的例子，使用记录类的等价代码如下所示</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="ec7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第18行，我创建了一个记录类。因为这个记录类是在一个方法中创建的，所以我们称之为本地记录类。这在此方法之外将不可用。这些在数据转换步骤中非常有用。</p><p id="d3b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在这里看到的，行数明显减少了。</p><p id="2e70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管记录类是不可变的，但是如果成员类是可变的，那么您仍然可以改变记录的状态，但是这是不可取的。当你要创建不可变的类时，总是使用不可变的成员。例如，您仍然可以执行以下操作。但是不建议这样做。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="js jt l"/></div></figure><h2 id="a2d9" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">参考资料:</h2><ul class=""><li id="4ca9" class="kp kq hi ih b ii kr im ks iq kt iu ku iy kv jc kw kx ky kz bi translated"><a class="ae jq" href="https://openjdk.java.net/jeps/395" rel="noopener ugc nofollow" target="_blank"> JEP 395 </a></li><li id="f4d8" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated"><a class="ae jq" href="https://github.com/mrajaian/personnel-management" rel="noopener ugc nofollow" target="_blank">作者的github资源库</a></li></ul></div></div>    
</body>
</html>