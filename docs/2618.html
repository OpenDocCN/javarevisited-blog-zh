<html>
<head>
<title>Let’s taste some Cookies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们尝尝饼干</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/lets-taste-cookies-30fd342e60cf?source=collection_archive---------1-----------------------#2022-12-17">https://medium.com/javarevisited/lets-taste-cookies-30fd342e60cf?source=collection_archive---------1-----------------------#2022-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a6ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">严格针对开发人员<strong class="ih hj"> —本地托管</strong></p><p id="fda6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们大多数人都知道什么是<a class="ae jd" href="https://developer.chrome.com/docs/devtools/storage/cookies/?utm_source=devtools" rel="noopener ugc nofollow" target="_blank">网络Cookie </a>。但是以防万一，如果你不知道，一个简单的<a class="ae jd" href="https://www.google.com/search?q=web+cookie&amp;oq=web+cookie&amp;aqs=chrome..69i57j69i60l3.1864j0j1&amp;sourceid=chrome&amp;ie=UTF-8" rel="noopener ugc nofollow" target="_blank">谷歌搜索就能让它大白于天下。</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><a href="https://www.java67.com/2022/06/web-development-interview-questions.html"><div class="er es je"><img src="../Images/59560af83110a35d700c96c7d284c91e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5W16PcsE912wHgRXD8ETw.png"/></div></a><p class="jm jn et er es jo jp bd b be z dx translated">由<a class="ae jd" href="https://beta.openai.com/docs/guides/images/introduction" rel="noopener ugc nofollow" target="_blank"> openai </a>生成的图像</p></figure><p id="f6be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个<em class="jq">帖子主要涵盖了</em>在实际<em class="jq">实现</em>一个<strong class="ih hj"> cookie </strong>时一个开发人员可能会有的问题，而不是<strong class="ih hj">在理论上阅读它们。</strong></p><p id="f8ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">内容</strong></p><ul class=""><li id="c965" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><a class="ae jd" href="#ed39" rel="noopener ugc nofollow">饼干桌</a></li><li id="2fb1" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">谁能设置Cookie？</li><li id="3db1" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="#83fb" rel="noopener ugc nofollow">默认字段</a></li><li id="ed42" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">Cookie可以在子域中访问吗，反之亦然？</li><li id="83d9" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">如何删除Cookie？</li><li id="2653" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">饼干可以用在哪里？</li><li id="491e" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="#da5f" rel="noopener ugc nofollow">如何用JavaScript让Cookie不可读？</a></li><li id="945b" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="#c4ee" rel="noopener ugc nofollow">子域集-Cookie </a> <br/> - <a class="ae jd" href="#dd90" rel="noopener ugc nofollow">代码变更</a>-<br/>-<a class="ae jd" href="#9cf6" rel="noopener ugc nofollow">无HttpOnly字段</a>-<a class="ae jd" href="#2f8d" rel="noopener ugc nofollow">有HttpOnly字段</a></li><li id="c413" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="#d6ae" rel="noopener ugc nofollow">跨域设置-Cookie </a></li><li id="30ed" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">为什么他们说饼干不安全？</li><li id="faee" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">我们如何保护Cookie？</li><li id="005e" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="#1939" rel="noopener ugc nofollow">问题和补救措施</a></li><li id="ee40" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="#63c8" rel="noopener ugc nofollow">最终拍摄</a></li></ul><p id="f817" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是关于用一个简单的<a class="ae jd" href="https://www.javascript.com/" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>例子探索所有的领域。</p><blockquote class="kf kg kh"><p id="ed39" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">饼干桌</p></blockquote><p id="e050" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://developer.chrome.com/docs/devtools/storage/cookies/?utm_source=devtools#open" rel="noopener ugc nofollow" target="_blank"> cookie表</a>有多个<a class="ae jd" href="https://developer.chrome.com/docs/devtools/storage/cookies/?utm_source=devtools#fields" rel="noopener ugc nofollow" target="_blank">字段</a>。下面是一个在本地运行的JavaScript应用程序示例，</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kl"><img src="../Images/888ffa11bee9950edf8505051a81af77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*atnpKOguLNQDdWQmutchug.gif"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">F12 —在一个开发人员工具箱中打开所有内容。导航到<strong class="bd kq">应用标签</strong>-&gt;-<strong class="bd kq">Cookies</strong></p></figure><blockquote class="kf kg kh"><p id="d4e7" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">谁能设置cookie？</p></blockquote><ul class=""><li id="3e95" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">Cookie可以在<strong class="ih hj"> JavaScript </strong>客户端代码中设置，</li></ul><pre class="jf jg jh ji fd kr ks kt bn ku kv bi"><span id="ed2a" class="kw kx hi ks b be ky kz l la lb">document.cookie = 'username=hello world'</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/8102bd7440636fef449c57c640dc1b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rtNZaYucnC67DV4sbc8i9Q.gif"/></div></div></figure><ul class=""><li id="0546" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">也可以从<strong class="ih hj"> Set-cookie <em class="jq">头</em> </strong>中的<strong class="ih hj">服务器响应</strong>设置Cookie，</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><p class="jm jn et er es jo jp bd b be z dx translated">从服务器发送的<a class="ae jd" href="#da5f" rel="noopener ugc nofollow"> httpOnly </a> Cookie</p></figure><blockquote class="kf kg kh"><p id="83fb" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">默认字段</p></blockquote><p id="9a5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如我们所知，有四个字段是默认的，</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lf"><img src="../Images/4a61988be6c55ad269a598ce274819cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/1*OCj1JTMsFbM0AEE2PimvoA.gif"/></div></figure><ul class=""><li id="4a92" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><strong class="ih hj">域</strong> <br/>这指定只有主机<strong class="ih hj"> localhost </strong>可以读取Cookie。如果试图从<strong class="ih hj"> <em class="jq">访问任何其他域</em> </strong> 127.0.0.1，它不会将cookie显示为<strong class="ih hj"> <em class="jq">字符串</em> localhost！= 127.0.0.1 </strong></li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lg"><img src="../Images/f8a33955f0b47fc16e678bff5f3cafa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMG248CZRSyP5GJNybdiEg.png"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">127.0.0.1 <strong class="bd kq">未显示</strong>我们之前设置的Cookie</p></figure><ul class=""><li id="93de" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><strong class="ih hj">路径<br/>路径</strong>cookie仅在<strong class="ih hj">路径</strong>集合中可见。它默认为url中的当前路径。</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lh"><img src="../Images/57a5f05c68161d5eb432251524cdda4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dTZMXc7FlppW11wXjvT37A.png"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">正如我们所看到的，url路径-<strong class="bd kq">/服务器</strong>没有显示相同的cookie</p></figure><ul class=""><li id="198d" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><strong class="ih hj"> Expiry/Max-age <br/> </strong>默认设置为<strong class="ih hj"> Session </strong> <em class="jq">(大部分是在浏览器关闭时，但根据浏览器和用户设置的不同而不同)</em> <strong class="ih hj">。</strong>当明确的<strong class="ih hj">到期</strong>或<strong class="ih hj">最大年龄</strong>被设置<a class="ae jd" href="#dcd6" rel="noopener ugc nofollow">时，cookie被从<a class="ae jd" href="#ed39" rel="noopener ugc nofollow"> cookie表</a>中移除</a>。</li><li id="d102" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><strong class="ih hj">优先级<br/> </strong>优先级设置为<strong class="ih hj">中。</strong></li></ul><blockquote class="kf kg kh"><p id="c85c" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">可以在子域中访问Cookie吗，反之亦然？</p></blockquote><p id="4ecb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">不</strong>由<em class="jq">默认</em>。然而，当如下所示明确设置<strong class="ih hj">域</strong>时，可以实现这一点，</p><pre class="jf jg jh ji fd kr ks kt bn ku kv bi"><span id="8b23" class="kw kx hi ks b be ky kz l la lb">document.cookie = 'username=suriya;domain=localhost.com'</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/d94a26c70496f06699ecaa25c8f6370a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*f6M-h7GM1E4LgVPXT8Uspw.gif"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">显示cookie级联到<strong class="bd kq">子域</strong>的示例</p></figure><p id="3f1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，当Cookie在客户机中设置时，这样做是可行的，但是当从服务器设置了<strong class="ih hj"> Cookie并在响应中将其发送回客户机时，情况又会如何呢？</strong>。让我们在子域和<a class="ae jd" href="#d6ae" rel="noopener ugc nofollow">跨域部分的</a><a class="ae jd" href="#da5f" rel="noopener ugc nofollow"> <strong class="ih hj"> Set-Cookie </strong> </a> <a class="ae jd" href="#c4ee" rel="noopener ugc nofollow">中查看一下吧。</a></p><blockquote class="kf kg kh"><p id="dcd6" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">如何删除Cookie？</p></blockquote><p id="3cac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将<a class="ae jd" href="https://www.w3schools.com/js/js_cookies.asp" rel="noopener ugc nofollow" target="_blank">过期<strong class="ih hj">过期日期</strong> </a> <strong class="ih hj"> </strong>设置为Cookie键会使<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#define_the_lifetime_of_a_cookie" rel="noopener ugc nofollow" target="_blank">的生存期</a>超出界限，从而从<a class="ae jd" href="#ed39" rel="noopener ugc nofollow"> cookie表</a>中删除Cookie。</p><pre class="jf jg jh ji fd kr ks kt bn ku kv bi"><span id="3357" class="kw kx hi ks b be ky kz l la lb">document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";</span></pre><blockquote class="kf kg kh"><p id="2995" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">饼干可以用在哪里？</p></blockquote><p id="c62d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它为无状态的HTTP协议记住有状态的信息。饼干<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#define_the_lifetime_of_a_cookie" rel="noopener ugc nofollow" target="_blank">主要有三个用途</a>、</p><ul class=""><li id="231e" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">会话管理</li><li id="ac9d" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">个性化</li><li id="84c3" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">跟踪</li></ul><blockquote class="kf kg kh"><p id="b227" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">运行同一个<strong class="ih hj">域</strong>的多个标签可以更新同一个Cookie密钥吗？</p></blockquote><p id="91f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同一浏览器中的不同选项卡/窗口—是。Cookie基于<a class="ae jd" href="https://developer.chrome.com/docs/devtools/storage/cookies/?utm_source=devtools#fields" rel="noopener ugc nofollow" target="_blank">域字段</a>。如果不同的选项卡运行相同的域，那么每个选项卡可以通过其<strong class="ih hj">密钥</strong>更新<em class="jq"> cookie值</em>。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/cd462dbdaac5be67f10b803437ec81de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sQRCtK5ea_Gji-KJZW8TSg.gif"/></div></div></figure><blockquote class="kf kg kh"><p id="da5f" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">如何用JavaScript让一个cookie不可读？</p></blockquote><p id="627c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过客户端代码创建的Cookies总是可以被客户端代码读取。</p><p id="6749" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，由<strong class="ih hj">服务器响应头<em class="jq"> Set-Cookie </em> </strong>创建的Cookie<a class="ae jd" href="#2f8d" rel="noopener ugc nofollow"><strong class="ih hj"><em class="jq">http only</em></strong><em class="jq">字段</em>使得</a>Cookie<a class="ae jd" href="#2f8d" rel="noopener ugc nofollow">不可读</a>到<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#restrict_access_to_cookies" rel="noopener ugc nofollow" target="_blank"> JavaScript像变魔术一样</a>。</p><blockquote class="kf kg kh"><p id="c4ee" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">子域集-Cookie</p></blockquote><p id="1a01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来演示一下这个案例，</p><ul class=""><li id="177f" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">在<strong class="ih hj">server.localhost.com</strong>运行<em class="jq">服务器</em></li><li id="5a3c" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">在<strong class="ih hj">client.localhost.com</strong>运行<em class="jq">客户端</em></li></ul><p id="f831" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的<strong class="ih hj">服务器</strong>和<strong class="ih hj">客户端</strong>是<a class="ae jd" href="#ed39" rel="noopener ugc nofollow"> Cookie表</a>中表示为<em class="jq"/><strong class="ih hj"><em class="jq">. localhost . com</em></strong>的<strong class="ih hj">localhost.com</strong>的子域</p><h2 id="dd90" class="li kx hi bd kq lj lk ll lm ln lo lp lq iq lr ls lt iu lu lv lw iy lx ly lz ma bi translated"><strong class="ak">代码变更</strong></h2><p id="50ef" class="pw-post-body-paragraph if ig hi ih b ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc hb bi translated">为了让它工作，我们需要更新我们的客户端代码<strong class="ih hj"><em class="jq">http . with credentials = true</em></strong>，</p><pre class="jf jg jh ji fd kr ks kt bn ku kv bi"><span id="f502" class="kw kx hi ks b be ky kz l la lb">    const http = new XMLHttpRequest();<br/>    const url='https://server.localhost.com:3000/server';<br/>    http.open("GET", url);<br/>    http.withCredentials = true;<br/>    http.send();</span></pre><p id="7881" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我们需要设置我们的服务器代码，</p><ul class=""><li id="8e6f" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">接受来自起源的请求</li><li id="f9ba" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">允许访问凭据</li></ul><pre class="jf jg jh ji fd kr ks kt bn ku kv bi"><span id="cbb3" class="kw kx hi ks b be ky kz l la lb">res.setHeader('Access-Control-Allow-Origin', 'https://client.localhost.com:5500');<br/>res.setHeader('Access-Control-Allow-Credentials', 'true');</span></pre><p id="4ed3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就要求连接要有<a class="ae jd" rel="noopener" href="/javarevisited/ssl-certificate-67b4e3bdee38#7ec7"> <strong class="ih hj">安全</strong> </a> <strong class="ih hj"> </strong>的意思，服务器应用需要在<a class="ae jd" rel="noopener" href="/javarevisited/self-signed-certificate-d545d6054327#59d2"> <strong class="ih hj"> https </strong> </a> <strong class="ih hj">上。</strong></p><pre class="jf jg jh ji fd kr ks kt bn ku kv bi"><span id="0835" class="kw kx hi ks b be ky kz l la lb">res.setHeader('Set-Cookie', 'where=server;domain=localhost.com;Secure;expires='+ getUtcTimeInSecondsFromNow(60));</span></pre><p id="a038" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查该岗位生成<strong class="ih hj">自签名</strong> <a class="ae jd" rel="noopener" href="/@suriyaprakhash/cryptography-algorithms-e86ce7e2bb9b#41bc"> <strong class="ih hj">证书</strong> </a>，</p><div class="mg mh ez fb mi mj"><a rel="noopener follow" target="_blank" href="/javarevisited/self-signed-certificate-d545d6054327"><div class="mk ab dw"><div class="ml ab mm cl cj mn"><h2 class="bd hj fi z dy mo ea eb mp ed ef hh bi translated">正在生成自签名证书</h2><div class="mq l"><h3 class="bd b fi z dy mo ea eb mp ed ef dx translated">本地主机</h3></div><div class="mr l"><p class="bd b fp z dy mo ea eb mp ed ef dx translated">medium.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jk mj"/></div></div></a></div><p id="7e75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>客户端应用<strong class="ih hj">不需要在<strong class="ih hj"> https上</strong>。</strong>但是，出于模拟生产环境的演示目的，在<a class="ae jd" rel="noopener" href="/javarevisited/self-signed-certificate-d545d6054327#59d2"><strong class="ih hj">https</strong></a><strong class="ih hj"/>上运行客户端也是如此。</p><h2 id="9cf6" class="li kx hi bd kq lj lk ll lm ln lo lp lq iq lr ls lt iu lu lv lw iy lx ly lz ma bi translated"><strong class="ak">不带<em class="my"> HttpOnly </em>字段</strong></h2><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/f473897a0a0a460317e5c50b1fc47cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*XLzETYBE0hwlrhdEUVoa3g.gif"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">不带HttpOnly的对<strong class="bd kq"> Set-Cookie </strong>的典型http调用</p></figure><p id="7a40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的截图显示，当<strong class="ih hj"> HttpOnly丢失时，对同一个域 <strong class="ih hj">的<em class="jq">后续http调用</em></strong>没有设置<strong class="ih hj"> cookie值</strong>。</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mz"><img src="../Images/3e14e177015b4a20774063742ce6d76a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Zs8e7YkajTyrEd12q-h-A.png"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">没有http的Set-cookie <strong class="bd kq">只有</strong> cookie在后续调用时<strong class="bd kq">不会发送回服务器</strong></p></figure><h2 id="2f8d" class="li kx hi bd kq lj lk ll lm ln lo lp lq iq lr ls lt iu lu lv lw iy lx ly lz ma bi translated"><strong class="ak">带<em class="my"> HttpOnly </em>字段</strong></h2><p id="2c73" class="pw-post-body-paragraph if ig hi ih b ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc hb bi translated">下面是响应中设置的HttpOnly字段，</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es na"><img src="../Images/2273f3c5fb7c4e38e7faf0c800101cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*AH3PpHJN7hVDMVNkrR9JbQ.gif"/></div><p class="jm jn et er es jo jp bd b be z dx translated">HttpOnly cookie</p></figure><p id="564a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管JavaScript代码出现在<a class="ae jd" href="#ed39" rel="noopener ugc nofollow"> Cookie表</a>中，但上面的内容使其<strong class="ih hj">不可读</strong>。</p><p id="f3c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">读取存储值<em class="jq">按钮</em> </strong> <em class="jq"> </em>读取时，无显示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/3a25d19d08026868f5223b6d80b13f2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5FhgKBf14C-MgsTEu49S2Q.gif"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated"><strong class="bd kq">http only</strong>JavaScript中的cookie不可读</p></figure><p id="7d9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，只有<strong class="ih hj"> HttpOnly </strong>的cookie才被发送回服务器，</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nb"><img src="../Images/eaebf6a5d7f349d541cd76dc656baaef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcZ9ykBAvQ7RFDcQsBKSlg.png"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">屏幕截图只显示了在下一次调用时，HttpOnly  Cookie被发送回服务器</p></figure><blockquote class="kf kg kh"><p id="d6ae" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">跨域Set-Cookie</p></blockquote><p id="66ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由服务器响应设置的<em class="jq">的<strong class="ih hj">跨域</strong>Cookie不会出现在<a class="ae jd" href="#ed39" rel="noopener ugc nofollow"> Cookie表</a>中。</em></p><p id="da1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，如果响应具有以下字段，它们将在后续请求中被发送到同一个域以进行进一步的服务器验证<strong class="ih hj">，</strong></p><ul class=""><li id="2588" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><a class="ae jd" href="#2f8d" rel="noopener ugc nofollow"> HttpOnly </a></li><li id="4639" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="#dd90" rel="noopener ugc nofollow">安全</a></li><li id="0480" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#define_where_cookies_are_sent" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">same site = None</strong></a>，此处检查浏览器兼容性<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite#browser_compatibility" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><p id="175f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且<strong class="ih hj">下面的字段去掉了</strong>，</p><ul class=""><li id="018c" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><a class="ae jd" href="#4a92" rel="noopener ugc nofollow">域</a>到<a class="ae jd" href="#bd73" rel="noopener ugc nofollow">避免浏览器验证</a></li></ul><p id="81ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且<strong class="ih hj">在非匿名窗口</strong>或<a class="ae jd" href="#2aeb" rel="noopener ugc nofollow">中尝试它，否则它可能要求改变用户偏好</a>。</p><p id="74a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出于演示目的，我们可以，</p><ul class=""><li id="e820" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">在<strong class="ih hj">clienthost.net</strong>运行<em class="jq">客户端</em></li><li id="1cd4" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">在<strong class="ih hj">server.localhost.com</strong>运行<em class="jq">服务器</em></li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/c9d84cd585fe932a2a89eb36da4f26a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-9GGGhVRQaMpCoXwJk89hw.gif"/></div></div></figure><blockquote class="kf kg kh"><p id="b3a7" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">为什么他们说<strong class="ih hj"> Cookie </strong>是<strong class="ih hj">不安全</strong>？</p></blockquote><p id="eff7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cookies容易受到<a class="ae jd" href="https://owasp.org/www-community/attacks/xss/" rel="noopener ugc nofollow" target="_blank"> XSS </a>和<a class="ae jd" href="https://owasp.org/www-community/attacks/csrf" rel="noopener ugc nofollow" target="_blank"> CSRF </a>的攻击。</p><blockquote class="kf kg kh"><p id="deb8" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">我们如何保护Cookie？</p></blockquote><p id="4c74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了应对攻击并避免信息丢失，我们需要注意以下几点:</p><ul class=""><li id="ed57" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">试图避免<a class="ae jd" href="#d6ae" rel="noopener ugc nofollow">跨域</a>，让根域通过子域处理请求。一旦我们开始使用带有 <a class="ae jd" href="https://developer.chrome.com/en/docs/privacy-sandbox/chips/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">芯片</strong> </a>的<strong class="ih hj"> cookies，这就有可能避免。</strong></li><li id="045f" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">使用<a class="ae jd" href="#93de" rel="noopener ugc nofollow"> <strong class="ih hj">路径</strong> </a> <strong class="ih hj"> </strong>并在必要时限制对客户端的访问。</li><li id="6c70" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">使用<a class="ae jd" href="#dd90" rel="noopener ugc nofollow"> <strong class="ih hj">安全</strong> </a> <strong class="ih hj">字段</strong>来避免<em class="jq">中间人</em>，因为流量将在http 上受到<a class="ae jd" rel="noopener" href="/javarevisited/ssl-certificate-67b4e3bdee38#6ba0">安全保护。</a></li><li id="2df9" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">为cookie设置一个<a class="ae jd" href="#198d" rel="noopener ugc nofollow"> <strong class="ih hj">到期</strong>或<strong class="ih hj">最大期限</strong> </a>，其中敏感信息可以按一定的时间间隔删除。</li><li id="060b" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">如果可能，使用<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">相同站点</strong>到<strong class="ih hj">严格</strong> </a>不允许跨域</li><li id="fd6c" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">使用<a class="ae jd" href="#2f8d" rel="noopener ugc nofollow"> <strong class="ih hj"> httpOnly </strong>标志来避免JavaScript代码在需要时访问cookie </a>。</li></ul><blockquote class="kf kg kh"><p id="1939" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">问题和补救措施</p></blockquote><h2 id="0f02" class="li kx hi bd kq lj lk ll lm ln lo lp lq iq lr ls lt iu lu lv lw iy lx ly lz ma bi translated"><strong class="ak"> CORS域名访问</strong></h2><p id="d854" class="pw-post-body-paragraph if ig hi ih b ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc hb bi translated"><strong class="ih hj">错误</strong>在“<a class="ae jd" href="https://server.localhost.com:3000/server'" rel="noopener ugc nofollow" target="_blank">https://server.localhost.com:3000/server'</a>从原点“<a class="ae jd" href="https://clienthost.net:5500'" rel="noopener ugc nofollow" target="_blank">https://client host . net:5500”</a>访问XMLHttpRequest已被CORS策略阻止:请求的资源上不存在“Access-Control-Allow-Origin”标头。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nc"><img src="../Images/04da3604ecebba7ae320afc1c5143cd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDYHaP7X7hGqaXvGw1i6Fg.png"/></div></div></figure><p id="9aa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">、</strong>中增加以下<strong class="ih hj">响应头</strong></p><pre class="jf jg jh ji fd kr ks kt bn ku kv bi"><span id="6e1d" class="kw kx hi ks b be ky kz l la lb"> res.setHeader('Access-Control-Allow-Origin', 'https://clienthost.net:5500');</span></pre><h2 id="bd73" class="li kx hi bd kq lj lk ll lm ln lo lp lq iq lr ls lt iu lu lv lw iy lx ly lz ma bi translated">Set-Cookie响应中的域集不正确</h2><p id="9daf" class="pw-post-body-paragraph if ig hi ih b ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc hb bi translated"><strong class="ih hj">警告</strong>通过Set-cookie头设置Cookie的尝试被阻止，因为其域属性对于当前主机url无效。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nd"><img src="../Images/604033e50b17307f126a4e96b25f551b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ChZeUoylNlPXO-cz69F2Pw.png"/></div></div></figure><p id="2d72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查以下内容，</p><ul class=""><li id="e35a" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">如果是同一个根域，url中的<a class="ae jd" href="#c4ee" rel="noopener ugc nofollow">域与请求url的</a>域相同</li><li id="4a2f" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">在跨域的情况下查看<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#define_where_cookies_are_sent" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">same site = None</strong></a>标志和<a class="ae jd" href="#d6ae" rel="noopener ugc nofollow">避免在响应</a>中传递域字段</li><li id="6c5d" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">检查url中的正确域名是否在<strong class="ih hj"> Set-Cookie头</strong>中传递</li></ul><h2 id="2aeb" class="li kx hi bd kq lj lk ll lm ln lo lp lq iq lr ls lt iu lu lv lw iy lx ly lz ma bi translated"><strong class="ak">由于用户偏好被阻止</strong></h2><p id="21e5" class="pw-post-body-paragraph if ig hi ih b ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc hb bi translated"><strong class="ih hj">警告</strong>由于用户偏好，通过Set-cookie头设置Cookie的尝试被阻止。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ne"><img src="../Images/c7d02491fca1d7c5e446763afc63b5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lXy7Vf0DEy4th-7uwgGFRg.png"/></div></div></figure><p id="34e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试使用<strong class="ih hj">非隐名窗口</strong>或<a class="ae jd" href="https://support.google.com/chrome/answer/95647?hl=en&amp;co=GENIE.Platform%3DDesktop" rel="noopener ugc nofollow" target="_blank">更改用户首选项</a>的设置。</p><blockquote class="kf kg kh"><p id="63c8" class="if ig jq ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">最终拍摄</p></blockquote><p id="acb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Cookies </strong>是<em class="jq">存储关于用户浏览<strong class="ih hj">活动</strong>和<strong class="ih hj">偏好</strong>的信息</em>的有用工具。它们可以用来<em class="jq">个性化用户在网站上的体验</em>和<em class="jq">跟踪用户在多个网站上的浏览活动</em>。</p><p id="3e05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，<strong class="ih hj">负责任地使用cookie</strong>和<strong class="ih hj">尊重用户的隐私</strong>是很重要的。这意味着<strong class="ih hj">对于<em class="jq">如何使用cookie</em>和<em class="jq">保持透明</em></strong>，让用户能够控制如何收集和使用他们的数据。考虑将 <strong class="ih hj">敏感信息</strong>存储在cookies中<em class="jq">的安全含义也很重要。</em></p><p id="8516" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一般来说，最好只在必要时使用cookies，并尽量减少存储在其中的个人数据量。让用户选择退出cookie跟踪，并在不再需要时删除或阻止cookie也是一个好主意。</p><p id="aa12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们忽略的领域是，</p><ul class=""><li id="1ca2" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><a class="ae jd" href="https://developer.chrome.com/en/docs/privacy-sandbox/chips/" rel="noopener ugc nofollow" target="_blank">分区键</a></li><li id="bc92" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jd" href="https://bugs.chromium.org/p/chromium/issues/detail?id=232693" rel="noopener ugc nofollow" target="_blank">优先级</a></li></ul><p id="6dab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在另一篇<strong class="ih hj"> localhost-ing </strong>帖子中讨论这个问题！</p></div></div>    
</body>
</html>