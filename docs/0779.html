<html>
<head>
<title>Containerizing Spring Boot Application with Jib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jib集装箱化Spring Boot应用</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/containerizing-springboot-application-with-jib-716daa3e0850?source=collection_archive---------0-----------------------#2020-11-15">https://medium.com/javarevisited/containerizing-springboot-application-with-jib-716daa3e0850?source=collection_archive---------0-----------------------#2020-11-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1123" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将了解如何在不安装任何docker客户端或不为我们的Spring Boot应用程序使用Dockerfile的情况下创建docker或<a class="ae jd" href="https://opencontainers.org/" rel="noopener ugc nofollow" target="_blank"> OCI </a>投诉图像。我们将在Jib的帮助下完成所有这些工作。</p><h2 id="c788" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">什么是Jib？</h2><blockquote class="jz"><p id="6519" class="ka kb hi bd kc kd ke kf kg kh ki jc dx translated"><a class="ae jd" href="https://cloud.google.com/blog/products/gcp/introducing-jib-build-java-docker-images-better" rel="noopener ugc nofollow" target="_blank"> <em class="kj"> Jib </em> </a> <em class="kj">是来自谷歌的Java容器器，让Java开发者使用Maven、Gradle等构建工具构建容器</em>。</p></blockquote><figure class="kl km kn ko kp kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kk"><img src="../Images/6e0f560ae7bd420117c01f2d7e448622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huVXCHTbvv9lLBENdM8QLg.png"/></div></div><p class="kx ky et er es kz la bd b be z dx translated">三角帆(图片<a class="ae jd" href="https://github.com/GoogleContainerTools/jib" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="7bbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但这还不是Jib真正有趣的地方在于，你不需要知道任何关于安装<a class="ae jd" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-maven-jenkins-and-docker-for-java-developers-51fa7a1e66f6?source=collection_home---4------3-----------------------"> docker </a>和维护Dockerfile等的知识。作为开发人员，你只关心工件(jar，war等。)你将要生产，你不必处理任何docker的废话(构建/推送，等等。).</p><figure class="lc ld le lf fd kq er es paragraph-image"><a href="https://medium.com/javarevisited/top-10-free-courses-to-learn-jenkins-docker-and-kubernetes-for-devops-in-2020-best-of-lot-62a0541ffeb3"><div class="er es lb"><img src="../Images/d23f4b3d081c79c9047004711b450143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*7LxwyXD1XOqX2CJeSyOa3Q.png"/></div></a><p class="kx ky et er es kz la bd b be z dx translated">Jib v/s Docker构建流程(图片来源Google Cloud)</p></figure><p id="8ea2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哇，这个真厉害！！！但是怎么做呢？</p><figure class="lc ld le lf fd kq er es paragraph-image"><div class="er es lg"><img src="../Images/92727ad25703035175bfb722faca5be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*e957_qF7Un-y6Z3F.gif"/></div></figure><h2 id="d615" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">如何转帆？</h2><p id="2aec" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">有了Jib，您只需将<a class="ae jd" rel="noopener" href="/javarevisited/6-best-maven-courses-for-beginners-in-2020-23ea3cba89"> Maven </a>或<a class="ae jd" rel="noopener" href="/javarevisited/5-best-gradle-courses-and-books-to-learn-in-2021-93f49ce8ff8e"> Gradle </a>插件添加到pom.xml .或build.gradle文件中，就可以立即将您的Java应用程序容器化。就这么简单。我们将首先报道Maven，稍后在Gradle之后。那我们开始吧。</p><p id="e7ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用spring <a class="ae jd" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> initializr </a>来生成一个可用的spring-boot项目。我们的<a class="ae jd" rel="noopener" href="/javarevisited/10-free-spring-boot-tutorials-and-courses-for-java-developers-53dfe084587e?source=collection_home---4------7-----------------------"> SpringBoot应用程序</a>的源代码在<a class="ae jd" href="https://github.com/userac/spring-boot-jib.git" rel="noopener ugc nofollow" target="_blank">这里</a>可以得到，它只是在图像通过Jib推送并且图像通过docker运行时打印一条Hello消息。</p><p id="94f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们准备好了IDE的设置，我们就可以继续下一步。</p><h2 id="a9b2" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">设置Maven </strong></h2><pre class="lc ld le lf fd lm ln lo lp aw lq bi"><span id="e66e" class="je jf hi ln b fi lr ls l lt lu">&lt;plugin&gt;<br/>   &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;<br/>   &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;<br/>   &lt;version&gt;2.6.0&lt;/version&gt;<br/>   &lt;configuration&gt;<br/>      &lt;from&gt;<br/>         &lt;image&gt;gcr.io/distroless/java:11&lt;/image&gt;<br/>      &lt;/from&gt;<br/>      &lt;to&gt;<br/>         &lt;image&gt;registry.hub.docker.com/hiashish/spring-boot-jib-image&lt;/image&gt;<br/>      &lt;/to&gt;<br/>   &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="194e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于maven，您可以将上述内容粘贴到pom.xml插件部分，这样就可以了。但是我会在这里试着解释一下<from>和<image>标签。</image></from></p><blockquote class="lv lw lx"><p id="66a0" class="if ig ly ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated"><from>配置基础映像以在基础上构建您的应用程序。</from></p></blockquote><p id="1b03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常你不需要提供<from>,因为默认情况下它使用distroless java8镜像。然而，我使用了<a class="ae jd" href="https://javarevisited.blogspot.com/2018/01/top-10-udemy-courses-for-java-and-web-developers.html#axzz6ggCCT42g" rel="noopener ugc nofollow" target="_blank"> java11 </a>，所以我在这里明确提到了这一点。此外，根据您的使用情况，您可能希望使用不同的基础映像。</from></p><blockquote class="lv lw lx"><p id="9bd7" class="if ig ly ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated"><image>这是指将被推送到容器注册表的目标图像。</image></p></blockquote><p id="6e83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用了docker注册中心，但是您可以使用任何可用的云提供商(ECS、GCR、ACR)容器注册中心。</p><p id="b5f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用插件的更多选项，您可以参考<a class="ae jd" href="https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h2 id="0ace" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">设置注册表凭证</strong></h2><p id="9cec" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">为了推送图像，我们需要将注册表凭证添加到maven settings.xml中。因为我们只是在做一个演示，所以以这种方式提供凭证是可以的，但要避免使用这种方法，因为它根本不安全。您可能想要保护凭证，如这里提到的<a class="ae jd" href="https://maven.apache.org/guides/mini/guide-encryption.html" rel="noopener ugc nofollow" target="_blank"/>。</p><pre class="lc ld le lf fd lm ln lo lp aw lq bi"><span id="994c" class="je jf hi ln b fi lr ls l lt lu">&lt;server&gt;<br/>    &lt;id&gt;registry.hub.docker.com&lt;/id&gt;<br/>    &lt;username&gt;username&lt;/username&gt;<br/>    &lt;password&gt;password&lt;/password&gt;<br/>&lt;/server&gt;</span></pre><h2 id="85ee" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">建立形象</strong></h2><p id="35a4" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">要建立一个图像，我们可以用以下方法。</p><ol class=""><li id="d19c" class="mc md hi ih b ii ij im in iq me iu mf iy mg jc mh mi mj mk bi translated">集成驱动电子设备</li></ol><p id="1d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，在<a class="ae jd" href="https://dev.to/javinpaul/5-best-courses-to-learn-intellij-idea-for-java-developers-5e6n" rel="noopener ugc nofollow" target="_blank"> IntelliJ </a>中，你可以进入项目的maven视图，然后进入插件&gt; jib，然后右键单击并运行maven构建。您可能希望为此创建一个IntelliJ运行配置，它可以运行maven目标，如清理、编译等。然后推你的形象。</p><figure class="lc ld le lf fd kq er es paragraph-image"><a href="https://medium.com/javarevisited/7-best-courses-to-learn-intellij-idea-for-beginners-and-experienced-java-programmers-2e9aa9bb0c05"><div class="er es ml"><img src="../Images/8ba00db1294498cd1d97513b77d35472.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*RLiWevrQLQ8KIv4ePBy1xQ.png"/></div></a><p class="kx ky et er es kz la bd b be z dx translated">运行IntelliJ</p></figure><p id="0864" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.使用命令行</p><p id="810f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只需运行下面的命令来构建应用程序的映像。确保你已经安装了<a class="ae jd" href="https://javarevisited.blogspot.com/2019/03/top-5-course-to-learn-apache-maven-for.html#axzz6ccm5KWKs" rel="noopener ugc nofollow" target="_blank"> maven </a>。</p><p id="196e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ly"> mvn编译转臂:构建</em></p><p id="2d6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将编译、构建，然后将应用程序的映像推送到已配置的容器注册表中。</p><p id="4145" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是输出。</p><blockquote class="lv lw lx"><p id="4971" class="if ig ly ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated">ashish @ MacBook-Air spring boot % mvn编译jib:build <br/> [INFO】扫描项目……<br/>[INFO]<br/>………..<br/>【信息】———Maven-compiler-plugin:3 . 8 . 1:compile(default-compile)@ spring-boot-jib—-<br/>【信息】什么都不编译—所有类都是最新的<br/>【信息】<br/>【信息】———jib-Maven-plugin:2 . 6 . 0:build(default-CLI)@ spring-boot-jib—-<br/>【警告】‘Maven-jar-plugin’中配置的‘main class’不是有效的Java类:${start-class} 【T8 <br/>【信息】执行任务:<br/>【信息】<br/>【信息】执行任务:<br/>【信息】<br/>【信息】执行任务:<br/>【信息】[= = = = = = = =]25.0%完成<br/>【信息】<br/>【信息】执行任务:<br/>【信息】[= = = = = =]25.0%完成<br/>【信息】&gt;推送blob sha256:6508f436f3 &gt;推送blob sha 256:6508 f 436 f 385 b 3751366 f 90 b 6…<br/>【信息】&gt;推送blob sha 256:c5e 22041 fc 97 b 838 b 93 a2 e18d…<br/>【信息】&gt;推送blob sha 256:b 25902383 f9ee 26808 b 68 ca 62…<br/>【信息】<br/>【信息】。 &gt;检查基础图层sha256:31eb28996804… <br/>【信息】<br/>【信息】执行任务:<br/>【信息】[========= ] 30.6%完成<br/>【信息】&gt;推送blob sha 256:c5e 22041 fc 97 b 838 b 93 a2 e18d…<br/>【信息】&gt;检查基础图层sha 256:31eb 288 容器入口点设置为[java，-cp，/app/resources:/app/classes:/app/libs/*，com . jib . example . spring . spring . spring boot application]<br/>【INFO】<br/>【INFO】构建并推送图像为registry.hub.docker.com/hiashish/spring-boot-jib-image<br/>【INFO】执行任务:【INFO】[= = = = = = = = = = = = = = = = = = = = = = = = 91.7%完成<br/>【INFO】&gt;启动层推送器<br/></p></blockquote><h2 id="940f" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">运行镜像</strong></h2><p id="3f20" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">我们已经成功地将映像(映像名:spring-boot-jib-image)推送到docker <a class="ae jd" href="https://hub.docker.com/r/hiashish/spring-boot-jib-image" rel="noopener ugc nofollow" target="_blank">注册中心</a>。现在我们可以使用docker运行图像。</p><figure class="lc ld le lf fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mm"><img src="../Images/bb44318a867aa97e0b0d55ebf9bc55c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhR3Rdf_AkyP9KHxvcPY6A.png"/></div></div><p class="kx ky et er es kz la bd b be z dx translated">运行图像</p></figure><p id="c666" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，我们的应用程序运行在一个容器中。现在只需运行<a class="ae jd" href="https://javarevisited.blogspot.com/2017/03/10-examples-of-curl-command-in-unix-and-Linux.html" rel="noopener ugc nofollow" target="_blank"> curl命令</a>，你就可以看到我们收到了来自spring-boot应用程序的hello消息。</p><figure class="lc ld le lf fd kq er es paragraph-image"><div class="er es mn"><img src="../Images/48d0662c926876e41db90d030f5be985.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*DAzHB-CIb-Qyr94-JNwNPw.png"/></div><p class="kx ky et er es kz la bd b be z dx translated">你好消息</p></figure><h2 id="f77c" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">快速演示</h2><figure class="lc ld le lf fd kq"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h2 id="e650" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">结论</strong></h2><p id="b988" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">在本文中，我们学习了如何在没有docker的情况下容器化Java应用程序。此外，使用Jib，你也可以使用<a class="ae jd" rel="noopener" href="/javarevisited/top-5-free-courses-to-learn-docker-for-beginners-best-of-lot-b2b1ad2b98ad?source=collection_home---4------2-----------------------"> docker </a>构建图像，但这不是X因素。为Java应用程序使用Jib的其他好处包括超级容易集成、更快的构建、可再现的构建、由Google支持等。可以通过这个<a class="ae jd" href="https://www.google.com/amp/s/cloudblog.withgoogle.com/products/gcp/introducing-jib-build-java-docker-images-better/amp/" rel="noopener ugc nofollow" target="_blank">链接</a>详细了解Jib的好处。</p><h2 id="b802" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">支持我</h2><p id="74a7" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">如果你喜欢你刚刚读到的，你可以给我买杯咖啡。</p><figure class="lc ld le lf fd kq er es paragraph-image"><a href="https://www.buymeacoffee.com/meashish"><div class="er es mq"><img src="../Images/20d3c5bcb0f4765a7c77d8cdd8310387.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*hAN_wUauJ85XhEOE.png"/></div></a></figure><h2 id="1ac4" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">延伸阅读</strong></h2><p id="6d4a" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">也可以看看我之前的一些文章。</p><div class="mr ms ez fb mt mu"><a rel="noopener follow" target="_blank" href="/javarevisited/running-simple-springboot-app-on-minishift-84f51894bdf6"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hj fi z dy mz ea eb na ed ef hh bi translated">在Openshift(Minishift)上运行简单的Spring Boot应用程序</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">在本文中，我将尝试演示如何在OpenShift (Minishift)上部署一个简单的Spring Boot应用程序。</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">medium.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni kv mu"/></div></div></a></div><div class="mr ms ez fb mt mu"><a rel="noopener follow" target="_blank" href="/javarevisited/skaffolding-springboot-application-dbfbc463e558"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hj fi z dy mz ea eb na ed ef hh bi translated">Kubernetes via Skaffold上Spring Boot应用的CI/CD工作流</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">使用Skaffold为部署到Kubernetes的Spring Boot应用程序创建CI/CD工作流。</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">medium.com</p></div></div><div class="nd l"><div class="nj l nf ng nh nd ni kv mu"/></div></div></a></div></div></div>    
</body>
</html>