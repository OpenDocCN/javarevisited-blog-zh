<html>
<head>
<title>The easiest SpringCloud tutorial ever | Chapter 3: Service Consumer (Feign) (Finchley Version)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有史以来最简单的SpringCloud教程|第3章:服务消费者(假装)</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/the-most-easiest-springcloud-tutorial-ever-chapter-3-service-consumer-feign-finchley-version-dc47e1351feb?source=collection_archive---------1-----------------------#2022-05-02">https://medium.com/javarevisited/the-most-easiest-springcloud-tutorial-ever-chapter-3-service-consumer-feign-finchley-version-dc47e1351feb?source=collection_archive---------1-----------------------#2022-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="fef0" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">第3章:服务消费者(假装)</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/9680ce7f11bd21f6333817a4939af354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MR1TNQrILPPBn3IWGrWLkQ.jpeg"/></div></div></figure><p id="4289" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">上一篇文章描述了如何通过RestTemplate+Ribbon消费服务。本文主要描述如何通过Feign消费服务。</p><ol class=""><li id="1491" class="kf kg hi jl b jm jn jp jq js kh jw ki ka kj ke kk kl km kn bi translated"><strong class="jl hj">介绍假装</strong></li></ol><p id="d43c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Feign是一个声明性的伪<a class="ae ko" href="https://javarevisited.blogspot.com/2015/06/how-to-create-http-server-in-java-serversocket-example.html" rel="noopener ugc nofollow" target="_blank"> HTTP客户端</a>，它使得编写HTTP客户端更加容易。使用Feign，您只需要创建一个接口并对其进行注释。它有一个可插入的注释特性，可以使用假造注释和JAX-RS注释。Feign支持可插拔的编码器和解码器。Feign默认集成Ribbon，默认与Eureka结合实现负载均衡。</p><p id="6014" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">一句话:</p><ul class=""><li id="0bd1" class="kf kg hi jl b jm jn jp jq js kh jw ki ka kj ke kp kl km kn bi translated">Feign使用基于接口的注释</li><li id="c209" class="kf kg hi jl b jm kq jp kr js ks jw kt ka ku ke kp kl km kn bi translated">Feign将ribbon与负载平衡功能集成在一起</li><li id="a7da" class="kf kg hi jl b jm kq jp kr js ks jw kt ka ku ke kp kl km kn bi translated">将Hystrix与融合能力相结合</li></ul><p id="9c34" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj"> 2。准备工作</strong></p><p id="6417" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">继续使用上一节的项目，启动eureka-server，端口为8761；启动service-hi两次，端口是8762和8773。</p><p id="0548" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj"> 3。创建一个虚拟服务</strong></p><p id="fe50" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">新建一个<a class="ae ko" href="https://javarevisited.blogspot.com/2022/01/spring-boot-reactjs-example-for-java.html" rel="noopener ugc nofollow" target="_blank"> spring-boot项目</a>，命名为serice-feign，并在其pom文件中引入feign的启动依赖项spring-cloud-starter-feign，Eureka的启动依赖项spring-cloud-starter-网飞-eureka-client，Web Start依赖于spring-boot-starter-web，代码如下:</p><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="9abf" class="la lb hi kw b fi lc ld l le lf">&lt;project ae ko" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank"&gt;http://maven.apache.org/POM/4.0.0" xmlns:xsi="<a class="ae ko" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>"<br/>         xsi:schemaLocation="<a class="ae ko" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/POM/4.0.0</a> <a class="ae ko" href="http://maven.apache.org/xsd/maven-4.0.0.xsd" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;<br/>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><span id="015f" class="la lb hi kw b fi lg ld l le lf">&lt;groupId&gt;com.forezp&lt;/groupId&gt;<br/>    &lt;artifactId&gt;service-feign&lt;/artifactId&gt;<br/>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br/>    &lt;packaging&gt;jar&lt;/packaging&gt;</span><span id="d458" class="la lb hi kw b fi lg ld l le lf">&lt;name&gt;service-feign&lt;/name&gt;<br/>    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;</span><span id="4ce0" class="la lb hi kw b fi lg ld l le lf">&lt;parent&gt;<br/>        &lt;groupId&gt;com.forezp&lt;/groupId&gt;<br/>        &lt;artifactId&gt;sc-f-chapter3&lt;/artifactId&gt;<br/>        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br/>    &lt;/parent&gt;</span><span id="b01a" class="la lb hi kw b fi lg ld l le lf">&lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;<br/>    <br/>    &lt;/project&gt;</span></pre><p id="671a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在项目配置文件application.yml文件中，指定程序名为service-feign，端口号为8765，服务注册地址为<a class="ae ko" href="http://localhost:8761/eureka/" rel="noopener ugc nofollow" target="_blank">http://localhost:8761/eureka/</a>，代码如下:</p><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="1367" class="la lb hi kw b fi lc ld l le lf">eureka:<br/>  client:<br/>    serviceUrl:<br/>      defaultZone: <a class="ae ko" href="http://localhost:8761/eureka/" rel="noopener ugc nofollow" target="_blank">http://localhost:8761/eureka/</a><br/>server:<br/>  port: 8765<br/>spring:<br/>  application:<br/>    name: service-feign</span></pre><p id="6f2a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在程序的启动类ServiceFeignApplication中，添加<a class="ae ko" href="https://www.java67.com/2018/12/top-5-spring-cloud-annotations-for-java.html" rel="noopener ugc nofollow" target="_blank"> @EnableFeignClients </a>注释来启用Feign的函数:</p><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="e4fe" class="la lb hi kw b fi lc ld l le lf"><a class="ae ko" href="http://twitter.com/SpringBootApplicatio" rel="noopener ugc nofollow" target="_blank">@SpringBootApplicatio</a>n<br/><a class="ae ko" href="http://twitter.com/EnableEurekaClient" rel="noopener ugc nofollow" target="_blank">@EnableEurekaClient</a><br/><a class="ae ko" href="http://twitter.com/EnableDiscoveryClien" rel="noopener ugc nofollow" target="_blank">@EnableDiscoveryClien</a>t<br/><a class="ae ko" href="http://twitter.com/EnableFeignClients" rel="noopener ugc nofollow" target="_blank">@EnableFeignClients</a><br/>public class ServiceFeignApplication {</span><span id="1cee" class="la lb hi kw b fi lg ld l le lf">public static void main(String[] args) {<br/>        SpringApplication.run( ServiceFeignApplication.class, args );<br/>    }<br/>}</span></pre><p id="6ef7" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">定义一个假接口，并指定通过@ FeignClient(“服务名”)调用哪个服务。比如代码中调用了service-hi服务的“/hi”接口，代码如下:</p><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="c348" class="la lb hi kw b fi lc ld l le lf"><a class="ae ko" href="http://twitter.com/FeignClient" rel="noopener ugc nofollow" target="_blank">@FeignClient</a>(value = "service-hi")<br/>public interface SchedualServiceHi {<br/>    <a class="ae ko" href="http://twitter.com/RequestMapping" rel="noopener ugc nofollow" target="_blank">@RequestMapping</a>(value = "/hi",method = RequestMethod.GET)<br/>    String sayHiFromClientOne(<a class="ae ko" href="http://twitter.com/RequestParam" rel="noopener ugc nofollow" target="_blank">@RequestParam</a>(value = "name") String name);<br/>}</span></pre><p id="365b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在web层的<a class="ae ko" href="https://javarevisited.blogspot.com/2022/05/how-to-validate-incoming-payload-on-spring-.html" rel="noopener ugc nofollow" target="_blank">控制器</a>层，对外公开了一个“/hi”的API接口，通过上面定义的Feign client <code class="du lh li lj kw b">ScheduleServiceHi </code>消费服务。代码如下所示:</p><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="f4b9" class="la lb hi kw b fi lc ld l le lf"><a class="ae ko" href="http://twitter.com/RestController" rel="noopener ugc nofollow" target="_blank">@RestController</a><br/>public class HiController {</span><span id="7825" class="la lb hi kw b fi lg ld l le lf">    <a class="ae ko" href="http://twitter.com/Autowired" rel="noopener ugc nofollow" target="_blank">@Autowired</a><br/>    SchedualServiceHi schedualServiceHi;</span><span id="2b9c" class="la lb hi kw b fi lg ld l le lf"><a class="ae ko" href="http://twitter.com/GetMapping" rel="noopener ugc nofollow" target="_blank">@GetMapping</a>(value = "/hi")<br/>    public String sayHi(<a class="ae ko" href="http://twitter.com/RequestParam" rel="noopener ugc nofollow" target="_blank">@RequestParam</a> String name) {<br/>        return schedualServiceHi.sayHiFromClientOne( name );<br/>    }<br/>}</span></pre><p id="261a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">启动程序，访问<a class="ae ko" href="http://localhost:8765/hi?name=forezp" rel="noopener ugc nofollow" target="_blank"> http://localhost:8765/hi？name=forezp </a>多次，浏览器会交替显示:</p><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="333f" class="la lb hi kw b fi lc ld l le lf">hi forezp,i am from port:8762</span><span id="014e" class="la lb hi kw b fi lg ld l le lf">hi forezp,i am from port:8763</span></pre><div class="lk ll ez fb lm ln"><a rel="noopener follow" target="_blank" href="/javarevisited/8-best-spring-and-hibernate-training-courses-for-java-developers-acf09aa0e244"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">2022年Java程序员学习Spring和Hibernate的8门最佳课程</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">这些是Java程序员学习Spring、Spring Boot和Hibernate的最佳在线培训课程。</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">medium.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb jh ln"/></div></div></a></div><div class="lk ll ez fb lm ln"><a rel="noopener follow" target="_blank" href="/javarevisited/top-10-rest-interview-questions-for-java-and-spring-developers-1611e3b78029"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">Java和Spring开发人员的10大REST面试问题</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">这些是Java和Spring开发者快速准备的最好的REST面试问题</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">medium.com</p></div></div><div class="lw l"><div class="mc l ly lz ma lw mb jh ln"/></div></div></a></div><div class="lk ll ez fb lm ln"><a rel="noopener follow" target="_blank" href="/javarevisited/21-spring-mvc-rest-interview-questions-answers-for-beginners-and-experienced-developers-21ad3d4c9b82"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">10大春季MVC + REST面试问题解答适合初学者和有经验的开发者</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">大家好。如果你正在准备Java和Spring面试或Spring认证，并经常寻找一些…</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">medium.com</p></div></div><div class="lw l"><div class="md l ly lz ma lw mb jh ln"/></div></div></a></div></div></div>    
</body>
</html>