# 仍然深入类型层次地狱代码，构建 DDTJ —第 5 天

> 原文：<https://medium.com/javarevisited/still-deep-in-type-hierarchy-hell-code-building-ddtj-day-5-7404378f7a63?source=collection_archive---------1----------------------->

![](img/0d5812a8312ff4e73195512c4456060b.png)

昨天我遇到了一个路障，不幸的是我今天还没有清除它…

在项目开发中，有一点你会觉得有点像那些战争电影场景。英雄被包围，只是在左右作战；这似乎是没有希望的，也不清楚他们将如何生存。这就是我现在和 DDTJ 在沼泽深处的情况，有一个很难建模的问题。

不幸的是，这并不能造就伟大的作品。我不能真正交流我在做什么，因为很多事情只是“左拍右拍”。我写的代码相当糟糕，因为我试图“让一些东西工作”，公平地说，我一直在改变我的想法。希望，当我得到一些工作，我会有动力去做清理。但是对于一个业余项目来说，这些是很难做到的。

我得到的一个问题是“你为什么不直接使用 JDI 对象模型？”。

JDI (Java 调试接口)已经做了我正在做的所有工作。起初，我觉得这是过度设计，但现在我更欣赏它(这是一个棘手的问题)。不幸的是，我不能重用他们的对象模型。如果可以的话，那会省掉我一大堆工作。但是他们的模型并不是实际的数据。它被绑定到一个[远程虚拟机](https://www.java67.com/2018/01/how-to-remote-debug-java-application-in-Eclipse.html)状态。因此，随着应用程序继续执行，数据会丢失。

我需要在本地复制远程虚拟机数据，这样当我想要基于该数据生成测试用例时，就可以拥有它。这意味着做一些类似于他们所做的事情。但也非常不同。我需要将所有远程状态信息传输到我的本地虚拟机。

# 这听起来并不难

当您的对象模型只包含基本的构建块时，就不是这样了。但是，当您需要镜像从本地 VM 中没有的类构建的整个对象图时，这变得非常困难。如果您正在考虑将类获取到本地 VM，那可能不是正确的想法。

类不是孤立工作的，你不能只拉一个类而不拉整个应用程序。将整个应用程序添加到当前虚拟机也是…不是一个好主意。它将打破孤立，创造一个我们可以显著影响执行的环境。

因此，解决方案是使用 JDI API 获取状态的完整快照，其中包含我们稍后生成代码所需的所有内容。这也包括方法/类元数据。复杂性主要在于我们存储数据和与这个 API 交互的方式。我写的很多代码看起来都很“丑”。

# 处理项目拖延

我今天没取得什么进展。这一天，我一直在讨论发帖的问题，但我认为，重要的是，人们既要看到成功，也要看到短期的失败。

每个相当复杂的项目都有一个艰难/不确定的阶段。你仍然不知道你是否能在隧道的另一边成功，拥有一些“好”的东西。不幸的是，没有真正的治疗方法。但是有一些策略可以“管理”这种情况，避免长期的挫折。

# 迭代过程

当你从头开始一个项目时，你实际上是在一张空白的画布前。那里什么也没有，你还看不到你的创作。在你看到一个东西运行之前，沮丧和绝望是很常见的。这就是为什么把目标定得比你的最终目标低很多很重要。

我们需要避免“理论化”的问题，例如性能优化、不必要的特性等。虔诚地坚持 MVP，即使以稍后重写大量代码为代价。如果你达到了一个中间目标，你最好写一些糟糕的代码，然后扔掉。

这非常符合短跑的概念。我不是一个方法论的狂热爱好者，并且觉得人们有时过于虔诚地应用这些过程。但是致力于短期量化目标的想法是强有力的。

# 捷径和权宜之计

黑客或中间点是让事情运转起来的绝佳方式。现在，我几乎忽略了项目的测试生成方面，只关注数据收集部分。

我还选择了其他快捷方式，避免使用 web 界面，现在只关注 CLI。我们可以在以后更新这些决策，但获得第一个运行版本是至关重要的。一旦你让事情运转起来，进步就会加快，并补偿你为这些捷径/权宜之计所走的任何弯路。

重要的是提出问题来解决这些捷径/权宜之计。我懒得在单个开发者项目上这么做(因为我懒)。但是如果你把这作为你工作的一部分，这很重要。一个好的项目经理会安排你的一些时间进行代码清理，并确保回到这些问题上。

# 追踪

这是最难做的事情。我们有时会走错方向，花太多时间试图让它发挥作用。

这可能是成品的“正确方向”。但是对于短跑来说，这可能太多了。不幸的是，一旦我们开始了一个长期看来“正确”的方向。很难停下来扔掉“正确的代码”来做实际上的黑客行为。

这种方法有时会奏效。只是需要很大的努力。在这种情况下，如果我试图实现的数据收集逻辑对于项目的这个阶段来说是过度工程化的，我会感到矛盾。我看不到更简单的实际可行的解决方案，但如果有捷径，我会选择它…

我可能需要回溯的一件事是我对质量和测试的关注。我想我可能需要暂时搁置质量方面，忽略代码覆盖率。

# 下星期

我希望这个周末能有一些运行的东西作为圣诞礼物…这些希望在严酷的现实和因为家庭义务而受到限制的时间面前破灭了。我有一种感觉，如果我在办公室工作，我会成功的。

我希望下周早些时候可以开始收集数据，否则代码生成就不会发生，整个实验也会失败。如果我现在不这样做，我不确定我什么时候能抽出时间来完成这样一个大项目，所以这是非常重要的。

回想起来，这周我觉得我在覆盖率和质量上花了太多时间，这可能是在早期阶段做的错误的事情。通常，我只是在项目运行的时候才添加这些工具。

我推迟了这个决定。我想知道下周如何开始，我在哪里。

如果你觉得这个系列有趣/有用，请随时在 twitter 上关注我