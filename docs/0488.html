<html>
<head>
<title>Bootstrap SQS with Spring Cloud Messaging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spring云消息的引导SQS</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/bootstrap-sqs-with-spring-cloud-messaging-b0c46ea537b3?source=collection_archive---------2-----------------------#2020-06-09">https://medium.com/javarevisited/bootstrap-sqs-with-spring-cloud-messaging-b0c46ea537b3?source=collection_archive---------2-----------------------#2020-06-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="31e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用不到20行代码建立一个简单队列服务(SQS)消费者，用于异步消息处理</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/989222758b043683d49b270850699772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z72aPC396d6MOqmbi2e5HQ.jpeg"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@levidjones" rel="noopener ugc nofollow" target="_blank">李维·琼斯</a>在<a class="ae jt" href="http://www.unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="0845" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi kb translated"><span class="l kc kd ke bm kf kg kh ki kj di">对于一些不需要向最终用户提供即时反馈的工作负载(<em class="kk">例如视频处理/转换</em>)，异步消息处理近年来已成为极具吸引力的产品。由于有了<a class="ae jt" rel="noopener" href="/javarevisited/top-10-courses-to-learn-amazon-web-services-aws-cloud-in-2020-best-and-free-317f10d7c21d"> AWS </a>，您有了一个触手可及的消息平台，您不必担心基础设施的管理，而是专注于为您的客户提供价值。</span></p><h2 id="fa5d" class="kl km hi bd kn ko kp kq kr ks kt ku kv iq kw kx ky iu kz la lb iy lc ld le lf bi translated">你需要什么</h2><ul class=""><li id="30ad" class="lg lh hi ih b ii li im lj iq lk iu ll iy lm jc ln lo lp lq bi translated">Java 8或以上版本</li><li id="ce62" class="lg lh hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">格雷尔/梅文</li><li id="9eb6" class="lg lh hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">AWS帐户</li><li id="3ae7" class="lg lh hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">拥有SQS访问权限的IAM用户</li></ul><h1 id="c71b" class="lw km hi bd kn lx ly lz kr ma mb mc kv md me mf ky mg mh mi lb mj mk ml le mm bi translated">项目设置</h1><p id="8624" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq mn is it iu mo iw ix iy mp ja jb jc hb bi translated">与任何Spring项目一样，<a class="ae jt" href="http://start.spring.io" rel="noopener ugc nofollow" target="_blank">Spring initializer</a>提供了一种简单、用户友好的方式来生成项目。让我们添加我们将需要的所有依赖项，然后在您喜欢的IDE中打开项目</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://dev.to/javinpaul/5-best-courses-to-learn-intellij-idea-for-java-developers-5e6n"><div class="er es mq"><img src="../Images/52a97d9a1e6c466a57fecaa05e3dd0d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBzG5am5h97YRv2JyPkE5w.png"/></div></a><p class="jp jq et er es jr js bd b be z dx translated">Spring初始化器项目设置</p></figure><h1 id="0b18" class="lw km hi bd kn lx ly lz kr ma mb mc kv md me mf ky mg mh mi lb mj mk ml le mm bi translated">创建SQS异步客户端</h1><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="4f4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，这里我们使用<code class="du mt mu mv mw b">DefaultAWSCredentialsProviderChain</code>来获取IAM凭证，而不是定义一个静态凭证提供者。这将告诉<a class="ae jt" rel="noopener" href="/javarevisited/5-best-courses-to-learn-spring-cloud-and-microservices-1ddea1af7012"> Spring Cloud </a>使用环境中提供的凭证来配置访问，这样您就不必在部署应用程序时指定任何凭证(所有<em class="kk"/><a class="ae jt" rel="noopener" href="/javarevisited/top-10-courses-to-learn-amazon-web-services-aws-cloud-in-2020-best-and-free-317f10d7c21d"><em class="kk">AWS</em></a><em class="kk">服务</em> <em class="kk">都为您预先配置了这些凭证</em>)。</p><h1 id="412a" class="lw km hi bd kn lx ly lz kr ma mb mc kv md me mf ky mg mh mi lb mj mk ml le mm bi translated">配置Spring Cloud</h1><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="5c8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，<a class="ae jt" rel="noopener" href="/hackernoon/top-5-spring-boot-and-spring-cloud-books-for-java-developers-75df155dcedc"> Spring Cloud </a> Messaging认为您正在使用CloudFormation模板运行您的应用程序。当您运行您的应用程序时，它会抛出一个关于堆栈不存在的异常，因此这将禁用该功能。除非使用CloudFormation，否则将上面的属性设置为false。</p><h1 id="6d2f" class="lw km hi bd kn lx ly lz kr ma mb mc kv md me mf ky mg mh mi lb mj mk ml le mm bi translated">建立SQS</h1><p id="cb57" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq mn is it iu mo iw ix iy mp ja jb jc hb bi translated">在AWS控制台服务搜索中键入<code class="du mt mu mv mw b">SQS</code>，并选择出现的第一个选项<code class="du mt mu mv mw b">Simple Queue Service (SQS)</code></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mx"><img src="../Images/c22b42149311849f8b93ff5693965219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1WHEr_3bwOYtAQiNV9_-LA.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">选择SQS服务</p></figure><p id="f93f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<code class="du mt mu mv mw b">Get Started Now</code>按钮，为您的队列输入一个名称。出于本教程的目的，我将使用<code class="du mt mu mv mw b">sqs-demo</code>。选择您想要的队列类型(<em class="kk">自明</em>)并点击<code class="du mt mu mv mw b">Quick Create Queue</code></p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://javarevisited.blogspot.com/2019/08/how-to-crack-aws-certified-solution-architect-exam.html"><div class="er es my"><img src="../Images/5aaf8da8864c58e24a2a63a2876da805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEUUPdrK0kbKI8XXFYKS1A.png"/></div></a><p class="jp jq et er es jr js bd b be z dx translated">SQS期权</p></figure><h1 id="a237" class="lw km hi bd kn lx ly lz kr ma mb mc kv md me mf ky mg mh mi lb mj mk ml le mm bi translated">添加SQS消费者</h1><p id="40eb" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq mn is it iu mo iw ix iy mp ja jb jc hb bi translated">设置一个新的消费者并用<code class="du mt mu mv mw b">@Component</code>对其进行注释，这样<a class="ae jt" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-spring-framework-for-java-developers-639db9348d25"> Spring </a>就可以引导一个新的类和<code class="du mt mu mv mw b">@Slf4j</code>，这样我们就可以获得<a class="ae jt" href="https://javarevisited.blogspot.com/2018/01/top-20-libraries-and-apis-for-java-programmers.html" rel="noopener ugc nofollow" target="_blank"> Lombok </a>提供的一些日志功能。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="76c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用<code class="du mt mu mv mw b">@SqsListener("QUEUE_NAME")</code>注释我们的方法告诉<a class="ae jt" rel="noopener" href="/javarevisited/top-5-books-and-courses-to-learn-restful-web-services-in-java-using-spring-mvc-and-spring-boot-79ec4b351d12"> Spring </a>从SQS获取队列并开始监听消息。运行应用程序，如果我们现在在SQS界面中发送一条测试消息，我们应该会看到它记录到我们的控制台中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mz"><img src="../Images/45f10f3cd25f48f89a494090354c9dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pgi2f0y4ZLyYeDFPwoiVfQ.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">向SQS控制台发送消息</p></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es na"><img src="../Images/d74820334f9dfe96ef6783fa44c673b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWu9d06GKBnm9ehoYk2-Cg.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">SQS消息收到</p></figure><h1 id="f9c1" class="lw km hi bd kn lx ly lz kr ma mb mc kv md me mf ky mg mh mi lb mj mk ml le mm bi translated">处理JSON消息</h1><p id="55c4" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq mn is it iu mo iw ix iy mp ja jb jc hb bi translated">定义一个新的模型(<em class="kk">不需要与下面的</em>相同)，我们将使用它来描述我们在监听器上接收到的消息。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mr ms l"/></div><p class="jp jq et er es jr js bd b be z dx translated">处理请求模型</p></figure><p id="8d3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Spring Cloud Messaging在序列化/去序列化它发送/接收的消息时配置它自己的对象映射器。不幸的是，这不支持JSON开箱即用，所以我们需要配置它。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="067c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本质上，我们使用应用程序的默认对象映射器定义了一个新的消息转换器，然后将它传递给一个<code class="du mt mu mv mw b">QueueMessageHandlerFactory</code>，后者告诉<a class="ae jt" rel="noopener" href="/javarevisited/5-advanced-spring-framework-books-experienced-java-developers-should-read-in-2020-best-of-lot-2a786fc5ad31"> Spring </a>在解序列化它在侦听器中接收的消息时使用我们的自定义消息转换器。将您在<code class="du mt mu mv mw b">@SqsListener</code>上指定的输入参数更改为新创建的模型，并发送另一条消息，这次是JSON格式，您应该会看到它记录到控制台。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nb"><img src="../Images/c1a7cd49902b7c87554d8c055626cd4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bKp75O5UypUJvrfd7FjkMQ.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">JSON消息</p></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nc"><img src="../Images/eb0567a8de2b5702b3adb12a88953c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8kKN-iCxXjxt6ZpS_4ZRzg.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">收到的JSON消息</p></figure><h1 id="dd50" class="lw km hi bd kn lx ly lz kr ma mb mc kv md me mf ky mg mh mi lb mj mk ml le mm bi translated">包装东西</h1><p id="3b6d" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq mn is it iu mo iw ix iy mp ja jb jc hb bi translated">到目前为止，您可能已经看到异步设置和处理消息是多么容易。所以让我们回顾一些事情</p><ul class=""><li id="1253" class="lg lh hi ih b ii ij im in iq nd iu ne iy nf jc ln lo lp lq bi translated"><strong class="ih hj"> AWS服务</strong>:消除对基础设施、扩展等的过度管理。</li><li id="b70b" class="lg lh hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj"> Spring Cloud Messaging </strong>:提供了一种独立于服务提供商定义消息API的抽象方法</li><li id="c01d" class="lg lh hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">defaultawscredialsproviderchain</strong>:使用环境变量来设置IAM访问</li><li id="abbd" class="lg lh hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">杰克森序列化/去序列化</strong>:默认不支持，需要额外配置</li></ul><p id="5f3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该项目的完整源代码可以在<a class="ae jt" href="https://github.com/Startup-Chronicles/sqs-demo" rel="noopener ugc nofollow" target="_blank">这里</a>找到，包括本教程中使用的所有要点</p><h2 id="1da7" class="kl km hi bd kn ko kp kq kr ks kt ku kv iq kw kx ky iu kz la lb iy lc ld le lf bi translated">参考</h2><p id="c99a" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq mn is it iu mo iw ix iy mp ja jb jc hb bi translated"><a class="ae jt" href="http://www.start.spring.io" rel="noopener ugc nofollow" target="_blank">弹簧初始化器</a></p><p id="dab7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://github.com/Startup-Chronicles/sqs-demo" rel="noopener ugc nofollow" target="_blank">项目源代码</a></p></div></div>    
</body>
</html>