<html>
<head>
<title>Model Validation for Http Triggered Azure Functions in C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C#中Http触发Azure函数的模型验证</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/model-validation-for-http-triggered-azure-functions-in-c-130676c2d490?source=collection_archive---------0-----------------------#2021-08-13">https://medium.com/javarevisited/model-validation-for-http-triggered-azure-functions-in-c-130676c2d490?source=collection_archive---------0-----------------------#2021-08-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/199e0d8cdddae68e3d761376df7c19ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dp9Rmhjzgi9egG6TWdHlqg.jpeg"/></div></div><p class="iq ir et er es is it bd b be z dx translated">本·科尔德在<a class="ae iu" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2bbd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">Azure功能简介</strong></p><p id="0b83" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Azure Functions是一个事件驱动的无服务器解决方案，开发人员可以专注于编写代码片段，而不必为部署和管理其可扩展性的基础架构投入太多精力。</p><p id="fc64" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个函数都有一个触发器，用于执行该函数。以下是使用的一些主要触发器:</p><ol class=""><li id="4114" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">超文本传送协议（Hyper Text Transport Protocol的缩写）</li><li id="9fa7" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">计时器</li><li id="4eac" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">事件网格</li><li id="d5f9" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">长队</li><li id="8be5" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi">…</li></ol><p id="1128" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以从他们的官方网站<a class="ae iu" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp#supported-bindings" rel="noopener ugc nofollow" target="_blank">这里</a>找到整个名单。</p><p id="5f69" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">今天，我们将关注Http触发的Azure函数，看看我们如何验证输入，比如查询参数和JSON主体。</p><p id="aed0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">ASP中的模型验证。NET Core Web API </strong></p><p id="2ca7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您不熟悉C#，是的，通过模型验证可以很容易地验证HTTP请求中的输入。</p><p id="eba0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以简单地向模型添加注释来指定需求。</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="597d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在这里找到更多的内置属性<a class="ae iu" href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/validation?view=aspnetcore-5.0" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="ed1e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在对模型进行注释之后，在控制器中，我们可以在继续处理请求之前简单地检查模型的有效性。</p><p id="64e4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是一个控制器的例子，摘自微软的<a class="ae iu" href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/model-validation-in-aspnet-web-api" rel="noopener ugc nofollow" target="_blank">文档</a>，关于如何在ASP中轻松实现验证。NET Web API。</p><pre class="kh ki kj kk fd kn ko kp kq aw kr bi"><span id="69bc" class="ks kt hi ko b fi ku kv l kw kx">using MyApi.Models;<br/>using System.Net;<br/>using System.Net.Http;<br/>using System.Web.Http;</span><span id="5f32" class="ks kt hi ko b fi ky kv l kw kx">namespace MyApi.Controllers<br/>{<br/>    public class ProductsController : ApiController<br/>    {<br/>        public HttpResponseMessage Post(Product product)<br/>        {<br/>            if (ModelState.IsValid)<br/>            {<br/>                // Do something with the product (not shown).</span><span id="23ee" class="ks kt hi ko b fi ky kv l kw kx">return new HttpResponseMessage(HttpStatusCode.OK);<br/>            }<br/>            else<br/>            {<br/>                return Request.CreateErrorResponse(HttpStatusCode.BadRequest, ModelState);<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="532e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">Azure函数中的模型验证</strong></p><p id="7272" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">能够重用ASP可用的模型验证的思想。NET /。NET Core将有助于使我们的代码更加直观和可读。</p><p id="b708" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，由于Azure函数中没有对验证的官方支持，所以手动编写If-Else语句来检查模型的有效性是一件非常痛苦的事情。</p><p id="94d7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里有一个解决方案。</p><p id="f8a8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们必须编写我们自己的包装类，它将保存一个关于模型是否有效的布尔值、值本身以及验证结果。</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="4edc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们用方法<code class="du kz la lb ko b">GetBodyAsync()</code>和<code class="du kz la lb ko b">GetQueryParamAsync()</code>为<code class="du kz la lb ko b">HttpRequest</code>构造一个扩展类，分别验证HTTP JSON主体和查询参数。</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="1084" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是一个在HTTP触发的Azure函数中使用ModelValidationExtension的例子。</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="fc20" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">瞧啊。我们现在可以用一种更直观的方式来验证我们的HTTP输入，这种方式很容易管理。</p><p id="08f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您阅读并关注更多关于Azure函数的文章！😁</p></div></div>    
</body>
</html>