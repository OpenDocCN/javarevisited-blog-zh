<html>
<head>
<title>The Simple Approach to Create a More Robust System</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建更强大系统的简单方法</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/the-simple-approach-to-create-a-more-robust-system-4e5366823178?source=collection_archive---------1-----------------------#2019-09-18">https://medium.com/javarevisited/the-simple-approach-to-create-a-more-robust-system-4e5366823178?source=collection_archive---------1-----------------------#2019-09-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6a64f9bd03de78067e44920038ecab3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q2V57T_do1ZJwnPW"/></div></div></figure><p id="f7a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">“系统不应该失败，应用程序不应该崩溃。”</em>这一原则已经在软件开发和设计分布式系统中得到广泛应用。各个公司都实施了某种方法来防止他们的应用程序崩溃。例如，亚马逊通过使用“<a class="ae jp" href="https://www.inc.com/kevin-j-ryan/the-crazy-ways-amazon-will-prevent-your-site-from-crashing.html" rel="noopener ugc nofollow" target="_blank">高可用系统</a>”来保护其云基础设施免于崩溃，高可用系统是指没有单点故障的系统——通过创建冗余，如果一个组件出现故障，系统可以继续运行。</p><p id="800b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">脸书在刚开始使用 MYSQL 数据库时，将其分区到每个区域，以防止应用程序崩溃。然而，就像所有人都会犯错一样，所有系统都会遭遇失败。</p><p id="d07e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有各种方法来限制应用程序不崩溃，如延迟失败，找到一个解决方法的错误，使系统可以继续运行，只是失败了。这些方法不是处理系统故障的最佳方式。</p><p id="900b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为什么？因为做那三件事并没有解决问题。bug 依然存在。隐藏问题只会导致问题在将来变得更大，从而花费更多的时间和资源来解决它。</p><p id="2bd6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">那么，如果申请失败了，我们该怎么办？</strong></p><p id="2635" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">答案是快速失败，然后早点回来。我们需要改变我们对待软件开发的方式。如果有任何问题，我们应该给出异常并返回它，而不是在方法中避免任何类型的异常并优雅地返回。</p><blockquote class="jq"><p id="522c" class="jr js hi bd jt ju jv jw jx jy jz jn dx translated"><em class="ka">“软件开发最讨厌的方面，对我来说，就是调试。我讨厌的错误是那些在不寻常的情况下，每小时成功操作后出现的错误。”—吉姆·肖尔</em></p></blockquote><h1 id="9bed" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">快速失败，而不是自动防故障</h1><p id="cc05" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">当软件快速失败时，它不会减少系统中的 bug 数量；但是会更容易发现错误并解决问题。快速失败会鼓励我们立即、明显地让系统失败。看起来它会通过立即暴露错误而使我们的系统变得脆弱。</p><p id="4bd9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，它创建了一个更健壮的系统，可以在投入生产之前解决问题。当错误更容易被发现和复制时，就更容易修复。例如，让我们创建一个自动防故障方法来计算租金金额:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="e105" class="ln kc hi lj b fi lo lp l lq lr">public int maxRent() {<br/>  RentPortfolio rent = Portfolio.get("rent-portfolio");<br/>  if(rent == null) {<br/>    return 1000;<br/>  } <br/>  return rent.getMaxPrice();<br/>}<!-- --> </span></pre><p id="a436" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该方法通过从<code class="du ls lt lu lj b">Portfolio</code>对象获取<code class="du ls lt lu lj b">rent-portfolio</code>属性来计算最大租金。当您在这个方法中输入任何值时，它都会优雅地返回。</p><p id="62a1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，想象一下在<code class="du ls lt lu lj b">Portfolio</code>类中有一个小的升级，一个正在升级代码库的开发人员在<code class="du ls lt lu lj b">rent-portfolio</code>到<code class="du ls lt lu lj b">rent-porttfolio</code>上创建了一个错别字。</p><p id="80b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">软件仍然可以成功交付，应用程序仍然可以工作。然而，用户每次都会得到错误的值，因为它将返回一个默认值。当客户意识到它不准确时，将很难调试这个问题。</p><p id="2c78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">相反，如果你写一个快速失败的方法:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="6096" class="ln kc hi lj b fi lo lp l lq lr">public int maxRent() {<br/>  RentPortfolio rent = Portfolio.get("rent-portfolio");<br/>  if(rent == null) {<br/>    throw new PortfolioNotFoundException("rent-portfolio is not found in " + this.portfolioPath);<br/>  }<br/>  return rent.getMaxPrice();<br/>}</span></pre><p id="ad46" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一次，开发人员会在发布软件之前检测到 bug，因为它会抛出一个<code class="du ls lt lu lj b">PortfolioNotFoundException</code>。</p><p id="0e08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">故障快速和故障安全方法的另一个例子:</p><p id="7643" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"><em class="jo"/></strong></p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="6e20" class="ln kc hi lj b fi lo lp l lq lr">public division(int numerator, int denominator) {<br/>  <em class="jo">/* some code here ........ */</em><br/>  return numerator / denominator;<br/>}<br/><br/>public static void main(String...args) {<br/>  division(2,0);<br/>}</span></pre><p id="b349" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ls lt lu lj b">Exception: java.lang.ArithmeticException: / by zero …</code></p><p id="dca4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">快速失效</em> </strong></p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="2ad9" class="ln kc hi lj b fi lo lp l lq lr">public division(int numerator, int denominator) {<br/>  if(denominator == 0) throw new IllegalArgumentException("denominator cannot be 0");<br/>  <em class="jo">/* some code here ..... */</em><br/>  return numerator / denominator;<br/>}<br/><br/>public static void main(String...args) {<br/>  division(2,0);<br/>}</span></pre><p id="d498" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ls lt lu lj b">Exception: java.lang.IllegalArgumentException: denominator cannot be 0 ….</code></p><p id="912d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个例子中，fail-fast 确实抛出了一个错误。但是，应用程序没有抛出正确的消息。bug 的根本原因是因为是<code class="du ls lt lu lj b">InvalidArgumentException</code>而不是<code class="du ls lt lu lj b">ArithmeticException</code>。因此，<a class="ae jp" href="https://javarevisited.blogspot.com/2018/05/10-tips-to-become-better-java-developer.html#axzz5jwmmAbXI" rel="noopener ugc nofollow" target="_blank">开发人员</a>需要多次搜索代码才能知道问题出在哪里。Fail-fast 将帮助维护程序的开发人员立即发现错误。</p><h1 id="a456" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km lv ko kp kq lw ks kt ku lx kw kx ky bi translated">小贴士——一对夫妇没有通过快速检查:</h1><ul class=""><li id="24da" class="ly lz hi is b it kz ix la jb ma jf mb jj mc jn md me mf mg bi translated">空</li><li id="0101" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated">空字符串</li><li id="cbd2" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated">空列表</li><li id="df9a" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated">大多数先决条件检查</li></ul><h1 id="de5f" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km lv ko kp kq lw ks kt ku lx kw kx ky bi translated">识别可见故障的方法:</h1><ul class=""><li id="e155" class="ly lz hi is b it kz ix la jb ma jf mb jj mc jn md me mf mg bi translated">使用<a class="ae jp" href="https://javarevisited.blogspot.com/2019/04/top-5-junit-and-unit-testing-courses-java-programmers.html" rel="noopener ugc nofollow" target="_blank">测试驱动开发</a>。甚至在实现方法之前，您就可以通过使用断言来陈述成功的用例以及失败的用例。</li><li id="e960" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated">在您的软件开发过程中有一个持续的集成构建将确保在将功能分支合并到主分支时任何必要的失败。</li><li id="d2fc" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated">为健全性检查创建断言——断言和异常之间的区别可以在这里找到(链接)。</li><li id="5a25" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated">当系统设置出现任何问题时，不使用后备功能，而是让系统出现故障，以便您可以得到通知并立即解决问题。</li><li id="6b82" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated">当前端向服务器请求对集合的 GET 调用时，不是在没有找到集合时返回空列表，而是返回 404 not found 异常。</li></ul><h1 id="c1f2" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km lv ko kp kq lw ks kt ku lx kw kx ky bi translated">早点回来</h1><p id="8022" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">早归与快败相伴。当您发现一个 bug 时，您可以将它抛出到函数上方的系统堆栈中，或者立即返回该错误。例如，当您想在函数参数中创建一个前置条件检查时，您可以这样做:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="a6f3" class="ln kc hi lj b fi lo lp l lq lr">public String getPersonalData(Person person) {<br/>  if(!systemIsUp) {<br/>   if(person.getName() == "") {<br/>    if(person.age == 0) {<br/>      if(person.pin == "") {<br/>        return "Person doesn't have a pin"; <br/>      }<br/>      return "Person age cannot be 0";<br/>    }<br/>    return "Person Doesn't have a name"<br/>   }<br/>   return "System is Down"<br/>  }<br/>  return person.getName();<br/>}</span></pre><p id="dc2a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你正在读这段代码，当你读到第三个语句时，你可能会忘记前两个参数的语句是什么。这种检查的主要问题是，当出现故障时，不仅很难调试，而且很难阅读。</p><p id="daca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这会导致很高的圈复杂度。圈复杂度是一个度量你的软件系统有多复杂的指标。你如何衡量复杂性？每当有<code class="du ls lt lu lj b">if</code>、<code class="du ls lt lu lj b">else</code>、<code class="du ls lt lu lj b">try</code>、<code class="du ls lt lu lj b">catch</code>、<code class="du ls lt lu lj b">for</code>、<code class="du ls lt lu lj b">and</code>、<code class="du ls lt lu lj b">or</code>、<code class="du ls lt lu lj b">others</code>、<code class="du ls lt lu lj b">while</code>的时候，你都在增加一点复杂性。圈复杂度越高，意味着系统越复杂，越难维护。</p><p id="60b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，记住所有的检查和嵌套的 if/else 语句很难。相反，应该尽早返回预处理的 if/else 语句，首先从简单的条件开始。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="f4f0" class="ln kc hi lj b fi lo lp l lq lr">public String getPersonal(Person person) {<br/>  if(!systemIsUp) return "System is Down";<br/>  <br/>  if(person.getName() == "") return "Person Doesn't have a name";<br/>  <br/>  if(person.age == 0) return "Person age cannot be 0";<br/>  <br/>  if(person.pin == 0) return "Person' doesn't have a pin";<br/>  <br/>  return person.getName();<br/>}</span></pre><p id="2e84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你正在阅读这段代码，你就会明白先决条件应该是什么。你在<a class="ae jp" href="https://www.java67.com/2018/01/how-to-remote-debug-java-application-in-Eclipse.html" rel="noopener ugc nofollow" target="_blank">调试应用</a>的时候，不需要有一张纸，写下所有的 if/else 语句。此外，函数中编写的代码更少。</p><h1 id="c902" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km lv ko kp kq lw ks kt ku lx kw kx ky bi translated">外卖食品</h1><blockquote class="mm mn mo"><p id="7621" class="iq ir jo is b it iu iv iw ix iy iz ja mp jc jd je mq jg jh ji mr jk jl jm jn hb bi translated"><em class="hi">“失败，一次又一次的失败，是成就道路上的标杆。一个人朝着成功前进。”刘易斯。</em></p></blockquote><p id="7a0f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了使系统更加健壮，开发人员应该抛出任何出现的错误，以便很容易立即捕捉并修复它们。处理前提条件和健全性检查的一个好方法是抛出一个<a class="ae jp" href="https://www.java67.com/2019/06/top-25-java-exception-interview-questions-answers.html" rel="noopener ugc nofollow" target="_blank">异常</a>或<a class="ae jp" href="https://javarevisited.blogspot.com/2012/01/what-is-assertion-in-java-java.html" rel="noopener ugc nofollow" target="_blank">断言</a>。一旦条件不满足，立即退货。通过快速失败和早期返回，我们可以降低调试成本并提高系统质量。</p></div><div class="ab cl ms mt gp mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hb hc hd he hf"><p id="40bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读！如果你喜欢这篇文章，请随意<a class="ae jp" href="https://edward-huang.com/subscribe/" rel="noopener ugc nofollow" target="_blank">订阅</a>我的时事通讯，每周都会收到关于科技职业的文章、有趣的链接和内容！</p><p id="876d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jp" href="https://edward-huang.com/software-best-practice/tech/software-development/2019/08/25/how-to-maintain-clean-code-in-your-projects/" rel="noopener ugc nofollow" target="_blank">如何在你的项目中保持干净的代码</a></p><p id="8563" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你也可以关注我在<a class="ae jp" rel="noopener" href="/@edwardgunawan880">媒体</a>上的更多帖子。</p><p id="e9ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">原载于</em><a class="ae jp" href="https://edward-huang.com/tech/software-development/2019/09/16/the-simple-approach-to-create-a-more-robust-system/" rel="noopener ugc nofollow" target="_blank"><em class="jo">https://edward-huang.com</em></a><em class="jo">。</em></p><h1 id="2a5a" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km lv ko kp kq lw ks kt ku lx kw kx ky bi translated">参考:</h1><ul class=""><li id="d782" class="ly lz hi is b it kz ix la jb ma jf mb jj mc jn md me mf mg bi translated"><a class="ae jp" href="https://www.martinfowler.com/ieeeSoftware/failFast.pdf" rel="noopener ugc nofollow" target="_blank">马丁-福勒快速失效</a></li><li id="83e1" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated"><a class="ae jp" href="https://dzone.com/articles/fail-fast-principle-in-software-development" rel="noopener ugc nofollow" target="_blank">软件开发中的快速失败原则——DZone Agile</a></li><li id="3b79" class="ly lz hi is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated"><a class="ae jp" href="https://www.codementor.io/joshuaaroke/dry-code-vs-wet-code-89xjwv11w" rel="noopener ugc nofollow" target="_blank">干代码与湿代码\-code mentor</a></li></ul></div><div class="ab cl ms mt gp mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hb hc hd he hf"><p id="4b34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">学习 Java 的其他<strong class="is hj">有用资源</strong>你可能喜欢的<br/><a class="ae jp" href="https://javarevisited.blogspot.com/2017/12/10-things-java-programmers-should-learn.html#axzz5atl0BngO" rel="noopener ugc nofollow" target="_blank">2019 年 Java 程序员应该学习的 10 件事</a> <br/> <a class="ae jp" href="http://www.java67.com/2018/08/top-10-free-java-courses-for-beginners-experienced-developers.html" rel="noopener ugc nofollow" target="_blank">从零开始学习 Java 的 10 门免费课程</a> <br/> <a class="ae jp" href="https://medium.freecodecamp.org/must-read-books-to-learn-java-programming-327a3768ea2f" rel="noopener ugc nofollow" target="_blank">深入学习 Java 的 10 本书</a> <br/> <a class="ae jp" href="http://www.java67.com/2018/04/10-tools-java-developers-should-learn.html" rel="noopener ugc nofollow" target="_blank"> 10 个工具每个 Java 开发者都应该知道的</a> <br/> <a class="ae jp" href="http://javarevisited.blogspot.sg/2013/04/10-reasons-to-learn-java-programming.html" rel="noopener ugc nofollow" target="_blank">学习 Java 编程语言的 10 个理由</a><br/><a class="ae jp" href="http://javarevisited.blogspot.sg/2018/01/10-frameworks-java-and-web-developers-should-learn.html" rel="noopener ugc nofollow" target="_blank">2019 年 Java 和 Web 开发者应该学习的 10 个框架【t 成为 2019 年更优秀的 Java 开发者</a><br/><a class="ae jp" href="http://javarevisited.blogspot.sg/2018/04/top-5-java-frameworks-to-learn-in-2018_27.html" rel="noopener ugc nofollow" target="_blank">2019 年要学习的 5 大 Java 框架</a> <br/> <a class="ae jp" href="https://javarevisited.blogspot.sg/2018/01/10-unit-testing-and-integration-tools-for-java-programmers.html" rel="noopener ugc nofollow" target="_blank">每个 Java 开发者都应该知道的 10 个测试库</a></p><div class="mz na ez fb nb nc"><a rel="noopener follow" target="_blank" href="/javarevisited/10-free-courses-to-learn-java-in-2019-22d1f33a3915"><div class="nd ab dw"><div class="ne ab nf cl cj ng"><h2 class="bd hj fi z dy nh ea eb ni ed ef hh bi translated">我最喜欢的深入学习 Java 的免费课程</h2><div class="nj l"><h3 class="bd b fi z dy nh ea eb ni ed ef dx translated">我的免费课程列表深入学习 Java 从核心 Java 到多线程到 JDBC 到合集，什么都有…</h3></div><div class="nk l"><p class="bd b fp z dy nh ea eb ni ed ef dx translated">medium.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq io nc"/></div></div></a></div></div></div>    
</body>
</html>