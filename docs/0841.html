<html>
<head>
<title>Do you really need “Event Sourcing”?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你真的需要“事件采购”吗？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/do-you-really-need-event-sourcing-22a53a32a96c?source=collection_archive---------1-----------------------#2020-12-14">https://medium.com/javarevisited/do-you-really-need-event-sourcing-22a53a32a96c?source=collection_archive---------1-----------------------#2020-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1fb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“事件源指的是基于将一个领域的<strong class="ih hj"> <em class="jd">完整历史作为事件序列</em> </strong>持久化，而不仅仅是持久化当前状态的思想的<strong class="ih hj">模式</strong>的集合”——乌迪·达汗</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/e61ba0e266236dfa094e8dadac1b54f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*takkK6BirOAS9iWPW3OBpA.jpeg"/></div><p class="jm jn et er es jo jp bd b be z dx translated">丹尼斯·安德森在<a class="ae jq" href="https://unsplash.com/s/photos/counting?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b6d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">剧透警报:</strong></p><p id="572a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在常规的企业应用程序开发中，事件源可能不会出现。但是它们在源代码控制系统(如<a class="ae jq" rel="noopener" href="/javarevisited/7-best-courses-to-master-git-and-github-for-programmers-d671859a68b2"> Git </a>、SVN)、数据库内部(如复制、备份和恢复)以及复杂企业应用 的一小部分中有其相关性。</p><blockquote class="jr"><p id="9941" class="js jt hi bd ju jv jw jx jy jz ka jc dx translated">“只有当你处理复杂且不断变化的领域时，活动外包才是一个很好的选择”——乌迪·达汗</p><p id="1eb4" class="js jt hi bd ju jv jw jx jy jz ka jc dx translated">“使用事件源的企业应用程序很少，但我见过一些使用它的应用程序(或部分应用程序)”Martin Fowler</p><p id="c3e5" class="js jt hi bd ju jv jw jx jy jz ka jc dx translated">“不要把简历放在要求之前”——尼廷·博万卡尔</p></blockquote></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="33bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事件源包括两个关键方面— <strong class="ih hj">应用程序状态和日志</strong>。在任何给定的时间点，应用程序状态都可以通过重放事件(日志)从零重新构建为最新状态。<strong class="ih hj"> <em class="jd">事件日志会是真相的来源。</em> </strong></p><p id="f868" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与活动采购相关的好处是(请收听<a class="ae jq" href="https://www.youtube.com/watch?v=aweV9FLTZkU" rel="noopener ugc nofollow" target="_blank"> Martin Fowler会议</a>了解更多详情)</p><ul class=""><li id="0aa6" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated">审查跟踪</li><li id="faa1" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">重放或历史状态</li><li id="e7ab" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">排除故障</li><li id="f563" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">变体方案/ CQRS</li><li id="8501" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">分销支持</li><li id="b8dc" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">另类历史</li></ul><p id="3910" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于解释事件来源的典型例子是订单。让我们考虑“内部事件”的购物车和“外部事件”的销售订单</p><blockquote class="kw kx ky"><p id="1945" class="if ig jd ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><em class="hi">💡订单管理实际上比大多数博客或视频会议解释的更复杂。</em></p></blockquote><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/e54c58d8b0f213e6476da1445f16ce15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VD5pJRRultWF-edjjQsgww.png"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">购物车(内部事件)</p></figure><p id="5b52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">注意:删除事件可以用许多不同的方式来捕获。为了简单起见，我在数量上使用了负值😄<em class="jd">(绝对不是真正的用例)。</em></em></p><p id="f713" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事件采购可能不适合这类内部交易(或事件)。 CRUD ( <a class="ae jq" href="https://martinfowler.com/eaaCatalog/transactionScript.html" rel="noopener ugc nofollow" target="_blank">交易脚本</a>)方法就足够了。</p><p id="c54a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获得收益的替代方法</p><p id="974b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">审计</strong></p><ul class=""><li id="96fc" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated">某些时候，业务需求或法规要求决定了实施。例如，簿记和银行交易— <br/> a .不要删除任何交易,<br/> b .根据需要输入冲销分录<br/> c .根据需要创建汇总报表<br/> d .根据需要创建快照，如月结或年结</li><li id="4c9b" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">在所有其他情况下，根据需要，我们可以跟踪交易/事件，并在达到阈值后清除</li></ul><p id="d580" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">重放或历史状态</strong></p><ul class=""><li id="35c2" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated">Apache Kafka类的事件流层可以跟踪事务并允许重放。</li><li id="771e" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">传统的消息传递层可以用于重放，但这将是一个挑战。定制开发将涉及持久化所有事件，并使用事件生成器重新生成事件。</li></ul><p id="5746" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">注:受可用存储空间和重新处理时间的限制</em></p><p id="f592" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">调试</strong></p><ul class=""><li id="d4c7" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated">使用ELK stack或Splunk之类的日志管理工具来简化调试。作为事件消费者之一插入堆栈。</li></ul><p id="7f71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">变型方案/ CQRS </strong></p><ul class=""><li id="5eb4" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated">报告数据库方法是一种低技术的替代方法，但在行业内长期适用</li><li id="3bae" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">物化视图是一种数据库特性，它允许完全刷新和“增量”刷新</li><li id="fbea" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">变更数据捕获和事件流可用于构建不同的方案</li></ul><p id="96d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">分销支持</strong></p><ul class=""><li id="0145" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated">让数据库来处理这些特性，而不是让应用程序来处理。例如，大多数数据库中的写入和读取副本功能</li></ul><p id="012b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">“备选历史”用例可能非常适合事件采购。</strong></p><p id="4976" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当涉及到外部系统时，与业务事件(外部事件)相关的用例实际上会违背事件源。在大多数现实世界的系统中，外部系统或其他部门系统总是存在的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/774a70d5177728304737843dae0d8cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R5qVXjtfPl4n0-iJc7-K4A.png"/></div></div><p class="jm jn et er es jo jp bd b be z dx translated">企业业务</p></figure><p id="a955" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们不能随意重放事件，除非我们确保禁止向外部系统发送通知和请求。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="e16f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想知道(像我一样)事件采购非常适合的罕见用例，答案是<strong class="ih hj">双时间</strong></p><blockquote class="kw kx ky"><p id="5934" class="if ig jd ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">Bitemporal允许您同时沿着两个时间轴跟踪数据库文档。它可以让您<strong class="ih hj">跟踪事件发生的时间</strong>(有效时间)，以及数据输入数据库的时间(系统时间)。</p><p id="8300" class="if ig jd ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">在金融服务、保险、医疗保健、智能、执法等一些行业中，记录这些不同的时间非常重要。了解信息何时已知，并能够在审计时重新创建历史记录或在事后执行分析，这一点至关重要。<br/>来源:<a class="ae jq" href="https://www.marklogic.com/blog/bitemporal/" rel="noopener ugc nofollow" target="_blank">https://www.marklogic.com/blog/bitemporal/</a></p></blockquote></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="a682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个博客是基于这些来源分享的观点</p><ul class=""><li id="620d" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated"><a class="ae jq" href="https://www.youtube.com/watch?v=aweV9FLTZkU" rel="noopener ugc nofollow" target="_blank">活动采购— 2016 </a>📺马丁·福勒</li><li id="5485" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated">【2020年欧洲DDD展会采购活动📺乌迪·达汗<br/> <em class="jd">旁注:我希望开发人员观看、学习和欣赏建筑讨论——乌迪·达汗的精彩演讲在YouTube上仅获得了4k的浏览量</em>😞</li><li id="45f5" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated"><a class="ae jq" href="https://axoniq.io/resources/event-sourcing" rel="noopener ugc nofollow" target="_blank">Axon事件源</a>📕</li></ul><blockquote class="kw kx ky"><p id="cbba" class="if ig jd ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj">免责声明:</strong> Axon框架简化了微服务的开发，有助于采用领域驱动设计和命令查询责任分离(CQRS)。唯一需要澄清的争议或疑问是“活动采购”。到目前为止，我还没有动手操作过Axon。</p></blockquote></div></div>    
</body>
</html>