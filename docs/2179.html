<html>
<head>
<title>Spring Cloud Alibaba’s Tutorial from Getting Started to a Master (6) — Message Component RocketMQ</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">春云阿里巴巴从入门到精通教程(六)——消息组件RocketMQ</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/spring-cloud-alibabas-tutorial-from-getting-started-to-a-master-6-message-component-rocketmq-bd95ff607442?source=collection_archive---------3-----------------------#2022-06-12">https://medium.com/javarevisited/spring-cloud-alibabas-tutorial-from-getting-started-to-a-master-6-message-component-rocketmq-bd95ff607442?source=collection_archive---------3-----------------------#2022-06-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3f34" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">消息组件RocketMQ服务器启动安装快速入门介绍</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/ef09273f738aa3b201b06bcff1075254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7J1qtdFGC2byofiCoCR5A.jpeg"/></div></div></figure><p id="a46b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">什么是RocketMQ？</strong></p><p id="a1d5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">RocketMq是阿里巴巴开源的消息中间件。它在设计上借鉴了<a class="ae kf" rel="noopener" href="/javarevisited/top-10-apache-kafka-online-training-courses-and-certifications-621f3c13b38c">卡夫卡</a>。2012年开源，2017年成为顶级Apache项目。</p><p id="1670" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">基本概念:</p><ul class=""><li id="9c78" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke kl km kn ko bi translated">RocketMQ主要由三部分组成:生产者、代理和消费者。生产者负责产生消息，消费者负责消费消息，代理负责存储消息。</li><li id="4356" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke kl km kn ko bi translated">代理对应于实际部署过程中的服务器。每个代理可以存储多个主题的消息，并且每个代理也可以存储在不同的代理分片中。</li><li id="934e" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke kl km kn ko bi translated">消息队列用于存储消息的物理地址，每个主题中的消息地址存储在多个消息队列中。</li><li id="9f94" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke kl km kn ko bi translated">ConsumerGroup由多个使用者实例组成。</li></ul><p id="e775" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">技术架构:主要分为四个部分</p><ol class=""><li id="cd5c" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke ku km kn ko bi translated">生产者:消息发布的角色，支持分布式集群部署。生产者通过MQ负载平衡模块为消息传递选择相应的代理集群队列。交付过程支持快速故障和低延迟。</li><li id="4416" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated">消费者:消息消费的角色，支持分布式集群部署。支持两种模式的消息消费:推和拉。同时还支持集群模式和广播模式下的消费。它提供了实时消息订阅机制，可以满足大多数用户的需求。</li><li id="cedf" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated">名称服务器:名称服务器是一个非常简单的主题路由注册中心。它的作用类似于Dubbo中的zookeeper，支持经纪人的动态注册和发现。主要包括两个功能:代理管理，NameServer接受代理集群的注册信息并保存为路由信息的基础数据。然后提供心跳检测机制，检查代理是否还活着；路由信息管理，每个名称服务器将保存关于代理集群的整个路由信息和队列信息，以供客户端查询。那么<a class="ae kf" href="https://javarevisited.blogspot.com/2015/06/java-lock-and-condition-example-producer-consumer.html" rel="noopener ugc nofollow" target="_blank">生产者</a>和<a class="ae kf" href="https://javarevisited.blogspot.com/2022/03/spring-boot-kafka-example-single-and-multiple-consumers.html" rel="noopener ugc nofollow" target="_blank">消费者</a>就可以通过名称服务器知道整个代理集群的路由信息，从而进行消息的传递和消费。名称服务器通常部署在一个集群中，每个实例之间不进行通信。Broker向每个名称服务器注册它自己的路由信息，因此每个名称服务器实例保存一段完整的路由信息。当一个名称服务器由于某种原因离线时，代理仍然可以将其路由信息与其他名称服务器同步，生产者和消费者仍然可以动态感知代理的路由信息。</li><li id="ca18" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated">BrokerServer: Broker主要负责消息的存储、交付和查询，以及服务高可用性保障。为了实现这些功能，Broker包括以下重要的子模块。</li></ol><p id="9fc2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">通用<a class="ae kf" href="https://javarevisited.blogspot.com/2014/03/top-10-websphere-mq-series-interview-questions-answers-active-rabbit.html" rel="noopener ugc nofollow" target="_blank"> MQ </a>适用场景:</p><ol class=""><li id="3c97" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke ku km kn ko bi translated">流量调峰:提高系统的高并发处理能力，比如尖峰场景</li><li id="caf1" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated">异步处理:提高系统吞吐量</li><li id="10a8" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated">应用程序解耦:减少系统模块之间的耦合</li></ol><p id="6638" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">快速启动</p><h2 id="75b6" class="kv kw hi bd kx ky kz la lb lc ld le lf js lg lh li jw lj lk ll ka lm ln lo lp bi translated">1.服务器启动安装</h2><ol class=""><li id="8061" class="kg kh hi jl b jm lq jp lr js ls jw lt ka lu ke ku km kn ko bi translated">准备环境</li></ol><p id="dc1d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">RocketMQ依赖于<a class="ae kf" href="https://javarevisited.blogspot.com/2012/08/how-to-get-environment-variables-in.html" rel="noopener ugc nofollow" target="_blank"> Java环境</a>来运行。如果您正在从代码构建和运行RocketMQ，您还需要为此配置一个<a class="ae kf" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-maven-jenkins-and-docker-for-java-developers-51fa7a1e66f6"> Maven </a>环境，确保在以下版本环境中安装和使用:</p><ol class=""><li id="052a" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke ku km kn ko bi translated">64位OS，支持Linux/Unix/Mac/Windows，<a class="ae kf" rel="noopener" href="/javarevisited/6-best-websites-to-learn-linux-4861ac21bfdf">推荐Linux </a> /Unix/Mac。</li><li id="a5e9" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated">64位JDK 1.8+；下载和配置。</li><li id="1d29" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated">maven 3.2 . x+；下载和配置。</li><li id="aa4c" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated"><a class="ae kf" rel="noopener" href="/javarevisited/11-best-online-places-to-learn-git-for-beginners-in-2021-6dc2b7c6ef48">饭桶</a></li><li id="d99c" class="kg kh hi jl b jm kp jp kq js kr jw ks ka kt ke ku km kn ko bi translated">4G或更多可用硬盘空间</li></ol><p id="4d8d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">2.下载源代码或安装包(本文中使用的方法)</p><p id="a281" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">本文使用的版本是:源码包rocket MQ-all-4 . 7 . 0-source-release . zip</p><p id="a55b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">3.下载后，解压缩并构建包</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="744a" class="kv kw hi lw b fi ma mb l mc md">unzip rocketmq-all-4.7.0-source-release.zip<br/>cd rocketmq-all-4.7.0-source-release/<br/>mvn -Prelease-all -DskipTests clean install -U</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://javarevisited.blogspot.com/2019/03/top-5-course-to-learn-apache-maven-for.html"><div class="er es me"><img src="../Images/a3b3ba52f477bd86cce210a4b444d83d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AqjVgxPey1AK34P8"/></div></a></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://javarevisited.blogspot.com/2017/06/10-maven-tips-java-developer-should-know.html"><div class="er es mf"><img src="../Images/57322c2f12221c0b2890b83e60e0c0b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Topeff7Reu_sHdGa"/></div></a></figure><p id="56ab" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">输入目录:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="8b5f" class="kv kw hi lw b fi ma mb l mc md">cd distribution/target/rocketmq-4.7.0/rocketmq-4.7.0</span></pre><p id="8159" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">4.启动名称服务器服务</p><p id="fcad" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">开始命令:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="6e09" class="kv kw hi lw b fi ma mb l mc md">nohup sh bin/mqnamesrv &amp;</span></pre><p id="be0c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">查看日志:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="fe43" class="kv kw hi lw b fi ma mb l mc md">tail -f ~/logs/rocketmqlogs/namesrv.log</span></pre><p id="c1b9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">5.启动代理服务</p><p id="3f4d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">开始命令:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="13a3" class="kv kw hi lw b fi ma mb l mc md">nohup sh bin/mqbroker -n localhost:9876 &amp;</span></pre><p id="724c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">查看日志:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="5aee" class="kv kw hi lw b fi ma mb l mc md">tail -f ~/logs/rocketmqlogs/broker.log</span></pre><p id="1286" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">6.测试发送和接收消息(演示)以验证成功</p><p id="ad29" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">“发送消息”测试:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="7dc7" class="kv kw hi lw b fi ma mb l mc md">&gt; export NAMESRV_ADDR=localhost:9876<br/> &gt; sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer<br/> SendResult [sendStatus=SEND_OK, msgId= ...</span></pre><p id="7ff3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">“接收消息”测试:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="0c1d" class="kv kw hi lw b fi ma mb l mc md">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer<br/>ConsumeMessageThread_%d Receive New Messages: [MessageExt...</span></pre><p id="e860" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">7.停止服务</p><p id="76f1" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">停止代理服务:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="901f" class="kv kw hi lw b fi ma mb l mc md">&gt; sh bin/mqshutdown broker<br/>The mqbroker(36695) is running...<br/>Send shutdown request to mqbroker(36695) OK</span></pre><p id="f834" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">停止名称服务器服务:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="d388" class="kv kw hi lw b fi ma mb l mc md">&gt; sh bin/mqshutdown namesrv<br/>The mqnamesrv(36664) is running...<br/>Send shutdown request to mqnamesrv(36664) OK</span></pre></div></div>    
</body>
</html>