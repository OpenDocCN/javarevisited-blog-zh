<html>
<head>
<title>Spring Boot Externalized Database Configuration with AWS Secrets Manager</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Secrets Manager的Spring Boot外部化数据库配置</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/spring-boot-externalized-database-configuration-with-aws-secrets-manager-605f5ea3006a?source=collection_archive---------0-----------------------#2021-12-30">https://medium.com/javarevisited/spring-boot-externalized-database-configuration-with-aws-secrets-manager-605f5ea3006a?source=collection_archive---------0-----------------------#2021-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="06fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实现高可用性、可扩展性和简单性</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/20682d75cd2d9447a7cadbb7978e30c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wo9MXHhmB-SkRAXi"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">巴勃罗·阿罗约在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="b41e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated"><strong class="ak">简介</strong></h2><p id="cadc" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在本教程中，我们将逐步完成Spring Boot的数据库配置与AWS Secrets Manager的集成。</p><p id="5312" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在深入实现细节之前，让我们先讨论一些上下文。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h2 id="b373" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">语境</h2><p id="d9e7" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">众所周知，设置Spring Boot数据库配置的最常见方法之一是使用应用程序属性。对一些人来说，更改数据库密码可能很少；然而，为了安全起见，定期做总是更好。</p><p id="b632" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">传统上，更改数据库密码意味着在应用了对应用程序属性的更改之后重新启动服务(对于环境变量也是可能的)。我们做得越频繁，就越有可能给用户带来服务中断。</p><p id="d670" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，通过集成AWS Secrets Manager，无论何时我们更改数据库密码，都不需要重新启动服务。它甚至提供了自动定期密码轮换选项。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h2 id="5eec" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤1:在AWS Secrets Manager中创建数据库凭据</h2><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/05/top-20-spring-boot-interview-questions-answers.html"><div class="er es lb"><img src="../Images/648abe31d7511082cb77cfaa9192519c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LBDdeE6Puu9A6nKVqt-GCg.png"/></div></a></figure><p id="ea33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前往AWS控制台，搜索“秘密管理器”然后，继续执行后续步骤，直到创建了秘密。</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://medium.com/javarevisited/7-best-courses-to-learn-spring-boot-with-aws-and-azure-cloud-platform-9f953d12bb93"><div class="er es lc"><img src="../Images/3d4393dc236e9388ed6dce228530768c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAtg3JoPLBkv6UNjcBGsPQ.png"/></div></a></figure></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h2 id="fe1f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤2:在pom.xml中添加必要的依赖项</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="d46a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:<em class="lf">spring-boot-starter-data-JPA</em>依赖关系可以与<em class="lf">spring-boot-starter-JDBC</em>互换。</strong>根据您的设置随意更改。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h2 id="235d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤3:相应地配置应用程序属性文件</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="0884" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，对于<em class="lf">驱动程序类名</em>属性，我们使用awssecretsmanagerpostgresql driver类。注意，它来自于<em class="lf">AWS-secrets manager-JDBC</em>依赖关系。</p><p id="365d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，对于<em class="lf">spring . JPA . database-platform</em>属性，我们使用了来自<em class="lf"> postgresql </em>依赖项的<em class="lf">PostgreSQL diaclet</em>。</p><p id="cd57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，值得指出的是<em class="lf">数据源url </em>前缀的变化，现在是<em class="lf"> jdbc-secretsmanager。</em></p><p id="b089" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，对于<em class="lf">数据源用户名，</em>我们使用来自AWS Secret Manager的<em class="lf">秘密名</em>。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h2 id="7c74" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated"><strong class="ak">步骤4:检查服务器的数据库和Secrets Manager连接</strong></h2><p id="25de" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">对于<em class="lf">数据库连接</em>，尝试使用<em class="lf"> psql </em>命令进行连接:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/f979e198e97ff7b00d7ef9bb4af2bf3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16d05F7N-Ak4YAES7OD9OA.png"/></div></div></figure><p id="f8fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我们可能会遇到的一些错误:</p><ul class=""><li id="39ac" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated"><strong class="ih hj"> psql未安装:</strong>请使用您的实例包管理器<strong class="ih hj">安装它。</strong></li><li id="46f7" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated"><strong class="ih hj">连接超时:确保EC2实例和数据库在同一VPC上。此外，将数据库的安全组附加到EC2实例</strong> —这将允许访问服务器以连接到数据库。</li></ul><p id="fe9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于机密管理器连接，再次使用aws-cli，尝试列出机密:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/5a8c86eb156175e1b7a2a32a2dbaca0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eheLNAXoAvtyParnQyX5aw.png"/></div></div></figure><p id="e9ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我们可能会遇到的一些错误:</p><ul class=""><li id="5a50" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated"><strong class="ih hj"><em class="lf">区域</em>未定义:使用aws configure进行设置。</strong>与此同时，人们可能会跳过与密钥相关的部分，因为将密钥存储在服务器的实例中通常是不安全的。</li><li id="ba37" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated"><strong class="ih hj"><em class="lf">EC2实例</em>无权访问<em class="lf"> AWS Secrets Manager </em> : </strong>为了获得更安全的方法，与其直接在EC2中配置密钥，<strong class="ih hj">不如创建一个具有Secrets Manager读访问策略的角色；然后，将其附加到EC2实例。</strong></li></ul></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h2 id="47a1" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated"><strong class="ak">最后，运行应用程序并测试其数据库连接</strong></h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ca"><img src="../Images/9e5546fd6ac4a3cc0d01fa183ebbf21c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0esbB5DY32KIdKffrVNG_A.png"/></div></div></figure><p id="1373" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据日志，我们可以确认与数据库的成功连接。此外，如果我们尝试轮换密码，由于AWS Secrets Manager中的缓存机制，我们仍然能够连接到数据库，而不会出现任何停机。</p><p id="6564" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！和往常一样，您可以在Github 上查看这个演示的源代码。</p></div></div>    
</body>
</html>