<html>
<head>
<title>How to encrypt secrets in a Spring boot application?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在一个Spring boot应用中加密秘密？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/how-to-encrypt-secrets-in-an-spring-boot-application-57a60c8abaa7?source=collection_archive---------0-----------------------#2021-09-24">https://medium.com/javarevisited/how-to-encrypt-secrets-in-an-spring-boot-application-57a60c8abaa7?source=collection_archive---------0-----------------------#2021-09-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/19d8dada17aec3f9cef41a2ba24a1e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w1fZ0WZy-BekOv_amvHR_A.jpeg"/></div></div></figure><p id="ec48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多的时候，我们习惯于在应用程序的属性<strong class="is hj"> </strong>文件中以纯文本变量的形式存储我们的秘密，但这不是一个好的做法。</p><h1 id="b48c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">存储纯文本机密不是好做法的原因？</strong></h1><p id="8fb3" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">如果我们在应用程序中存储纯文本机密，任何能够访问我们的文件系统的人都可以访问受密码保护的资源，这也使得攻击者的工作变得非常容易。</p><p id="17e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，为了保护我们的应用程序并增强其安全性，我们需要使用一些加密方法，或者将我们的秘密存储在保险库或secret manager服务中的某个地方，比如在<a class="ae kr" rel="noopener" href="/javarevisited/5-best-aws-courses-for-beginners-and-experienced-developers-to-learn-in-2021-563212409fbd"> AWS </a>中。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="b5e0" class="jo jp hi bd jq jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl bi translated"><strong class="ak">我们如何加密这些内容？</strong></h1><p id="020e" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这里我们举一个简单的例子，假设您有一个<a class="ae kr" rel="noopener" href="/hackernoon/top-5-spring-boot-and-spring-cloud-books-for-java-developers-75df155dcedc?source=---------23------------------"> spring boot应用程序</a>，并且您已经将您的纯文本数据库凭证存储在application.yml(yaml文件)或application.properties文件中，如下所示:</p><blockquote class="le lf lg"><p id="e26c" class="iq ir lh is b it iu iv iw ix iy iz ja li jc jd je lj jg jh ji lk jk jl jm jn hb bi translated"><strong class="is hj"><em class="hi">application . yml</em></strong></p></blockquote><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="1694" class="lu jp hi lq b fi lv lw l lx ly">spring:<br/>  datasource:<br/>    url: jdbc:mysql://localhost:3306/cdr?useSSL=false<br/>    username: root<br/>    password: root123</span></pre><p id="e25b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，要加密用户名和密码字符串，我们可以在这里使用<a class="ae kr" href="http://www.jasypt.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Jasypt(Java简化加密)库</strong> </a> <strong class="is hj"> </strong>。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="0e1f" class="jo jp hi bd jq jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl bi translated"><strong class="ak">jas ypt如何工作？</strong></h1><p id="1671" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">Jasypt提供了两种加密方式:单向加密(没有私钥)和双向加密(有私钥)</p><p id="3426" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它使用默认的<a class="ae kr" href="https://javarevisited.blogspot.com/2019/04/top-20-searching-and-sorting-algorithms-interview-questions.html" rel="noopener ugc nofollow" target="_blank">加密算法</a>:<strong class="is hj">pbewithmd 5和DES </strong>，但是它也提供了使用更强加密选项的选项，例如:<strong class="is hj">pbewithmd 5和TripleDES </strong>。</p><p id="5b06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有一个<a class="ae kr" href="https://www.devglan.com/online-tools/jasypt-online-encryption-decryption" rel="noopener ugc nofollow" target="_blank">免费的Jasypt在线加密和解密工具</a> <strong class="is hj"> </strong>，它提供了单向和双向(简单)加密和解密的选项。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="86da" class="jo jp hi bd jq jr kz jt ju jv la jx jy jz lb kb kc kd lc kf kg kh ld kj kk kl bi translated"><strong class="ak">如何在Spring boot应用中使用Jasypt？</strong></h1><p id="e13d" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">如果您有<code class="du lz ma mb lq b">@SpringBootApplication</code>或<code class="du lz ma mb lq b">@EnableAutoConfiguration</code>自动配置注释，那么您可以简单地将下面的starter依赖项和插件添加到项目的pom.xml或build.gradle中，加密属性将在整个应用程序中启用:</p><blockquote class="le lf lg"><p id="2fd8" class="iq ir lh is b it iu iv iw ix iy iz ja li jc jd je lj jg jh ji lk jk jl jm jn hb bi translated"><em class="hi">美芬:</em></p></blockquote><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="faf7" class="lu jp hi lq b fi lv lw l lx ly">&lt;dependency&gt;<br/>        &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;<br/>        &lt;artifactId&gt;jasypt-spring-boot-starter&lt;/artifactId&gt;<br/>        &lt;version&gt;3.0.4&lt;/version&gt;<br/>&lt;/dependency&gt;</span><span id="7c17" class="lu jp hi lq b fi mc lw l lx ly">&lt;plugin&gt;<br/>   &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;<br/>   &lt;artifactId&gt;jasypt-maven-plugin&lt;/artifactId&gt;<br/>   &lt;version&gt;3.0.4&lt;/version&gt;<br/>&lt;/plugin&gt;</span></pre><blockquote class="le lf lg"><p id="18ed" class="iq ir lh is b it iu iv iw ix iy iz ja li jc jd je lj jg jh ji lk jk jl jm jn hb bi translated">格雷尔:</p></blockquote><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="6dde" class="lu jp hi lq b fi lv lw l lx ly">implementation group: ‘com.github.ulisesbocchio’, name: ‘jasypt-spring-boot-starter’, version: ‘3.0.4’</span><span id="4ac3" class="lu jp hi lq b fi mc lw l lx ly">implementation group: ‘com.github.ulisesbocchio’, name: ‘jasypt-maven-plugin’, version: ‘3.0.4’</span></pre></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="28e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您不使用<code class="du lz ma mb lq b"><a class="ae kr" href="https://javarevisited.blogspot.com/2018/05/the-springbootapplication-annotation-example-java-spring-boot.html#axzz6qnblZnVj" rel="noopener ugc nofollow" target="_blank">@SpringBootApplication</a></code>或<code class="du lz ma mb lq b"><a class="ae kr" href="https://www.java67.com/2018/05/difference-between-springbootapplication-vs-EnableAutoConfiguration-annotations-Spring-Boot.html" rel="noopener ugc nofollow" target="_blank">@EnableAutoConfiguration</a></code>自动配置注释，那么不添加上面的依赖项，而是将下面的依赖项添加到您的项目中:</p><blockquote class="le lf lg"><p id="035b" class="iq ir lh is b it iu iv iw ix iy iz ja li jc jd je lj jg jh ji lk jk jl jm jn hb bi translated"><a class="ae kr" rel="noopener" href="/javarevisited/6-best-maven-courses-for-beginners-in-2020-23ea3cba89"> <em class="hi">美芬</em> </a> <em class="hi"> : </em></p></blockquote><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="d15c" class="lu jp hi lq b fi lv lw l lx ly">&lt;dependency&gt;<br/>        &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;<br/>        &lt;artifactId&gt;jasypt-spring-boot&lt;/artifactId&gt;<br/>        &lt;version&gt;3.0.4&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><blockquote class="le lf lg"><p id="c699" class="iq ir lh is b it iu iv iw ix iy iz ja li jc jd je lj jg jh ji lk jk jl jm jn hb bi translated"><a class="ae kr" rel="noopener" href="/javarevisited/5-best-gradle-courses-and-books-to-learn-in-2021-93f49ce8ff8e"><em class="hi"/></a><em class="hi">:</em></p></blockquote><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="67b3" class="lu jp hi lq b fi lv lw l lx ly">implementation group: ‘com.github.ulisesbocchio’, name: ‘jasypt-spring-boot’, version: ‘3.0.4’</span></pre></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="2e02" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后将<code class="du lz ma mb lq b">@EnableEncryptableProperties</code>添加到您的配置类中:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="dea0" class="lu jp hi lq b fi lv lw l lx ly">@Configuration<br/>@EnableEncryptableProperties<br/>public class MyApplication {<br/>    ...<br/>}</span></pre><p id="b4fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，一旦您添加了这些依赖项，只需更新您的项目，这样这些依赖项就可以在您的<a class="ae kr" href="https://javarevisited.blogspot.com/2020/06/maven-vs-gradle-beginners-introduction.html#axzz6dHZ7oEpK" rel="noopener ugc nofollow" target="_blank"> maven/gradle </a>存储库中使用了。</p><p id="2051" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要用Jasypt加密凭证，只需转到application.yml并添加以下属性:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="d6b7" class="lu jp hi lq b fi lv lw l lx ly">jasypt:<br/>  encryptor:<br/>    algorithm: PBEWithMD5AndTripleDES<br/>    iv-generator-classname: org.jasypt.iv.NoIvGenerator</span></pre><p id="ad40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除此之外，您还需要编写类似于<strong class="is hj">DEC(<em class="lh">secret _ string</em>)</strong>的秘密字符串，以便Jasypt了解哪些字符串需要加密:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="fe09" class="lu jp hi lq b fi lv lw l lx ly">spring:<br/>  datasource:<br/>    url: jdbc:mysql://localhost:3306/cdr?useSSL=false<br/>    username: DEC(root)<br/>    password: DEC(root123)</span></pre><p id="8c27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后进入终端，在pom.xml所在的项目根文件夹中运行下面的命令:</p><p id="fad3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="lh">注意:</em> </strong>如果您有application.yml，那么您需要在命令中添加文件路径参数，如下所示，因为Jasypt默认在类路径中查找application.properties文件</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="b367" class="lu jp hi lq b fi lv lw l lx ly">mvn jasypt:encrypt -Djasypt.plugin.path=”file:src/main/resources/application.yml” -Djasypt.encryptor.password=”secretkey”</span></pre><p id="83c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您正在使用application.properties，则可以使用以下命令:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="a6a1" class="lu jp hi lq b fi lv lw l lx ly">mvn jasypt:encrypt -Djasypt.encryptor.password=”secretkey”</span></pre><p id="4295" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"/></p><p id="00f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你运行这个命令，进入你的application.properties或者application.yml文件，你会看到你的秘密已经被加密了… <em class="lh">瞧</em></p><p id="dc70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，你可以看到这些字符串变成了这样:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="f876" class="lu jp hi lq b fi lv lw l lx ly">spring:<br/>  datasource:<br/>    username: <strong class="lq hj">ENC(zI0hID6ReXaLOMNaOPMWQg==)</strong></span></pre><p id="48dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，如果您现在尝试运行这个应用程序，因为您的秘密已经被加密，您的应用程序将由于数据库连接错误而无法运行。</p><h2 id="f69d" class="lu jp hi bd jq md me mf ju mg mh mi jy jb mj mk kc jf ml mm kg jj mn mo kk mp bi translated"><strong class="ak">现在..想想我们如何告诉应用程序以解密的形式使用这些秘密？</strong></h2><p id="f655" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们想到的一个解决方案是将私钥(用于加密我们的秘密)存储在加密秘密的某个地方，但这也不是一个好方法。</p><p id="ab37" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为替代，我们可以将它存储在系统或环境变量中，或者我们需要以加密形式存储它。</p><p id="3694" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更好的方法是在系统/环境变量中的某个地方配置私钥，为此我们再次需要在application.yml中存储一个变量，我们将把它配置为我们的<a class="ae kr" href="https://javarevisited.blogspot.com/2012/08/how-to-get-environment-variables-in.html" rel="noopener ugc nofollow" target="_blank">环境变量</a>:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="ad55" class="lu jp hi lq b fi lv lw l lx ly">jasypt:<br/>  encryptor:<br/>    algorithm: PBEWithMD5AndTripleDES<br/>    iv-generator-classname: org.jasypt.iv.NoIvGenerator<br/>    password: ${JASYPT_ENCRYPTOR_PASSWORD}</span></pre><p id="9243" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要将这个JASYPT_ENCRYPTOR_PASSWORD存储为环境变量，请转到终端并运行命令</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="336c" class="lu jp hi lq b fi lv lw l lx ly">vi ~/.bash_profile</span></pre><p id="6e36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并在那里添加属性</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="a550" class="lu jp hi lq b fi lv lw l lx ly">export JASYPT_ENCRYPTOR_PASSWORD = secretkey</span></pre><p id="b2cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">保存文件并退出，然后使用</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="ab3d" class="lu jp hi lq b fi lv lw l lx ly">source ~/.bash_profile</span></pre><p id="6e9b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您使用的是IDE，您需要重新启动它以从环境/系统变量中获取更新的值。</p><p id="6170" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在你都准备好了。如果您要运行您的应用程序，它将开始没有任何错误。</p><p id="e928" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>这篇文章关注的是整个spring boot应用程序中的加密，但是如果你只需要为某些类定制它，你可以参考这里的<a class="ae kr" href="https://github.com/ulisesbocchio/jasypt-spring-boot" rel="noopener ugc nofollow" target="_blank">jaspyt Github库</a>。</p><p id="1155" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可能喜欢的其他Java和Spring Boot文章</p><div class="mq mr ez fb ms mt"><a rel="noopener follow" target="_blank" href="/javarevisited/top-10-courses-to-learn-spring-boot-in-2020-best-of-lot-6ffce88a1b6e"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">我最喜欢的2021年学习Spring Boot的课程——最好的</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">大家好，如果你有兴趣学习Spring Boot并寻找一些很棒的资源，如书籍，教程…</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">medium.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh io mt"/></div></div></a></div><div class="mq mr ez fb ms mt"><a rel="noopener follow" target="_blank" href="/javarevisited/10-best-online-courses-to-learn-spring-framework-in-2020-f7f73599c2fd"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">2021年学习Spring框架的10个最佳在线课程</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">学习Spring框架、Spring Boot、Spring安全和RESTful Web服务的最佳在线课程</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">medium.com</p></div></div><div class="nc l"><div class="ni l ne nf ng nc nh io mt"/></div></div></a></div><div class="mq mr ez fb ms mt"><a rel="noopener follow" target="_blank" href="/javarevisited/10-best-java-microservices-courses-with-spring-boot-and-spring-cloud-6d04556bdfed"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">2021年Spring Boot和Spring Cloud的10个最佳Java微服务课程</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">我最喜欢的2021年用Spring Boot和Spring Cloud为初学者学习Java微服务的在线课程来自…</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">medium.com</p></div></div><div class="nc l"><div class="nj l ne nf ng nc nh io mt"/></div></div></a></div></div></div>    
</body>
</html>