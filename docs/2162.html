<html>
<head>
<title>Feign Client: One of the Elegant Ways to Integrate Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">假装客户端:集成服务的一种优雅方式</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/feign-client-one-of-the-elegant-ways-to-integrate-services-64f5c6c03283?source=collection_archive---------1-----------------------#2022-06-04">https://medium.com/javarevisited/feign-client-one-of-the-elegant-ways-to-integrate-services-64f5c6c03283?source=collection_archive---------1-----------------------#2022-06-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="4cea" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">从最低限度到深度定制</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/43a202f899c321b28db0101c5482f545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*svj1aWE8HgId7hQp"/></div></div><p class="jj jk et er es jl jm bd b be z dx translated">约翰·汤纳在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h2 id="c50b" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">简介</strong></h2><p id="fbe3" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">在这个简洁的教程中，让我们了解使用Feign Client集成服务是多么简单。我们将从实现最常见的方法开始——不要太花哨，只要能让我们理解就行。</p><p id="a911" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">然后，一旦我们理解了基础知识，我们将直接进入定制，这在与其他<a class="ae jn" rel="noopener" href="/javarevisited/10-best-java-microservices-courses-with-spring-boot-and-spring-cloud-6d04556bdfed">微服务</a>集成时通常是必要的。特别是，需要为授权设置预定义的请求头就是一个很好的例子。</p><p id="58e1" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">在我们深入研究之前，让我们从最基本的开始。</p></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><h2 id="efc7" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">裸露最小值</strong></h2><p id="7cc8" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">为了建立一些上下文(让我们过度通信)，假设我们有<em class="lr">服务A </em>和<em class="lr">服务B — </em>独立运行。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/08/top-10-coursera-certifications-to-learn-cloud-computing-aws.html"><div class="er es ls"><img src="../Images/47ebf57560d7746d9cb19c7d9b40a748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MqbJWIefwRd6GQTV2rY7yw.png"/></div></a></figure><p id="eb22" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">现在，让我们假设<em class="lr">服务A </em>需要从<em class="lr">服务B </em>访问一些资源(这非常简单和常见)。鉴于这一要求，有很多方法可以做到这一点；但是让我们使用Feign Client——因为rest服务调用实现已经被抽象了。</p><p id="a900" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">首先，为了简单起见，让我们从服务B创建一个虚拟端点:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="dcb1" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">然后，在服务A上，让我们为它创建一个虚拟客户端:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="55fb" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">此外，不要忘记在您的配置类或主类中包含注释来启用Feign clients:<code class="du lv lw lx ly b">@EnableFeignClients</code>——这对于组件扫描<code class="du lv lw lx ly b">@FeignClient</code>注释是必要的。</p><p id="d46f" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">最后，让我们创建一个集成测试来验证我们的Feign客户端是否工作:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="109a" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">确保服务B 正在运行——瞧！我们现在成功地访问了<em class="lr">和</em>端点；然而，在现实中，有相当多的东西我们需要使之可配置。让我们来看看其中的一些(非详尽):</p><ul class=""><li id="0d7e" class="lz ma hi ko b kp lf ks lg jz mb kd mc kh md le me mf mg mh bi translated">URL —每个环境都有适当的值</li><li id="2b53" class="lz ma hi ko b kp mi ks mj jz mk kd ml kh mm le me mf mg mh bi translated">标题—在请求中包含与身份验证相关的详细信息</li><li id="d5fd" class="lz ma hi ko b kp mi ks mj jz mk kd ml kh mm le me mf mg mh bi translated">错误处理</li><li id="1ba4" class="lz ma hi ko b kp mi ks mj jz mk kd ml kh mm le me mf mg mh bi translated">等等</li></ul><p id="9d26" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">有了这些，事实上，很明显我们需要学习如何进行定制——让我们直接开始吧。</p></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><h2 id="5dec" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">定制</strong></h2><p id="7559" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">有几种方法可以进行定制，其中一些只需要对上面的代码做很小的改动；然而，在某些情况下，有必要手动创建虚拟客户端。</p><p id="2250" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">这样，使用FeignBuilder API——让我们来探索这种方法。</p><p id="edb4" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">为了演示，让我们创建一个新的接口，我们称之为<code class="du lv lw lx ly b">CustomFeignClient</code>:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="54db" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">接下来，让我们为它创建一个配置类:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="1b0f" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">请注意，使用这种配置，我们能够解决我们之前担心的问题:</p><ul class=""><li id="7a81" class="lz ma hi ko b kp lf ks lg jz mb kd mc kh md le me mf mg mh bi translated">URL —使用目标，我们可以通过任何方式自由配置它(例如，应用程序属性、集中式配置服务器等等)</li><li id="0ff0" class="lz ma hi ko b kp mi ks mj jz mk kd ml kh mm le me mf mg mh bi translated">头——使用请求拦截器，我们可以添加与auth相关的条目。(很明显，甚至可以创建一个单独的类并实现<code class="du lv lw lx ly b">RequestInterceptor</code>接口来实现一种更简洁的方法。)</li><li id="ad11" class="lz ma hi ko b kp mi ks mj jz mk kd ml kh mm le me mf mg mh bi translated">错误处理——同样，我们可以使用lambda或通过创建实现<code class="du lv lw lx ly b">ErrorEncoder</code>的具体类来处理异常，在这种情况下。</li></ul><p id="2aaf" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">现在，为了再次验证一切正常，让我们快速创建一个集成测试:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="011b" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">所以是的，就是这样！</p></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><h2 id="cb4d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h2><p id="504d" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">在这个简短的教程中，我们已经使用feign client初步实现了集成两个服务的最低要求，然后学习了如何完全定制它。</p><p id="31c6" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">此外，虽然我们只看了最重要的代码要点，并跳过了pom.xml的一些设置，以保持文章简洁明了——但是，如果我们需要参考它，完整的源代码总是可以在<a class="ae jn" href="https://github.com/emyasa/medium-articles/tree/master/spring-cloud-feign" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div></div>    
</body>
</html>