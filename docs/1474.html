<html>
<head>
<title>OAuth 2.0 basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OAuth 2.0基础</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/oauth-2-0-basics-b732e857cb25?source=collection_archive---------2-----------------------#2021-08-16">https://medium.com/javarevisited/oauth-2-0-basics-b732e857cb25?source=collection_archive---------2-----------------------#2021-08-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="37f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将借助问答技术来了解OAuth 2.0的基础知识。问答是我最喜欢的学习新概念的方式，因为它更具互动性，有助于记忆。所以让我们开始吧，我希望你也会觉得这很有帮助-</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h2 id="d3c8" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">什么是OAuth 2.0？</strong></h2><p id="4fb0" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">OAuth 2.0代表<strong class="ih hj">开放授权</strong>，是授权的行业标准。OAuth使客户端(第三方应用程序)能够代表资源所有者<strong class="ih hj">对<strong class="ih hj">受保护资源</strong>进行<strong class="ih hj">范围的访问</strong>，而无需知道或存储</strong>资源所有者(最终用户)的<strong class="ih hj">凭证</strong>。</p><p id="e7c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kk"> ( </em> </strong> <em class="kk">术语</em> <strong class="ih hj"> <em class="kk">【客户】</em> </strong> <em class="kk">和</em> <strong class="ih hj"> <em class="kk">第三方应用</em> </strong> <em class="kk">在本文中用作同义词)</em></p><h2 id="6be8" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">为什么我们不能使用传统的客户端服务器授权模式？</strong></h2><p id="8c13" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">在传统的客户端服务器授权模型中，为了访问受保护的资源，客户端需要知道/存储资源所有者的凭证，以便在服务器上成功地进行身份验证，并且对于该资源所有者，必须与客户端共享凭证。</p><figure class="km kn ko kp fd kq er es paragraph-image"><a href="https://javarevisited.blogspot.com/2021/02/spring-security-interview-questions-answers-java.html"><div class="er es kl"><img src="../Images/41f5c56bbdcb607ca0d1f9ef88b66603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lzoQ_2kLZ7-fsfmiE2uAbQ.png"/></div></a><p class="kt ku et er es kv kw bd b be z dx translated">传统的客户端服务器授权模型</p></figure><p id="ab71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这有许多限制，其中一些主要的限制是</p><ul class=""><li id="37c0" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">由于客户端存储资源所有者的凭据，客户端应用程序中的任何安全漏洞都会导致资源所有者的密码泄露。</li><li id="c65d" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">客户端应用程序获得超过所需的对资源所有者的受保护资源的访问，并且资源所有者没有任何能力来限制访问的<strong class="ih hj">范围</strong>和<strong class="ih hj">持续时间</strong>。</li></ul><h2 id="72fb" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">好吧，但是OAuth 2.0如何解决这些限制呢？</h2><p id="aa26" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">OAuth 2.0通过添加一个<strong class="ih hj">授权服务器来解决这些限制。</strong></p><p id="99bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae ll" rel="noopener" href="/javarevisited/top-10-courses-to-learn-spring-security-and-oauth2-with-spring-boot-for-java-developers-8f0222d6066d?source=---------5-----------------------"> OAuth 2.0，</a>访问受保护的资源，客户端在资源所有者的批准下从授权服务器获得一组不同的凭证(<strong class="ih hj">访问令牌</strong>)。</p><p id="8d82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">访问令牌代表资源所有者授予的访问的<strong class="ih hj">范围</strong>和<strong class="ih hj">持续时间</strong>。</p><h2 id="1f7d" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">你能更详细地解释OAuth 2.0流程吗？</h2><p id="85ea" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">当然，我们来看看<strong class="ih hj">授权码授予类型</strong>流程。</p><figure class="km kn ko kp fd kq er es paragraph-image"><a href="https://javarevisited.blogspot.com/2017/05/how-to-enable-spring-security-in-java-web-application.html"><div class="er es ca"><img src="../Images/3e62393fc0f273959ca8aef21b77c1c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*INCgBuxiO5w4pn0L17Ml1Q.png"/></div></a><p class="kt ku et er es kv kw bd b be z dx translated">授权码授权类型— OAuth 2.0流程</p></figure><ol class=""><li id="f576" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lm ld le lf bi translated">客户端向资源所有者请求<strong class="ih hj">授权</strong>。这个请求通常通过作为中介的授权服务器来完成。<em class="kk">(如客户端引导资源所有者到授权服务器的</em> <strong class="ih hj"> <em class="kk">授权端点</em> </strong> <em class="kk">进行认证并获得同意)。</em></li><li id="9f25" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lm ld le lf bi translated">客户收到<strong class="ih hj">授权许可。</strong>授权许可表示资源所有者访问受保护资源的授权。客户端使用它来获得<strong class="ih hj">访问令牌</strong> <strong class="ih hj">。</strong></li><li id="fb29" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lm ld le lf bi translated">客户端通过传递在上一步中收到的<strong class="ih hj">授权许可</strong>并通过<strong class="ih hj">向授权服务器认证</strong>自身来请求访问令牌。</li><li id="0b26" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lm ld le lf bi translated">授权服务器验证客户端凭证(例如，客户端id、客户端机密等)。)，授权许可并发布一个<strong class="ih hj">访问令牌</strong>(以及可选的<strong class="ih hj">刷新令牌</strong>)</li><li id="d15d" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lm ld le lf bi translated">客户端通过传递访问令牌向资源服务器请求受保护的源。</li><li id="760a" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lm ld le lf bi translated">资源服务器验证访问令牌并返回受保护的资源。</li></ol><h2 id="6e24" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">你能解释一下客户端认证和授权服务器部分吗？</strong></h2><p id="cf1f" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">作为OAuth 2.0的先决条件，客户机向授权服务器注册自己。有不同的客户注册方式，最常见的是使用基于网络的注册表格。注册是一种与授权服务器建立信任并获得客户端属性(客户端标识符、客户端秘密等)的手段。).通常在注册期间，客户提供-</p><ul class=""><li id="1f3c" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">客户类型</li><li id="ea5e" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">客户端重定向URI</li></ul><h2 id="7c03" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">客户类型</strong></h2><ul class=""><li id="6690" class="kx ky hi ih b ii kf im kg iq ln iu lo iy lp jc lc ld le lf bi translated"><strong class="ih hj">机密</strong> —能够安全地存储他们的凭证，例如托管在安全服务器上的web应用程序</li><li id="538b" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj">公共</strong> —不能安全地存储他们的凭证。例如基于本地设备/桌面的应用和基于用户代理的应用(其中代码在用户代理(例如浏览器)中执行)</li></ul><h2 id="29ac" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">什么是授权许可？</strong></h2><p id="0d4a" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">授权许可代表资源所有者访问受保护资源的授权，它被客户端用来获得<strong class="ih hj">访问令牌</strong></p><p id="6b7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在核心OAuth 2.0规范中，有4种授权类型</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lq"><img src="../Images/3c7807b888530f374be65644f99adedb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WO2vD26SRUQS_2Ro4V_C9w.png"/></div></div></figure><h2 id="765e" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">隐式授权流</h2><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lv"><img src="../Images/a64d37d8d3463f4165305ce56d23417a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G37859oP0duCIwJ1WJU55w.png"/></div></div><p class="kt ku et er es kv kw bd b be z dx translated">隐式授权流</p></figure><h2 id="6f14" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">资源所有者密码凭据</h2><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lw"><img src="../Images/6c4be4e854d998c55e2029f91c08bd96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ddxFr8E_jjG6gq822p5BOw.png"/></div></div><p class="kt ku et er es kv kw bd b be z dx translated">资源所有者口令身份证明授予类型流程</p></figure><h2 id="2d98" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">客户端凭据授予类型</h2><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lx"><img src="../Images/d626b19136764f03b3ac0d07cdc5d851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bf7coEoz27BbeEXUV_c0ZA.png"/></div></div><p class="kt ku et er es kv kw bd b be z dx translated">客户端凭据授予类型流程</p></figure><h2 id="18a5" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">什么是访问令牌？</h2><p id="d642" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">访问令牌是用于访问受保护资源的凭证。它们代表特定的访问范围和持续时间，由资源所有者授予，由资源服务器和授权服务器强制执行。</p><h2 id="74ef" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">什么是刷新令牌？</strong></h2><p id="9282" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">当<strong class="ih hj">访问令牌到期</strong>或<strong class="ih hj">失效</strong>时，客户端可以使用<strong class="ih hj">刷新令牌</strong>从授权服务器获得新的<strong class="ih hj">访问令牌</strong>。刷新令牌<strong class="ih hj">从不发送到资源服务器</strong>，并且仅用于授权服务器。</p><h2 id="028b" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">OAuth 2.0中涉及哪些不同的端点？</strong></h2><p id="809f" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">授权服务器公开2个端点-</p><ul class=""><li id="b06c" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated"><strong class="ih hj">授权</strong> —这个端点处理所有的用户交互，通常是通过浏览器。它用于在授权服务器上授权资源所有者。</li><li id="9177" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj">令牌</strong> —该端点用于获取访问令牌，仅适用于机器。它是通过远离浏览器的安全API调用来调用的。</li></ul><h2 id="3230" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">您能展示这些端点(授权和令牌)的示例请求和响应吗</h2><h2 id="d14f" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">授权请求</strong></h2><figure class="km kn ko kp fd kq er es paragraph-image"><div class="er es ly"><img src="../Images/77527fc4a46bda043a94ff3ead13e0b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*v68KB1veckpkxYDQ_xRMKQ.jpeg"/></div><p class="kt ku et er es kv kw bd b be z dx translated">授权请求</p></figure><ul class=""><li id="bfa9" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated"><strong class="ih hj"> response_type </strong> —该查询参数的值用于标识授权流将要使用的授权类型。<strong class="ih hj">【代码】</strong>用于授权代码授权类型流程。</li><li id="4db6" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj">客户端id </strong> —客户端应用程序的唯一标识符</li><li id="e641" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj"> redirect_uri </strong> —这是授权服务器将重定向资源所有者的端点(在资源所有者成功授权并同意之后)。该重定向URI必须已经向授权服务器注册。</li><li id="f71d" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj">范围</strong> —用于定义访问范围。它可以有空格分隔的值。这些值由授权服务器定义。如果在url中不存在，则授权服务器可以使用默认范围处理请求，或者使请求失败。</li><li id="b5cb" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj">状态</strong> —建议使用该查询参数，以防止跨站请求伪造。这是一个可选参数，但是如果在请求中出现，授权响应也应该使用完全相同的值。</li></ul><h2 id="9716" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">授权响应</strong></h2><p id="c15a" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">在资源所有者验证并同意客户端请求的内容(范围)后，授权服务器会将资源所有者重定向到<strong class="ih hj"> redirect_uri </strong>(这是授权请求的一部分)，并且redirect_uri会在查询参数(<strong class="ih hj">代码</strong>)中具有<strong class="ih hj">授权代码值</strong></p><figure class="km kn ko kp fd kq er es paragraph-image"><div class="er es lz"><img src="../Images/6b871b2e4e07eadc71626eb2f12267f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*5RGTqzEG-PQdNm_WtjuNmw.jpeg"/></div><p class="kt ku et er es kv kw bd b be z dx translated">授权响应</p></figure><h2 id="b354" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">令牌请求</h2><p id="8045" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">在令牌POST请求中，我们传递<strong class="ih hj">授权类型</strong>(本例中为<strong class="ih hj">授权_代码</strong>)、实际<strong class="ih hj">授权代码值</strong>(在授权响应中接收)、<strong class="ih hj">重定向_uri、</strong> <strong class="ih hj">客户端_id </strong>和<strong class="ih hj">客户端_秘密</strong>。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div class="er es ma"><img src="../Images/b62cccb2155dc90a6e3ef067867dea2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*ZbkS7X1QLVnDHl8pAD0xtg.jpeg"/></div><p class="kt ku et er es kv kw bd b be z dx translated">令牌请求示例</p></figure><h2 id="31a4" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">令牌响应</h2><p id="6ee2" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">访问令牌和令牌类型在令牌响应中返回，然后在授权头中使用，以访问受保护的资源。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div class="er es lz"><img src="../Images/04eadc3ec01d676694a516eab21d4dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*zqK64icIT28GDMTyT4dP5w.jpeg"/></div><p class="kt ku et er es kv kw bd b be z dx translated">令牌响应</p></figure><h2 id="bc81" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">不同授权许可类型的授权和令牌请求的response_type和grant_type值。</h2><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es mb"><img src="../Images/9ae74ff7f0c1aeaa975d1314254d126d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oQjP_J8h5Ai8f-j8BpbCAg.png"/></div></div><p class="kt ku et er es kv kw bd b be z dx translated">不同授权类型的response_type和grant_type参数值</p></figure><h2 id="8d63" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">摘要</h2><p id="4fc9" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">在本文中，我们讨论了什么是OAuth 2.0，以及它如何解决传统授权模型的局限性。然后，我们研究了各种授权类型、何时使用每种类型及其高级流程。我们还讨论了不同的客户端类型。在文章的最后，我们看了示例授权和令牌请求/响应。</p><h2 id="1650" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">结论</h2><p id="d557" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">我们已经介绍了OAuth 2.0规范的基础知识，如果您有兴趣深入研究我们在本文中讨论的一些概念，我强烈建议您阅读OAuth 2.0规范的原始版本<strong class="ih hj"> RFC 6749。</strong></p></div></div>    
</body>
</html>