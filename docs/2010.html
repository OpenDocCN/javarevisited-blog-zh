<html>
<head>
<title>Blink a LED on a Raspberry Pi With Vaadin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">闪烁的LED上的树莓皮与瓦丁</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/blink-a-led-on-a-raspberry-pi-with-vaadin-983ef490bc5e?source=collection_archive---------1-----------------------#2022-03-18">https://medium.com/javarevisited/blink-a-led-on-a-raspberry-pi-with-vaadin-983ef490bc5e?source=collection_archive---------1-----------------------#2022-03-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/1c0e801dc125fd1b93a74e2078eeb4f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*ggv1U8fWfxkTESFX.jpg"/></div></figure><p id="7e85" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就年龄而言，随着我成为一名高级开发人员，我已经从一种语言过渡到另一种语言。我的主要兴趣之一一直是干净、易于理解的ui(用户界面)。我的旅程始于<strong class="io hj">导演</strong>(创作多媒体光盘)<strong class="io hj"> Flash </strong>网站动画和<strong class="io hj"> Flex </strong>富互联网应用程序。</p><p id="a687" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当我在10年前开始使用<a class="ae jk" rel="noopener" href="/javarevisited/10-best-places-to-learn-java-online-for-free-ce5e713ab5b2"> <strong class="io hj"> Java </strong> </a>开发时，我们有一些项目使用了早期版本的<a class="ae jk" href="https://javarevisited.blogspot.com/2019/01/10-web-development-frameworks-fullstack-developer-should-learn.html" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj"> Vaadin </strong> </a>和<a class="ae jk" rel="noopener" href="/javarevisited/7-best-java-fx-online-courses-for-beginners-9e774ba6f996"> <strong class="io hj"> JavaFX </strong> </a>。当我继续开发服务器端应用程序时，我只继续使用JavaFX进行一些个人和业余项目，我喜欢用XML(实际上是FXML)和代码创建UI的方式，这与我喜欢使用Flex的方式完全相同。从那以后，我对Java和JavaFX的热爱与日俱增，它仍然是我的主要编程环境。</p><p id="bf46" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是<a class="ae jk" rel="noopener" href="/javarevisited/6-free-courses-to-learn-servlet-jsp-and-java-fx-in-2020-best-of-lot-720201c84f63"> JavaFX </a>有一个缺失的部分:在浏览器中运行它……是的，<a class="ae jk" href="https://www.jpro.one/" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj"> JPRO </strong> </a>可以做到这一点，但是它需要一个许可证和一个专用的服务器。是的，有一些项目正在将JavaFX完全引入浏览器，但它们正在进行中，尚未成熟…让我们看看另一种方法:Vaadin流，并在Raspberry Pi上运行它来控制LED并显示按钮的状态。</p><figure class="jm jn jo jp fd ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/06/top-5-courses-to-learn-java-fx-in-2020.html"><div class="er es jl"><img src="../Images/c1d37417876c0a0d12a88948d2968030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5YQubsaUJpEFJNtVW_gIeA.jpeg"/></div></a><p class="jq jr et er es js jt bd b be z dx translated">本文演示应用程序的最终结果</p></figure><h1 id="c65d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">关于瓦丁</h1><p id="e0fc" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">只是最近我重新发现了<a class="ae jk" href="https://vaadin.com/" rel="noopener ugc nofollow" target="_blank"> Vaadin来构建Web用户界面</a>，这真的感觉像是浏览器中的JavaFX。完整的Java代码来创建您的视图并在浏览器中运行它，而无需编写一个单独的<a class="ae jk" rel="noopener" href="/javarevisited/10-best-html-and-css-courses-for-beginners-in-2021-6757eec00032"> HTML </a>、<a class="ae jk" rel="noopener" href="/javarevisited/10-best-css-online-courses-for-beginners-and-experienced-developers-54aa2e8c0253"> CSS </a>、<a class="ae jk" rel="noopener" href="/javarevisited/10-best-online-courses-to-learn-javascript-in-2020-af5ed0801645"> JavaScript </a>或<a class="ae jk" rel="noopener" href="/@javinpaul/7-best-courses-to-learn-typescript-in-depth-58439e1ce729"> TypeScript </a>文件！<strong class="io hj"> Vaadin Flow </strong>是一个独特的框架，让您构建现代(响应迅速！)web应用100%用Java编写，不用写HTML或者JavaScript。</p><p id="d20f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本教程中，我将使用这个Vaadin流结合<strong class="io hj"> Pi4J </strong>来创建一个web界面，以便与连接到Raspberry Pi的GPIO(通用输入/输出)引脚的LED和按钮进行交互。<a class="ae jk" href="https://github.com/FDelporte/Vaadin-examples" rel="noopener ugc nofollow" target="_blank">GitHub上有完成的项目</a>。</p><h1 id="6641" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">关于Pi4J</h1><p id="58ec" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated"><a class="ae jk" href="https://pi4j.com/" rel="noopener ugc nofollow" target="_blank"> Pi4J，Raspberry Pi </a>的Java I/O库，旨在将Java编程与电子学结合起来。该项目始于2012年。版本1.3于2021年2月发布，支持最新的Raspberry Pi板(4400和Compute 4)，是基于Java 8的最后一个版本。2021年夏天，基于Java 11、PiGpio、Java modules等，推出了完全重构的V2。</p><p id="a072" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过在项目中使用Pi4J-dependency，连接到Raspberry Pi 的<strong class="io hj"> GPIO(通用输入/输出)引脚的控制电子元件可以作为<a class="ae jk" href="https://javarevisited.blogspot.com/2016/05/command-design-pattern-in-java-example-code.html" rel="noopener ugc nofollow" target="_blank"> Java代码</a>中的对象进行控制。Pi4J使用本地库来控制GPIOs，因此作为程序员，您不需要完全了解与硬件通信相关的所有“魔法”。</strong></p><h1 id="bc80" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">为什么要在树莓派上运行Java？！</h1><p id="7c4b" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">Raspberry Pi项目的目标是构建一台所有人都能负担得起的廉价PC(起价15美元)。如果你没有电脑屏幕，可以将它连接到电视上，根据你的预算，有不同的版本可供选择。Raspberry Pi是一款“完整的”Linux PC，提供不同版本的Raspberry Pi操作系统，让你可以轻松开始使用所有编程语言，当然也包括Java。</p><p id="cbfe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但我爱上树莓派的主要原因是GPIOs。当您查看Raspberry Pi板时，您会发现有40个引脚(2排，每排20个)。那些是GPIO(通用输入/输出)引脚。其中一些可以用作数字输入或输出引脚，这意味着0伏为关，3.3伏为开。你能用它做的事情多得惊人！这些GPIOs引脚是树莓Pi如此成功的主要因素！你确实可以找到一台便宜的二手笔记本电脑，包括电池、屏幕等。但是你永远也不能像用树莓派那样简单地构建软硬件结合的实验。</p><p id="d69f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">树莓派的最后一个优点:它的力量！4版本速度快，内存大。我写了一本关于它的书，并用它创建了许多不同的Java应用程序。您可以连接多达两个4K显示器，这意味着大量的空间来拥有不同的应用程序，终端，文件浏览器等。立刻打开。</p><h1 id="7458" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Spring + Vaadin + Pi4J应用示例</h1><p id="7a63" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">让我们创建一个基于Spring的演示项目来说明Vaadin用户界面(网站)如何通过使用<a class="ae jk" href="https://www.pi4j.com" rel="noopener ugc nofollow" target="_blank"> Pi4J库</a>与Raspberry Pi的GPIOs进行交互。GPIO交互基于<a class="ae jk" href="https://pi4j.com/getting-started/minimal-example-application/" rel="noopener ugc nofollow" target="_blank"> Pi4J最小示例应用</a>，使用一个按钮和一个LED来演示数字输入和输出交互。布线非常简单，只需要几个元件。</p><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kx"><img src="../Images/dfa9f6e80f5074197223f98b0e40e563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBkn3rdIegswK-aIff0qQg.png"/></div></div><p class="jq jr et er es js jt bd b be z dx translated">试验板布线</p></figure><p id="7b1a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">基本代码在<a class="ae jk" href="https://start.vaadin.com/app" rel="noopener ugc nofollow" target="_blank">start.vaadin.com/app</a>上生成，选择如下:</p><ul class=""><li id="58da" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">瓦丁23</li><li id="8e9c" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">Java 17</li><li id="deda" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">流程(仅限Java)</li><li id="c3f4" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">额外页面和自定义图标</li></ul><figure class="jm jn jo jp fd ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/09/top-5-courses-to-learn-intellij-idea-java-and-android-development.html"><div class="er es lq"><img src="../Images/55f92c08a5a0b20053fe03b0c75c4e34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BVpnndTAZHpAzrpZ4DSM8w.png"/></div></a><p class="jq jr et er es js jt bd b be z dx translated">启动Vaadin网站</p></figure><p id="6b5e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下载源代码，解压缩并在您喜欢的IDE中打开。这是一个<a class="ae jk" rel="noopener" href="/javarevisited/6-best-maven-courses-for-beginners-in-2020-23ea3cba89"> Maven </a>项目，因此您可以立即运行它并检查自动生成的代码。当您启动它时，该应用程序将在设备本身的<a class="ae jk" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>上可用。</p><h1 id="9579" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">额外的依赖性</h1><p id="de7c" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">因为我们想通过Pi4J与GPIOs交互，所以我们需要向pom.xml添加一些额外的依赖项:</p><ul class=""><li id="691e" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">pi4j-核心</li><li id="8afe" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">pi4j-插件-raspberrypi</li><li id="1bec" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">pi4j-插件-pigpio</li></ul><h1 id="4c66" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Pi4J服务</h1><p id="fd54" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">因为我们已经预先生成了一个<a class="ae jk" href="https://javarevisited.blogspot.com/2022/01/spring-boot-reactjs-example-for-java.html" rel="noopener ugc nofollow" target="_blank"> Spring应用程序</a>，所以我们可以很容易地用一个服务来扩展它，以管理所有与Pi4J相关的方法。让我们从负责所有GPIO交互的Pi4J上下文的初始化开始。</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="7756" class="lw jv hi ls b fi lx ly l lz ma">private final Context pi4j;</span><span id="563c" class="lw jv hi ls b fi mb ly l lz ma">private static final int PIN_BUTTON = 24; // PIN 18 = BCM 24<br/>private static final int PIN_LED = 22; // PIN 15 = BCM 22</span><span id="4a9c" class="lw jv hi ls b fi mb ly l lz ma">private final Queue&lt;ButtonListener&gt; buttonListeners;<br/>private DigitalOutput led;</span><span id="03d1" class="lw jv hi ls b fi mb ly l lz ma">public Pi4JService() {<br/>    pi4j = Pi4J.newAutoContext();<br/>    buttonListeners = new ConcurrentLinkedQueue&lt;&gt;();<br/>    initLed();<br/>    initButton();<br/>}</span></pre><p id="283a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一旦我们有了上下文，我们就可以用它来配置和初始化LED的数字输出和按钮的数字输入。在我们的示例应用程序中，我们只有一个根据按钮状态而变化的组件，但是通过使用ButtonListener接口和一系列实现，我们可以将无限数量的组件与按钮状态链接起来。</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="6637" class="lw jv hi ls b fi lx ly l lz ma">private void initLed() {<br/>    try {<br/>        var ledConfig = DigitalOutput.newConfigBuilder(pi4j)<br/>                .id("led")<br/>                .name("LED")<br/>                .address(PIN_LED)<br/>                .shutdown(DigitalState.LOW)<br/>                .initial(DigitalState.LOW)<br/>                .provider("pigpio-digital-output");<br/>        led = pi4j.create(ledConfig);<br/>        logger.info("The LED has been initialized on pin {}", PIN_LED);<br/>    } catch (Exception ex) {<br/>        logger.error("Error while initializing the LED: {}", ex.getMessage());<br/>    }<br/>}</span><span id="8b10" class="lw jv hi ls b fi mb ly l lz ma">/**<br/>* Toggle the LED on or off.<br/>*<br/>* <a class="ae jk" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> on<br/>*/<br/>public void setLedState(boolean on) {<br/>    led.setState(on);<br/>}</span><span id="192a" class="lw jv hi ls b fi mb ly l lz ma">private void initButton() {<br/>    try {<br/>        var buttonConfig = DigitalInput.newConfigBuilder(pi4j)<br/>                .id("button")<br/>                .name("Button")<br/>                .address(PIN_BUTTON)<br/>                .pull(PullResistance.PULL_DOWN)<br/>                .debounce(3000L)<br/>                .provider("pigpio-digital-input");<br/>        var button = pi4j.create(buttonConfig);<br/>        button.addListener(e -&gt; {<br/>            logger.info("Button state changed to {}", e.state());<br/>            buttonListeners.forEach(bl -&gt; bl.onButtonEvent(e.state()));<br/>        });<br/>        logger.info("The button has been initialized on pin {}", PIN_BUTTON);<br/>    } catch (Exception ex) {<br/>        logger.error("Error while initializing the button: {}", ex.getMessage());<br/>    }<br/>}</span><span id="b89d" class="lw jv hi ls b fi mb ly l lz ma">/**<br/>* Add a button listener which will get all state changes of the button DigitalInput<br/>*<br/>* <a class="ae jk" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> buttonListener<br/>*/<br/>public void addButtonListener(ButtonListener buttonListener) {<br/>    buttonListeners.add(buttonListener);<br/>}</span></pre><p id="3b9d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，还有一些助手方法来显示Pi4J库的状态。这只是其中之一，请查看完整实现的源代码:</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="3bf1" class="lw jv hi ls b fi lx ly l lz ma">/**<br/>* Providers are intended to represent I/O implementations and provide access to the I/O interfaces available on<br/>* the system. Providers 'provide' concrete runtime implementations of I/O interfaces.<br/>*/<br/>public String getProviders() {<br/>    if (pi4j == null || pi4j.providers() == null) {<br/>        return "None";<br/>    }<br/>    return pi4j.providers().all().entrySet().stream()<br/>            .map(e -&gt; e.getKey() + ": " + e.getValue())<br/>            .collect(Collectors.joining(","));<br/>}</span></pre><h1 id="7d2b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">切换LED的用户界面</h1><p id="db24" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">现在让我们更改第一页来控制LED。代码实际上非常有限，因为我们使用了一个<code class="du mc md me ls b">Checkbox</code>并添加了一个值监听器来告诉我们的Pi4JService改变LED的状态。</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="021c" class="lw jv hi ls b fi lx ly l lz ma">public class ButtonView extends HorizontalLayout implements ButtonListener {</span><span id="280d" class="lw jv hi ls b fi mb ly l lz ma">Logger logger = LoggerFactory.getLogger(ButtonView.class);</span><span id="c2bb" class="lw jv hi ls b fi mb ly l lz ma">private final UI ui;<br/>    private final Label lbl;</span><span id="d44e" class="lw jv hi ls b fi mb ly l lz ma">public ButtonView(<a class="ae jk" href="http://twitter.com/Autowired" rel="noopener ugc nofollow" target="_blank">@Autowired</a> Pi4JService pi4JService) {<br/>        ui = UI.getCurrent();<br/>        lbl = new Label("Waiting for button change...");<br/>        add(lbl);</span><span id="1dc3" class="lw jv hi ls b fi mb ly l lz ma">setMargin(true);<br/>        setVerticalComponentAlignment(Alignment.END, lbl);</span><span id="7ffd" class="lw jv hi ls b fi mb ly l lz ma">pi4JService.addButtonListener(this);<br/>    }</span><span id="a608" class="lw jv hi ls b fi mb ly l lz ma"><a class="ae jk" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>    public void onButtonEvent(DigitalState state) {<br/>        var isPressed = state.equals(DigitalState.HIGH);<br/>        logger.info("Button event in listener: {} - Is on: {}", state, isPressed);<br/>        ui.accessSynchronously(() -&gt; lbl.setText(isPressed ? "Button is pressed" : "Button is released"));<br/>    }<br/>}</span></pre><figure class="jm jn jo jp fd ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/07/top-5-websites-to-learn-coding-in-java.html"><div class="er es mf"><img src="../Images/2dad88d21a2f8c7347052fc8ce20eb4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*-9vIIZUQmjxqHn3EFEIfMQ.png"/></div></a><p class="jq jr et er es js jt bd b be z dx translated">LED用户界面</p></figure><h1 id="a84b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">用户界面来查看按钮的状态</h1><p id="bb9c" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">这个用户界面有更多的代码。它扩展了<code class="du mc md me ls b">ButtonListener</code>,所以需要覆盖<code class="du mc md me ls b">onButtonEvent</code>,但是代码的其他部分非常容易理解。这里需要额外注意的一点是:我们需要使用<code class="du mc md me ls b">ui.accessSynchronously</code>来改变作为视图一部分的组件，因为Pi4JService和用户界面运行在不同的线程中。</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="63ee" class="lw jv hi ls b fi lx ly l lz ma">public class ButtonView extends HorizontalLayout implements ButtonListener {</span><span id="5424" class="lw jv hi ls b fi mb ly l lz ma">Logger logger = LoggerFactory.getLogger(ButtonView.class);</span><span id="409e" class="lw jv hi ls b fi mb ly l lz ma">private final UI ui;<br/>    private final Label lbl;</span><span id="52c2" class="lw jv hi ls b fi mb ly l lz ma">public ButtonView(<a class="ae jk" href="http://twitter.com/Autowired" rel="noopener ugc nofollow" target="_blank">@Autowired</a> Pi4JService pi4JService) {<br/>        ui = UI.getCurrent();<br/>        lbl = new Label("Waiting for button change...");<br/>        add(lbl);</span><span id="4139" class="lw jv hi ls b fi mb ly l lz ma">setMargin(true);<br/>        setVerticalComponentAlignment(Alignment.END, lbl);</span><span id="78a3" class="lw jv hi ls b fi mb ly l lz ma">pi4JService.addButtonListener(this);<br/>    }</span><span id="464e" class="lw jv hi ls b fi mb ly l lz ma"><a class="ae jk" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>    public void onButtonEvent(DigitalState state) {<br/>        var isPressed = state.equals(DigitalState.HIGH);<br/>        logger.info("Button event in listener: {} - Is on: {}", state, isPressed);<br/>        ui.accessSynchronously(() -&gt; lbl.setText(isPressed ? "Button is pressed" : "Button is released"));<br/>    }<br/>}</span></pre><figure class="jm jn jo jp fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/362a04392f7e603fdb70bba6a5c3d62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*KhCydykzUDhJ-NNSTXVWbQ.png"/></div><p class="jq jr et er es js jt bd b be z dx translated">按钮用户界面</p></figure><p id="708d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">主类中还需要一个额外的改变。因为我们想将来自<code class="du mc md me ls b">backend</code>的更改发送到<code class="du mc md me ls b">user interface</code>，所以我们需要添加<a class="ae jk" href="https://vaadin.com/docs/latest/flow/advanced/server-push" rel="noopener ugc nofollow" target="_blank"> @Push属性</a>。这个微小的变化允许您从服务器更新UI，而无需用户明确请求更新。这是基于客户端与服务器的连接(如果支持WebSocket，或者其他连接),客户端建立该连接，然后服务器可以使用该连接向客户端发送更新。</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="7a53" class="lw jv hi ls b fi lx ly l lz ma"><a class="ae jk" href="http://twitter.com/SpringBootApplicatio" rel="noopener ugc nofollow" target="_blank">@SpringBootApplicatio</a>n<br/><a class="ae jk" href="http://twitter.com/Theme" rel="noopener ugc nofollow" target="_blank">@Theme</a>(value = "pi4jdemo")<br/><a class="ae jk" href="http://twitter.com/NpmPackage" rel="noopener ugc nofollow" target="_blank">@NpmPackage</a>(value = "line-awesome", version = "1.3.0")<br/><a class="ae jk" href="http://twitter.com/Push" rel="noopener ugc nofollow" target="_blank">@Push</a><br/>public class Application extends SpringBootServletInitializer implements AppShellConfigurator {</span></pre><h1 id="fefd" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">带有Pi4J信息的用户界面</h1><p id="de0e" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">为了能够调试Pi4J如何与GPIOs交互，一些附加信息被添加到“About”屏幕以显示加载的平台和提供者。注册表包含所有初始化的输入和输出的列表，所以我们期望在这里看到LED和按钮。</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="88cd" class="lw jv hi ls b fi lx ly l lz ma">public class AboutView extends VerticalLayout {<br/>    public AboutView(<a class="ae jk" href="http://twitter.com/Autowired" rel="noopener ugc nofollow" target="_blank">@Autowired</a> Pi4JService pi4JService) {<br/>        setSpacing(false);<br/>        add(<br/>            new H2("Java"),<br/>            new Paragraph("Version: " + System.getProperty("java.version")),<br/>            new H2("Pi4J"),<br/>            new Paragraph("Default platform: " + pi4JService.getDefaultPlatform()),<br/>            new Paragraph("Loaded platforms: " + pi4JService.getLoadedPlatforms()),<br/>            new Paragraph("Providers: " + pi4JService.getProviders()),<br/>            new Paragraph("Registry: " + pi4JService.getRegistry())<br/>        );<br/>        setSizeFull();<br/>        getStyle().set("text-align", "left");<br/>    }<br/>}</span></pre><figure class="jm jn jo jp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mh"><img src="../Images/2abbcb08cff2cd6b7bcd329aa7cc1383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*An6ysslzocrJNqkInR9leg.png"/></div></div><p class="jq jr et er es js jt bd b be z dx translated">关于UI</p></figure><h1 id="eb8c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">构建并上传到Raspberry Pi</h1><p id="88e8" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">如果您在PC上开发，您可以使用以下命令构建应用程序</p><ul class=""><li id="c74b" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">视窗:<code class="du mc md me ls b">mvnw clean package -Pproduction</code></li><li id="9478" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">Mac &amp; <a class="ae jk" rel="noopener" href="/javarevisited/6-best-websites-to-learn-linux-4861ac21bfdf"> Linux </a> : <code class="du mc md me ls b">./mvnw clean package -Pproduction</code></li></ul><p id="c0cf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并使用以下命令上传到您的Raspberry Pi(用您的板替换登录名<code class="du mc md me ls b">pi</code>和IP地址):</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="ff61" class="lw jv hi ls b fi lx ly l lz ma">$ scp target/pi4jdemo-1.0-SNAPSHOT.jar pi@192.168.0.222://home/pi/</span></pre><h1 id="bb20" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">在树莓派上运行</h1><p id="9786" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">我们现在可以在我们的Raspberry Pi上启动应用程序，但是需要运行<code class="du mc md me ls b">sudo</code>,因为Pi4J(仍然)需要它来使用PiGpio作为本地库与Gpio交互。</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="0268" class="lw jv hi ls b fi lx ly l lz ma">$ sudo java -jar /home/pi/pi4jdemo-1.0-SNAPSHOT.jar</span></pre><p id="ce4d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您以普通用户的身份用SDKMAN安装Java，您可能会得到以下错误:</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="f7f6" class="lw jv hi ls b fi lx ly l lz ma">sudo: java: command not found</span></pre><p id="77d2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">解决这个问题的一种方法是让命令本身通过使用<code class="du mc md me ls b">`which java`</code>来查找Java的安装位置:</p><pre class="jm jn jo jp fd lr ls lt lu aw lv bi"><span id="9077" class="lw jv hi ls b fi lx ly l lz ma">$ sudo `which java` -jar /home/pi/pi4jdemo-1.0-SNAPSHOT.jar</span><span id="eefd" class="lw jv hi ls b fi mb ly l lz ma">____   _  _  _        _   ____                          <br/>|  _ \ (_)| || |      | | |  _ \   ___  _ __ ___    ___  <br/>| |_) || || || |_  _  | | | | | | / _ \| '_ ` _ \  / _ \ <br/>|  __/ | ||__   _|| |_| | | |_| ||  __/| | | | | || (_) |<br/>|_|    |_|   |_|   \___/  |____/  \___||_| |_| |_| \___/</span><span id="5044" class="lw jv hi ls b fi mb ly l lz ma">INFO 1807 --- [           main] be.webtechie.vaadin.pi4j.Application     : Starting Application v1.0-SNAPSHOT using Java 17.0.2 on 64bit with PID 1807 (/home/pi/pi4jdemo-1.0-SNAPSHOT.jar started by root in /home/pi)<br/>INFO 1807 --- [           main] be.webtechie.vaadin.pi4j.Application     : No active profile set, falling back to 1 default profile: "default"<br/>INFO 1807 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)<br/>INFO 1807 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]<br/>INFO 1807 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.58]<br/>INFO 1807 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext<br/>INFO 1807 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 6486 ms<br/>INFO 1807 --- [           main] c.v.f.s.VaadinServletContextInitializer  : Search for VaadinAppShell took 125 ms<br/>INFO 1807 --- [           main] com.pi4j.Pi4J                            : New auto context<br/>INFO 1807 --- [           main] com.pi4j.Pi4J                            : New context builder<br/>INFO 1807 --- [           main] c.p.p.impl.DefaultRuntimePlatforms       : adding platform to managed platform map [id=raspberrypi; name=RaspberryPi Platform; priority=5; class=com.pi4j.plugin.raspberrypi.platform.RaspberryPiPlatform]<br/>INFO 1807 --- [           main] b.w.vaadin.pi4j.service.Pi4JService      : The LED has been initialized on pin 22<br/>INFO 1807 --- [           main] b.w.vaadin.pi4j.service.Pi4JService      : The button has been initialized on pin 24<br/>INFO 1807 --- [           main] c.v.f.s.DefaultDeploymentConfiguration   : Vaadin is running in production mode.<br/>INFO 1807 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''<br/>INFO 1807 --- [           main] be.webtechie.vaadin.pi4j.Application     : Started Application in 14.089 seconds (JVM running for 17.643)<br/>INFO 1807 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'<br/>INFO 1807 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'<br/>INFO 1807 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 3 ms<br/>INFO 1807 --- [nio-8080-exec-1] c.vaadin.flow.spring.SpringInstantiator  : The number of beans implementing 'I18NProvider' is 0. Cannot use Spring beans for I18N, falling back to the default behavior<br/>INFO 1807 --- [       Thread-7] b.w.vaadin.pi4j.service.Pi4JService      : Button state changed to LOW<br/>INFO 1807 --- [       Thread-7] b.w.vaadin.pi4j.views.button.ButtonView  : Button event in listener: LOW - Is on: false<br/>INFO 1807 --- [       Thread-8] b.w.vaadin.pi4j.service.Pi4JService      : Button state changed to HIGH<br/>INFO 1807 --- [       Thread-8] b.w.vaadin.pi4j.views.button.ButtonView  : Button event in listener: HIGH - Is on: true</span></pre><p id="6216" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在此视频中，您可以看到Raspberry Pi上正在运行的应用程序的日志，同一网络中PC上的一个浏览器来展示响应的web界面，以及带有LED和按钮的试验板和Raspberry Pi的摄像头视图:</p><figure class="jm jn jo jp fd ij"><div class="bz dy l di"><div class="mi mj l"/></div></figure><h1 id="2f15" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="2301" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">多亏了Vaadin提供的启动站点，您只需点击几下鼠标就可以获得一个完全运行的应用程序。使用Pi4J库很容易添加GPIO交互，并允许您与连接到Raspberry Pi的GPIO引脚的电子组件完全交互。有了本文的源代码，您可以很容易地开始使用其他类型的组件并进一步扩展。</p></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><p id="8a49" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="mr">原载于</em><a class="ae jk" href="https://dzone.com/articles/blink-a-led-on-a-raspberry-pi-with-vaadin" rel="noopener ugc nofollow" target="_blank"><em class="mr">https://dzone.com</em></a><em class="mr">。</em></p></div></div>    
</body>
</html>