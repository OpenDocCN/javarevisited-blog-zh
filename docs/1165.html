<html>
<head>
<title>Tracing a Java Application with Elastic APM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用弹性APM跟踪Java应用程序</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/tracing-a-java-application-with-elastic-apm-62d4b90f031e?source=collection_archive---------0-----------------------#2021-04-20">https://medium.com/javarevisited/tracing-a-java-application-with-elastic-apm-62d4b90f031e?source=collection_archive---------0-----------------------#2021-04-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/99c7f5632455ba591d3e316021bae57f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzLyeuowShfQtSmd3-jvvw.jpeg"/></div></div><p class="iq ir et er es is it bd b be z dx translated">图片来源:<a class="ae iu" href="https://unsplash.com/@neonbrand" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>来自<a class="ae iu" href="http://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="da78" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">TL；DR:在这篇博客中，我们将看到如何使用一个简单的Java CRUD应用程序开始使用弹性Java APM。</p><p id="e50b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Elasticsearch是一个基于java的分布式搜索引擎，用于构建搜索引擎、分析日志、存储指标、安全事件，甚至是应用程序跟踪，支持微服务环境的分布式跟踪。</p><p id="93d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Elastic在2018年通过Elasticsearch 6.2推出了开源应用性能监控(APM)，使应用能够发布它们的踪迹。今天的APM有更多的特性，比如相关性。</p><p id="a0eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，我们将了解如何使用Java代理为Java应用程序配置跟踪，以及spin在云上部署APM所需的基础设施。弹性APM还支持<a class="ae iu" href="https://opentelemetry.io" rel="noopener ugc nofollow" target="_blank">开放式遥测</a>，还有一个<a class="ae iu" href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/elasticexporter" rel="noopener ugc nofollow" target="_blank">弹性导出器</a>。但是，我们关注的是本地弹性APM Java语言代理。</p><h1 id="9425" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">分布式跟踪</h1><p id="40a3" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">分布式跟踪有助于您了解基于分布式微服务的应用程序中发生的请求流。我们可以进行性能分析、根本原因分析、查找故障、错误和异常！</p><p id="0da8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">开发人员对微服务架构和其他生态系统工具感兴趣，如Docker、Kubernetes、Java框架，如<a class="ae iu" rel="noopener" href="/javarevisited/10-best-free-dropwizard-vert-x-micronaut-and-quarkus-online-courses-for-java-developers-9c2b4161f17"> Quarkus </a>、<a class="ae iu" href="https://javarevisited.blogspot.com/2020/09/top-5-courses-to-learn-dropwizard-Micronaut-Quarkus-Java-Microservices.html" rel="noopener ugc nofollow" target="_blank"> Micronaut </a>、<a class="ae iu" rel="noopener" href="/javarevisited/top-10-courses-to-learn-spring-boot-in-2020-best-of-lot-6ffce88a1b6e"> Spring Boot </a>。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><h1 id="f0b2" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">弹性APM的高层架构:</h1><p id="a228" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" rel="noopener" href="/javarevisited/10-best-java-microservices-courses-with-spring-boot-and-spring-cloud-6d04556bdfed">微服务</a>应用程序本质上可以包含来自不同编程语言的服务，这些服务相互交流，共享信息。</p><p id="a45e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">弹性APM代理是Java Jar、Nodejs包或Python包，被配置为从应用程序收集数据。下面是数据如何流动的高级架构图。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><a href="https://www.java67.com/2021/04/5-free-microservice-courses-for-java.html"><div class="er es lc"><img src="../Images/c7d5b17cad8a4c708d768b27711bfa54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MYDyepfzDtgr5bSmDG9gBg.png"/></div></a><p class="iq ir et er es is it bd b be z dx translated">弹性APM部署</p></figure><p id="de66" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">APM服务器接收来自各种应用程序的所有数据，并在Elasticsearch中创建文档。</p><h1 id="bacf" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Java CRUD应用程序</h1><p id="368c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" href="https://github.com/aravindputrevu/javalin-student" rel="noopener ugc nofollow" target="_blank">源代码</a></p><h2 id="514a" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">爪哇林</h2><p id="2654" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我正在使用Javalin，一个轻量级的web框架来快速构建Java端点。Javalin运行在Jetty之上，Jetty是JVM上最常用和最稳定的web服务器之一。</p><p id="5fe9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Java应用程序存储学生的详细信息，如Id、姓名、年龄。如果愿意，您可以添加其他属性。</p><p id="ff01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该应用程序有两个端点:</p><ul class=""><li id="bb01" class="lr ls hi ix b iy iz jc jd jg lt jk lu jo lv js lw lx ly lz bi translated">/学生:获取、发布、上传、删除</li><li id="f846" class="lr ls hi ix b iy ma jc mb jg mc jk md jo me js lw lx ly lz bi translated">/school/_count:查找学生人数。</li></ul><p id="5111" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:您可以使用VS代码或<a class="ae iu" rel="noopener" href="/javarevisited/7-best-courses-to-learn-intellij-idea-for-beginners-and-experienced-java-programmers-2e9aa9bb0c05?source=---------16------------------"> IntelliJ </a>来添加代码。无论哪种方式，项目的根目录下都有一个<em class="mf"> pom.xml </em>。</p><h2 id="0835" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">创建APM部署:</h2><p id="fea3" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我使用弹性云来部署弹性APM部署。您可以<a class="ae iu" href="https://cloud.elastic.co/registration" rel="noopener ugc nofollow" target="_blank">开始试用</a>并加快部署。或者，您也可以通过下载二进制文件来部署<a class="ae iu" href="https://www.elastic.co/downloads/elasticsearch" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>、<a class="ae iu" href="https://www.elastic.co/downloads/kibana" rel="noopener ugc nofollow" target="_blank"> Kibana </a>和<a class="ae iu" href="https://www.elastic.co/downloads/apm" rel="noopener ugc nofollow" target="_blank"> APM Server </a>。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/86fc74d54140dbf7211cd6fe25020cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JNSsSpheUZLKKk9B9ZcPkg.png"/></div></div><p class="iq ir et er es is it bd b be z dx translated">弹性云部署页面</p></figure><figure class="kw kx ky kz fd ij er es paragraph-image"><a href="https://www.java67.com/2020/12/5-free-cloud-computing-courses-for-beginners.html"><div class="er es mh"><img src="../Images/4f05c27d0855ae001d5324daa6db42c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DILaOd6oZYGnyprKp5W5zA.png"/></div></a></figure><p id="c1b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选择任意云厂商，最好是最新版本的Elastic Stack，点击<code class="du mi mj mk ml b">Create deployment</code>。或者，您可以选择单击<code class="du mi mj mk ml b">Customize</code>通过添加额外的硬件层(热层、冷层)来进行部署。</p><p id="5b5c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建部署后，您需要复制APM服务器URL和秘密令牌。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/c6037613dfb5a96f836b06080f623e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*ZTjx2AlUwcpkhZn9vXJYhQ.png"/></div><p class="iq ir et er es is it bd b be z dx translated">部署的左侧菜单</p></figure><ul class=""><li id="20cb" class="lr ls hi ix b iy iz jc jd jg lt jk lu jo lv js lw lx ly lz bi translated">单击左侧菜单中的APM链接，如上图所示。</li><li id="3e64" class="lr ls hi ix b iy ma jc mb jg mc jk md jo me js lw lx ly lz bi translated">我们将需要APM服务器的URL，秘密令牌。</li></ul><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/8ee171d424d979d8620c1f2fd962815e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*I_g_CjZ54quChL_Fapbj8g.png"/></div></figure><h2 id="bbe0" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">克隆存储库:</h2><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="d3a4" class="ld ju hi ml b fi ms mt l mu mv">git clone <a class="ae iu" href="https://github.com/aravindputrevu/javalin-student.git" rel="noopener ugc nofollow" target="_blank">https://github.com/aravindputrevu/javalin-student.git</a></span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/23f3409780bc3f045464a605c4dcf133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpD6To_UCNnuvdnN0Tbf6A.png"/></div></div></figure><p id="0644" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">克隆完成后，请注意resources文件夹下的文件。添加APM服务器URL，从控制台复制到<code class="du mi mj mk ml b">server_urls</code>和<code class="du mi mj mk ml b">secret_token.</code>的秘密令牌</p><p id="2cae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> elasticapm.properties </strong></p><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="3362" class="ld ju hi ml b fi ms mt l mu mv">service_name=javalin<br/>application_packages=com.example<br/>server_urls=<br/>secret_token=</span></pre><h2 id="aeee" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">建筑应用</h2><p id="bd60" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在源代码的根文件夹中，您可以找到项目。像javalin、<a class="ae iu" href="https://javarevisited.blogspot.com/2013/08/why-use-sl4j-over-log4j-for-logging-in.html#axzz6JyHI5fGb" rel="noopener ugc nofollow" target="_blank"> sl4j </a>和<a class="ae iu" href="https://javarevisited.blogspot.com/2013/02/how-to-convert-json-string-to-java-object-jackson-example-tutorial.html" rel="noopener ugc nofollow" target="_blank"> Jackson </a>这样的依赖很少。</p><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="4f38" class="ld ju hi ml b fi ms mt l mu mv">&lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;io.javalin&lt;/groupId&gt;<br/>        &lt;artifactId&gt;javalin&lt;/artifactId&gt;<br/>        &lt;version&gt;3.9.1&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br/>        &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;<br/>        &lt;version&gt;1.7.30&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>     &lt;dependency&gt;<br/>         &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;<br/>         &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;<br/>         &lt;version&gt;2.11.2&lt;/version&gt;<br/>     &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="0327" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">执行<code class="du mi mj mk ml b">mvn clean</code>、<code class="du mi mj mk ml b">mvn install</code>在<code class="du mi mj mk ml b">target</code>文件夹下生成<code class="du mi mj mk ml b">jar</code>。</p><p id="1185" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>你需要在你的机器上安装<code class="du mi mj mk ml b"><a class="ae iu" rel="noopener" href="/javarevisited/6-best-maven-courses-for-beginners-in-2020-23ea3cba89">maven</a></code> <a class="ae iu" rel="noopener" href="/javarevisited/6-best-maven-courses-for-beginners-in-2020-23ea3cba89"> </a>(而java dev的笔记本电脑上没有<code class="du mi mj mk ml b">ant</code><code class="du mi mj mk ml b">maven</code><code class="du mi mj mk ml b"><a class="ae iu" rel="noopener" href="/javarevisited/5-best-gradle-courses-and-books-to-learn-in-2021-93f49ce8ff8e">gradle</a></code><a class="ae iu" rel="noopener" href="/javarevisited/5-best-gradle-courses-and-books-to-learn-in-2021-93f49ce8ff8e"/>)！😉)</p><p id="afbf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">启动应用程序:<code class="du mi mj mk ml b">java -jar target/javalin-student-1.0-snapshot.jar</code></p><p id="03f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以使用REST客户端如<code class="du mi mj mk ml b"><a class="ae iu" rel="noopener" href="/javarevisited/7-best-courses-to-learn-postman-tool-for-web-service-and-api-testing-f225c138fa5a?source=---------13------------------">Postman</a></code> <a class="ae iu" rel="noopener" href="/javarevisited/7-best-courses-to-learn-postman-tool-for-web-service-and-api-testing-f225c138fa5a?source=---------13------------------"> </a>或命令行工具如<code class="du mi mj mk ml b"><a class="ae iu" href="https://javarevisited.blogspot.com/2017/03/10-examples-of-curl-command-in-unix-and-Linux.html" rel="noopener ugc nofollow" target="_blank">cURL</a></code> <a class="ae iu" href="https://javarevisited.blogspot.com/2017/03/10-examples-of-curl-command-in-unix-and-Linux.html" rel="noopener ugc nofollow" target="_blank"> </a>来检查应用程序端点。</p><p id="9983" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">创建:</strong></p><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="8972" class="ld ju hi ml b fi ms mt l mu mv">$ curl -X POST -H "Content-Type: application/json" <a class="ae iu" href="http://localhost:8080/students" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/students</a> -d '{ "id": "003","name": "Javalin","age": 15}'</span><span id="f0eb" class="ld ju hi ml b fi mx mt l mu mv">$ curl -X POST -H "Content-Type: application/json" <a class="ae iu" href="http://localhost:8080/students" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/students</a> -d '{ "id": "005","name": "Micronaut","age": 12}'</span><span id="4b74" class="ld ju hi ml b fi mx mt l mu mv">$ curl -X POST -H "Content-Type: application/json" <a class="ae iu" href="http://localhost:8080/students" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/students</a> -d '{ "id": "001","name": "Quarkus","age": 16}'</span></pre><p id="8f15" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">改为:</strong></p><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="6739" class="ld ju hi ml b fi ms mt l mu mv">$ curl -X GET <a class="ae iu" href="http://localhost:8080/students" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/students</a></span><span id="deec" class="ld ju hi ml b fi mx mt l mu mv">$ curl -X GET http://localhost:8080/students/003</span></pre><p id="5f5c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">更新:</strong></p><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="7594" class="ld ju hi ml b fi ms mt l mu mv">$ curl -X PATCH -H "Content-Type: application/json" <a class="ae iu" href="http://localhost:8080/students" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/students</a> -d '{ "id": "001","name": "Quarkus","age": 32}' #updating age</span></pre><p id="c0cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">删除:</strong></p><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="0e7b" class="ld ju hi ml b fi ms mt l mu mv">$ curl -X DELETE http://localhost:8080/students/001</span></pre><p id="2f4f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">计数:</strong></p><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="af8c" class="ld ju hi ml b fi ms mt l mu mv">$ curl -X GET http://locahost:8080/school/_count</span></pre><h2 id="34b6" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">跟踪应用程序</h2><p id="839b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我们还没有开始跟踪我们的申请。您需要从<a class="ae iu" href="https://search.maven.org/search?q=g:co.elastic.apm%20AND%20a:elastic-apm-agent" rel="noopener ugc nofollow" target="_blank"> maven central </a>下载Java代理，并将其放在项目的根文件夹下。</p><p id="ed6e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有三种方法可以设置代理:</p><ol class=""><li id="3b2d" class="lr ls hi ix b iy iz jc jd jg lt jk lu jo lv js my lx ly lz bi translated">使用<code class="du mi mj mk ml b">-javaagent</code>标志。</li><li id="baa0" class="lr ls hi ix b iy ma jc mb jg mc jk md jo me js my lx ly lz bi translated">使用<code class="du mi mj mk ml b">apm-agent-attach-standalone.jar</code> — Beta</li><li id="151a" class="lr ls hi ix b iy ma jc mb jg mc jk md jo me js my lx ly lz bi translated">使用编程连接。—贝塔</li></ol><p id="3ac9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用选项1，<code class="du mi mj mk ml b">javaagent</code>方法。</p><p id="b76d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您需要启动带有<code class="du mi mj mk ml b">javaagent</code>标志的应用程序，如下例所示。</p><pre class="kw kx ky kz fd mo ml mp mq aw mr bi"><span id="d67e" class="ld ju hi ml b fi ms mt l mu mv">$ java -javaagent:elastic-apm-agent-1.22.0.jar -jar target/javalin-student-1.0-SNAPSHOT.jar</span></pre><p id="654a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>您还可以按照<a class="ae iu" href="https://www.elastic.co/guide/en/apm/agent/java/1.x/setup-javaagent.html#application-server-setup" rel="noopener ugc nofollow" target="_blank">文档</a>中所述配置支持的应用服务器。</p><h2 id="36f8" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">在Kibana中查看应用程序跟踪</h2><p id="4cbc" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">当您开始访问应用程序端点时，您应该在Kibana -&gt; Observability -&gt; APM中看到数据。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/454cc41d00758a8caeac2aebed859507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*43jB6ZgkGZInKLim42QDXA.png"/></div></div></figure><p id="3539" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以使用相关性观察特定字段的较慢性能和错误率。它使用弹性搜索的<code class="du mi mj mk ml b">significant terms</code>集合来提供这些信息。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/6002e88f6d2ff0fd954a3aaab3561f88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N1ScF2bu3MKoXKv-XW1nZg.png"/></div></div></figure><p id="a9ed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不是这个。您可以创建特定的阈值、延迟警报、从错误面板中查找错误、使用<code class="du mi mj mk ml b">@CaptureSpan</code>注释为特定方法创建跨度。</p><p id="53df" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">除此之外，您可以启用日志关联来查找属于特定跟踪的日志，反之亦然。Elastic提供了<a class="ae iu" href="https://www.elastic.co/guide/en/ecs-logging/java/current/setup.html" rel="noopener ugc nofollow" target="_blank"> ECS日志库</a>来从您的应用程序进行结构化日志记录，并将其直接导入到Elasticsearch。</p><h1 id="25cb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="ecf7" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">使用弹性Java APM很容易上手。支持大多数应用服务器和框架。您还可以使用<a class="ae iu" href="https://www.elastic.co/guide/en/apm/agent/java/1.x/public-api.html" rel="noopener ugc nofollow" target="_blank">公共API </a>手动创建跟踪和事务。</p><h2 id="53aa" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">资源:</h2><ul class=""><li id="6f47" class="lr ls hi ix b iy kr jc ks jg nb jk nc jo nd js lw lx ly lz bi translated"><a class="ae iu" href="https://www.elastic.co/training/apm-quick-start" rel="noopener ugc nofollow" target="_blank"> APM快速入门培训</a></li><li id="9c91" class="lr ls hi ix b iy ma jc mb jg mc jk md jo me js lw lx ly lz bi translated"><a class="ae iu" href="https://github.com/elastic/apm" rel="noopener ugc nofollow" target="_blank">弹性公共APM页面</a></li><li id="c77f" class="lr ls hi ix b iy ma jc mb jg mc jk md jo me js lw lx ly lz bi translated"><a class="ae iu" href="https://github.com/elastic/apm-server" rel="noopener ugc nofollow" target="_blank"> APM服务器源代码</a></li><li id="fd5a" class="lr ls hi ix b iy ma jc mb jg mc jk md jo me js lw lx ly lz bi translated"><a class="ae iu" href="https://github.com/elastic/apm-agent-java" rel="noopener ugc nofollow" target="_blank"> Java代理源代码</a></li></ul><h2 id="9de1" class="ld ju hi bd jv le lf lg jz lh li lj kd jg lk ll kh jk lm ln kl jo lo lp kp lq bi translated">关于Elasticsearch的更多问题？</h2><p id="911b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">请随意在这里写下您的回复，或者在<a class="ae iu" href="https://twitter.com/aravindputrevu" rel="noopener ugc nofollow" target="_blank"> Twitter </a>:)上给我发短信</p></div></div>    
</body>
</html>