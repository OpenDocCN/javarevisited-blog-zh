<html>
<head>
<title>Null Check vs Optional? Are they same?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">空检查vs可选？它们一样吗？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/null-check-vs-optional-are-they-same-c361d15fade3?source=collection_archive---------0-----------------------#2020-11-04">https://medium.com/javarevisited/null-check-vs-optional-are-they-same-c361d15fade3?source=collection_archive---------0-----------------------#2020-11-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b159143d45bae890c171169dd24638ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ef3_H8QLWeDZ90Iz6odY_g.jpeg"/></div></div></figure><p id="1bd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个问题在采访中被问到的时候，我和大家一样回答了“<strong class="is hj"> Java 8在java.util包中引入了这个新类</strong> <a class="ae jo" href="https://javarevisited.blogspot.com/2017/04/10-examples-of-optional-in-java-8.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">可选</strong> </a> <strong class="is hj">。通过使用Optional，我们避免了空检查，并可以指定返回替代值，从而使我们的代码更具可读性。</strong>”</p><p id="493b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是接下来面试官写了下面的代码(见例1)并问“<strong class="is hj">为什么optional更好，如果它和null check做了几乎相同的事情，因此没有达到任何特殊的目的。”</strong></p><h1 id="cf92" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">示例1:</h1><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="c85c" class="kw jq hi ks b fi kx ky l kz la">String value = null;<br/><strong class="ks hj">Optional&lt;String&gt; optionalValue = someFunction();</strong><br/><br/>if(<strong class="ks hj">optionalValue.isPresent()</strong>) <br/>   value = <strong class="ks hj">optionalValue.get().toUpperCase();</strong><br/>else<br/>   value =<strong class="ks hj"> "NO VALUE";</strong></span></pre><p id="67be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="c26a" class="kw jq hi ks b fi kx ky l kz la">String value = null; <br/>String <strong class="ks hj">possibleNull = someFunction(); <br/>if(possibleNull != null) </strong><br/>   value = <strong class="ks hj">possibleNull.toUpperCase()</strong>;<br/>else<br/>   value =<strong class="ks hj"> "NO VALUE";</strong></span></pre><h1 id="c3c8" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">示例2:</h1><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="7386" class="kw jq hi ks b fi kx ky l kz la">private<!-- --> <!-- -->boolean<!-- --> <!-- -->validAddress(NullPerson person) <br/>{<br/>  <strong class="ks hj">if</strong><strong class="ks hj"> </strong><strong class="ks hj">(person != null) </strong><br/>  {<br/>    <strong class="ks hj">if</strong><strong class="ks hj"> </strong><strong class="ks hj">(person.getAddress() != null) </strong><br/>    {<br/>     final<!-- --> <!-- -->Instant validFrom = person.getAddress().getValidFrom();<br/>     return<!-- --> <strong class="ks hj">validFrom != null</strong> <!-- -->&amp;&amp; validFrom.isBefore(now());<br/>    }<br/>    else<br/>      return<!-- --> <!-- -->false;<br/>   } <br/>   else<br/>     return<!-- --> <!-- -->false;<br/>}</span></pre><p id="1748" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="d8b6" class="kw jq hi ks b fi kx ky l kz la">private<!-- --> <!-- -->boolean<!-- --> <!-- -->validAddress(NullPerson person) <br/>{<br/>  return<!-- --> <strong class="ks hj">personOptional.isPresent()</strong> <!-- -->&amp;&amp;<!-- -->   <strong class="ks hj">person.getAddress().isPresent()</strong> <!-- -->&amp;&amp;<!-- --> <strong class="ks hj">person.getAddress().getValidFrom().isPresent()</strong> <!-- -->&amp;&amp;<!-- --> <!-- -->person.getAddress().getValidFrom().isBefore(now());<br/>}</span></pre><h2 id="307f" class="kw jq hi bd jr lb lc ld jv le lf lg jz jb lh li kd jf lj lk kh jj ll lm kl ln bi translated"><strong class="ak">真正的</strong>优势<code class="du lo lp lq ks b">Optional</code></h2><p id="98ed" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">这是一个库类，它有一个相当丰富的API来以一种更安全的方式处理空的情况。</p><p id="ff18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此例1的<a class="ae jo" href="https://javarevisited.blogspot.com/2018/08/top-5-free-java-8-and-9-courses-for-programmers.html#axzz6ccm5KWKs" rel="noopener ugc nofollow" target="_blank">可选</a>方式应为:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="95bf" class="kw jq hi ks b fi kx ky l kz la"><strong class="ks hj">String value = someFunction().map(String::toUpperCase)<br/>          .orElse("NO VALUE");</strong></span></pre><p id="3c39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">示例2应该写成</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="e5bc" class="kw jq hi ks b fi kx ky l kz la">private<!-- --> <!-- -->boolean<!-- --> <!-- -->validAddress(NullPerson person) <br/>{<br/>  return<!-- --> <strong class="ks hj">person.flatMap(Person::getAddress).flatMap(Address::getValidFrom).filter(x -&gt; x.before(now())).isPresent();</strong><br/>}</span></pre><h1 id="e8a0" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">不足之处</h1><p id="1db1" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">当然，没有灵丹妙药…</p><p id="9a88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1)在性能上:将原始值包装到可选实例中，会在紧循环中表现出明显的性能下降。在Java 10 <a class="ae jo" href="http://cr.openjdk.java.net/~jrose/values/values-0.html" rel="noopener ugc nofollow" target="_blank">中，值类型</a>可能会进一步减少或消除损失。</p><p id="f9eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2)关于序列化:<code class="du lo lp lq ks b"><a class="ae jo" href="http://blog.codefx.org/jdk/dev/why-isnt-optional-serializable/" rel="noopener ugc nofollow" target="_blank">Optional</a></code> <a class="ae jo" href="http://blog.codefx.org/jdk/dev/why-isnt-optional-serializable/" rel="noopener ugc nofollow" target="_blank">不可序列化</a>但是一个<a class="ae jo" href="http://blog.codefx.org/jdk/serialize-optional/" rel="noopener ugc nofollow" target="_blank">变通方法</a>并不过分复杂。</p><h1 id="9912" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="7cb0" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated"><code class="du lo lp lq ks b">Optional</code>的主要目的是在为函数返回值时指出缺少值(即空值)。这是为了向打电话的人阐明意图。</p><p id="0b93" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我相信，当可选的使用方式与早期的NPE检查相同时，问题就出现了。可选类是指包含值或不包含值的容器。<strong class="is hj">因此我认为Java不应该提供</strong> <a class="ae jo" href="https://www.java67.com/2018/06/java-8-optional-example-ispresent-orElse-get.html?fbclid=IwAR3_3ir-IAia8frQHZetwSqQaN3hQerLvhpq7Jukh1zD_EbPtaRjHn0rkhk#ixzz5mMbVkkfm" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> get()和ifPresent()方法</strong> </a> <strong class="is hj">或者应该提供替代机制来方便检索(和检查行为</strong>)。</p><p id="1317" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">参考资料:</p><ol class=""><li id="e2bb" class="lw lx hi is b it iu ix iy jb ly jf lz jj ma jn mb mc md me bi translated"><a class="ae jo" href="https://www.nurkiewicz.com/2013/08/optional-in-java-8-cheat-sheet.html" rel="noopener ugc nofollow" target="_blank">https://www . nurkiewicz . com/2013/08/optional-in-Java-8-cheat-sheet . html</a></li><li id="352f" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated"><a class="ae jo" href="https://nipafx.dev/intention-revealing-code-java-8-optional#" rel="noopener ugc nofollow" target="_blank">https://ni pafx . dev/intention-revealing-code-Java-8-optional #</a></li><li id="0d6c" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated"><a class="ae jo" href="https://dev.to/piczmar_0/java-optional-in-class-fields-why-not-40df" rel="noopener ugc nofollow" target="_blank">https://dev . to/piczmar _ 0/Java-optional-in-class-fields-why-not-40df</a></li><li id="5b9c" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated"><a class="ae jo" href="https://ionutbalosin.com/2018/05/optional-api-vs-explicit-null-check-race/" rel="noopener ugc nofollow" target="_blank">https://ionutbalosin . com/2018/05/optional-API-vs-explicit-null-check-race/</a></li><li id="34f7" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated"><a class="ae jo" href="https://www.oracle.com/technical-resources/articles/java/java8-optional.html" rel="noopener ugc nofollow" target="_blank">https://www . Oracle . com/technical-resources/articles/Java/Java 8-optional . html</a></li><li id="9be3" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated"><a class="ae jo" href="https://javarevisited.blogspot.com/2017/04/10-examples-of-optional-in-java-8.html" rel="noopener ugc nofollow" target="_blank">https://Java re visited . blogspot . com/2017/04/10-examples-of-optional-in-Java-8 . html</a></li></ol></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><p id="d614" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有问题吗？评论？建议？</p><p id="00cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是什么？</p><p id="4437" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" rel="noopener" href="/@vaibhav0109"> <strong class="is hj">在媒体上关注我</strong> </a>成为第一个阅读我的故事的人。</p></div></div>    
</body>
</html>