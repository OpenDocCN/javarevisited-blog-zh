<html>
<head>
<title>Schedule your holiday for 2038</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将你的假期安排在2038年</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/schedule-your-holiday-for-2038-3d611f91e10a?source=collection_archive---------6-----------------------#2022-12-01">https://medium.com/javarevisited/schedule-your-holiday-for-2038-3d611f91e10a?source=collection_archive---------6-----------------------#2022-12-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ce2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">年底将至，是时候开始安排下一年的假期了。但是我决定更进一步，已经为2038年做了计划！为什么？几个星期前，我给学生们做了一个报告，当我意识到他们在提到2000年问题时根本不知道我在说什么。他们中的大多数人在2000年还没有出生呢！我也在那一刻意识到，我可能正在成为一个脾气暴躁的老人，但这是另一个帖子的主题……；-)但我也发现了一个新的类似问题即将在… 2038年出现！</p><p id="265b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们调查一下在那一年<code class="du jd je jf jg b">jshell</code>会发生什么...</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="jm jn l"/></div></figure><h1 id="e5b5" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">2000年问题是什么？</h1><p id="4595" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">在2000年之前的最后几年，人们越来越关注使用日期的计算机系统，以及它们如何处理从1999年到2000年的过渡。事实上，许多系统只使用最后两位数字的年份，肯定会导致排序问题。</p><p id="82ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，以YYMMDD格式存储日期的数据库系统将包含这些数据，很明显，从2000年开始，排序将会“混乱”:</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="79cf" class="kv jp hi jg b be kw kx l ky kz">February 28th of 1970   --&gt;     700228<br/>October 23st of 1982    --&gt;     821023<br/>January 1st of 2000     --&gt;     000101</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/9e4c455e7230b92a5ebf30dc4d011cc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l0oSx4ijswKM9VCe.jpg"/></div></div><p class="lh li et er es lj lk bd b be z dx translated">因为千年虫，报纸封面宣布世界末日</p></figure><p id="87d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，在世界崩溃之前，大多数系统都被打了补丁，千年虫很快就消失了。</p><h1 id="bfd1" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">jshell是什么？</h1><p id="f018" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">在版本9中,<code class="du jd je jf jg b">jshell</code>工具被添加到Java开发工具包(JDK)中。它能够快速测试Java代码。如果你有一个安装了的<a class="ae ll" href="https://javarevisited.blogspot.com/2013/02/how-to-install-jdk-7-on-windows-8-java-32bit-64.html" rel="noopener ugc nofollow" target="_blank"> JDK，你可以在你的命令行或终端中使用<code class="du jd je jf jg b">jshell</code>。</a></p><p id="f950" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查您的Java版本并启动<code class="du jd je jf jg b">jshell</code>:</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="5e8c" class="kv jp hi jg b be kw kx l ky kz">$ java -version<br/>openjdk version "19" 2022-09-20<br/>OpenJDK Runtime Environment Zulu19.28+81-CA (build 19+36)<br/>OpenJDK 64-Bit Server VM Zulu19.28+81-CA (build 19+36, mixed mode, sharing)<br/><br/>$ jshell<br/>|  Welcome to JShell -- Version 19<br/>|  For an introduction type: /help intro<br/><br/>jshell&gt;</span></pre><p id="73d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想知道你能做什么，输入<code class="du jd je jf jg b">/help intro</code>:</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="457b" class="kv jp hi jg b be kw kx l ky kz">jshell&gt; /help intro<br/>|<br/>|                                   intro<br/>|                                   =====<br/>|<br/>|  The jshell tool allows you to execute Java code, getting immediate results.<br/>|  You can enter a Java definition (variable, method, class, etc), like:  int x = 8<br/>|  or a Java expression, like:  x + x<br/>|  or a Java statement or import.<br/>|  These little chunks of Java code are called 'snippets'.<br/>|<br/>|  There are also the jshell tool commands that allow you to understand and<br/>|  control what you are doing, like:  /list<br/>|<br/>|  For a list of commands: /help</span></pre><p id="d29b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个简单的例子:</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="9679" class="kv jp hi jg b be kw kx l ky kz">jshell&gt; var txt = "Hello World!"<br/>txt ==&gt; "Hello World!"<br/><br/>jshell&gt; txt<br/>txt ==&gt; "Hello World!"<br/><br/>jshell&gt; txt + (5*4)<br/>$3 ==&gt; "Hello World!20"<br/><br/>jshell&gt; txt.substring(2, 5)<br/>$4 ==&gt; "llo"</span></pre><p id="6389" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要结束“jshell ”,请使用“/exit ”:</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="d4ee" class="kv jp hi jg b be kw kx l ky kz">jshell&gt; /exit<br/>|  Goodbye</span></pre><h1 id="d746" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">2038年会发生什么？</h1><p id="d342" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">一个新的千年虫似乎正在逼近，但幸运的是我们还有时间去阻止它！或者你已经可以为2038年安排一个长假了…</p><p id="00e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们来看看<code class="du jd je jf jg b">jshell</code>的问题。首先，我们需要导入一些包，因为我们将使用一些日期和时间方法。</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="12b8" class="kv jp hi jg b be kw kx l ky kz">jshell&gt; import java.time.Instant<br/>jshell&gt; import java.time.ZoneId<br/>jshell&gt; import java.time.ZonedDateTime</span></pre><p id="f8eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所知，许多日期格式始于1970年1月1日。Matt Howells 和社区贡献在这个<a class="ae ll" href="https://stackoverflow.com/questions/1090869/why-is-1-1-1970-the-epoch-time" rel="noopener ugc nofollow" target="_blank"> StackOverflow回答</a>中对此做了很好的解释:</p><p id="8e84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lm">早期版本的unix以1/60秒的间隔测量系统时间。这意味着32位无符号整数只能表示小于829天的时间跨度。因此，由数字0代表的时间(称为纪元)必须设定在最近的过去。因为这是在20世纪70年代初，纪元被设定为1971-01-01。</em></p><p id="455c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lm">后来系统时间改为每秒递增，将32位无符号整数所能表示的时间跨度增加到136年左右。由于从计数器中挤出每一秒不再那么重要，这个纪元被四舍五入到最近的十年，因此成为1970-01-01。人们必须假设，这被认为比1971年1月1日的情况要好一些。</em></p><p id="1e2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lm">请注意，使用1970–01–01作为历元的32位有符号整数可以表示直到2038–01–19的日期，在该日期，它将绕回1901–12–13。</em></p><p id="3b69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据这个答案，使用整数存储日期显然不是一个理想的解决方案…这可以通过几行代码进行完美的测试:</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="0a79" class="kv jp hi jg b be kw kx l ky kz">jshell&gt; var testDate = ZonedDateTime.of(1970, 1, 1, 0, 0, 0, 0, ZoneId.of("UTC"));<br/>testDate ==&gt; 1970-01-01T00:00Z[UTC]<br/><br/>jshell&gt; testDate.toEpochSecond()<br/>$5 ==&gt; 0</span></pre><p id="caee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事实上，1970–01–01返回值0作为纪元。现在让我们回到未来，将最大整数值分配给我们的测试日期:</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="b6fc" class="kv jp hi jg b be kw kx l ky kz">jshell&gt; testDate = ZonedDateTime.ofInstant(Instant.ofEpochSecond(Integer.MAX_VALUE), ZoneId.of("UTC"));<br/>testDate ==&gt; 2038-01-19T03:14:07Z[UTC]<br/><br/>jshell&gt; testDate.toEpochSecond()<br/>$5 ==&gt; 2147483647<br/><br/>jshell&gt; testDate = testDate.minusSeconds(1)<br/>testDate ==&gt; 2038-01-19T03:14:06Z[UTC]<br/><br/>jshell&gt; testDate.toEpochSecond()<br/>$6 ==&gt; 2147483646<br/><br/>jshell&gt; testDate = testDate.plusSeconds(2)<br/>testDate ==&gt; 2038-01-19T03:14:08Z[UTC]<br/><br/>jshell&gt; testDate.toEpochSecond()<br/>$7 ==&gt; 2147483648</span></pre><p id="094f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一切似乎都没问题，但是由于<code class="du jd je jf jg b">toEpochSecond()</code>返回一个long类型的值，当我们将最后一个值转换为整数时，问题就变得很明显了。它变成了一个负值，当它被用作重建日期的瞬间时，会让我们回到1901年12月13日！</p><pre class="jh ji jj jk fd kr jg ks bn kt ku bi"><span id="78ea" class="kv jp hi jg b be kw kx l ky kz">jshell&gt; (int) testDate.toEpochSecond()<br/>$8 ==&gt; -2147483648<br/><br/>jshell&gt; testDate = ZonedDateTime.ofInstant(Instant.ofEpochSecond(-2147483648), ZoneId.of("UTC"));<br/>testDate ==&gt; 1901-12-13T20:45:52Z[UTC]</span></pre><h1 id="798d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="03fa" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">在过去，当存储空间有限且昂贵时，选择最小的变量类型来存储数据是有意义的。但是，如果我们不限制存储日期和时间的空间，我们未来的自己和/或维护我们现在正在构建的系统的人将会非常感激。</p></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><p id="c193" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lm">原发布于</em><a class="ae ll" href="https://webtechie.be/post/2022-12-01-schedule-holiday-2038/" rel="noopener ugc nofollow" target="_blank"><em class="lm">https://web techie . be</em></a><em class="lm">。</em></p></div></div>    
</body>
</html>