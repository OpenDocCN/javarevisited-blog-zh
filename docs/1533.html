<html>
<head>
<title>Spring Boot Data JPA — Part IV (Projections)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot数据JPA —第四部分(预测)</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/spring-boot-data-jpa-part-iv-projections-9d25a5637dd9?source=collection_archive---------0-----------------------#2021-09-06">https://medium.com/javarevisited/spring-boot-data-jpa-part-iv-projections-9d25a5637dd9?source=collection_archive---------0-----------------------#2021-09-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1d0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://maheshbonagiri.medium.com/getting-started-with-spring-data-jpa-7e949e0c5f2b" rel="noopener">第一部分(入门)</a> | <a class="ae jd" href="https://maheshbonagiri.medium.com/spring-boot-data-jpa-part-ii-pagination-and-sorting-bec179029978" rel="noopener">第二部分(分页&amp;排序)</a> | <a class="ae jd" href="https://maheshbonagiri.medium.com/spring-boot-data-jpa-part-iii-auditing-1fa5d9595eb2" rel="noopener">第三部分(审核)</a></p><p id="b6c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的帖子中，我解释了如何开始使用Spring boot Data JPA的、<a class="ae jd" href="https://maheshbonagiri.medium.com/spring-boot-data-jpa-part-ii-pagination-and-sorting-bec179029978" rel="noopener">分页&amp;排序</a>和<a class="ae jd" href="https://maheshbonagiri.medium.com/spring-boot-data-jpa-part-iii-auditing-1fa5d9595eb2" rel="noopener">审计</a>。在本帖中，我们将讨论如何对Spring数据使用投影。</p><p id="4834" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当使用<a class="ae jd" href="https://javarevisited.blogspot.com/2021/08/top-5-spring-data-jpa-courses-for-java.html" rel="noopener ugc nofollow" target="_blank"> Spring Data JPA </a>时，存储库通常会返回根类的一个或多个实例。可能有这样的情况，我们不需要查询方法中的整个实体，而只对该实体的几个属性或该实体的子集感兴趣，其中有一些操作。这就是投影派上用场的地方。</p><p id="ea0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我们开始:</strong></p><p id="af3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用<a class="ae jd" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> Spring Initializer </a>为我们的项目生成基础，在我之前的<a class="ae jd" href="https://maheshbonagiri.medium.com/getting-started-with-spring-boot-eclipse-d3a297ca90a0" rel="noopener">帖子</a>中，我已经解释了如何从<a class="ae jd" rel="noopener" href="/javarevisited/top-10-courses-to-learn-spring-boot-in-2020-best-of-lot-6ffce88a1b6e?source=---------39------------------"> Spring Boot </a> + <a class="ae jd" rel="noopener" href="/javarevisited/6-free-best-eclipse-ide-courses-for-java-programmers-1229ee9e5d87">日蚀</a>开始。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><a href="https://www.java67.com/2017/11/top-5-free-core-spring-mvc-courses-learn-online.html"><div class="er es je"><img src="../Images/61e88ccc05d235b8ddd7335b95cddd2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4EJrhxUjq2OmBFuPRfbXeg.png"/></div></a></figure><h1 id="7e6c" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">定义一个简单的实体</h1><p id="38ba" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">让我们创建一个名为<strong class="ih hj"> BookEntity </strong>的实体，如下所示(我们可以重用在之前的<a class="ae jd" href="https://maheshbonagiri.medium.com/spring-boot-data-jpa-part-iii-auditing-1fa5d9595eb2" rel="noopener"> post </a>中创建的实体)。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="5252" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的每个<em class="kr"> Book </em>实例都有一个惟一的标识符:<em class="kr"> id </em>，它的<em class="kr">名称、作者、价格</em>和审计信息，比如created date/modified date/createdBy/modified by</p><h1 id="649e" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">存储库接口:</h1><p id="45c9" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">让我们来看看我们的BookRepoisitory，它扩展了JpaRepository。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><h1 id="cabe" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">基于界面的投影</h1><p id="2cd6" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在这种类型中，我们创建一个接口，该接口只包含我们希望从实体类中获得的属性的getter方法。这个接口将是我们在Spring Data JPA的Repository接口中编写的查询方法的返回类型。</p><p id="50c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">近距离投影:</strong></p><p id="45ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在封闭投影中，接口的getter方法与实体属性的getter方法完全匹配。查看Book实体，我们可以看到它有许多属性，但并不是所有的属性都有用。例如，并不是所有时候都需要审计信息。</p><p id="e9f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们为Book实体声明一个投影接口，如下所示。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="9a7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如下所示更新BookRepository。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="98ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用一个投影接口和<a class="ae jd" href="https://javarevisited.blogspot.com/2016/01/why-jpa-entity-or-hibernate-persistence-should-not-be-final-in-java.html#axzz5SmuS0lnR" rel="noopener ugc nofollow" target="_blank">实体类</a>定义一个存储库方法是非常相似的。唯一不同的是基于接口的投影接口中的<strong class="ih hj"> </strong>被用作返回集合中的元素类型。</p><h1 id="ec3d" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">创建应用程序类</h1><p id="57c5" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">创建如下所示的<code class="du ks kt ku kv b">SpringbootDataJpaProjectionsApplication </code>类。使用CommandLineRunner，我们将首先保存一些记录，然后再获取这些记录。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="74ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您运行应用程序时，您应该会看到类似如下的输出:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="5c89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在上面看到的，生成的SQL语句只选择由接口映射的列。</p><p id="fb39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">打开投影:</strong></p><p id="392a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Open Projection中，我们将创建一个接口，只使用选择性属性的getter方法，但除此之外，我们还使用SpEL表达式。SpEL表达式将帮助我们从现有属性中定义一个新属性。就像上面的例子一样，如果我们想要一个属性“图书和作者姓名”，那么我们可以使用SpEL表达式和<a class="ae jd" href="http://twitter.com/Value" rel="noopener ugc nofollow" target="_blank"> @Value </a>注释来定义它。</p><p id="e084" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如下所示更新BookView.java。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="8122" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在spring boot datajpaprojectionapplication之上运行，您应该会看到类似如下的输出</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="8a1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如上所述，开放式投影有一个缺点。Spring Data无法优化查询执行，因为它事先不知道将使用哪些属性。因此，当封闭投影不能处理我们的需求时，我们应该只使用开放投影。</p><h1 id="d06f" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">基于类别的预测:</h1><p id="39dc" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在基于类的投影中，我们使用类而不是接口。我们创建投影类，它只包含我们对实体类及其类层次结构感兴趣的那些属性。</p><p id="3d92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们为Book实体声明一个投影类，如下所示。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="8dc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们更新BookRepository，如下所示。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="649d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新springbootdatajpaprojectionapplication，如下所示。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="ab72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在spring boot datajpaprojectionapplication之上运行，您应该会看到类似如下的输出</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="52d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，基于实体的投影提取了所有字段，基于类/接口的投影仅提取了我们定义的字段。</p><h1 id="e7e4" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">动态预测:</h1><p id="adcb" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">一个实体类可能有许多投影。在某些情况下，我们可能使用某种类型，但在其他情况下，我们可能需要另一种类型。有时候，我们也需要使用实体类本身。</p><p id="e02a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅仅为了支持多种返回类型而定义单独的存储库接口或方法是很麻烦的。为了解决这个问题，Spring Data提供了一个更好的解决方案:动态预测。</p><p id="5cfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过用一个<em class="kr">类</em>参数:声明一个存储库方法来应用动态投影</p><p id="6481" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们更新BookRepository，如下所示。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="20a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们更新springbootdatajpaprojectionapplication，如下所示。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="9a9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在spring boot datajpaprojectionapplication之上运行，您应该会看到类似如下的输出</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><h1 id="8ec9" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">奖励积分:</h1><p id="ed55" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在某些情况下，我们的投影类包含大量的属性，我们可能希望对需要不同属性集的不同需求使用相同的类。为所有这些需求创建一个带有多个参数的新构造函数可能不是一个好的做法。在这种情况下，我们在带有地图的投影类中添加一个构造函数。映射包含所选属性的别名作为键(字符串)及其值。虽然我们使用相同的投影类，但是这里只设置感兴趣的属性。</p><p id="1be1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加CustomBook，如下所示</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="94e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如下所示更新BookRepository。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="978d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新springbootdatajpaprojectionapplication，如下所示。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="4b60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在spring boot datajpaprojectionapplication之上运行，您应该会看到类似如下的输出</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><h1 id="6e20" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">结论:</h1><p id="179f" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">如果你想参考完整的代码，请查看https://github.com/projectk-user1/Springboot-learning.git的<a class="ae jd" href="https://github.com/projectk-user1/Springboot-learning.git" rel="noopener ugc nofollow" target="_blank"/></p><p id="cb79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请务必参考我关于弹簧靴的其他文章。</p><div class="kw kx ez fb ky kz"><a href="https://maheshbonagiri.medium.com/getting-started-with-spring-data-jpa-7e949e0c5f2b" rel="noopener follow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">Spring Boot数据JPA入门</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">第二部分(分页和排序)|第三部分(审计)</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">maheshbonagiri.medium.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jk kz"/></div></div></a></div><div class="kw kx ez fb ky kz"><a href="https://maheshbonagiri.medium.com/spring-boot-data-jpa-part-ii-pagination-and-sorting-bec179029978" rel="noopener follow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">Spring Boot数据JPA —第二部分(分页和排序)</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">在之前的帖子中，我解释了如何开始使用Spring boot Data JPA。在这篇文章中，我们将讨论如何使用…</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">maheshbonagiri.medium.com</p></div></div><div class="li l"><div class="lo l lk ll lm li ln jk kz"/></div></div></a></div><div class="kw kx ez fb ky kz"><a href="https://maheshbonagiri.medium.com/spring-boot-data-jpa-part-iii-auditing-1fa5d9595eb2" rel="noopener follow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">Spring Boot数据JPA —第三部分(审计)</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">在以前的帖子中，我解释了如何开始使用Spring boot Data JPA进行分页和排序。在本帖中，我们将…</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">maheshbonagiri.medium.com</p></div></div><div class="li l"><div class="lp l lk ll lm li ln jk kz"/></div></div></a></div><div class="kw kx ez fb ky kz"><a href="https://maheshbonagiri.medium.com/getting-started-with-spring-boot-eclipse-d3a297ca90a0" rel="noopener follow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">Spring Boot + Eclipse入门</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">概观</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">maheshbonagiri.medium.com</p></div></div><div class="li l"><div class="lq l lk ll lm li ln jk kz"/></div></div></a></div><div class="kw kx ez fb ky kz"><a href="https://maheshbonagiri.medium.com/spring-boot-restfull-web-service-aa46fcd81d29" rel="noopener follow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">Spring Boot restful网络服务</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">在之前的帖子中，我解释了如何开始使用Spring boot。在这篇文章中，我们将介绍如何创建…</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">maheshbonagiri.medium.com</p></div></div><div class="li l"><div class="lr l lk ll lm li ln jk kz"/></div></div></a></div><div class="kw kx ez fb ky kz"><a href="https://maheshbonagiri.medium.com/spring-boot-and-content-negotiation-183b20eaa425" rel="noopener follow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">Spring Boot REST Web服务内容协商</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">介绍</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">maheshbonagiri.medium.com</p></div></div><div class="li l"><div class="ls l lk ll lm li ln jk kz"/></div></div></a></div></div></div>    
</body>
</html>