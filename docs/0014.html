<html>
<head>
<title>The Sum of all Reductions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">所有缩减的总和</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/the-sum-of-all-reductions-d46dfd334704?source=collection_archive---------0-----------------------#2018-02-02">https://medium.com/javarevisited/the-sum-of-all-reductions-d46dfd334704?source=collection_archive---------0-----------------------#2018-02-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="61a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有总和的减少</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/913f6bf15d30bf11a6ce5e436f4f169a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4V0JpvDWE8rlqhN2A21u5w.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">新泽西州贝尔马，2018年深度冰冻期间</p></figure><p id="8e66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在2018年的深冻期间，世间万物仿佛都化为冰雪，包括天空。就连太阳也似乎缩小了，因为它颤抖着从我的相机旁跑开了。</p><p id="9485" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这让我想到了我们在Java中可用的不同种类的缩减，包括Eclipse集合和Java流。我想知道我们可以用多少种方法来定义<code class="du ju jv jw jx b">sum</code>。</p><h2 id="6fb0" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">对整数数组求和</h2><p id="95a1" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">让我们考虑几种在Java中对int数组中的值求和的方法。</p><p id="e5ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们将使用的数据。</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="a5f7" class="lc jz hi jx b be ld le l lf lg">int[] ints = {1, 2, 3, 4, 5};<br/><br/>// This supplier will generate an IntStream on demand<br/>IntStream intStream = Arrays.stream(ints);<br/><br/>// This creates an IntList from Eclipse Collections<br/>IntList intList = IntLists.immutable.with(ints);</span></pre><p id="60d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为循环</strong></p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="40e7" class="lc jz hi jx b be ld le l lf lg">int sumForLoop = 0;<br/>for (int i = 0; i &lt; ints.length; i++)<br/>{<br/>    sumForLoop += ints[i];<br/>}<br/>Assertions.assertEquals(15, sumForLoop);</span></pre><p id="1f74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">forEach</strong>(<code class="du ju jv jw jx b">IntStream</code>)/<strong class="ih hj">each</strong>(<code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/IntList.html" rel="noopener ugc nofollow" target="_blank">IntList</a></code></p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="8b91" class="lc jz hi jx b be ld le l lf lg">// sumForEach will be effectively final<br/>int[] sumForEach = {0};<br/>intStream.forEach(e -&gt; sumForEach[0] += e);<br/><br/>Assertions.assertEquals(15, sumForEach[0]);<br/><br/>// sumEach will be effectively final<br/>int[] sumEach = {0};<br/>intList.each(e -&gt; sumEach[0] += e);<br/><br/>Assertions.assertEquals(15, sumEach[0]);</span></pre><p id="2942" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注射</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/IntList.html" rel="noopener ugc nofollow" target="_blank">IntList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="c3a7" class="lc jz hi jx b be ld le l lf lg">// injectInto boxes on IntList as there is no primitive version<br/>int sumInject = <br/>    intList.injectInto(Integer.valueOf(0), Integer::sum).intValue();<br/><br/>Assert.assertEquals(15, sumInject);</span></pre><p id="7fca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">减少</strong> ( <code class="du ju jv jw jx b">IntStream</code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="6ace" class="lc jz hi jx b be ld le l lf lg">// reduce does not box on IntStream<br/>int sumReduce = <br/>    intStream.reduce(Integer::sum).getAsInt();<br/><br/>Assertions.assertEquals(15, sumReduce);</span></pre><p id="62d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">总和</strong> ( <code class="du ju jv jw jx b">IntStream</code> / <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/IntList.html" rel="noopener ugc nofollow" target="_blank">IntList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="c34a" class="lc jz hi jx b be ld le l lf lg">int sum1 = intStream.sum();<br/><br/>Assertions .assertEquals(15, sum1);<br/><br/>long sum2 = intList.sum();<br/><br/>Assertions.assertEquals(15, sum2);</span></pre><p id="1d76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显然，<code class="du ju jv jw jx b">IntStream</code>和<code class="du ju jv jw jx b">IntList</code>上可用的<code class="du ju jv jw jx b">sum</code>方法是最简单的解决方案。与<code class="du ju jv jw jx b">IntList</code>的微小区别是结果被扩大为<code class="du ju jv jw jx b">long</code>，这意味着您可以添加非常大的<code class="du ju jv jw jx b">int</code>值而不会溢出。</p><h2 id="fa1c" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">汇总整数数组</h2><p id="fd29" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">当我们使用Java 8中添加的<code class="du ju jv jw jx b">IntSummaryStatistics</code>类进行汇总时，我们得到的是同时计算的<code class="du ju jv jw jx b">count</code>、<code class="du ju jv jw jx b">sum</code>、<code class="du ju jv jw jx b">min</code>、<code class="du ju jv jw jx b">max</code>和<code class="du ju jv jw jx b">average</code>。这样可以避免多次迭代。我们将使用和以前一样的数据。</p><p id="ee6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为循环</strong></p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="bc53" class="lc jz hi jx b be ld le l lf lg">IntSummaryStatistics statsForLoop = new IntSummaryStatistics();<br/>for (int i = 0; i &lt; ints.length; i++)<br/>{<br/>    statsForLoop.accept(ints[i]);<br/>}<br/><br/>Assertions.assertEquals(15, statsForLoop.getSum());<br/>Assertions.assertEquals(1, statsForLoop.getMin());<br/>Assertions.assertEquals(5, statsForLoop.getMax());</span></pre><p id="25ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">forEach</strong>(<code class="du ju jv jw jx b">IntStream</code>)/<strong class="ih hj">each</strong>(<code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/IntList.html" rel="noopener ugc nofollow" target="_blank">IntList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="763e" class="lc jz hi jx b be ld le l lf lg">IntSummaryStatistics statsForEach = new IntSummaryStatistics();<br/>intStream.forEach(statsForEach::accept);<br/><br/>Assertions.assertEquals(15, statsForEach.getSum());<br/>Assertions.assertEquals(1, statsForEach.getMin());<br/>Assertions.assertEquals(5, statsForEach.getMax());<br/><br/>IntSummaryStatistics statsEach = new IntSummaryStatistics();<br/>intList.each(statsEach::accept);<br/><br/>Assertions.assertEquals(15, statsEach.getSum());<br/>Assertions.assertEquals(1, statsEach.getMin());<br/>Assertions.assertEquals(5, statsEach.getMax());</span></pre><p id="09bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注射液</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/IntList.html" rel="noopener ugc nofollow" target="_blank">IntList</a></code></p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="6d65" class="lc jz hi jx b be ld le l lf lg">IntSummaryStatistics statsInject =<br/>        intList.injectInto(<br/>            new IntSummaryStatistics(), <br/>            (iss, each) -&gt; {iss.accept(each); return iss;});<br/><br/>Assertions.assertEquals(15, statsInject.getSum());<br/>Assertions.assertEquals(1, statsInject.getMin());<br/>Assertions.assertEquals(5, statsInject.getMax());</span></pre><p id="07d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">收藏</strong> ( <code class="du ju jv jw jx b">IntStream</code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="2f73" class="lc jz hi jx b be ld le l lf lg">IntSummaryStatistics statsCollect =<br/>        intStream.collect(<br/>            IntSummaryStatistics::new, <br/>            IntSummaryStatistics::accept, <br/>            IntSummaryStatistics::combine);<br/><br/>Assertions.assertEquals(15, statsCollect.getSum());<br/>Assertions.assertEquals(1, statsCollect.getMin());<br/>Assertions.assertEquals(5, statsCollect.getMax());</span></pre><p id="710a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:我不能使用<code class="du ju jv jw jx b">reduce</code>，因为两个参数必须是同一类型。我不得不使用<code class="du ju jv jw jx b">collect</code>来代替，这是一个可变的归约。原语流上的<code class="du ju jv jw jx b">collect</code>方法不采用<code class="du ju jv jw jx b">Collector</code>，而是采用<code class="du ju jv jw jx b">Supplier</code>、<code class="du ju jv jw jx b">ObjectIntConsumer</code>(累加器)和<code class="du ju jv jw jx b">BiConsumer</code>(合并器)。</p><p id="1351" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">汇总统计</strong> ( <code class="du ju jv jw jx b">IntStream</code> / <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/IntList.html" rel="noopener ugc nofollow" target="_blank">IntList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="81cf" class="lc jz hi jx b be ld le l lf lg">IntSummaryStatistics stats1 = intStream.summaryStatistics();<br/><br/>Assertions.assertEquals(15, stats1.getSum());<br/>Assertions.assertEquals(1, stats1.getMin());<br/>Assertions.assertEquals(5, stats1.getMax());<br/><br/>IntSummaryStatistics stats2 = intList.summaryStatistics();<br/><br/>Assertions.assertEquals(15, stats2.getSum());<br/>Assertions.assertEquals(1, stats2.getMin());<br/>Assertions.assertEquals(5, stats2.getMax());</span></pre><p id="7f51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样，<code class="du ju jv jw jx b">summaryStatistics</code>方法是最简单的解决方案。</p><h2 id="4b79" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">对字符串数组的长度求和</h2><p id="6c0e" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">假设我们想对一个数组中的字符串长度求和。这种方法可以用来对一个对象的任何int属性求和。</p><p id="73e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们将使用的数据。</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="289f" class="lc jz hi jx b be ld le l lf lg">String[] words = {"The", "Quick", "Brown", "Fox", "jumps", "over", "the", <br/>    "lazy", "dog"};<br/><br/>Stream&lt;String&gt; stream = Stream.of(words);<br/><br/>ImmutableList&lt;String&gt; list = Lists.immutable.with(words);</span></pre><p id="9602" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为</strong>循环<strong class="ih hj">为</strong></p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="863f" class="lc jz hi jx b be ld le l lf lg">int sumForLoop = 0;<br/>for (int i = 0; i &lt; words.length; i++)<br/>{<br/>    sumForLoop += words[i].length();<br/>}<br/><br/>Assertions.assertEquals(35, sumForLoop);</span></pre><p id="b2b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为</strong>每个<strong class="ih hj">为</strong> ( <code class="du ju jv jw jx b">Stream</code> ) / <strong class="ih hj">每个</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="71da" class="lc jz hi jx b be ld le l lf lg">int[] sumForEach = {0};<br/>stream.forEach(e -&gt; sumForEach[0] += e.length());<br/><br/>Assertions.assertEquals(35, sumForEach[0]);<br/><br/>int[] sumEach = {0};<br/>list.each(e -&gt; sumEach[0] += e.length());<br/><br/>Assertions.assertEquals(35, sumEach[0]);</span></pre><p id="7d06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">采集剂</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code> )+ <strong class="ih hj">注射液</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/IntList.html" rel="noopener ugc nofollow" target="_blank">IntList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="623c" class="lc jz hi jx b be ld le l lf lg">int sumInject = list<br/>        .collectInt(String::length)<br/>        .injectInto(Integer.valueOf(0), Integer::sum)<br/>        .intValue();<br/><br/>Assertions.assertEquals(35, sumInject);</span></pre><p id="2ee8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">收</strong> ( <code class="du ju jv jw jx b">Stream</code> ) + <strong class="ih hj">减</strong> ( <code class="du ju jv jw jx b">Collectors</code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="0072" class="lc jz hi jx b be ld le l lf lg">int sumReducing = <br/>    stream.collect(Collectors.reducing(0,<br/>                String::length,<br/>                Integer::sum)).intValue();<br/><br/>Assertions.assertEquals(35, sumReduce);</span></pre><p id="2af1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">mapToInt</strong>(<code class="du ju jv jw jx b">Stream</code>)+<strong class="ih hj">Reduce</strong>(<code class="du ju jv jw jx b">IntStream</code></p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="a4c9" class="lc jz hi jx b be ld le l lf lg">int sumReduce = stream<br/>        .mapToInt(String::length)<br/>        .reduce(Integer::sum)<br/>        .getAsInt();<br/><br/>Assertions.assertEquals(35, sumReduce);</span></pre><p id="f6c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">映射输入</strong> ( <code class="du ju jv jw jx b">Stream</code> ) + <strong class="ih hj">总和</strong> ( <code class="du ju jv jw jx b">IntStream</code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="90af" class="lc jz hi jx b be ld le l lf lg">int sum1 = stream<br/>        .mapToInt(String::length)<br/>        .sum();<br/><br/>Assertions.assertEquals(35, sum1);</span></pre><p id="f3c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">集合</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code> ) + <strong class="ih hj">总和</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/IntList.html" rel="noopener ugc nofollow" target="_blank">IntList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="2455" class="lc jz hi jx b be ld le l lf lg">long sum2 = list<br/>        .collectInt(String::length)<br/>        .sum();<br/><br/>Assertions.assertEquals(35, sum2);</span></pre><p id="c386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">收集</strong> ( <code class="du ju jv jw jx b">Stream</code> ) + <strong class="ih hj">总和</strong> ( <code class="du ju jv jw jx b">Collectors</code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="20b5" class="lc jz hi jx b be ld le l lf lg">Integer summingInt = stream<br/>    .collect(Collectors.summingInt(String::length));<br/><br/>Assertions.assertEquals(35, summingInt.intValue());</span></pre><p id="78dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> sumOfInt </strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="7771" class="lc jz hi jx b be ld le l lf lg">long sumOfInt = list.sumOfInt(String::length);<br/><br/>Assertions.assertEquals(35, sumOfInt);</span></pre><p id="f202" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我认为在这些例子中，<code class="du ju jv jw jx b">sumOfInt</code>是最简单的解决方案。</p><h2 id="32d3" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">对按第一个字符分组的字符串的长度求和</h2><p id="7a92" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在这个问题中，我们将根据字符串的第一个字符和每个字符的长度对字符串进行分组。如果可能的话，我更喜欢在这里使用原始贴图进行分组。</p><p id="f898" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是数据。</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="b309" class="lc jz hi jx b be ld le l lf lg">String[] words = {"The", "Quick", "Brown", "Fox", "jumps", "over", "the", <br/>    "lazy", "dog"};<br/><br/>Stream&lt;String&gt; stream = Stream.of(words).map(String::toLowerCase);<br/><br/>ImmutableList&lt;String&gt; list =<br/>    Lists.immutable.with(words).collect(String::toLowerCase);</span></pre><p id="e781" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分别使用<code class="du ju jv jw jx b">map</code>和<code class="du ju jv jw jx b">collect</code>将<code class="du ju jv jw jx b">Stream</code>和<code class="du ju jv jw jx b">ImmutableList</code>字符串转换成小写。在for循环示例中，我们将手动执行此操作。</p><p id="f867" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为</strong>循环<strong class="ih hj">为</strong></p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="7816" class="lc jz hi jx b be ld le l lf lg">MutableCharIntMap sumByForLoop = new CharIntHashMap();<br/>for (int i = 0; i &lt; words.length; i++)<br/>{<br/>    String word = words[i].toLowerCase();<br/>    sumByForLoop.addToValue(word.charAt(0), word.length());<br/>}<br/><br/>Assertions.assertEquals(35, sumByForLoop.values().sum());<br/>Assertions.assertEquals(6, sumByForLoop.get('t'));</span></pre><p id="6f00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为</strong>每个<strong class="ih hj">为</strong> ( <code class="du ju jv jw jx b">Stream</code> ) / <strong class="ih hj">每个</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="0582" class="lc jz hi jx b be ld le l lf lg">MutableCharIntMap sumByForEach = new CharIntHashMap();<br/>stream.forEach(e -&gt; sumByForEach.addToValue(e.charAt(0), e.length()));<br/><br/>Assertions.assertEquals(35, sumByForEach.values().sum());<br/>Assertions.assertEquals(6, sumByForEach.get('t'));<br/><br/>MutableCharIntMap sumByEach = new CharIntHashMap();<br/>list.each(e -&gt; sumByEach.addToValue(e.charAt(0), e.length()));<br/><br/>Assertions.assertEquals(35, sumByEach.values().sum());<br/>Assertions.assertEquals(6, sumByEach.get('t'));</span></pre><p id="8a13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注入</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/primitive/ImmutableIntList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="627d" class="lc jz hi jx b be ld le l lf lg">MutableCharIntMap sumByInject =<br/>        list.injectInto(<br/>                new CharIntHashMap(),<br/>                (map, each) -&gt; {<br/>                    map.addToValue(each.charAt(0), each.length());<br/>                    return map;<br/>                });<br/><br/>Assertions.assertEquals(35, sumByInject.values().sum());<br/>Assertions.assertEquals(6, sumByInject.get('t'));</span></pre><p id="3ac5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">减少</strong> ( <code class="du ju jv jw jx b">Stream</code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="cea4" class="lc jz hi jx b be ld le l lf lg">MutableCharIntMap sumByReduce = stream<br/>        .reduce(<br/>                new CharIntHashMap(),<br/>                (map, e) -&gt; {<br/>                    map.addToValue(e.charAt(0), e.length());<br/>                    return map;<br/>                },<br/>                (map1, map2) -&gt; {<br/>                    map1.putAll(map2);<br/>                    return map1;<br/>                });<br/><br/>Assertions.assertEquals(35, sumByReduce.values().sum());<br/>Assertions.assertEquals(6, sumByReduce.get('t'));</span></pre><p id="d92c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">聚合者</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="112d" class="lc jz hi jx b be ld le l lf lg">ImmutableMap&lt;Character, Long&gt; aggregateBy = list.aggregateBy(<br/>        word -&gt; word.charAt(0),<br/>        () -&gt; new Long(0),<br/>        (sum, each) -&gt; sum + each.length());<br/><br/>Assertions.assertEquals(35,<br/>    aggregateBy.valuesView().sumOfLong(Long::longValue));<br/>Assertions.assertEquals(6, aggregateBy.get('t').longValue());</span></pre><p id="9016" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">聚集地点由</strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="5110" class="lc jz hi jx b be ld le l lf lg">ImmutableMap&lt;Character, LongAdder&gt; aggregateInPlaceBy = <br/>        list.aggregateInPlaceBy(<br/>                word -&gt; word.charAt(0),<br/>                LongAdder::new,<br/>                (adder, each) -&gt; adder.add(each.length()));<br/><br/>Assertions.assertEquals(35,<br/>    aggregateInPlaceBy.valuesView().sumOfLong(LongAdder::longValue));<br/>Assertions.assertEquals(6, aggregateInPlaceBy.get('t').longValue());</span></pre><p id="891a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">收藏</strong> ( <code class="du ju jv jw jx b">Stream</code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="9bcd" class="lc jz hi jx b be ld le l lf lg">MutableCharIntMap sumByCollect = stream.collect(<br/>        CharIntHashMap::new,<br/>        (map, e) -&gt; map.addToValue(e.charAt(0), e.length()),<br/>        CharIntHashMap::putAll);<br/><br/>Assertions.assertEquals(35, sumByCollect.values().sum());<br/>Assertions.assertEquals(6, sumByCollect.get('t'));</span></pre><p id="3ddb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">收集</strong> ( <code class="du ju jv jw jx b">Stream</code> ) + <strong class="ih hj">分组，按</strong> ( <code class="du ju jv jw jx b">Collectors</code> ) + <strong class="ih hj">求和</strong> ( <code class="du ju jv jw jx b">Collectors</code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="208f" class="lc jz hi jx b be ld le l lf lg">Map&lt;Character, Integer&gt; sumByCollectSummingInt =<br/>        stream.collect(Collectors.groupingBy(<br/>                        word -&gt; word.charAt(0),<br/>                        Collectors.summingInt(String::length)));<br/>Assertions.assertEquals(35,<br/>    sumByCollectSummingInt.values()<br/>        .stream().mapToInt(Integer::intValue).sum());<br/>Assertions.assertEquals(Integer.valueO(6), sumByCollectSummingInt.get('t'));</span></pre><p id="208c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">收藏</strong>(<code class="du ju jv jw jx b">Stream</code>)+<strong class="ih hj">sumByInt</strong>(<code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/impl/collector/Collectors2.html" rel="noopener ugc nofollow" target="_blank">Collectors2</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="06e6" class="lc jz hi jx b be ld le l lf lg">ObjectLongMap&lt;Character&gt; sumByCollectors2 =<br/>        stream.collect(<br/>                Collectors2.sumByInt(<br/>                    word -&gt; word.charAt(0), String::length));<br/><br/>Assertions.assertEquals(35, sumByCollectors2.values().sum());<br/>Assertions.assertEquals(6, sumByCollectors2.get('t'));</span></pre><p id="6e3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">reduce in place</strong>(<code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code>)+<strong class="ih hj">sumByInt</strong>(<code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/impl/collector/Collectors2.html" rel="noopener ugc nofollow" target="_blank">Collectors2</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="9005" class="lc jz hi jx b be ld le l lf lg">ObjectLongMap&lt;Character&gt; reduceInPlaceCollectors2 =<br/>        list.reduceInPlace(<br/>                Collectors2.sumByInt(<br/>                    e -&gt; e.charAt(0), String::length));<br/><br/>Assertions.assertEquals(35, reduceInPlaceCollectors2.values().sum());<br/>Assertions.assertEquals(6, reduceInPlaceCollectors2.get('t'));</span></pre><p id="9817" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> sumByInt </strong> ( <code class="du ju jv jw jx b"><a class="ae jt" href="https://www.eclipse.org/collections/javadoc/11.1.0/org/eclipse/collections/api/list/ImmutableList.html" rel="noopener ugc nofollow" target="_blank">ImmutableList</a></code>)</p><pre class="je jf jg jh fd ky jx kz bn la lb bi"><span id="b354" class="lc jz hi jx b be ld le l lf lg">ObjectLongMap&lt;Character&gt; sumByInt =<br/>        list.sumByInt(e -&gt; e.charAt(0), String::length);<br/><br/>Assertions.assertEquals(35, sumByInt.values().sum());<br/>Assertions.assertEquals(6, sumByInt.get('t'));</span></pre><p id="7c64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里最简单的解决方法是<code class="du ju jv jw jx b">sumByInt</code>。</p><h1 id="704e" class="lh jz hi bd ka li lj lk ke ll lm ln ki lo lp lq kl lr ls lt ko lu lv lw kr lx bi translated">结论</h1><p id="65ac" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">我们已经介绍了许多不同的方法，您可以使用Java和Eclipse集合来获取<code class="du ju jv jw jx b">sum</code>或<code class="du ju jv jw jx b">summarize</code>值。在求和的情况下，使用名称中带有sum的方法可能会给出最简单的解决方案。使用像<code class="du ju jv jw jx b">injectInto</code>和<code class="du ju jv jw jx b">reduceInPlace</code> (Eclipse集合)或collect (Java流)这样的方法，几乎可以解决任何问题。当你的结果需要不同于你的输入时，像<code class="du ju jv jw jx b">reduce</code>这样的方法就没那么有用了。像<code class="du ju jv jw jx b">aggregateBy</code>和<code class="du ju jv jw jx b">aggregateInPlaceBy</code>这样的方法给你一个比<code class="du ju jv jw jx b">collect</code>更具体的结果，因为它们总是返回一个<code class="du ju jv jw jx b">Map</code>。如果您想迭代一个<code class="du ju jv jw jx b">Stream</code>并使用<code class="du ju jv jw jx b">collect</code>轻松获得原始地图结果，使用<code class="du ju jv jw jx b">Collectors2</code>会很有帮助。</p><p id="3849" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ly">我是</em><a class="ae jt" href="https://projects.eclipse.org/projects/technology.collections" rel="noopener ugc nofollow" target="_blank"><em class="ly">Eclipse Foundation</em></a><em class="ly">的</em><a class="ae jt" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"><em class="ly">Eclipse Collections</em></a><em class="ly">OSS项目的项目负责人。</em> <a class="ae jt" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> <em class="ly">月食收藏</em> </a> <em class="ly">为</em> <a class="ae jt" href="https://github.com/eclipse/eclipse-collections/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank"> <em class="ly">投稿</em> </a> <em class="ly">打开。如果你喜欢这个库，你可以在GitHub上让我们知道。</em></p></div></div>    
</body>
</html>