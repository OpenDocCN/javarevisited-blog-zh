<html>
<head>
<title>Demystifying Google Container Tool, Jib: Java Image Builder</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭秘Google容器工具Jib: Java Image Builder</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/demystifying-google-container-tool-jib-java-image-builder-583badfe1ba?source=collection_archive---------0-----------------------#2021-01-21">https://medium.com/javarevisited/demystifying-google-container-tool-jib-java-image-builder-583badfe1ba?source=collection_archive---------0-----------------------#2021-01-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if"><p id="6b00" class="ig ih hi bd ii ij ik il im in io ip dx translated">本文涵盖了由容器映像构建器Jib创建的映像分层的一些内部内容，并探讨了什么是发行版映像及其优点。</p></blockquote><figure class="ir is it iu iv iw er es paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="er es iq"><img src="../Images/1c80270a26bc32249f61dcaf904348a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bUPfhx2y0ShNJ45o"/></div></div><p class="jd je et er es jf jg bd b be z dx translated">由<a class="ae jh" href="https://unsplash.com/@kjarrett?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯文·杰瑞特</a>在<a class="ae jh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6b94" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">你想知道Jib是什么吗？。在继续之前，你也许应该读一读我以前的文章。</p><div class="kf kg ez fb kh ki"><a href="https://ashishtechmill.com/containerizing-spring-boot-application-with-jib" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hj fi z dy kn ea eb ko ed ef hh bi translated">用Jib集装箱化Spring Boot应用</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">在本帖中，我们将了解如何创建docker或OCI投诉图片，而无需安装任何docker客户端或…</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">ashishtechmill.com</p></div></div><div class="kr l"><div class="ks l kt ku kv kr kw jb ki"/></div></div></a></div><p id="56da" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">对于对Java应用程序的容器化感兴趣，但对创建和维护Dockerfile或安装<a class="ae jh" rel="noopener" href="/javarevisited/top-15-online-courses-to-learn-docker-kubernetes-and-aws-for-fullstack-developers-and-devops-d8cc4f16e773"> Docker </a>不感兴趣的Java开发人员来说，Jib是一个优秀的工具。</p><p id="da86" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">一个Java开发者可以给<a class="ae jh" rel="noopener" href="/javarevisited/6-best-maven-courses-for-beginners-in-2020-23ea3cba89"> Maven </a>或者<a class="ae jh" rel="noopener" href="/javarevisited/5-best-gradle-courses-and-books-to-learn-in-2021-93f49ce8ff8e"> Gradle </a>添加一个插件，就这样。你不需要学习新技术来封装你的Java应用程序。现在来说一些内部情况。</p></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><h2 id="a0cc" class="le lf hi bd lg lh li lj lk ll lm ln lo jt lp lq lr jx ls lt lu kb lv lw lx ly bi translated">悬臂图像分层</h2><p id="43ee" class="pw-post-body-paragraph ji jj hi jk b jl lz jn jo jp ma jr js jt mb jv jw jx mc jz ka kb md kd ke ip hb bi translated">Jib智能地将您的映像分为以下几层，以进行更精细的增量构建。</p><ol class=""><li id="18d1" class="me mf hi jk b jl jm jp jq jt mg jx mh kb mi ip mj mk ml mm bi translated">属国</li><li id="8c50" class="me mf hi jk b jl mn jp mo jt mp jx mq kb mr ip mj mk ml mm bi translated">资源</li><li id="6291" class="me mf hi jk b jl mn jp mo jt mp jx mq kb mr ip mj mk ml mm bi translated">班级</li><li id="fd66" class="me mf hi jk b jl mn jp mo jt mp jx mq kb mr ip mj mk ml mm bi translated">快照依赖关系</li><li id="3ee1" class="me mf hi jk b jl mn jp mo jt mp jx mq kb mr ip mj mk ml mm bi translated">所有其他依赖项</li><li id="0fb7" class="me mf hi jk b jl mn jp mo jt mp jx mq kb mr ip mj mk ml mm bi translated">每个额外的目录(<code class="du ms mt mu mv b">jib.extraDirectories</code>在Gradle中，<code class="du ms mt mu mv b">&lt;extraDirectories&gt;</code>在Maven中)构建到它自己的层</li></ol><figure class="mx my mz na fd iw er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/11/why-devops-engineer-learn-docker-kubernetes.html#axzz6dXsEfLvJ"><div class="er es mw"><img src="../Images/2b157770381869c31b53252e68e6a819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*Lf3PRWTHiv-06r1bhVvlFg.png"/></div></a><p class="jd je et er es jf jg bd b be z dx translated">悬臂普通层</p></figure><p id="eea2" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">当您进行任何代码更改时，只会重新生成您的更改，而不是整个应用程序。这意味着Jib只推动发生变化的层，其余的层保持不变。</p><p id="85a2" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">例如，在下面的演示中，只修改了一个类文件，Jib只推送编译后的类层。后来，我们可以看到，在docker提取过程中，只提取了已更改的图层。</p><figure class="mx my mz na fd iw er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/03/top-20-skills-java-developers-can-learn.html#axzz6k4XBgTw4"><div class="er es nb"><img src="../Images/5f8d9f6f385c482e7080a88e3907ed2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aHuwLSLVZUlivSB_7Zn9KQ.gif"/></div></a><p class="jd je et er es jf jg bd b be z dx translated">动臂</p></figure><p id="3fda" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">此外，为了更深入地挖掘，现在我们将使用在以前的<a class="ae jh" rel="noopener" href="/javarevisited/containerizing-springboot-application-with-jib-716daa3e0850">文章</a>中使用的简单的spring boot应用程序。源代码可在<a class="ae jh" href="https://github.com/yrashish/spring-boot-jib" rel="noopener ugc nofollow" target="_blank">这里</a>获得。我们将在调试模式下运行maven来理解这些层。然而，在下面的日志中，您将只看到依赖项、资源和类作为单独的层，因为我们没有其他的依赖项。</p><figure class="mx my mz na fd iw"><div class="bz dy l di"><div class="nc nd l"/></div><p class="jd je et er es jf jg bd b be z dx translated">Maven调试日志</p></figure></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><h2 id="0761" class="le lf hi bd lg lh li lj lk ll lm ln lo jt lp lq lr jx ls lt lu kb lv lw lx ly bi translated">深潜图像层</h2><p id="5fb0" class="pw-post-body-paragraph ji jj hi jk b jl lz jn jo jp ma jr js jt mb jv jw jx mc jz ka kb md kd ke ip hb bi translated">您可以使用<a class="ae jh" href="https://github.com/wagoodman/dive" rel="noopener ugc nofollow" target="_blank">潜水</a>工具检查Jib创建的图像。正如您在RHS上看到的，我们在下面的路径中展开了类、资源和依赖项的目录结构，它们的大小非常小。</p><p id="a22e" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated"><code class="du ms mt mu mv b">/apps/classes,/apps/libs,/apps/resources</code></p><p id="bebb" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">其余的内容是你的基本形象。</p><figure class="mx my mz na fd iw er es paragraph-image"><a href="https://www.java67.com/2020/07/top-5-courses-to-learn-linux-in-depth.html"><div class="er es ne"><img src="../Images/2dfb95fc8f1dd6a1d8072b3e4e2f0e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2KuFLuF0M3VGtFRDOZFDQ.png"/></div></a><p class="jd je et er es jf jg bd b be z dx translated">深潜悬臂图像层</p></figure><p id="5b89" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">Dive还会告诉你是否在浪费空间，如果是的话，你可以想办法缩小你的<a class="ae jh" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-maven-jenkins-and-docker-for-java-developers-51fa7a1e66f6?source=collection_home---4------3-----------------------">码头工人/OCI形象</a>的尺寸。然而，在我们的例子中，没有浪费空间:)。！</p><p id="802b" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">您也可以使用<strong class="jk hj"> docker history </strong>命令查看图像内容。让我们看看它是什么样子的。</p><figure class="mx my mz na fd iw er es paragraph-image"><a href="https://javarevisited.blogspot.com/2019/05/top-5-courses-to-learn-docker-and-kubernetes-for-devops.html"><div class="er es nf"><img src="../Images/49e5771a8788a159fd247487d39226dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*LDxPPdjkfzUnMnnExyPPuA.png"/></div></a><p class="jd je et er es jf jg bd b be z dx translated">图像内容</p></figure></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><h2 id="0d45" class="le lf hi bd lg lh li lj lk ll lm ln lo jt lp lq lr jx ls lt lu kb lv lw lx ly bi translated">什么是发行版映像？</h2><p id="22b0" class="pw-post-body-paragraph ji jj hi jk b jl lz jn jo jp ma jr js jt mb jv jw jx mc jz ka kb md kd ke ip hb bi translated">谷歌对无发行版图片的定义如下:</p><blockquote class="ng nh ni"><p id="d0c9" class="ji jj nj jk b jl jm jn jo jp jq jr js nk ju jv jw nl jy jz ka nm kc kd ke ip hb bi translated">发行版映像是轻量级的基础映像，因为它们只包含运行应用程序所需的依赖项。它们不包含包管理器、shells或任何其他您期望在标准Linux发行版中找到的程序。</p></blockquote><p id="29ab" class="pw-post-body-paragraph ji jj hi jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke ip hb bi translated">此外，Jib创建的层是在<a class="ae jh" href="https://github.com/GoogleCloudPlatform/distroless" rel="noopener ugc nofollow" target="_blank">发行版</a>基础映像的顶部创建的。Jib默认使用distrolles<a class="ae jh" rel="noopener" href="/hackernoon/top-5-java-8-courses-to-learn-online-2db57d9dfb8d">Java 8</a>镜像，但是你可以选择你喜欢的镜像。</p></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><h2 id="cd5d" class="le lf hi bd lg lh li lj lk ll lm ln lo jt lp lq lr jx ls lt lu kb lv lw lx ly bi translated">为什么是Distroless？</h2><ol class=""><li id="7590" class="me mf hi jk b jl lz jp ma jt nn jx no kb np ip mj mk ml mm bi translated">需要修补的漏洞更少</li><li id="f515" class="me mf hi jk b jl mn jp mo jt mp jx mq kb mr ip mj mk ml mm bi translated">更好的安全性</li><li id="f433" class="me mf hi jk b jl mn jp mo jt mp jx mq kb mr ip mj mk ml mm bi translated">以最少的依赖性构建</li></ol></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><h2 id="130b" class="le lf hi bd lg lh li lj lk ll lm ln lo jt lp lq lr jx ls lt lu kb lv lw lx ly bi translated">调试发行版映像</h2><p id="b967" class="pw-post-body-paragraph ji jj hi jk b jl lz jn jo jp ma jr js jt mb jv jw jx mc jz ka kb md kd ke ip hb bi translated">因为没有安装包管理器，你不能对你的容器使用ssh，所以运行无发行版的基础映像使得它们很难调试。在理想情况下，您应该添加更好的日志记录，然后为容器启用shell访问。但是有一些方法可以让你添加外壳支持和调试你的应用程序。</p></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><h2 id="1b36" class="le lf hi bd lg lh li lj lk ll lm ln lo jt lp lq lr jx ls lt lu kb lv lw lx ly bi translated">结论</h2><p id="2919" class="pw-post-body-paragraph ji jj hi jk b jl lz jn jo jp ma jr js jt mb jv jw jx mc jz ka kb md kd ke ip hb bi translated">在这篇文章中，我们已经介绍了Jib的一些内部知识，例如图像分层，这使得它很快。我们还讨论了发行版映像的优点和缺陷，比如调试。</p><h2 id="5df5" class="le lf hi bd lg lh li lj lk ll lm ln lo jt lp lq lr jx ls lt lu kb lv lw lx ly bi translated">支持我</h2><p id="e5b4" class="pw-post-body-paragraph ji jj hi jk b jl lz jn jo jp ma jr js jt mb jv jw jx mc jz ka kb md kd ke ip hb bi translated">如果你喜欢你刚刚读的，那么你可以给我买杯咖啡。</p><figure class="mx my mz na fd iw er es paragraph-image"><a href="https://www.buymeacoffee.com/meashish"><div class="er es nq"><img src="../Images/883994fb2cde2cb170202b796dac9bb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*zpLAgysjoDBd4fxu.png"/></div></a></figure><h2 id="cbac" class="le lf hi bd lg lh li lj lk ll lm ln lo jt lp lq lr jx ls lt lu kb lv lw lx ly bi translated">进一步阅读</h2><p id="d77a" class="pw-post-body-paragraph ji jj hi jk b jl lz jn jo jp ma jr js jt mb jv jw jx mc jz ka kb md kd ke ip hb bi translated">你可以在我的博客上继续阅读我以前的一些文章。</p><div class="kf kg ez fb kh ki"><a href="https://ashishtechmill.com/" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hj fi z dy kn ea eb ko ed ef hh bi translated">阿什什·乔杜里</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">我是一名软件工程师和技术作家，热爱Java、Spring Boot、DevOps和云。</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">ashishtechmill.com</p></div></div><div class="kr l"><div class="nr l kt ku kv kr kw jb ki"/></div></div></a></div><div class="kf kg ez fb kh ki"><a href="https://ashishtechmill.com/running-kubernetes-application-on-docker-desktop-for-mac" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hj fi z dy kn ea eb ko ed ef hh bi translated">在Mac版Docker桌面上运行Kubernetes应用程序</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">在这篇短文中，我将解释如何在Mac版Docker桌面上启用Kubernetes并进行部署…</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">ashishtechmill.com</p></div></div><div class="kr l"><div class="ns l kt ku kv kr kw jb ki"/></div></div></a></div></div></div>    
</body>
</html>