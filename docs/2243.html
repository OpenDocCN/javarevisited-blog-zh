<html>
<head>
<title>How about using @Async?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用@Async怎么样？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/how-about-using-async-c0ae1cb7b5fd?source=collection_archive---------0-----------------------#2022-07-12">https://medium.com/javarevisited/how-about-using-async-c0ae1cb7b5fd?source=collection_archive---------0-----------------------#2022-07-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="05c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有助于用Spring Boot和Java构建异步执行的注释</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://javarevisited.blogspot.com/2021/12/what-is-springboottest-annotation-in.html"><div class="er es jd"><img src="../Images/85c440516637a7a250b5f8e1dc62af9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UbCy1hKRLPOOAHeGXtfoNA.jpeg"/></div></a></figure><p id="115d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，官方文件就在这里【https://spring.io/guides/gs/async-method/ T2】</p><p id="750f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个例子中，我使用了Spring Boot 2.7.1和Java 11。</p><p id="8e95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有时我们可以在程序内部做一些动作，而不必等到程序结束。在这种情况下，您可以使用注释@Async。</p><p id="9a52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">当你把@Async放在一个方法上，这意味着这个方法将在一个单独的线程中执行，调用者不会等待这个叫做</strong>的方法完成。</p><h2 id="43b7" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">给我看看代码</h2><p id="a257" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">我们如何实现这一点？</p><p id="abf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这边走:</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="36a4" class="jm jn hi kn b fi kr ks l kt ku"><strong class="kn hj">@EnableAsync</strong><br/>@SpringBootApplication<br/>public class DemoApplication {<br/><br/>   public static void main(String[] args) {<br/>      SpringApplication.<em class="kv">run</em>(DemoApplication.class, args);<br/>   }<br/><br/>}</span></pre><p id="539c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kw kx ky kn b">@EnableAsyn</code>显示<a class="ae jl" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-spring-framework-for-java-developers-639db9348d25"> Spring </a>存在一些@Async注释的方法。如果需要，您可以创建一个配置类。</p><p id="9a9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以编写这样的代码:</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="ab3b" class="jm jn hi kn b fi kr ks l kt ku">import org.springframework.scheduling.annotation.Async;<br/>import org.springframework.scheduling.annotation.AsyncResult;<br/>import org.springframework.stereotype.Service;<br/><br/>import java.time.LocalDateTime;<br/><br/>@Service<br/>public class ExampleService {<br/><br/>    @Async<br/>    public void execute() {<br/>        try {<br/>            Thread.<em class="kv">sleep</em>(10000);<br/>            System.<em class="kv">out</em>.println(LocalDateTime.<em class="kv">now</em>() + " | test finished");<br/>        } catch (Exception e) {<br/>            e.printStackTrace();<br/>        }<br/>    }<br/>    <br/>}</span></pre><p id="efb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们称这个方法为:</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="bdb3" class="jm jn hi kn b fi kr ks l kt ku">import org.springframework.web.bind.annotation.GetMapping;<br/>import org.springframework.web.bind.annotation.RestController;<br/><br/>@RestController<br/>public class TestController {<br/><br/>    private final ExampleService exampleService;<br/><br/>    public TestController(ExampleService exampleService) {<br/>        this.exampleService = exampleService;<br/>    }<br/><br/>    @GetMapping("test-async")<br/>    public String test(){<br/>        exampleService.execute();<br/>        System.<em class="kv">out</em>.println("executing final of request before the method execute()");<br/>        return "ok";<br/>    }<br/><br/>}</span></pre><p id="f8c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae jl" href="http://localhost:8080/async-test" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/async-test</a>上查看GET请求的结果</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://javarevisited.blogspot.com/2022/02/how-to-fix-autowired-no-qualifying-bean.html"><div class="er es kz"><img src="../Images/7ac901ed741014c585fd2c37de2b8090.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJS8ZOa3ihYFJEqNFn59DQ.png"/></div></a></figure><p id="a770" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“在方法执行之前执行最终请求”向我们展示了控制器方法没有等到控制器方法完成。</p><p id="4366" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个有趣的用例:</p><ul class=""><li id="1818" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated"><a class="ae jl" href="https://www.java67.com/2018/01/4-examples-to-send-email-with.html" rel="noopener ugc nofollow" target="_blank">在请求期间发送电子邮件</a>,无需等待流程终止</li></ul><h2 id="0945" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">深入</h2><p id="b759" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated"><strong class="ih hj">异步结果类</strong></p><p id="6b20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我创建了一个void方法，但是如果你必须处理一些结果，你可以使用AsyncResult类并对返回做一些事情。</p><p id="b93e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将修改这段代码并登录<a class="ae jl" href="https://javarevisited.blogspot.com/2022/05/how-to-return-json-xml-or-thymeleaf-.html" rel="noopener ugc nofollow" target="_blank">控制器类</a>返回方法<em class="kv"> execute()。</em></p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="46ee" class="jm jn hi kn b fi kr ks l kt ku">import java.time.LocalDateTime;<br/>import java.util.concurrent.Future;<br/><br/>@Service<br/>public class ExampleService {<br/><br/>    @Async<br/>    public Future&lt;String&gt; execute() {<br/>        try {<br/>            Thread.<em class="kv">sleep</em>(10000);<br/>            var response = new AsyncResult&lt;String&gt;(LocalDateTime.<em class="kv">now</em>() + " | test finished");<br/>            System.<em class="kv">out</em>.println(response.get());<br/>            return response;<br/>        } catch (Exception e) {<br/>            e.printStackTrace();<br/>            return null;<br/>        }<br/>    }<br/><br/>}</span></pre><p id="edb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AsyncResult实现接口Future，菱形可以是任何对象。</p><p id="814a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">控制器类别:</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="f66e" class="jm jn hi kn b fi kr ks l kt ku">import org.springframework.web.bind.annotation.GetMapping;<br/>import org.springframework.web.bind.annotation.RestController;<br/><br/>import java.time.LocalDateTime;<br/><br/>@RestController<br/>public class TestController {<br/><br/>    private final ExampleService exampleService;<br/><br/>    public TestController(ExampleService exampleService) {<br/>        this.exampleService = exampleService;<br/>    }<br/><br/>    @GetMapping("test-async")<br/>    public String test(){<br/>        try {<br/>            var response = exampleService.execute();<br/>            if(response.isDone()){<br/>                System.<em class="kv">out</em>.println("method execute finished");<br/>            } else {<br/>                System.<em class="kv">out</em>.println(LocalDateTime.<em class="kv">now</em>() + " method execute not finished");<br/>            }<br/>            return "ok";<br/>        } catch (Exception e) {<br/>            return "nok";<br/>        }<br/>    }<br/><br/>}</span></pre><p id="0f9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果是:</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://javarevisited.blogspot.com/2022/05/how-to-validate-incoming-payload-on-spring-.html"><div class="er es lj"><img src="../Images/4f32998b95ec8e05f9070e991c29e1d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cJYokojVewBvcrvIjsl2aA.png"/></div></a></figure><p id="275a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">响应是在方法<em class="kv"> execute() </em>完成之前发送的。</p><h2 id="ffed" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">异常处理</h2><p id="7c11" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">首先，我编写了一个实现AsyncUncaughtExceptionHandler的类:</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="b876" class="jm jn hi kn b fi kr ks l kt ku">import org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;<br/>import java.lang.reflect.Method;<br/><br/><br/>public class AsyncExceptionHandler implements AsyncUncaughtExceptionHandler {<br/><br/>    @Override<br/>    public void handleUncaughtException(Throwable throwable, Method method, Object... obj) {<br/>        System.<em class="kv">out</em>.println("Message from exception - " + throwable.getMessage());<br/>        System.<em class="kv">out</em>.println("Method name " + method.getName());<br/>    }<br/><br/>}</span></pre><p id="bb3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其次，我创建了一个配置类，并将注释<code class="du kw kx ky kn b">@EnableAsync</code>移动到这个类中，如下所示:</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="10c4" class="jm jn hi kn b fi kr ks l kt ku">import org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;<br/>import org.springframework.context.annotation.Configuration;<br/>import org.springframework.scheduling.annotation.AsyncConfigurer;<br/>import org.springframework.scheduling.annotation.EnableAsync;<br/><br/>@EnableAsync<br/>@Configuration<br/>public class AsyncConfig implements AsyncConfigurer {<br/><br/>    @Override<br/>    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {<br/>        return new AsyncExceptionHandler();<br/>    }<br/><br/>}</span></pre><p id="eccd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，这里我注册了AsyncExceptionHandler。</p><p id="680b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我用一个有目的的例外做了另一个方法:</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="13c6" class="jm jn hi kn b fi kr ks l kt ku">@Async<br/>public void executeWithException() throws Exception{<br/>    Thread.<em class="kv">sleep</em>(10000);<br/>    throw new Exception("Some exception");<br/>}</span></pre><p id="402e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后是<a class="ae jl" href="https://javarevisited.blogspot.com/2017/11/difference-between-component-service.html" rel="noopener ugc nofollow" target="_blank">控制器</a>:</p><pre class="je jf jg jh fd km kn ko kp aw kq bi"><span id="00be" class="jm jn hi kn b fi kr ks l kt ku">@GetMapping("test-async2")<br/>public String test2() throws Exception {<br/>    exampleService.executeWithException();<br/>    return "ok";<br/>}</span></pre><p id="d837" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果是:</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://www.java67.com/2021/10/3-ways-to-send-different-content-types.html"><div class="er es lk"><img src="../Images/c9af2e17b72df786d26c9d1b2b1d14d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*Gs1Q8nZUhg2wE97-l5PMDg.png"/></div></a></figure><p id="7a4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码在这里:<a class="ae jl" href="https://github.com/mmarcosab/async-example" rel="noopener ugc nofollow" target="_blank">https://github.com/mmarcosab/async-example</a></p><div class="ll lm ez fb ln lo"><a rel="noopener follow" target="_blank" href="/javarevisited/21-spring-mvc-rest-interview-questions-answers-for-beginners-and-experienced-developers-21ad3d4c9b82"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hj fi z dy lt ea eb lu ed ef hh bi translated">10大春季MVC + REST面试问题解答适合初学者和有经验的开发者</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">大家好。如果你正在准备Java和Spring面试或Spring认证，并经常寻找一些…</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">medium.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc jj lo"/></div></div></a></div><div class="ll lm ez fb ln lo"><a rel="noopener follow" target="_blank" href="/javarevisited/13-topics-you-should-prepare-for-your-next-spring-boot-interview-5f2993a04ff5"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hj fi z dy lt ea eb lu ed ef hh bi translated">你应该为2022年的下一次Spring Boot面试准备的13个话题</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">你应该为下一次Java和Spring Boot面试准备的13个基本主题的列表和学习资源…</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">medium.com</p></div></div><div class="lx l"><div class="md l lz ma mb lx mc jj lo"/></div></div></a></div><div class="ll lm ez fb ln lo"><a rel="noopener follow" target="_blank" href="/javarevisited/top-10-rest-interview-questions-for-java-and-spring-developers-1611e3b78029"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hj fi z dy lt ea eb lu ed ef hh bi translated">Java和Spring开发人员的10大REST面试问题</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">这些是Java和Spring开发者快速准备的最好的REST面试问题</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">medium.com</p></div></div><div class="lx l"><div class="me l lz ma mb lx mc jj lo"/></div></div></a></div></div></div>    
</body>
</html>