<html>
<head>
<title>HiveMQ Cloud, part 3 — Sending sensor data from Raspberry Pi Pico to HiveMQ Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HiveMQ云，第3部分—将传感器数据从Raspberry Pi Pico发送到HiveMQ云</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/hivemq-cloud-part-3-sending-sensor-data-from-raspberry-pi-pico-to-hivemq-cloud-5841ad0f999e?source=collection_archive---------3-----------------------#2021-12-17">https://medium.com/javarevisited/hivemq-cloud-part-3-sending-sensor-data-from-raspberry-pi-pico-to-hivemq-cloud-5841ad0f999e?source=collection_archive---------3-----------------------#2021-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e29e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本系列的前两篇文章中，我们在Raspberry Pi微型计算机上使用Java将传感器数据发送到HiveMQ Cloud，并在仪表板上可视化。</p><ul class=""><li id="d3cd" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><a class="ae jm" href="https://www.hivemq.com/blog/mqtt-raspberrypi-part01-sensor-data-hivemqcloud-java-pi4j/" rel="noopener ugc nofollow" target="_blank">“第1部分:Raspberry Pi上的MQTT，用Java和Pi4J将传感器数据发送到hive MQ Cloud”</a></li><li id="4696" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://www.hivemq.com/blog/mqtt-raspberrypi-part02-visualizing-sensor-data-on-a-tilesfx-dashboard/" rel="noopener ugc nofollow" target="_blank">“第2部分:使用MQTT和Raspberry Pi在TilesFX仪表板上可视化传感器数据”</a></li></ul><p id="1d8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将使用Raspberry Pi家族的另一个成员:Pico向我们的消息传递系统添加更多的数据。</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="jx jy l"/></div></figure><h1 id="5ae7" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">关于覆盆子馅饼</h1><p id="32a2" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">2021年1月，推出了树莓派Pico。这是一种全新的开发板，因为它不是一台完整的Linux PC，而是一个由Raspberry Pi自己开发的微控制器芯片(RP2040 ),位于一个小型的多功能开发板上。这款RP2040采用双核Arm Cortex-M0+处理器，具有264KB内部RAM，支持高达16MB的片外闪存，结合广泛的GPIOs(支持I2C、SPI和可编程I/O (PIO))。因此它相当于Arduino或类似的微控制器板。但是这款Pico最大的惊喜:只有4美金的价格！</p><p id="02dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">树莓派基金会确保在发布该板时有一个非常广泛的<a class="ae jm" href="https://www.raspberrypi.com/documentation/microcontrollers/raspberry-pi-pico.html" rel="noopener ugc nofollow" target="_blank">文档网站</a>可用。编程可以用一个<a class="ae jm" rel="noopener" href="/javarevisited/top-10-courses-to-learn-c-for-beginners-best-and-free-4afc262a544e"> C/C++ </a>和MicroPython SDK来完成。</p><p id="8efd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pico提供许多GPIOs，这些GPIOs通过接地连接很好地组合在一起。这些地面甚至在板上有不同的形状(没有圆角)，以便更容易找到您想要使用的正确引脚。</p><h1 id="820d" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">Pico项目</h1><p id="ea45" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">在这篇文章中，我们将扩展Pico的WiFi模块和一个距离传感器，作为一个例子，您可以轻松地从这个廉价的板将传感器数据发送到HiveMQ Cloud。为了实现这个非常低的价格，Pico不包含无线功能。</p><p id="613a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，有不同的可能性可以为Pico添加WiFi，其中<a class="ae jm" href="https://www.adafruit.com/product/4201" rel="noopener ugc nofollow" target="_blank"> Adafruit AirLift ESP32 WiFi协处理器分线板</a>可能是最简单和最便宜的，价格为9.95美元。Adafruit产品的一个额外优势是他们在网站上提供了大量的文档。</p><p id="3145" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些例子中的大多数使用了不同“风格”的MicroPython，称为<strong class="ih hj"> CircuitPython </strong>，它基于相同的Python实现，但更侧重于初学者、教育和入门教程。</p><p id="670f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文中的项目结合了Adafruit的不同例子:</p><ul class=""><li id="5a17" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><a class="ae jm" href="https://learn.adafruit.com/mqtt-in-circuitpython/connecting-to-a-mqtt-broker" rel="noopener ugc nofollow" target="_blank">连接到MQTT代理</a></li><li id="994e" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://learn.adafruit.com/getting-started-with-raspberry-pi-pico-circuitpython/overview" rel="noopener ugc nofollow" target="_blank">开始使用Raspberry Pi Pico和CircuitPython </a></li><li id="95c2" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://learn.adafruit.com/quickstart-rp2040-pico-with-wifi-and-circuitpython/overview" rel="noopener ugc nofollow" target="_blank">快速启动物联网—带WiFi的Raspberry Pi Pico RP 2040</a></li><li id="b24b" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://learn.adafruit.com/ultrasonic-sonar-distance-sensors/python-circuitpython" rel="noopener ugc nofollow" target="_blank"> Python &amp; CircuitPython </a></li><li id="07ba" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://learn.adafruit.com/welcome-to-circuitpython/installing-mu-editor" rel="noopener ugc nofollow" target="_blank">安装管理部门编辑器</a></li></ul><h1 id="690b" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">为CircuitPython准备Pico</h1><p id="b322" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">让我们从准备本教程的Pico开始。我们需要连接组件，在Pico上flash CircuitPython，添加库，并上传我们的代码。</p><h1 id="9c2c" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">接线</h1><p id="b293" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">拿一块试验板和一些电线来创建这个小测试设置。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/b582f9823a7c91b2c9d33ad8cc1c53f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KJx6h5XmypTMp70Z.jpg"/></div></div></figure><h2 id="d0c4" class="lj ka hi bd kb lk ll lm kf ln lo lp kj iq lq lr kn iu ls lt kr iy lu lv kv lw bi translated">Adafruit空运WiFi</h2><p id="8c45" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">AirLift是WiFi模块，它将处理Pico和HiveMQ云之间的所有通信。我们需要8根试验板电线来连接两个元件。通过使用引脚10至15，我们将所有GPIO连接集中在一侧。</p><p id="30d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Adafruit网站上的重要提示:<strong class="ih hj">您必须使用Pico的VSYS引脚为空运突破供电。</strong></p><p id="8aaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Pico —空运</strong><br/>VSYS—Vin<br/>GND—GND<br/>GP10(SPI 1 SCK)—SCK<br/>GP11(SPI 1 TX)—MOSI<br/>GP12(SPI 1 RX)—MISO<br/>GP13(SPI 1 CSn)—CS<br/>GP14—忙碌<br/> GP15 —！英特尔的快速储存技术</p><h2 id="4ab4" class="lj ka hi bd kb lk ll lm kf ln lo lp kj iq lq lr kn iu ls lt kr iy lu lv kv lw bi translated">距离传感器</h2><p id="2406" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">试验板上的第三个元件是HC-SR04距离传感器，与CrowPi中的类似。这里我们需要4根线，对于GPIOs，我们使用Pico的另一端。</p><p id="8484" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Pico—HC-SR04</strong><br/>VBUS—Vcc<br/>GND—GND<br/>GP16—ECHO<br/>GP17—TRIGGER</p><h1 id="4f7b" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">Pico上的CircuitPython</h1><p id="d005" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">为了让我们的Pico支持这个示例CircuitPython项目，我们需要加载正确的固件并添加一些库。</p><h2 id="a29e" class="lj ka hi bd kb lk ll lm kf ln lo lp kj iq lq lr kn iu ls lt kr iy lu lv kv lw bi translated">固件</h2><p id="edd0" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">下载需要安装在Pico上的固件，以便能够将其用作CircuitPython设备。这个. uf2文件可以从circuitpython.org/board/raspberry_pi_pico<a class="ae jm" href="https://circuitpython.org/board/raspberry_pi_pico/" rel="noopener ugc nofollow" target="_blank">下载。</a></p><p id="dac9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用USB电缆(非充电专用)，按住Pico上的BOOTSEL按钮，并将电缆连接在Pico和电脑之间。等到你看到一个新的USB驱动器“RPI-RP2”出现在你的电脑上，释放BOOTSEL按钮。</p><p id="c594" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将下载的. uf2文件拖动或复制到“RPI-RP2”驱动器。完成后，这个驱动器将在Pico重新启动时消失，并重新显示为一个名为“CIRCUITPY”的驱动器。现在您的Pico已经准备好用CircuitPython编程了。</p><h2 id="3fef" class="lj ka hi bd kb lk ll lm kf ln lo lp kj iq lq lr kn iu ls lt kr iy lu lv kv lw bi translated">图书馆</h2><p id="5b69" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">为了简化组件的使用，在<a class="ae jm" href="https://circuitpython.org/libraries" rel="noopener ugc nofollow" target="_blank">circuitpython.org/libraries</a>上可以下载一整套库。下载ZIP文件，将其解压缩到您的PC上，并将以下列表中的目录或文件复制到“CIRCUITPY”驱动器上的“libs”目录中。</p><ul class=""><li id="84ac" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">adafruit_bus_device</li><li id="96b4" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">阿达果_esp32_spi</li><li id="a141" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">阿达果_hcsr04</li><li id="4831" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">阿达果_木卫一</li><li id="783b" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">adafruit_minimqtt</li><li id="d48b" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">阿达果_请求</li></ul><figure class="js jt ju jv fd jw er es paragraph-image"><div class="er es lx"><img src="../Images/9c0f6dac86cf464dcf2c504669d87654.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/0*PIDMG1X4Kqba2UJm.png"/></div></figure><h1 id="d892" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">集成驱动电子设备</h1><p id="77a4" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">代码文件可以用任何文本编辑器或IDE直接写入Pico。Adafruit建议使用Mu编辑器，因为这允许在一个工具中编写代码和查看应用程序输出。你可以从<a class="ae jm" href="https://codewith.mu/" rel="noopener ugc nofollow" target="_blank"> codewith.mu </a>下载这个工具。</p><p id="5c0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的电脑上安装应用程序，运行它并选择模式&gt; CircuitPython。</p><figure class="js jt ju jv fd jw er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/09/top-5-courses-to-learn-intellij-idea-java-and-android-development.html#axzz6A8Vy1sea"><div class="er es ly"><img src="../Images/5931914a1f07e2eb0e0b9aa315f6ae98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cDq7wYfU_IvL_AUe.png"/></div></a></figure><h1 id="e855" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">密码</h1><p id="7de2" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">这个应用程序的源代码<a class="ae jm" href="https://github.com/FDelporte/HiveMQ-examples" rel="noopener ugc nofollow" target="_blank">可以在GitHub的同一个资源库中找到，在这个资源库中可以找到前两篇文章</a>的源代码。</p><h2 id="e6e3" class="lj ka hi bd kb lk ll lm kf ln lo lp kj iq lq lr kn iu ls lt kr iy lu lv kv lw bi translated">秘密</h2><p id="29c0" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">要将通用代码与您的特定WiFi和HiveMQ云凭据分开，需要使用一个单独的文件。创建一个文件<code class="du lz ma mb mc b">secrets.py</code>,用你的登录名、密码等将它保存到Pico。</p><pre class="js jt ju jv fd md mc me mf aw mg bi"><span id="8798" class="lj ka hi mc b fi mh mi l mj mk">secrets = {<br/>   'ssid' : 'WIFI_NETWORK_NAME',<br/>   'password' : 'WIFI_PASSWORD',<br/>   'timezone' : 'Europe/Brussels',<br/>   'mqtt_username' : 'HIVEMQ_USERNAME',<br/>   'mqtt_key' : 'HIVEMQ_PASSWORD',<br/>   'broker' : 'YOUR_INSTANCE.hivemq.cloud',<br/>   'port' : 8883<br/>}</span></pre><h2 id="1d46" class="lj ka hi bd kb lk ll lm kf ln lo lp kj iq lq lr kn iu ls lt kr iy lu lv kv lw bi translated">主代码</h2><p id="a29a" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">下面你可以找到这个项目的完整代码。我试图通过添加评论和打印来解释每一步。在Mu中创建一个新文件，复制这段代码并将其保存到Pico中作为<code class="du lz ma mb mc b">code.py</code>。</p><pre class="js jt ju jv fd md mc me mf aw mg bi"><span id="6445" class="lj ka hi mc b fi mh mi l mj mk">import time<br/>import board<br/>import busio<br/>import adafruit_hcsr04<br/>import adafruit_requests as requests<br/>import adafruit_esp32spi.adafruit_esp32spi_socket as socket<br/>import adafruit_minimqtt.adafruit_minimqtt as MQTT<br/><br/>from digitalio import DigitalInOut<br/>from adafruit_esp32spi import adafruit_esp32spi<br/><br/># Load the WiFi and HiveMQ Cloud credentials from secrets.py<br/>try:<br/>    from secrets import secrets<br/>except ImportError:<br/>    print("Error, secrets could not be read")<br/>    raise<br/><br/># MQTT Topic to publish data from Pico to HiveMQ Cloud<br/>topic_name = "pico/distance"<br/><br/># Initialize the Pico pins, WiFi module and distance sensor<br/>esp32_cs = DigitalInOut(board.GP13)<br/>esp32_ready = DigitalInOut(board.GP14)<br/>esp32_reset = DigitalInOut(board.GP15)<br/>spi = busio.SPI(board.GP10, board.GP11, board.GP12)<br/>esp = adafruit_esp32spi.ESP_SPIcontrol(spi, esp32_cs, esp32_ready, esp32_reset)<br/>hcsr04 = adafruit_hcsr04.HCSR04(trigger_pin=board.GP17, echo_pin=board.GP16)<br/><br/># Handle HTTP requests<br/>requests.set_socket(socket, esp)<br/><br/># Check ESP32 status<br/>print("Checking ESP32")<br/>if esp.status == adafruit_esp32spi.WL_IDLE_STATUS:<br/>    print("\tESP32 found and in idle mode")<br/>print("\tFirmware version: ", esp.firmware_version)<br/>print("\tMAC address: ", [hex(i) for i in esp.MAC_address])<br/><br/># List the detected WiFi networks<br/>print("Discovered WiFi networks:")<br/>for ap in esp.scan_networks():<br/>    print("\t", (str(ap["ssid"], "utf-8")), "\t\tRSSI: ", ap["rssi"])<br/><br/># Connect to the configured WiFi network<br/>print("Connecting to WiFi: ", secrets["ssid"])<br/>while not esp.is_connected:<br/>    try:<br/>        esp.connect_AP(secrets["ssid"], secrets["password"])<br/>    except RuntimeError as e:<br/>        print("\tCould not connect to WiFi: ", e)<br/>        continue<br/>print("\tConnected to ", str(esp.ssid, "utf-8"), "\t\tRSSI:", esp.rssi)<br/>print("\tIP address of this board: ", esp.pretty_ip(esp.ip_address))<br/>print("\tPing google.com: " + str(esp.ping("google.com")) + "ms")<br/><br/># Configure MQTT to use the ESP32 interface<br/>MQTT.set_socket(socket, esp)<br/><br/># Configure MQTT client (uses secure connection by default)<br/>mqtt_client = MQTT.MQTT(<br/>    broker=secrets["broker"],<br/>    port=secrets["port"],<br/>    username=secrets["mqtt_username"],<br/>    password=secrets["mqtt_key"]<br/>)<br/><br/># Define callback methods and assign them to the MQTT events<br/>def connected(client, userdata, flags, rc):<br/>    print("\tConnected to MQTT broker: ", client.broker)<br/><br/>def disconnected(client, userdata, rc):<br/>    print("\tDisconnected from MQTT broker!")<br/><br/>def publish(mqtt_client, userdata, topic, pid):<br/>    print("\tPublished a message to: ", topic)<br/><br/>mqtt_client.on_connect = connected<br/>mqtt_client.on_disconnect = disconnected<br/>mqtt_client.on_publish = publish<br/><br/># Connect to the MQTT broker<br/>print("Connecting to MQTT broker...")<br/>try:<br/>    mqtt_client.connect()<br/>    print("\tSucceeded")<br/>except Exception as e:<br/>    print("\tMQTT connect failed: ", e)<br/><br/># Continuously measure the distance and send the value to HiveMQ<br/>print("Starting the distance measurement")<br/>killed = False<br/>while not killed:<br/>    # Measure distance<br/>    distance = 0<br/>    try:<br/>        distance = hcsr04.distance<br/>    except Exception as e:<br/>        print("Distance measurement failure\n", e)<br/><br/>    # Send to HiveMQ Cloud<br/>    try:<br/>        json = "{\"value\": " + str(distance) + "}"<br/>        print("\tMessage for queue: " + json)<br/>        mqtt_client.publish(topic_name, json)<br/>    except Exception as e:<br/>        print("\tMQTT publish Failed, retrying\n", e)<br/>        killed = True<br/>        continue<br/><br/>    # Sleep a second<br/>    time.sleep(1)</span></pre><p id="45ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为<code class="du lz ma mb mc b">code.py</code>是主代码的默认文件名，所以这个文件会被直接执行，或者你可以在Mu的终端用<code class="du lz ma mb mc b">CTRL+D</code>软复位板卡。</p><h2 id="25be" class="lj ka hi bd kb lk ll lm kf ln lo lp kj iq lq lr kn iu ls lt kr iy lu lv kv lw bi translated">程序输出</h2><p id="7c90" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">在Mu的终端，显示打印输出。</p><pre class="js jt ju jv fd md mc me mf aw mg bi"><span id="c03d" class="lj ka hi mc b fi mh mi l mj mk">Auto-reload is on. Simply save files over USB to run them or enter REPL to disable.<br/>code.py output:<br/>Checking ESP32<br/>	ESP32 found and in idle mode<br/>	Firmware version:  bytearray(b'1.2.2\x00')<br/>	MAC address:  ['0x50', '0x18', '0x49', '0x95', '0xab', '0x34']<br/>Discovered WiFi networks:<br/>	 *****1 		RSSI:  -73<br/>	 *****2 		RSSI:  -79<br/>Connecting to WiFi:  *****1<br/>	Connected to  *****1 		RSSI: -71<br/>	IP address of this board:  192.168.0.189<br/>	Ping google.com: 20ms<br/>Connecting to MQTT broker...<br/>	Connected to MQTT broker:  ***.s1.eu.hivemq.cloud<br/>	Succeeded<br/>Starting the distance measurement<br/>	Message for queue: {"value": 106.777}<br/>	Published a message to:  pico/distance<br/>	Message for queue: {"value": 106.352}<br/>	Published a message to:  pico/distance<br/>	Message for queue: {"value": 107.202}</span></pre><h1 id="c211" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">将数据添加到我们的JavaFX仪表板</h1><p id="468c" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">经过一些小的改动，我们现在可以将Pico消息的数据添加到我们在前一篇文章中创建的JavaFX应用程序中。唯一需要修改的文件是<code class="du lz ma mb mc b">DashboardView.java</code>。</p><h1 id="54d3" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">代码更改</h1><p id="4562" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">首先我们添加一个新变量:</p><pre class="js jt ju jv fd md mc me mf aw mg bi"><span id="afc3" class="lj ka hi mc b fi mh mi l mj mk">private final Tile gaucheDistancePico;</span></pre><p id="73c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在构造函数中，我们初始化类似于现有瓦片的瓦片，并定义对Pico发布其距离测量的主题的订阅。</p><pre class="js jt ju jv fd md mc me mf aw mg bi"><span id="651f" class="lj ka hi mc b fi mh mi l mj mk">gaucheDistancePico = TileBuilder.create()<br/>    .skinType(Tile.SkinType.GAUGE)<br/>    .prefSize(TILE_WIDTH, TILE_HEIGHT)<br/>    .title("Distance Pico")<br/>    .unit("cm")<br/>    .maxValue(255)<br/>    .build();<br/><br/>client.toAsync().subscribeWith()<br/>    .topicFilter("pico/distance")<br/>    .qos(MqttQos.AT_LEAST_ONCE)<br/>    .callback(this::handlePicoData)<br/>    .send();</span></pre><p id="2764" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还需要最后一个方法来解析接收到的数据并更新图块:</p><pre class="js jt ju jv fd md mc me mf aw mg bi"><span id="a929" class="lj ka hi mc b fi mh mi l mj mk">public void handlePicoData(Mqtt5Publish message) {<br/>    var sensorData = new String(message.getPayloadAsBytes());<br/>    logger.info("Pico distance data: {}", sensorData);<br/>    try {<br/>        var sensor = mapper.readValue(sensorData, <br/>           DoubleValue.class);<br/>        gaucheDistancePico.setValue(sensor.getValue());<br/>    } catch (JsonProcessingException ex) {<br/>        logger.error("Could not parse the data to JSON: {}", <br/>           ex.getMessage());<br/>    }<br/>}</span></pre><h1 id="b675" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">扩展布局</h1><p id="49b5" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">经过这些小小的修改，我们现在可以在一个仪表板上看到CrowPi和Pico的数据。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es ml"><img src="../Images/e4b0d9e5bae0f14770b5f84b955ace3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ruu8dYcUTwvF2vpV.png"/></div></div></figure><h1 id="1b25" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">结论</h1><p id="7936" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">Raspberry Pi Pico是一款价格非常低廉的多功能设备。通过额外的Adafruit WiFi模块，您可以轻松添加无线通信。与此同时，已经有许多基于相同RP2040微控制器的新电路板上市，其中一些甚至具有板载WiFi。一个很好的概述可以在<a class="ae jm" href="https://www.tomshardware.com/best-picks/best-rp2040-boards" rel="noopener ugc nofollow" target="_blank">tomshardware.com/best-picks/best-rp2040-boards</a>找到。</p><p id="5284" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">HiveMQ云是一个伟大的(并免费多达100台设备！)尝试消息传递的方式。当将其与Java、Raspberry Pi和电子组件结合使用时，在不同的应用程序和设备之间交换数据变得非常容易。</p><p id="26b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这三个帖子可以帮助你开始创建自己的项目！</p></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><p id="170f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mt">本文应HiveMQ的要求而写，最初发表于HiveMQ的博客</em><a class="ae jm" href="https://www.hivemq.com/blog/mqtt-raspberrypi-part03-sending-sensor-data-hivemqcloud-pico/" rel="noopener ugc nofollow" target="_blank"><em class="mt"/></a><em class="mt">。</em></p></div></div>    
</body>
</html>