<html>
<head>
<title>API Documentation using Swagger 3 with Spring Boot 2 + Spring Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Swagger 3和Spring Boot 2 + Spring Security的API文档</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/api-documentation-using-swagger-3-with-spring-boot-2-spring-security-5a0d2b0996ee?source=collection_archive---------0-----------------------#2021-09-29">https://medium.com/javarevisited/api-documentation-using-swagger-3-with-spring-boot-2-spring-security-5a0d2b0996ee?source=collection_archive---------0-----------------------#2021-09-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7690" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想为spring boot 2应用程序编写API文档吗？嗯，使用开放API规范非常简单。</p><h1 id="943d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">什么是开放API规范？</strong></h1><p id="ca40" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">开放API规范是Rest APIs的标准API描述格式。</p><h1 id="a9f5" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">什么是霸气？</h1><p id="8052" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">Swagger是SmartBear提供的一个实现该规范的开源工具。它可以帮助你设计、构建、记录和使用你的<a class="ae kg" rel="noopener" href="/javarevisited/6-best-rest-api-tools-for-testing-design-and-development-1c5f69ed1f22">Rest API</a>。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="58dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将看看如何记录我们的Rest APIs，并使用Swagger UI将其可视化。那么，让我们开始实施吧…</p><figure class="kp kq kr ks fd kt er es paragraph-image"><a href="https://javarevisited.blogspot.com/2021/04/top-5-tools-to-test-rest-apis-in-java.html"><div class="er es ko"><img src="../Images/23b5903aab35edd55b81cd7cb1e1701d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7o3mrA86fG8EnJ_Wgtm41A.jpeg"/></div></a><p class="kw kx et er es ky kz bd b be z dx translated">在Spring Boot应用程序中使用swagger打开Api Spec 3.0</p></figure><p id="5a39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，您需要在pom.xml或build.gradle文件中添加以下依赖项:</p><blockquote class="la lb lc"><p id="da8e" class="if ig ld ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated"><a class="ae kg" rel="noopener" href="/javarevisited/6-best-maven-courses-for-beginners-in-2020-23ea3cba89"> <em class="hi">美芬</em> </a> <em class="hi"> : </em></p></blockquote><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="6797" class="lm je hi li b fi ln lo l lp lq">&lt;dependency&gt;<br/>   &lt;groupId&gt;io.springfox&lt;/groupId&gt;<br/>   &lt;artifactId&gt;springfox-boot-starter&lt;/artifactId&gt;<br/>   &lt;version&gt;3.0.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><blockquote class="la lb lc"><p id="b2c8" class="if ig ld ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated"><a class="ae kg" rel="noopener" href="/javarevisited/5-best-gradle-courses-and-books-to-learn-in-2021-93f49ce8ff8e"><em class="hi"/></a>:</p></blockquote><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="3081" class="lm je hi li b fi ln lo l lp lq">implementation group: ‘io.springfox’, name: ‘springfox-boot-starter’, version: ‘3.0.0’</span></pre><p id="7819" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您需要创建一个如下所示的Swagger配置java类:</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="417d" class="lm je hi li b fi ln lo l lp lq">@Configuration<br/>public class SwaggerConfig {<br/><br/>    private ApiInfo apiInfo() {<br/>        return new ApiInfo("MyApp Rest APIs",<br/>                "APIs for MyApp.",<br/>                "1.0",<br/>                "Terms of service",<br/>                new Contact("test", "www.org.com", "test@emaildomain.com"),<br/>                "License of API",<br/>                "API license URL",<br/>                Collections.<em class="ld">emptyList</em>());<br/>    }<br/><br/>    @Bean<br/>    public Docket api() {<br/>        return new Docket(DocumentationType.<em class="ld">OAS_30</em>)<br/>                .apiInfo(apiInfo())<br/>                .select()<br/>                .apis(RequestHandlerSelectors.<em class="ld">any</em>())<br/>                .paths(PathSelectors.<em class="ld">any</em>())<br/>                .build();<br/>    }<br/>}</span></pre><p id="d7e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你需要用<strong class="ih hj"> @Configuration </strong>注释来注释这个类。第一个方法<strong class="ih hj"> apiInfo() </strong>用于添加关于api的定制信息，然后在API()方法中调用。</p><p id="6590" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> api() </strong>方法通过方法链接使用构建器模式，并返回spring bean Docket来确定生成各种文档的配置。在我们的例子中，我们提供的文档类型是Open Api Spec 3.0。</p><p id="12d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们通过使用any() on <code class="du lr ls lt li b">RequestHandlerSelectors </code>和PathSelectors为所有API和路径创建文档，但是如果您愿意，您可以配置您希望Swagger为其生成文档的特定API或路径。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="8d5f" class="jd je hi bd jf jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka bi translated">具有弹簧安全性的大摇大摆配置</h1><p id="d3a1" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">如果您在应用程序中启用了spring安全性，那么您需要将相同的安全性添加到您的swagger配置类中，这样您的swagger APIs将受到保护，如果您试图通过swaggerUI调用您的API，它也会要求在那里提供身份验证。</p><p id="96c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果在您的应用程序中使用JWT身份验证，那么您的Swagger配置文件应该如下所示:</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="f19b" class="lm je hi li b fi ln lo l lp lq">@Configuration<br/>public class SwaggerConfiguration {<br/>    public static final String <em class="ld">AUTHORIZATION_HEADER </em>= "Authorization";<br/><br/>    private ApiInfo apiInfo() {<br/>        return new ApiInfo("MyApp Rest APIs",<br/>                "APIs for MyApp.",<br/>                "1.0",<br/>                "Terms of service",<br/>                new Contact("test", "www.org.com", "test@emaildomain.com"),<br/>                "License of API",<br/>                "API license URL",<br/>                Collections.<em class="ld">emptyList</em>());<br/>    }<br/><br/>    @Bean<br/>    public Docket api() {<br/>        return new Docket(DocumentationType.<em class="ld">OAS_30</em>)<br/>                .apiInfo(apiInfo())<br/>                .securityContexts(Arrays.<em class="ld">asList</em>(securityContext()))<br/>                .securitySchemes(Arrays.<em class="ld">asList</em>(apiKey()))<br/>                .select()<br/>                .apis(RequestHandlerSelectors.<em class="ld">any</em>())<br/>                .paths(PathSelectors.<em class="ld">any</em>())<br/>                .build();<br/>    }<br/><br/>    private ApiKey apiKey() {<br/>        return new ApiKey(<em class="ld">AUTHORIZATION_HEADER</em>, "JWT", "header");<br/>    }<br/><br/>    private SecurityContext securityContext() {<br/>        return SecurityContext.<em class="ld">builder</em>()<br/>                .securityReferences(defaultAuth())<br/>                .build();<br/>    }<br/><br/>    List&lt;SecurityReference&gt; defaultAuth() {<br/>        AuthorizationScope authorizationScope<br/>                = new AuthorizationScope("global", "accessEverything");<br/>        AuthorizationScope[] authorizationScopes = new AuthorizationScope[1];<br/>        authorizationScopes[0] = authorizationScope;<br/>        return Arrays.<em class="ld">asList</em>(new SecurityReference(<em class="ld">AUTHORIZATION_HEADER</em>, authorizationScopes));<br/>    }<br/>}</span></pre><p id="f667" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了增加安全性，需要添加<strong class="ih hj"> apiKey() </strong>和<a class="ae kg" href="https://javarevisited.blogspot.com/2018/02/what-is-securitycontext-and-SecurityContextHolder-Spring-security.html#axzz6qnblZnVj" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">security context()</strong></a>方法来使用默认的认证方法。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="a7d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您需要在您的<strong class="ih hj">WebSecurityConfig.java</strong>类中做一些更改，将认证api(如果您启用了spring security)和swagger相关URL列入白名单，然后在configure()方法中默认授权来自这些白名单URL的请求，这样对于这些URL它就不会要求您授权。</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="843a" class="lm je hi li b fi ln lo l lp lq">private static final String[] <em class="ld">AUTH_WHITELIST </em>= {<br/>        "/authenticate",<br/>        "/swagger-resources/**",<br/>        "/swagger-ui/**",<br/>        "/v3/api-docs",<br/>        "/webjars/**"<br/>};</span><span id="4da7" class="lm je hi li b fi lz lo l lp lq">@Override<br/> protected void configure(HttpSecurity httpSecurity) throws Exception {<br/>     httpSecurity<br/>             .cors()<br/>             .and()<br/>             .csrf()<br/>             .disable()<br/>             .headers()<br/>             .frameOptions()<br/>             .deny()<br/>             .and()<br/>             // dont authenticate this particular request<br/>             <strong class="li hj">.authorizeRequests().antMatchers(<em class="ld">AUTH_WHITELIST</em>).permitAll().</strong><br/>             // all other requests need to be authenticated<br/>                     anyRequest().authenticated().and().<br/>             // make sure we use stateless session; session won't be // used to store user's state.<br/>                     exceptionHandling().authenticationEntryPoint(jwtAuthenticationEntryPoint).and().sessionManagement()<br/>             .sessionCreationPolicy(SessionCreationPolicy.<em class="ld">STATELESS</em>);<br/>     // Add a filter to validate the tokens with every request<br/>     httpSecurity.addFilterBefore(jwtRequestFilter, UsernamePasswordAuthenticationFilter.class);<br/> }</span></pre><p id="b707" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成这些更改并启动应用程序后，您应该能够看到swagger-ui网页，如下所示:</p><p id="0177" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ld">网址</em></strong>:<a class="ae kg" href="http://localhost:8080/swagger-ui/index.html#/CDRProducts%20APIs" rel="noopener ugc nofollow" target="_blank">http://&lt;app-root&gt;/swagger-ui/index . html</a></p><figure class="kp kq kr ks fd kt er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/02/top-5-postman-tutorials-and-courses-for-web-developers.html"><div class="er es ma"><img src="../Images/9d4bc5e3714cc24c232a46a4c55c85ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wOu4xUY0TOZ3gYM0kBYmXw.png"/></div></a></figure><p id="c41e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，要在swagger UI上标记您的API或提供每个API的描述，您需要对API使用一些注释:</p><p id="4715" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">@ <strong class="ih hj"> Api </strong>:在类级别使用标签或值属性，将其定义为swagger资源</p><p id="4785" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">@ <strong class="ih hj"> ApiOperation </strong>:用在API方法级别，用value或tag属性来描述操作。</p><p id="d553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据需要，可以在API上使用不同的注释。同样可以参考<a class="ae kg" href="https://docs.swagger.io/swagger-core/current/apidocs/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Swagger API文档</strong> </a> <strong class="ih hj"> </strong>。</p><p id="f9e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Swagger还配置了一个API端点来查看所有API及其详细信息，您可以通过<a class="ae kg" rel="noopener" href="/javarevisited/7-best-courses-to-learn-postman-tool-for-web-service-and-api-testing-f225c138fa5a"> postman </a>测试/执行这些信息。</p><p id="8722" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API URL:<strong class="ih hj">http://&lt;app-root&gt;/v3/API-docs</strong></p><p id="cebf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">方法类型:<strong class="ih hj">获取</strong></p><p id="f58f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它应该会返回如下类似的响应:</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="c1c1" class="lm je hi li b fi ln lo l lp lq">openapi: 3.0.0<br/>info:<br/>  version: 1.0.0<br/>  title: Sample API<br/>  description: A sample API to illustrate OpenAPI concepts<br/>paths:<br/>  /list:<br/>    get:<br/>      description: Returns a list of stuff              <br/>      responses:<br/>        '200':<br/>          description: Successful response</span></pre><p id="8c8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望您现在能够看到应用程序的API文档和swagger ui。</p><p id="f44d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编码快乐！！</p><p id="6041" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能喜欢的其他<strong class="ih hj"> REST API教程和课程</strong></p><div class="mb mc ez fb md me"><a rel="noopener follow" target="_blank" href="/javarevisited/top-10-rest-interview-questions-for-java-and-spring-developers-1611e3b78029"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">Java和Spring开发人员的10大REST面试问题</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">这些是Java和Spring开发者快速准备的最好的REST面试问题</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">medium.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ku me"/></div></div></a></div><div class="mb mc ez fb md me"><a rel="noopener follow" target="_blank" href="/javarevisited/10-best-java-web-services-rest-soap-and-api-courses-for-beginners-724a8f51298d"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">初学者在线学习的10个最佳Java Web服务[REST + SOAP]课程</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">我最喜欢的在线课程，学习如何使用Spring、JAX RS和其他</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">medium.com</p></div></div><div class="mn l"><div class="mt l mp mq mr mn ms ku me"/></div></div></a></div><div class="mb mc ez fb md me"><a href="https://javarevisited.blogspot.com/2022/01/top-5-courses-to-learn-swagger-or-open.html" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">初学者学习Swagger或Open API的5大课程——最佳选择</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">大家好，如果你想学习Swagger并寻找最好的在线课程，那么你来对地方了…</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">javarevisited.blogspot.com</p></div></div><div class="mn l"><div class="mu l mp mq mr mn ms ku me"/></div></div></a></div><p id="9809" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你不是媒体成员，我强烈推荐你加入媒体，阅读不同领域伟大作家的精彩故事。你可以在 这里<strong class="ih hj">加入介质</strong> <a class="ae kg" rel="noopener" href="/@somasharma_81597/membership"> <strong class="ih hj"/></a></p></div></div>    
</body>
</html>