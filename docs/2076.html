<html>
<head>
<title>[Python] Build a today’s weather bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Python]建造一个今天的天气机器人</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/python-build-a-todays-weather-bot-15bf12ab6e8?source=collection_archive---------0-----------------------#2022-04-25">https://medium.com/javarevisited/python-build-a-todays-weather-bot-15bf12ab6e8?source=collection_archive---------0-----------------------#2022-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/12/10-free-python-courses-for-programmers.html"><div class="er es if"><img src="../Images/1e0878524f472508e78ef84431eba33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DfMlWYjpe3D3rgQm.png"/></div></a><p class="im in et er es io ip bd b be z dx translated">行通知API</p></figure><p id="7832" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">LINE是台湾最受欢迎的消息应用。在这些特性中，带有授权令牌的LINE Notify API允许web应用程序手动或自动将通知传递给个人帐户或组帐户。</p><p id="ee53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">线路令牌:<a class="ae jo" href="https://notify-bot.line.me/my/" rel="noopener ugc nofollow" target="_blank">https://notify-bot.line.me/my/</a></p><h1 id="d39a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第一步。邀请线路通知到组</h1><p id="844c" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如果您想将信息发送到线路群组而不是您的个人帐户，请记住在发送信息之前将线路通知邀请到群组，以便群组可以首先收到信息。</p><h1 id="96e8" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第二步。生成令牌</h1><p id="8438" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在<a class="ae jo" href="https://notify-bot.line.me/my/" rel="noopener ugc nofollow" target="_blank">页面</a>生成令牌。当您点击<strong class="is hj">生成令牌</strong>然后看到令牌时，请将其复制到安全的地方，因为注意到<em class="ks">如果您离开此页面，您将无法再次查看您新生成的令牌。请在离开此页面前复制令牌。</em></p><figure class="ku kv kw kx fd ij er es paragraph-image"><a href="https://www.java67.com/2018/02/5-free-python-online-courses-for-beginners.html"><div class="er es kt"><img src="../Images/981a827b5d80672d5bcd47e18163f7c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVca6zSUPlkZUUYL4zFaAQ.png"/></div></a><p class="im in et er es io ip bd b be z dx translated">线路API令牌</p></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6e2f" class="ld jq hi kz b fi le lf l lg lh">Note:<br/>Line Notify allow you to generate a token as the key to authorization. You can apply more than one token for variant purposes. Moreover, you can remove not used tokens.</span></pre><h1 id="5b71" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第三步。获取天气API凭据</h1><p id="269b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">有很多免费的开源天气API。在本教程中，我将使用OpenWeather，这是最流行的天气API之一。当前天气的文档可以在<a class="ae jo" href="https://openweathermap.org/current" rel="noopener ugc nofollow" target="_blank">这里</a>看到。</p><p id="c5df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要获得您的API密钥，您应该点击“API密钥”并从<a class="ae jo" href="https://home.openweathermap.org/api_keys" rel="noopener ugc nofollow" target="_blank">这里</a>复制您的API密钥。</p><h1 id="636b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第四步。密码</h1><ol class=""><li id="b73f" class="li lj hi is b it kn ix ko jb lk jf ll jj lm jn ln lo lp lq bi translated">检查<a class="ae jo" rel="noopener" href="/javarevisited/7-best-courses-to-learn-postman-tool-for-web-service-and-api-testing-f225c138fa5a"> API </a>是否工作。我更习惯于看到摄氏温度，所以我将API调用的参数替换为下面的<code class="du lr ls lt kz b">unit=metric</code>。</li></ol><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="f677" class="ld jq hi kz b fi le lf l lg lh">import requests</span><span id="1110" class="ld jq hi kz b fi lu lf l lg lh">import json</span><span id="5104" class="ld jq hi kz b fi lu lf l lg lh">apiKey = "Your API key from step 3"<br/>lineToken = "Your token got from step 2"</span><span id="e2c8" class="ld jq hi kz b fi lu lf l lg lh"># id = city ID</span><span id="2b21" class="ld jq hi kz b fi lu lf l lg lh">url = "https://api.openweathermap.org/data/2.5/weather?id=1668338&amp;units=metric&amp;appid=" + key</span><span id="28a3" class="ld jq hi kz b fi lu lf l lg lh">r = requests.get(url)<br/>data = json.loads(r.text)</span><span id="c016" class="ld jq hi kz b fi lu lf l lg lh">print(data)</span></pre><p id="3c6f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">结果将类似于下图，<code class="du lr ls lt kz b">status=200</code>表示成功获取数据:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="5bc0" class="ld jq hi kz b fi le lf l lg lh">{'coord': {'lon': 121.6503, 'lat': 25.0486}, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'base': 'stations', 'main': {'temp': 25.9, 'feels_like': 26.37, 'temp_min': 25.33, 'temp_max': 27.26, 'pressure': 1011, 'humidity': 70}, 'visibility': 9000, 'wind': {'speed': 3.09, 'deg': 100}, 'clouds': {'all': 75}, 'dt': 1650885341, 'sys': {'type': 2, 'id': 2032887, 'country': 'TW', 'sunrise': 1650835355, 'sunset': 1650881998}, 'timezone': 28800, 'id': 1668338, 'name': 'Taipei City', 'cod': 200}<br/>{"status":200,"message":"ok"}</span></pre><p id="81ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.因为我只需要下面消息中的城市、当前温度、最高温度、最低温度和天气描述的数据，所以处理<a class="ae jo" href="https://www.java67.com/2016/10/3-ways-to-convert-string-to-json-object-in-java.html" rel="noopener ugc nofollow" target="_blank"> JSON数据</a>就是为了这个目的。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/02/how-to-parse-json-with-date-field-in-java-jackson-example.html"><div class="er es lv"><img src="../Images/41e2a19070ee1e6973a1e17af4bfff12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FST34F4izEu7oqjfbG6UUg.png"/></div></a></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="5f7e" class="ld jq hi kz b fi le lf l lg lh">"""<br/># if units=imperial and it should be converted to metric additionally:</span><span id="055e" class="ld jq hi kz b fi lu lf l lg lh">def tempToC(fTemp):<br/>return round((fTemp - 32) * 5 / 9, 1)<br/>temp = data["main"]["temp"])<br/>temp_max = tempToC(data["main"]["temp_max"])<br/>temp_min = tempToC(data["main"]["temp_min"])<br/>"""</span><span id="7b3a" class="ld jq hi kz b fi lu lf l lg lh">temp = data["main"]["temp"]<br/>temp_max = data["main"]["temp_max"]<br/>temp_min = data["main"]["temp_min"]<br/>weather = data["weather"][0]["description"].capitalize()</span></pre><p id="0656" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.我将通过天气机器人发送的消息由以下字符串组成:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="e613" class="ld jq hi kz b fi le lf l lg lh">msg = "%s\n 🌡Current temperature: %s°C\n 💌Highest temperature: %s\n 💌Lowest temperature: %s\n 💧%s" %(data['name'],temp,temp_max,temp_min,weather)</span></pre><p id="7f3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.现在，我们可以使用LINE notify API发送HTTP请求来发送消息:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="d0de" class="ld jq hi kz b fi le lf l lg lh">url = "https://notify-api.line.me/api/notify"<br/>payload = {"message": {msg}}<br/>headers = {"Authorization": "Bearer " + lineToken}<br/>response = requests.request("POST", url, headers=headers, data=payload)<br/>print(response.text)</span></pre><p id="2379" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.使用<code class="du lr ls lt kz b">schedule</code>模块使代码在每天早上7:30例行运行:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="211e" class="ld jq hi kz b fi le lf l lg lh">import schedule<br/>import time</span><span id="95cc" class="ld jq hi kz b fi lu lf l lg lh">schedule.every().day.at("07:30").do(sendToLine(lineToken,msg))<br/>schedule.every(10).seconds.do(sendToLine, (lineToken))</span><span id="6409" class="ld jq hi kz b fi lu lf l lg lh">while True:<br/>     schedule.run_pending()<br/>     time.sleep(1)</span></pre><p id="8e05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">瞧啊。！搞定了。！🎉</p></div></div>    
</body>
</html>