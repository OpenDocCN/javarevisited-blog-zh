<html>
<head>
<title>Migration from Swagger 2 to OpenAPI 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Swagger 2迁移到OpenAPI 3</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/migration-from-swagger-2-to-openapi-3-391f3e97da73?source=collection_archive---------0-----------------------#2021-05-18">https://medium.com/javarevisited/migration-from-swagger-2-to-openapi-3-391f3e97da73?source=collection_archive---------0-----------------------#2021-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1bda" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">发现记录我们API的新方法</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/36ae225882347e3b8d2b0a6a9d337487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KF_MRwLdyoVL7jQa.png"/></div></div></figure><p id="efd7" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">许多API都是使用<a class="ae kf" href="https://swagger.io/" rel="noopener ugc nofollow" target="_blank"> Swagger </a>编写的，这是一件好事，API被编写成文档，便于理解它们如何工作以及如何调用它们。<br/>但是很多这些API都是使用Swagger 2编写的，现在<a class="ae kf" href="https://swagger.io/specification/" rel="noopener ugc nofollow" target="_blank"> OpenApi </a>发布了(<a class="ae kf" href="https://en.wikipedia.org/wiki/OpenAPI_Specification#Release_dates" rel="noopener ugc nofollow" target="_blank">从2017年开始，实际版本是3.1，从15/02/2021 </a>开始可用)一些项目没有更新他们的文档工具，我将在本文中尝试帮助你这样做。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="4d25" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">你需要什么</h1><p id="4650" class="pw-post-body-paragraph jj jk hi jl b jm lf ij jo jp lg im jr js lh ju jv jw li jy jz ka lj kc kd ke hb bi translated">为了遵循本教程，您将需要一个<a class="ae kf" rel="noopener" href="/javarevisited/top-5-books-and-courses-to-learn-restful-web-services-in-java-using-spring-mvc-and-spring-boot-79ec4b351d12?source=---------17------------------"> REST API </a>，因此您可以:</p><ul class=""><li id="2ac3" class="lk ll hi jl b jm jn jp jq js lm jw ln ka lo ke lp lq lr ls bi translated">按照<a class="ae kf" rel="noopener" href="/javarevisited/building-a-simple-rest-api-with-springboot-3f2e4b123ebb">教程来构建你的API </a>和<a class="ae kf" rel="noopener" href="/javarevisited/documenting-your-api-with-swagger-c27a94104135">教程来文档化它</a></li><li id="64fa" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated">克隆这个库的<a class="ae kf" href="https://github.com/ErwanLT/HumanCloningFacilities" rel="noopener ugc nofollow" target="_blank">swagger分支</a></li><li id="8db2" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated">使用Swagger 2准备好您自己的API文档</li></ul></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="0c59" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">步骤1:摆脱SpringFox依赖关系</h1><p id="9552" class="pw-post-body-paragraph jj jk hi jl b jm lf ij jo jp lg im jr js lh ju jv jw li jy jz ka lj kc kd ke hb bi translated">当我们第一次实现Swagger时，我们将这些依赖项添加到have中</p><ul class=""><li id="d5aa" class="lk ll hi jl b jm jn jp jq js lm jw ln ka lo ke lp lq lr ls bi translated">在<a class="ae kf" href="http://localhost:8080/v2/api-docs" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/v2/API-docs</a>生成的json</li><li id="e4cb" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated">在<a class="ae kf" href="http://localhost:8080/swagger-ui.html" rel="noopener ugc nofollow" target="_blank">的界面http://localhost:8080/swagger-UI . html</a></li><li id="fddc" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated">Bean验证</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="2ede" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们将不再需要它，所以您可以从您的<a class="ae kf" href="https://maven.apache.org/guides/introduction/introduction-to-the-pom.html" rel="noopener ugc nofollow" target="_blank"> pom.xml </a>中取消它们。<br/>这三个依赖项将被一个取代</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="3594" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">有了这种依赖性，我们将拥有:</p><ul class=""><li id="4ec6" class="lk ll hi jl b jm jn jp jq js lm jw ln ka lo ke lp lq lr ls bi translated">json生成了<a class="ae kf" href="http://localhost:8080/v3/api-docs/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/v3/API-docs/</a></li><li id="22d0" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated">UI页面<a class="ae kf" href="http://localhost:8080/swagger-ui.html" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/swagger-UI . html</a></li><li id="be1c" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated">bean验证</li></ul><p id="a172" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在这一点上，我们应该有一些编译问题，因为一些注释由于我们已经替换的丢失的依赖项。我们现在就更正。</p><h1 id="d878" class="kn ko hi bd kp kq ma ks kt ku mb kw kx io mc ip kz ir md is lb iu me iv ld le bi translated">步骤2:更改端点的注释</h1><p id="48c5" class="pw-post-body-paragraph jj jk hi jl b jm lf ij jo jp lg im jr js lh ju jv jw li jy jz ka lj kc kd ke hb bi translated">在上一个教程中，我们使用一个配置类记录了我们的API</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="fc5f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里我们有两个选择</p><ul class=""><li id="2daa" class="lk ll hi jl b jm jn jp jq js lm jw ln ka lo ke lp lq lr ls bi translated">声明新的配置类</li><li id="8ac0" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated">在我们的<a class="ae kf" href="https://javarevisited.blogspot.com/2017/11/difference-between-component-service.html" rel="noopener ugc nofollow" target="_blank">控制器</a>中使用注释</li></ul><p id="63f3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我会给你2个OpenApi方式的前面的代码等价的例子</p><h2 id="2eaa" class="mf ko hi bd kp mg mh mi kt mj mk ml kx js mm mn kz jw mo mp lb ka mq mr ld ms bi translated">配置类</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h2 id="a807" class="mf ko hi bd kp mg mh mi kt mj mk ml kx js mm mn kz jw mo mp lb ka mq mr ld ms bi translated">带注释</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h2 id="c818" class="mf ko hi bd kp mg mh mi kt mj mk ml kx js mm mn kz jw mo mp lb ka mq mr ld ms bi translated">它在用户界面上会是什么样子</h2><p id="554d" class="pw-post-body-paragraph jj jk hi jl b jm lf ij jo jp lg im jr js lh ju jv jw li jy jz ka lj kc kd ke hb bi translated">前面的例子在UI页面中看起来是一样的，所以由您来选择您想要使用的方法</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/52615d49bd1483e89434aa2462eef540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cspnv6JdTib09Vhkti8ldg.png"/></div></div></figure><h1 id="afc3" class="kn ko hi bd kp kq ma ks kt ku mb kw kx io mc ip kz ir md is lb iu me iv ld le bi translated">步骤3:更改端点的注释</h1><h2 id="2014" class="mf ko hi bd kp mg mh mi kt mj mk ml kx js mm mn kz jw mo mp lb ka mq mr ld ms bi translated">Swagger 2.0注释</h2><p id="cc2c" class="pw-post-body-paragraph jj jk hi jl b jm lf ij jo jp lg im jr js lh ju jv jw li jy jz ka lj kc kd ke hb bi translated">让我们举一个例子</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="2c5c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里有一个用classique Swagger 2注释记录的<a class="ae kf" href="https://www.java67.com/2016/09/when-to-use-put-or-post-in-restful-web-services.html" rel="noopener ugc nofollow" target="_blank"> POST方法</a></p><ul class=""><li id="1930" class="lk ll hi jl b jm jn jp jq js lm jw ln ka lo ke lp lq lr ls bi translated"><strong class="jl hj"> @ApiOperation </strong>:描述针对特定路径的操作或者典型的HTTP方法。</li><li id="5a37" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated"><strong class="jl hj"> @ApiResponses </strong>:一个允许多个ApiResponse对象列表的包装器。这里我有2个<strong class="jl hj"> @ApiResponse </strong>来描述我的200和500 HTTP状态返回代码。<br/>我还可以描述我的状态将返回什么，200将用一个objet响应，所以我将object类添加到<em class="mu">响应</em>字段。</li></ul><p id="205e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这将在UI页面中呈现如下图片</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/579725478349af6a1eb123facb7aa41e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lEy9hNfq7JKeiSXM.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/a90b688cd5693291df6c1532935111a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*umcAcTvxyu9sBGZB.png"/></div></div></figure><p id="f0e6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这是GET方法的第二个例子</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="8ddb" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里除了前面的注释，我还使用<strong class="jl hj"> @ApiParam </strong>添加了方法参数的文档。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/50875a198fd03a1ea3016f74034a82fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGoQfsjUPQN9mroeA368pA.png"/></div></div></figure><p id="175e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">有了新的依赖关系，所描述的注释不再相同。<br/>那么让我们来看看发生了什么变化。</p><h2 id="9a63" class="mf ko hi bd kp mg mh mi kt mj mk ml kx js mm mn kz jw mo mp lb ka mq mr ld ms bi translated">OpenAPI注释</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="55cf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在上面的例子中，我们可以看到一些操作上的变化。</p><ul class=""><li id="e0d3" class="lk ll hi jl b jm jn jp jq js lm jw ln ka lo ke lp lq lr ls bi translated"><strong class="jl hj">@ API Operation</strong>-&gt;<strong class="jl hj">@ Operation</strong>，<em class="mu">值</em>字段变为<em class="mu">汇总</em>，<em class="mu">注释</em>变为<em class="mu">描述。</em></li><li id="fc7c" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated"><strong class="jl hj"> @ApiResponse </strong>:字段<em class="mu"> code </em>变成<em class="mu"> responseCode </em>不再是整数而是字符串，字段<em class="mu"> message </em>也变成<em class="mu"> description </em>。<br/>最大的变化是响应字段现在是一个注释。<strong class="jl hj">@内容。</strong></li><li id="4bd8" class="lk ll hi jl b jm lt jp lu js lv jw lw ka lx ke lp lq lr ls bi translated"><strong class="jl hj"> @ApiParam </strong>变成<strong class="jl hj">@参数</strong></li></ul><p id="03ee" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">它们是其他的变化，但是由于这里没有用到，我推荐你使用<a class="ae kf" href="https://springdoc.org/#Introduction" rel="noopener ugc nofollow" target="_blank"> openAPI文档</a>。</p><h1 id="53bd" class="kn ko hi bd kp kq ma ks kt ku mb kw kx io mc ip kz ir md is lb iu me iv ld le bi translated">步骤4:更改模型的注释</h1><h2 id="3c7d" class="mf ko hi bd kp mg mh mi kt mj mk ml kx js mm mn kz jw mo mp lb ka mq mr ld ms bi translated">Swagger 2.0注释</h2><p id="df01" class="pw-post-body-paragraph jj jk hi jl b jm lf ij jo jp lg im jr js lh ju jv jw li jy jz ka lj kc kd ke hb bi translated">所以在Swagger 2中，当我想记录一个对象时，我的类看起来像这样</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="a4fc" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如你所见，我的类用<strong class="jl hj"> @ApiModel </strong>注释，它的属性用<strong class="jl hj"> @ApiModelProperty注释。<br/></strong><strong class="jl hj">@ ApiModelProperty</strong>允许我们添加描述(值)、名称、数据类型、示例值和允许值等定义。</p><h2 id="f884" class="mf ko hi bd kp mg mh mi kt mj mk ml kx js mm mn kz jw mo mp lb ka mq mr ld ms bi translated">OpenAPI注释</h2><p id="c92f" class="pw-post-body-paragraph jj jk hi jl b jm lf ij jo jp lg im jr js lh ju jv jw li jy jz ka lj kc kd ke hb bi translated">如果您仔细查看我的ApiResponse(状态代码为200)，您将会看到响应现在是<strong class="jl hj"> @Content </strong>，并且我们为schema字段提供了将像这样返回的类@ Schema(implementation = my class . class)。有了注释，OpenApi知道加载哪个类，所以我不必用类似注释来注释我的类，但是我仍然可以记录我的属性。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="a718" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">那么，我在这里做了什么？<br/>像以前一样，我的字段被记录，但我使用了两种不同的方法进行验证(大小)。</p><p id="34a2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我可以使用bean验证注释，或者我可以使用模式注释的属性，结果将是相同的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/fab7242c02bf13dc37d7e0d111359afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YhvQOL3wccWxluJrjwLjZQ.png"/></div></div></figure><p id="380e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">位置属性不再存在，字段的顺序与类的顺序相同。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="7a78" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">感谢您的阅读时间，和以前一样，本教程中使用的代码可以在<a class="ae kf" href="https://github.com/ErwanLT/HumanCloningFacilities" rel="noopener ugc nofollow" target="_blank">this Github repository</a>toOpenApi分支中找到。</p></div></div>    
</body>
</html>