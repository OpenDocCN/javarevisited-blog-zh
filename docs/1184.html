<html>
<head>
<title>Create your next Production Ready GraphQL API in minutes.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在几分钟内创建下一个生产就绪的GraphQL API。</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/create-your-next-production-ready-graphql-api-in-minutes-72da70b9a0ed?source=collection_archive---------2-----------------------#2021-04-24">https://medium.com/javarevisited/create-your-next-production-ready-graphql-api-in-minutes-72da70b9a0ed?source=collection_archive---------2-----------------------#2021-04-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d411000726c37ffaf3df069fe5f3a862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ESEaBvBebAm7t3d0sGC_OQ.jpeg"/></div></div><p class="hr hs et er es ht hu bd b be z dx translated"><a class="ae hv" href="https://unsplash.com/@possessedphotography?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">附身摄影</a>在<a class="ae hv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><div class=""/><p id="a1f4" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我告诉您，您可以在几分钟内创建一个使用Postgres实现持久性的全功能GraphQL服务器，那会怎么样？如果您将来更改了表模式，您的GraphQL API会自动检测到这种更改并自动进行自我更改？你会相信我吗？听起来很神奇，对吧？好吧，我向你保证这里没有魔法。我们将使用一些看起来像魔术一样的库。激动吗？好吧，让我们看看我们今天将使用哪些工具。</p><p id="3d6e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">波斯特格里斯:我们心爱的大象。</strong></p><figure class="ju jv jw jx fd hk er es paragraph-image"><div class="er es jt"><img src="../Images/3efbca83aa7057208b48409bf75ade45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*szUy4of1spvhYVlwUdRNsg.png"/></div><p class="hr hs et er es ht hu bd b be z dx translated">照片由<a class="ae hv" href="https://unsplash.com/@gerandeklerk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Geran de Klerk </a>在<a class="ae hv" href="https://unsplash.com/s/photos/elephant?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="569a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我说很多的时候，Postgres 有很多特点，哦，天哪，真的很多。事实上，Postgres比其他任何开源数据库都有更多的特性。你知道Postgres也可以处理你的申请的授权部分吗？不仅如此，你还可以用Postgres编写你的业务代码。不相信我？今天，我们将做同样的事情，我们的业务代码将只使用Postgres。</p><p id="5772" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">海报:巫师。</strong></p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es jy"><img src="../Images/915d993f3a61d561d12c308b950ddd77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*knOg-IXYdorWB8JnYOS4_w.jpeg"/></div></div><p class="hr hs et er es ht hu bd b be z dx translated">Artem Maltsev 在<a class="ae hv" href="https://unsplash.com/s/photos/wizard?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0dfc" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">PostGraphile将为我们做所有的繁重工作，它将与Postgres DB连接，并将我们的数据库作为graphQL API公开。在Postgtaphile的官方<a class="ae hv" href="https://www.graphile.org/postgraphile/" rel="noopener ugc nofollow" target="_blank">网站</a>上，他们已经将其定义为:</p><blockquote class="jz ka kb"><p id="41fd" class="iv iw kc ix b iy iz ja jb jc jd je jf kd jh ji jj ke jl jm jn kf jp jq jr js hb bi translated">PostGraphile会自动检测表、列、索引、关系、视图、类型、函数、注释等——提供一个对数据高度智能的GraphQL服务器，当您修改数据库时，它会自动更新自己而无需重新启动。</p></blockquote><p id="63df" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">酷吧？PostGraphile是一个开源项目，他们创建了如此高效的库，值得称赞。如果你打算在生产中使用postgrapile，你也可以查看他们的pro计划，解锁postgrapile的一些新特性。</p><p id="2edb" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以找到设置Postgraphile的说明，而<a class="ae hv" href="https://javarevisited.blogspot.com/2020/02/top-5-courses-to-learn-postgresql-in.html" rel="noopener ugc nofollow" target="_blank"> Postgres </a>可以在<a class="ae hv" href="https://www.graphile.org/postgraphile/quick-start-guide/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="3293" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，让我们创建两个模式。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="7ffb" class="kl km hy kh b fi kn ko l kp kq">create schema medium_example_public;<br/>create schema medium_example_private;<br/>commit;</span></pre><p id="3cf7" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以创建任意多的模式，但是在本教程中，我将使用2个模式。我将在公共模式和私有模式中创建所有表，其中将有与身份验证相关的表。如果您也打算在生产中使用Postgraphile，我建议在不同的模式中定义表结构，然后在带有视图的公共模式中公开这些表。</p><p id="133d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们在公共模式中创建一个表来包含作者的数据。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="4abe" class="kl km hy kh b fi kn ko l kp kq">create table medium_example_public.author (<br/> id               serial primary key,<br/> name       text not null check (char_length(name) &lt; 80),<br/> about            text,<br/> created_at       timestamp default now()<br/>);<br/></span></pre><p id="65de" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在每个作家都可以写关于某个主题的文章，所以让我们首先创建一个具有不同主题名称的<a class="ae hv" href="https://www.java67.com/2018/07/java-enum-with-constructor-example.html" rel="noopener ugc nofollow" target="_blank"> enum </a>，稍后在帖子的表格中使用。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="6358" class="kl km hy kh b fi kn ko l kp kq">create type medium_example_public.post_topic as enum (<br/>'Programming',<br/>'Gaming',<br/>'Music',<br/>'Culture'<br/>);</span></pre><p id="4a13" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们再创建一个表来存储所有的文章。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="afb6" class="kl km hy kh b fi kn ko l kp kq">create table medium_example_public.post (<br/>id               serial primary key,<br/>author_id        integer not null references<br/>medium_example_public.author(id),<br/>title         text not null check (char_length(title) &lt; 280),<br/>body             text,<br/>topic            medium_example_public.post_topic,<br/>created_at       timestamp default now()<br/>);</span></pre><p id="5120" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，我们已经创建了2个表，我们还可以在自动生成的文档中添加表和列的注释。所以让我们也这样做吧</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="b842" class="kl km hy kh b fi kn ko l kp kq">comment on table medium_example_public.author is 'A user of the medium.';<br/>comment on column medium_example_public.author.id is 'The primary unique identifier for the person.';<br/>comment on column medium_example_public.author.name is 'The person’s  name.';<br/>comment on column medium_example_public.author.about is 'A short description about the user, written by the user.';<br/>comment on column medium_example_public.author.created_at is 'The time this person was created.';</span><span id="543a" class="kl km hy kh b fi kr ko l kp kq">comment on table medium_example_public.post is 'A forum post written by a author.';<br/>comment on column medium_example_public.post.id is 'The primary key for the post.';<br/>comment on column medium_example_public.post.title is 'The title written by the user.';<br/>comment on column medium_example_public.post.author_id is 'The id of the author.';<br/>comment on column medium_example_public.post.topic is 'The topic this has been posted in.';<br/>comment on column medium_example_public.post.body is 'The main body text of our post.';<br/>comment on column medium_example_public.post.created_at is 'The time this post was created.';</span></pre><p id="2086" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在你已经拥有了运行GraphQL的API的一切。让我们开始PostGraphile</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="f54b" class="kl km hy kh b fi kn ko l kp kq">postgraphile -c postgres://postgres:123456@127.0.0.1/medium --schema medium_example_public</span></pre><p id="b88f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经可以运行一些GraphQL的查询，让我们假设对于作者的主页，我们需要获取作者的详细信息和作者写的所有帖子。这很容易做到，如下所示。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><a href="https://dev.to/javinpaul/5-best-courses-to-learn-graphql-in-2020-2fo5"><div class="er es ks"><img src="../Images/aad7043268c37810da41ff1aa01ca568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o00PuPckgA-ThYsAUPFVmQ.png"/></div></a></figure><p id="7bdf" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">令人难以置信的是，我们已经有一些基本的GraphQL查询在运行，对吗？如果你想根据你的业务支持一些其他的GraphQL，那也可以毫不费力地实现。假设您想在文章的正文和标题中搜索一个字符串。我们可以在Postgres中编写函数来支持业务操作。例如，我们可以编写下面的函数来搜索文章。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="28dd" class="kl km hy kh b fi kn ko l kp kq">create function medium_example_public.search_posts(search text)<br/>returns setof medium_example_public.post as $$<br/>select post.*<br/>from medium_example_public.post as post<br/>where position(search in post.title) &gt; 0 or position(search in post.body) &gt; 0<br/>$$ language sql stable;</span><span id="16d6" class="kl km hy kh b fi kr ko l kp kq">comment on function medium_example_public.search_posts(text) is 'Returns posts containing a given search term.';</span></pre><p id="77a7" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以看到它是多么简单。现在我们也来测试一下。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kt"><img src="../Images/0a44cba125df993506a76ec1e8008002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-A360lPNR8V4GHakBN9xw.png"/></div></div></figure><p id="094f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你能在这么短的时间内做这么多事情，这是多么酷啊？不仅如此，如果您愿意，还可以在查询中使用分页。</p><p id="73ac" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可能想知道这可能是开发GraphQL API最快的方法，但是安全性在哪里呢？嗯，你说得对，没有安全性，我们无法部署任何应用程序。</p><p id="dd65" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了API的安全性，我们将使用<a class="ae hv" rel="noopener" href="/javarevisited/top-10-courses-to-learn-spring-security-and-oauth2-with-spring-boot-for-java-developers-8f0222d6066d"> JWT令牌</a>。您需要定义PostGraphile将用来生成JWT令牌的数据类型。我们需要我们的JWT令牌来包含关于作者的帐户id、角色和令牌到期日期的信息。所以我们将在Postgres中创建一个类型，如下所示。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="029b" class="kl km hy kh b fi kn ko l kp kq">create type <!-- -->medium_example_public<!-- -->.jwt_token as (<br/>  role text,<br/>  <!-- -->account_id <!-- -->integer,<br/>  exp bigint<br/>);</span></pre><p id="9853" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">PostGraphile将采用这种类型，为我们制作一个JWT令牌。我们还需要存储用户的电子邮件和密码，这样一旦用户通过身份验证，我们就可以在输出中给他发送一个JWT令牌。让我们在私有模式中为它创建一个表。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="68a4" class="kl km hy kh b fi kn ko l kp kq">create table medium_example_private.account (<br/>account_id        integer primary key references medium_example_public.author(id) on delete cascade,<br/>email            text not null unique check (email ~* '^.+@.+\..+$'),<br/>password    text not null<br/>);<br/>comment on table medium_example_private.account is 'login details about authors account.';<br/>comment on column medium_example_private.account.account_id is 'Author Id';<br/>comment on column medium_example_private.account.email is 'The email address of the author.';<br/>comment on column medium_example_private.account.password is 'password of author, stored as hash.'</span></pre><p id="80a2" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在account表中，我们存储了电子邮件id、散列加密密码和作者id。现在，让我们创建一个函数，它接受电子邮件和密码作为输入，并在输出中返回JWT令牌。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="dde6" class="kl km hy kh b fi kn ko l kp kq">create function medium_example_public.authenticate(email text,<br/>password text) returns medium_example_public.jwt_token as $$<br/>declare<br/>account medium_example_private.account;<br/>begin<br/>select a.* into account from medium_example_private.account as a<br/>where a.email = $1;<br/>if account.password = crypt(password, account.password) then<br/>return ('medium_example_author', account.account_id, extract(epoch from (now() + interval '1 days')))::medium_example_public.jwt_token;<br/>else<br/>return null;<br/>end if;<br/>end;<br/>$$ language plpgsql strict security definer;</span><span id="64c2" class="kl km hy kh b fi kr ko l kp kq">comment on function medium_example_public.authenticate(text, text) is 'Create a JWT token with 1 day of validity';</span></pre><p id="3356" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你知道基本的<a class="ae hv" rel="noopener" href="/javarevisited/7-free-courses-to-learn-database-and-sql-for-programmers-and-data-scientist-e7ae19514ed2"> SQL </a>，你就已经知道我们在上面的函数中做了什么。我们正在尝试验证用户，如果电子邮件和密码是正确的，我们发送JWT，否则返回null。如果你想知道什么是地穴？这是Postgres中的一个函数，它将返回字符串的散列值。</p><p id="6918" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看这么多SQL烦不烦？再忍耐我两秒钟。让我们快速地写一个函数来注册一个用户。这个函数将在account表和author表中插入数据。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="a3da" class="kl km hy kh b fi kn ko l kp kq">create function medium_example_public.register_author(<br/>name text,<br/>email text,<br/>password text<br/>) returns medium_example_public.author as $$<br/>declare<br/>author medium_example_public.author;<br/>begin<br/>insert into medium_example_public.author (name) values<br/>(name)<br/>returning * into author ;<br/>insert into medium_example_private.account (account_id, email, password) values<br/>(author.id, email, crypt(password, gen_salt('bf')));<br/>return author;<br/>end;<br/>$$ language plpgsql strict security definer;<br/>comment on function medium_example_public.register_author(text, text, text, text) is 'Register an author';</span></pre><p id="6603" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们有了注册用户的方法，登录用户的方法，但是嘿！我想我们还是遗漏了一些东西。我知道，我们缺少角色，每个用户都应该有不同的角色，就像用户应该能够在没有帐户的情况下查看和搜索帖子，每个用户只能访问其个人数据。为此，我们将使用Postgres的角色，让我们创建2个角色:</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="e8fc" class="kl km hy kh b fi kn ko l kp kq">create role medium_example_anonymous;<br/>create role medium_example_author;</span></pre><p id="177a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们现在有一个匿名角色和一个作者角色。现在，让我们根据我们的业务在这些表格上申请一些资助。我们的匿名用户应该只能查看帖子，搜索帖子，注册为作者，并查看其他作者。一旦用户登录，他可以修改文章，创建新文章，甚至删除文章。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="ce8c" class="kl km hy kh b fi kn ko l kp kq">alter default privileges revoke execute on functions from public;<br/>grant usage on schema medium_example_public to medium_example_anonymous, medium_example_author;<br/>grant select on table medium_example_public.author to medium_example_anonymous, medium_example_author;<br/>grant update, delete on table medium_example_public.author to medium_example_author;</span><span id="0af0" class="kl km hy kh b fi kr ko l kp kq">grant select on table medium_example_public.post to medium_example_anonymous, medium_example_author;<br/>grant insert, update, delete on table medium_example_public.post to medium_example_author;<br/>grant usage on sequence medium_example_public.post_id_seq to medium_example_author;<br/>grant execute on function medium_example_public.search_posts(text) to medium_example_anonymous, medium_example_author;<br/>grant execute on function medium_example_public.authenticate(text, text) to medium_example_anonymous, medium_example_author;<br/>grant execute on function medium_example_public.register_author(text, text, text) to medium_example_anonymous;</span></pre><p id="0dc4" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认情况下，Postgres中的函数可以从公众中执行，在上面的第一行中，我们限制了由公众执行的函数。然后我们根据我们的需求授予表和函数。现在让我们试着注册一个用户。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/02/top-5-postman-tutorials-and-courses-for-web-developers.html"><div class="er es ku"><img src="../Images/d42a8f549ba1ba285f79502ffd975dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j2jS8spLaOPWgZmeVcHLfw.png"/></div></a></figure><p id="4fc6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">很好，我们的用户已经注册成功。现在让我们尝试用这个用户获得一个JWT令牌。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kv"><img src="../Images/b5fa1a1e2e94808732ff8b4e90e14ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HG9rJ70vfv6NcQrjK1Eunw.png"/></div></div></figure><p id="82f6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如你所看到的，我们也成功地获得了JWT令牌。现在让我们用这个令牌创建一个帖子。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kw"><img src="../Images/2f7e27ed97fd8e9563e60bf90c46ba25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3bStZ1bZWdCaH62lKy2Vng.png"/></div></div></figure><p id="57a0" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在有一个问题，我们只是验证一个用户是否是我们网站的注册用户，这意味着一个用户也可以代表其他用户发帖。这是不好的，我们肯定要改变它。Postgres还支持行级锁。因此，我们将使用行级锁，并确保我们的用户只能为自己发帖。</p><pre class="ju jv jw jx fd kg kh ki kj aw kk bi"><span id="3692" class="kl km hy kh b fi kn ko l kp kq">alter table medium_example_public.author enable row level security;<br/>alter table medium_example_public.post enable row level security;</span><span id="80fe" class="kl km hy kh b fi kr ko l kp kq">create policy select_author on medium_example_public.author for select using (true);<br/>create policy select_post on medium_example_public.post for select<br/>using (true);<br/>create policy update_person on medium_example_public.author for update to forum_example_person using (id = nullif(current_setting('jwt.claims.account_id', true), '')::integer);<br/>create policy delete_person on medium_example_public.author for delete to forum_example_person using (id = nullif(current_setting('jwt.claims.account_id', true), '')::integer);<br/>create policy insert_post on medium_example_public.author for insert to forum_example_person with check (author_id = nullif(current_setting('jwt.claims.account_id', true), '')::integer);<br/>create policy update_post on medium_example_public.author for update to forum_example_person using (author_id = nullif(current_setting('jwt.claims.account_id', true), '')::integer);<br/>create policy delete_post on medium_example_public.post for delete to forum_example_person using (author_id = nullif(current_setting('jwt.claims.person_id', true), '')::integer);</span></pre><p id="0a70" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们试着用其他用户的作者id创建一篇文章</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ku"><img src="../Images/d4e2f1deb03d1e92dcab493e20579d06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KSuyq8xaN2_zl1T1TiP99A.png"/></div></div></figure><p id="fe99" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如你所见，我们不允许这样做。好了，今天就到这里吧。如果你读到这里，我真的要感谢你。</p><h1 id="92f1" class="kx km hy bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">结论</strong></h1><p id="d017" class="pw-post-body-paragraph iv iw hy ix b iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo ly jq jr js hb bi translated">当你要开始创业时，尽快实现你的想法是非常重要的。在这种情况下，像Postgraphile和Postgres这样的工具会派上用场。在开发的大部分时间里，我们浪费时间重新创建已经存在的特性，比如Postgres中的授权。想象一下，如果你不得不在<a class="ae hv" rel="noopener" href="/javarevisited/top-10-courses-to-learn-spring-boot-in-2020-best-of-lot-6ffce88a1b6e"> Spring boot </a>中做同样的事情，你将会为认证、基于角色的访问写很多代码，而这些你实际上并不需要。我强烈建议你应该尝试一下PostGraphile。</p><h1 id="61a7" class="kx km hy bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">资源</h1><div class="hh hi ez fb hj lz"><a href="https://www.graphile.org/postgraphile/postgresql-schema-design/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hz fi z dy me ea eb mf ed ef hx bi translated">PostgreSQL模式设计</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">Postgres数据库的功能非常丰富，远远超过其他任何数据库。然而，大多数开发人员并不…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">www.graphile.org</p></div></div></div></a></div><div class="hh hi ez fb hj lz"><a href="https://netflixtechblog.com/beyond-rest-1b76f7c20ef6" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hz fi z dy me ea eb mf ed ef hx bi translated">超越休息</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">GraphQL微服务的快速开发</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">netflixtechblog.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn hp lz"/></div></div></a></div></div></div>    
</body>
</html>