<html>
<head>
<title>Content Security Policy in a Nutshell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简而言之，内容安全政策</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/content-security-policy-in-a-nutshell-feeaab793fd?source=collection_archive---------2-----------------------#2020-04-05">https://medium.com/javarevisited/content-security-policy-in-a-nutshell-feeaab793fd?source=collection_archive---------2-----------------------#2020-04-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><a href="https://medium.com/javarevisited/top-10-courses-to-learn-spring-security-and-oauth2-with-spring-boot-for-java-developers-8f0222d6066d"><div class="er es if"><img src="../Images/18a72a4457a3198b8bb3de9e89c99446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODCxFgHfwQeNmGSN7NKyOQ.jpeg"/></div></a><p class="im in et er es io ip bd b be z dx translated"><a class="ae iq" href="https://unsplash.com/@casparrubin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卡斯帕·卡米尔·鲁宾</a>上<a class="ae iq" href="https://unsplash.com/s/photos/javascript?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><blockquote class="ir is it"><p id="df85" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">内容安全策略(CSP)是一个安全层，用于缓解诸如跨站点脚本(XSS)和数据注入等攻击</p></blockquote><p id="a01f" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">网页可以以不同的方式与不同的网页内容进行交互。很少有人加载和执行内联和外部JS &amp; CSS文件，进行AJAX调用，将图像/字体等资源加载到web应用程序中。以这种方式，如此多的内容与网络应用相关联。</p><p id="9115" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">由于上述内容与网页的交互，可能存在诸如跨站脚本(XSS)和代码注入等攻击。为了防止这些攻击，添加了策略安全层。</p><p id="824c" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">CSP可以通过两种方法实现</p><ol class=""><li id="a63e" class="jw jx hi ix b iy iz jc jd jt jy ju jz jv ka js kb kc kd ke bi translated">使用HTTP响应头(<code class="du kf kg kh ki b"><strong class="ix hj">Content-Security-Policy</strong></code>)</li><li id="6652" class="jw jx hi ix b iy kj jc kk jt kl ju km jv kn js kb kc kd ke bi translated">在html文件中使用meta元素(<meta> </meta>)</li></ol><p id="c254" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">当使用上述方法之一将CSP规则添加到特定网页时，web浏览器会检查这些策略并据此采取行动。</p><p id="6d80" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">下面是一些常见的CSP示例</p><ol class=""><li id="e9e6" class="jw jx hi ix b iy iz jc jd jt jy ju jz jv ka js kb kc kd ke bi translated">所有内容将来自该网站自己的起源</li></ol><pre class="ko kp kq kr fd ks ki kt ku aw kv bi"><span id="d203" class="kw kx hi ki b fi ky kz l la lb">Content-Security-Policy: default-src 'self'</span></pre><p id="c1ea" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">2.所有内容将来自该网站自己的起源和example.com的子域</p><pre class="ko kp kq kr fd ks ki kt ku aw kv bi"><span id="9241" class="kw kx hi ki b fi ky kz l la lb">Content-Security-Policy: default-src 'self' *.example.com</span></pre><p id="947e" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">3.所有内容将来自example.com通过TLS安全渠道只</p><pre class="ko kp kq kr fd ks ki kt ku aw kv bi"><span id="22a5" class="kw kx hi ki b fi ky kz l la lb">Content-Security-Policy: default-src https://example.com</span></pre><p id="7afd" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">4.所有内容将来自example.com，图像可以来自任何地方</p><pre class="ko kp kq kr fd ks ki kt ku aw kv bi"><span id="c7da" class="kw kx hi ki b fi ky kz l la lb">Content-Security-Policy: default-src <a class="ae iq" href="https://example.com;" rel="noopener ugc nofollow" target="_blank">https://example.com;</a> img-src *</span></pre><p id="3133" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">5.允许内联脚本执行(写在<script>标签内的脚本)&lt;/root&gt;</script></p><pre class="ko kp kq kr fd ks ki kt ku aw kv bi"><span id="d2da" class="kw kx hi ki b fi ky kz l la lb">Content-Security-Policy: script-src 'unsafe-inline'</span><span id="c935" class="kw kx hi ki b fi lc kz l la lb">This method allows all the inline scripts, but hash value of a script can be given to enforce more security.</span><span id="46ec" class="kw kx hi ki b fi lc kz l la lb">Content-Security-Policy: script-src '&lt;HashAlgorithm&gt;-&lt;Base64 encoded hash of the script&gt;'</span></pre><p id="f0ec" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">测试样本策略</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ld le l"/></div><p class="im in et er es io ip bd b be z dx translated"><a class="ae iq" href="https://gist.github.com/tnishada/a4fa36d381be945054ec8cee8b999c7d" rel="noopener ugc nofollow" target="_blank">样本HTML代码</a></p></figure><p id="d6c3" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">在此<a class="ae iq" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-html-5-css-3-and-web-development-872d62d97a97"> HTML </a>代码中，CSP被设置为<strong class="ix hj">default-src‘self’，</strong>因此浏览器不会加载任何外部资源或执行任何内联脚本。</p><p id="7f17" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">在浏览器中打开上面的HTML代码。然后，您将在浏览器控制台中看到两条错误消息，说明它无法加载外部jquery文件，也无法执行内联脚本。</p><p id="152f" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">之后，请用下面的标签替换meta标签，并重新加载浏览器。然后你会看到所有的东西都被正确地加载/执行了。</p><pre class="ko kp kq kr fd ks ki kt ku aw kv bi"><span id="2897" class="kw kx hi ki b fi ky kz l la lb">&lt;meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src * 'unsafe-inline' ;"&gt;</span></pre><p id="9a74" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">通过这种方式，您可以测试这个内容安全策略。</p><p id="6a03" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated">参考资料:</p><p id="36b7" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated"><a class="ae iq" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="noopener ugc nofollow" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP</a></p><p id="4dae" class="pw-post-body-paragraph iu iv hi ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hb bi translated"><a class="ae iq" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy</a></p></div></div>    
</body>
</html>