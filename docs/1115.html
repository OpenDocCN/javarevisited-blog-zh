<html>
<head>
<title>Guidelines for Java code review</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java代码审查指南</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/guidelines-for-java-code-review-12756c8a89b9?source=collection_archive---------0-----------------------#2021-04-01">https://medium.com/javarevisited/guidelines-for-java-code-review-12756c8a89b9?source=collection_archive---------0-----------------------#2021-04-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2560" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Java开发人员快速审查代码的技巧。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/31993ecf4364c2670b9679495ce55bc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AVG9-XVvHnOXgIF1.png"/></div></div></figure><p id="97a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让另一双眼睛审视你的代码总是有用的，可以帮助你在中断生产之前发现错误。你不需要成为专家来审查别人的代码。一些编程语言的经验和一个回顾清单应该可以帮助你开始。我们整理了一份清单，列出了您在审查Java代码时应该记住的事情。请继续阅读！</p><h1 id="7f46" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">1.遵循Java代码约定</h1><p id="9202" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">遵循语言约定有助于快速浏览代码并理解它，从而提高可读性。例如，Java中所有的包名都是小写的，常量全部大写，变量名用CamelCase，等等。点击此处查看<a class="ae ks" href="https://www.oracle.com/technetwork/java/codeconventions-150003.pdf" rel="noopener ugc nofollow" target="_blank">会议的完整列表。</a></p><p id="42cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些团队开发了他们自己的约定，所以在这种情况下要灵活！</p><h1 id="9107" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">2.用lambdas和streams替换命令式代码</h1><p id="7421" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">如果您使用的是Java 8+，用streams和lambdas替换循环和极其冗长的方法会使代码看起来更整洁。<a class="ae ks" rel="noopener" href="/javarevisited/7-best-java-tutorials-and-books-to-learn-lambda-expression-and-stream-api-and-other-features-3083e6038e14?source=---------14------------------"> Lambdas </a>和<a class="ae ks" rel="noopener" href="/javarevisited/7-best-java-collections-and-stream-api-courses-for-beginners-in-2020-3ad18d52c38"> streams </a>允许你用Java编写功能代码。以下代码片段以传统的命令方式过滤奇数:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="f279" class="ky jq hi ku b fi kz la l lb lc">List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> oddNumbers <strong class="ku hj">=</strong> <strong class="ku hj">new</strong> ArrayList<strong class="ku hj">&lt;&gt;();</strong><br/><strong class="ku hj">for</strong> <strong class="ku hj">(</strong>Integer number <strong class="ku hj">:</strong> Arrays<strong class="ku hj">.</strong>asList<strong class="ku hj">(</strong>1<strong class="ku hj">,</strong> 2<strong class="ku hj">,</strong> 3<strong class="ku hj">,</strong> 4<strong class="ku hj">,</strong> 5<strong class="ku hj">,</strong> 6<strong class="ku hj">))</strong> <strong class="ku hj">{</strong><br/>	<strong class="ku hj">if</strong> <strong class="ku hj">(</strong>number <strong class="ku hj">%</strong> 2 <strong class="ku hj">!=</strong> 0<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>	  oddNumbers<strong class="ku hj">.</strong>add<strong class="ku hj">(</strong>number<strong class="ku hj">);</strong><br/>  <strong class="ku hj">}</strong><br/><strong class="ku hj">}</strong></span></pre><p id="41e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是<a class="ae ks" href="http://javarevisited.blogspot.sg/2013/04/how-to-check-if-number-is-even-or-odd.html#axzz59AWpr6cb" rel="noopener ugc nofollow" target="_blank">过滤奇数</a>的功能方式:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="ccd1" class="ky jq hi ku b fi kz la l lb lc">List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> oddNumbers <strong class="ku hj">=</strong> Stream<strong class="ku hj">.</strong>of<strong class="ku hj">(</strong>1<strong class="ku hj">,</strong> 2<strong class="ku hj">,</strong> 3<strong class="ku hj">,</strong> 4<strong class="ku hj">,</strong> 5<strong class="ku hj">,</strong> 6<strong class="ku hj">)</strong><br/>  <strong class="ku hj">.</strong>filter<strong class="ku hj">(</strong>number <strong class="ku hj">-&gt;</strong> number <strong class="ku hj">%</strong> 2 <strong class="ku hj">!=</strong> 0<strong class="ku hj">)</strong><br/>  <strong class="ku hj">.</strong>collect<strong class="ku hj">(</strong>Collectors<strong class="ku hj">.</strong>toList<strong class="ku hj">());</strong></span></pre><h1 id="730b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">3.当心<code class="du ld le lf ku b">NullPointerException</code></h1><p id="77c7" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">当编写新方法时，如果可能的话，尽量避免返回空值。这可能导致空指针异常。在下面的代码片段中，如果列表中没有整数，则最高方法返回null。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="4e84" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">class</strong> <strong class="ku hj">Items</strong> <strong class="ku hj">{</strong><br/>	<strong class="ku hj">private</strong> <strong class="ku hj">final</strong> List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> items<strong class="ku hj">;</strong><br/>	<strong class="ku hj">public</strong> <strong class="ku hj">Items(</strong>List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> items<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>	        <strong class="ku hj">this.</strong>items <strong class="ku hj">=</strong> items<strong class="ku hj">;</strong><br/>	<strong class="ku hj">}</strong><br/>	<strong class="ku hj">public</strong> Integer <strong class="ku hj">highest()</strong> <strong class="ku hj">{</strong><br/>	  <strong class="ku hj">if</strong> <strong class="ku hj">(</strong>items<strong class="ku hj">.</strong>isEmpty<strong class="ku hj">())</strong> <strong class="ku hj">return</strong> <strong class="ku hj">null;</strong><br/>	  Integer highest <strong class="ku hj">=</strong> <strong class="ku hj">null;</strong><br/>	  <strong class="ku hj">for</strong> <strong class="ku hj">(</strong>Integer item <strong class="ku hj">:</strong> items<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>	      <strong class="ku hj">if</strong> <strong class="ku hj">(</strong>items<strong class="ku hj">.</strong>indexOf<strong class="ku hj">(</strong>item<strong class="ku hj">)</strong> <strong class="ku hj">==</strong> 0<strong class="ku hj">)</strong> highest <strong class="ku hj">=</strong> item<strong class="ku hj">;</strong><br/>	      <strong class="ku hj">else</strong> highest <strong class="ku hj">=</strong> highest <strong class="ku hj">&gt;</strong> item <strong class="ku hj">?</strong> highest <strong class="ku hj">:</strong> item<strong class="ku hj">;</strong><br/>	  <strong class="ku hj">}</strong><br/>	  <strong class="ku hj">return</strong> highest<strong class="ku hj">;</strong><br/>	<strong class="ku hj">}</strong><br/><strong class="ku hj">}</strong></span></pre><p id="ef27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在直接调用对象上的方法之前，我建议检查一下<a class="ae ks" href="https://javarevisited.blogspot.com/2014/12/9-things-about-null-in-java.html#axzz6fLto55st" rel="noopener ugc nofollow" target="_blank">是否为空值</a>，如下所示。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="3a20" class="ky jq hi ku b fi kz la l lb lc">Items items <strong class="ku hj">=</strong> <strong class="ku hj">new</strong> Items<strong class="ku hj">(</strong>Collections<strong class="ku hj">.</strong>emptyList<strong class="ku hj">());</strong><br/>Integer item <strong class="ku hj">=</strong> items<strong class="ku hj">.</strong>highest<strong class="ku hj">();</strong><br/><strong class="ku hj">boolean</strong> isEven <strong class="ku hj">=</strong> item <strong class="ku hj">%</strong> 2 <strong class="ku hj">==</strong> 0<strong class="ku hj">;</strong> <em class="lg">// throws NullPointerException ❌<br/></em><strong class="ku hj">boolean</strong> isEven <strong class="ku hj">=</strong> item <strong class="ku hj">!=</strong> <strong class="ku hj">null</strong> <strong class="ku hj">&amp;&amp;</strong> item <strong class="ku hj">%</strong> 2 <strong class="ku hj">==</strong> 0  <em class="lg">// ✅</em></span></pre><p id="1c29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，在代码中到处都使用空检查是非常麻烦的。如果您使用的是Java 8+，可以考虑使用<code class="du ld le lf ku b">Optional</code>类来表示可能没有有效状态的值。它允许您轻松地定义替代行为，并且对于链接方法非常有用。</p><p id="e691" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的代码片段中，我们使用<a class="ae ks" href="https://javarevisited.blogspot.com/2020/04/top-5-courses-to-learn-java-collections-and-streams.html" rel="noopener ugc nofollow" target="_blank"> Java Stream API </a>通过返回<code class="du ld le lf ku b">Optional</code>的方法来查找最大的数字。注意，我们使用的是<code class="du ld le lf ku b">Stream.reduce</code>，它返回一个<code class="du ld le lf ku b">Optional</code>值。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="6585" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">public</strong> Optional<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> <strong class="ku hj">highest()</strong> <strong class="ku hj">{</strong><br/>    <strong class="ku hj">return</strong> items<br/>            <strong class="ku hj">.</strong>stream<strong class="ku hj">()</strong><br/>            <strong class="ku hj">.</strong>reduce<strong class="ku hj">((</strong>integer<strong class="ku hj">,</strong> integer2<strong class="ku hj">)</strong> <strong class="ku hj">-&gt;</strong> <br/>							integer <strong class="ku hj">&gt;</strong> integer2 <strong class="ku hj">?</strong> integer <strong class="ku hj">:</strong> integer2<strong class="ku hj">);</strong><br/><strong class="ku hj">}</strong><br/>Items items <strong class="ku hj">=</strong> <strong class="ku hj">new</strong> Items<strong class="ku hj">(</strong>Collections<strong class="ku hj">.</strong>emptyList<strong class="ku hj">());</strong><br/>items<strong class="ku hj">.</strong>highest<strong class="ku hj">().</strong>ifPresent<strong class="ku hj">(</strong>integer <strong class="ku hj">-&gt;</strong> <strong class="ku hj">{</strong>             <em class="lg">// ✅<br/></em>    <strong class="ku hj">boolean</strong> isEven <strong class="ku hj">=</strong> integer <strong class="ku hj">%</strong> 2 <strong class="ku hj">==</strong> 0<strong class="ku hj">;</strong><br/><strong class="ku hj">});</strong></span></pre><p id="417b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，您也可以使用像<code class="du ld le lf ku b">@Nullable</code>或<code class="du ld le lf ku b">@NonNull</code>这样的注释，如果在构建代码时出现空冲突，就会产生警告。例如，向接受<code class="du ld le lf ku b">@NonNull</code>参数的方法传递一个<code class="du ld le lf ku b">@Nullable</code>参数。</p><h1 id="1f85" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">4.直接从客户端代码向字段分配引用</h1><p id="930e" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">即使该字段是final，也可以操作向客户端代码公开的引用。让我们用一个例子来更好地理解这一点。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="a17d" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">private</strong> <strong class="ku hj">final</strong> List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> items<strong class="ku hj">;</strong><br/><strong class="ku hj">public</strong> <strong class="ku hj">Items(</strong>List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> items<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>        <strong class="ku hj">this.</strong>items <strong class="ku hj">=</strong> items<strong class="ku hj">;</strong><br/><strong class="ku hj">}</strong></span></pre><p id="c7a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码片段中，我们直接将客户端代码中的引用分配给一个字段。客户端可以很容易地改变列表的内容，并操纵我们的代码，如下所示。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="a9ac" class="ky jq hi ku b fi kz la l lb lc">List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> numbers <strong class="ku hj">=</strong> <strong class="ku hj">new</strong> ArrayList<strong class="ku hj">&lt;&gt;();</strong><br/>Items items <strong class="ku hj">=</strong> <strong class="ku hj">new</strong> Items<strong class="ku hj">(</strong>numbers<strong class="ku hj">);</strong><br/>numbers<strong class="ku hj">.</strong>add<strong class="ku hj">(</strong>1<strong class="ku hj">);</strong> <em class="lg">// This will change how items behaves as well</em></span></pre><p id="82e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相反，考虑<a class="ae ks" href="https://javarevisited.blogspot.com/2013/09/how-clone-method-works-in-java.html#axzz5Y4Ks1BbR" rel="noopener ugc nofollow" target="_blank">克隆引用</a>或创建一个新的引用，然后将其分配给字段，如下所示:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="9cdb" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">private</strong> <strong class="ku hj">final</strong> List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> items<strong class="ku hj">;</strong><br/><strong class="ku hj">public</strong> <strong class="ku hj">Items(</strong>List<strong class="ku hj">&lt;</strong>Integer<strong class="ku hj">&gt;</strong> items<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>    <strong class="ku hj">this.</strong>items <strong class="ku hj">=</strong> <strong class="ku hj">new</strong> ArrayList<strong class="ku hj">&lt;&gt;(</strong>items<strong class="ku hj">);</strong><br/><strong class="ku hj">}</strong></span></pre><p id="c45a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回引用时，同样的规则也适用。您需要小心谨慎，以免暴露内部可变状态。</p><h1 id="5cf3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">5.小心处理异常</h1><p id="6905" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在捕捉异常时，如果有多个catch块，请确保catch块的顺序从最特定到最不特定。在下面的代码片段中，异常永远不会在第二个块中被捕获，因为<code class="du ld le lf ku b">Exception</code>类是所有异常的母体。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="747b" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">try</strong> <strong class="ku hj">{</strong><br/>	stack<strong class="ku hj">.</strong>pop<strong class="ku hj">();</strong><br/><strong class="ku hj">}</strong> <strong class="ku hj">catch</strong> <strong class="ku hj">(</strong>Exception exception<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>	<em class="lg">// handle exception<br/></em><strong class="ku hj">}</strong> <strong class="ku hj">catch</strong> <strong class="ku hj">(</strong>StackEmptyException exception<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>	<em class="lg">// handle exception<br/></em><strong class="ku hj">}</strong></span></pre><p id="df53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果这种情况是可恢复的，并且可以由客户端(库或代码的消费者)处理，那么最好使用<a class="ae ks" href="https://javarevisited.blogspot.com/2011/12/checked-vs-unchecked-exception-in-java.html" rel="noopener ugc nofollow" target="_blank">检查异常</a>。例如<code class="du ld le lf ku b">IOException</code>是一个被检查的异常，它迫使客户端处理这个场景，如果客户端选择重新抛出异常，那么它应该是一个有意识的调用来忽略这个异常。</p><h1 id="b729" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">6.思考数据结构的选择</h1><p id="5405" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">Java集合提供<code class="du ld le lf ku b">ArrayList</code>、<code class="du ld le lf ku b">LinkedList</code>、<code class="du ld le lf ku b">Vector</code>、<code class="du ld le lf ku b">Stack</code>、<code class="du ld le lf ku b">HashSet</code>、<code class="du ld le lf ku b">HashMap</code>、<code class="du ld le lf ku b">Hashtable</code>。重要的是要了解每种方法的优缺点，以便在正确的上下文中使用它们。帮助你做出正确选择的一些提示:</p><ul class=""><li id="7cf7" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated"><code class="du ld le lf ku b">Map</code>:如果您有键、值对形式的无序条目，并且需要高效的检索、插入和删除操作，那么这个选项非常有用。<code class="du ld le lf ku b"><a class="ae ks" href="https://www.java67.com/2017/08/top-10-java-hashmap-interview-questions.html" rel="noopener ugc nofollow" target="_blank">HashMap</a></code>、<code class="du ld le lf ku b">Hashtable</code>、<code class="du ld le lf ku b">LinkedHashMap</code>都是<code class="du ld le lf ku b">Map</code>接口的实现。</li><li id="7183" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated"><code class="du ld le lf ku b">List</code>:非常常用于创建有序的项目列表。此列表可能包含重复项。<code class="du ld le lf ku b">ArrayList</code>是<code class="du ld le lf ku b">List</code>接口的实现。使用<code class="du ld le lf ku b">Collections.synchronizedList</code>可以使列表成为线程安全的，因此不再需要使用<code class="du ld le lf ku b">Vector</code>。<a class="ae ks" href="https://javaconceptoftheday.com/not-use-vector-class-code/" rel="noopener ugc nofollow" target="_blank">这里</a>有更多关于为什么<code class="du ld le lf ku b">Vector</code>本质上已经过时的信息。</li><li id="c524" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated"><code class="du ld le lf ku b">Set</code>:类似列表，但不允许重复。<code class="du ld le lf ku b">HashSet</code>实现了<code class="du ld le lf ku b">Set</code>接口。</li></ul><h1 id="fb57" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">7.在你暴露之前三思</h1><p id="2b95" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">Java中有很多访问修饰符可供选择— <code class="du ld le lf ku b">public</code>、<code class="du ld le lf ku b">protected</code>、<code class="du ld le lf ku b">private</code>。除非您想向客户端代码公开一个方法，否则您可能想保留默认的一切<code class="du ld le lf ku b">private</code>。一旦你公开了一个API，就没有回头路了。</p><p id="7eaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，您有一个类<code class="du ld le lf ku b">Library</code>,它有下面的方法来按名称检查一本书:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="48ca" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">public</strong> <strong class="ku hj">checkout(</strong>String bookName<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>	Book book <strong class="ku hj">=</strong> searchByTitle<strong class="ku hj">(</strong>availableBooks<strong class="ku hj">,</strong> bookName<strong class="ku hj">);</strong><br/>  availableBooks<strong class="ku hj">.</strong>remove<strong class="ku hj">(</strong>book<strong class="ku hj">);</strong><br/>  checkedOutBooks<strong class="ku hj">.</strong>add<strong class="ku hj">(</strong>book<strong class="ku hj">);</strong><br/><strong class="ku hj">}</strong></span><span id="7cf2" class="ky jq hi ku b fi lv la l lb lc"><strong class="ku hj">private</strong> <strong class="ku hj">searchByTitle(</strong>List<strong class="ku hj">&lt;</strong>Book<strong class="ku hj">&gt;</strong> availableBooks<strong class="ku hj">,</strong> String bookName<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/><strong class="ku hj">...</strong><br/><strong class="ku hj">}</strong></span></pre><p id="6da5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您没有在默认情况下保持<code class="du ld le lf ku b">searchByTitle</code>方法私有，并且它最终被公开，其他类可能会开始使用它并在它之上构建逻辑，您可能希望成为<code class="du ld le lf ku b">Library</code>类的一部分。它可能会破坏<code class="du ld le lf ku b">Library</code>类的封装，或者在不破坏其他人的代码的情况下不可能恢复/修改。自觉曝光！</p><h1 id="1e75" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">8.接口代码</h1><p id="d534" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">如果你有某些接口的具体实现(例如<code class="du ld le lf ku b">ArrayList</code>或<code class="du ld le lf ku b">LinkedList</code>)并且如果你直接在你的代码中使用它们，那么它会导致高耦合。坚持使用<code class="du ld le lf ku b">List</code>接口可以让你在未来的任何时候切换实现，而不会破坏任何代码。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="7a55" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">public</strong> <strong class="ku hj">Bill(</strong>Printer printer<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>	<strong class="ku hj">this.</strong>printer <strong class="ku hj">=</strong> printer<strong class="ku hj">;</strong><br/><strong class="ku hj">}</strong></span><span id="9e5f" class="ky jq hi ku b fi lv la l lb lc"><strong class="ku hj">new</strong> Bill<strong class="ku hj">(new</strong> ConsolePrinter<strong class="ku hj">());</strong><br/><strong class="ku hj">new</strong> Bill<strong class="ku hj">(new</strong> HTMLPrinter<strong class="ku hj">());</strong></span></pre><p id="3915" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码片段中，使用<code class="du ld le lf ku b">Printer</code>接口允许开发人员转移到另一个具体的类<code class="du ld le lf ku b">HTMLPrinter</code>。</p><h1 id="082a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">9.不要强行安装接口</h1><p id="7be3" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">看看下面的界面:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="6ef3" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">interface</strong> <strong class="ku hj">BookService</strong> <strong class="ku hj">{</strong><br/>		List<strong class="ku hj">&lt;</strong>Book<strong class="ku hj">&gt;</strong> <strong class="ku hj">fetchBooks();</strong><br/>    <strong class="ku hj">void</strong> <strong class="ku hj">saveBooks(</strong>List<strong class="ku hj">&lt;</strong>Book<strong class="ku hj">&gt;</strong> books<strong class="ku hj">);</strong><br/>    <strong class="ku hj">void</strong> <strong class="ku hj">order(</strong>OrderDetails orderDetails<strong class="ku hj">)</strong> <strong class="ku hj">throws</strong> BookNotFoundException<strong class="ku hj">,</strong> BookUnavailableException<strong class="ku hj">;</strong>	<br/><strong class="ku hj">}</strong></span><span id="3ca0" class="ky jq hi ku b fi lv la l lb lc"><strong class="ku hj">class</strong> <strong class="ku hj">BookServiceImpl</strong> <strong class="ku hj">implements</strong> BookService <strong class="ku hj">{</strong><br/><strong class="ku hj">...</strong></span></pre><p id="0807" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建这样的界面有什么好处吗？这个接口被另一个类实现了吗？这个接口是否足够通用，可以被另一个类实现？如果所有这些问题的答案都是否定的，那么我肯定会建议你避免这个不必要的接口，因为你将来必须维护它。马丁·福勒在他的博客中对此做了很好的解释。</p><p id="3ae3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，什么是好的接口用例呢？假设我们有一个<code class="du ld le lf ku b">class Rectangle</code>和一个<code class="du ld le lf ku b">class Circle</code>来计算周长。总而言之，如果有一个需求，即所有形状的周长——多态性的一个用例，那么拥有这个接口会更有意义，如下所示。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="662e" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">interface</strong> <strong class="ku hj">Shape</strong> <strong class="ku hj">{</strong><br/>		Double <strong class="ku hj">perimeter();</strong><br/><strong class="ku hj">}</strong></span><span id="750f" class="ky jq hi ku b fi lv la l lb lc"><strong class="ku hj">class</strong> <strong class="ku hj">Rectangle</strong> <strong class="ku hj">implements</strong> Shape <strong class="ku hj">{</strong><br/><em class="lg">//data members and constructors<br/></em>    @Override<br/>    <strong class="ku hj">public</strong> Double <strong class="ku hj">perimeter()</strong> <strong class="ku hj">{</strong><br/>        <strong class="ku hj">return</strong> 2 <strong class="ku hj">*</strong> <strong class="ku hj">(this.</strong>length <strong class="ku hj">+</strong> <strong class="ku hj">this.</strong>breadth<strong class="ku hj">);</strong><br/>    <strong class="ku hj">}</strong><br/><strong class="ku hj">}</strong></span><span id="245d" class="ky jq hi ku b fi lv la l lb lc"><strong class="ku hj">class</strong> <strong class="ku hj">Circle</strong> <strong class="ku hj">implements</strong> Shape <strong class="ku hj">{</strong><br/><em class="lg">//data members and constructors<br/></em>    @Override<br/>    <strong class="ku hj">public</strong> Double <strong class="ku hj">perimeter()</strong> <strong class="ku hj">{</strong><br/>        <strong class="ku hj">return</strong> 2 <strong class="ku hj">*</strong> Math<strong class="ku hj">.</strong>PI <strong class="ku hj">*</strong> <strong class="ku hj">(this.</strong>radius<strong class="ku hj">);</strong><br/>    <strong class="ku hj">}</strong><br/><strong class="ku hj">}</strong></span><span id="8c38" class="ky jq hi ku b fi lv la l lb lc"><strong class="ku hj">public</strong> <strong class="ku hj">double</strong> <strong class="ku hj">totalPerimeter(</strong>List<strong class="ku hj">&lt;</strong>Shape<strong class="ku hj">&gt;</strong> shapes<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>	<strong class="ku hj">return</strong> shapes<strong class="ku hj">.</strong>stream<strong class="ku hj">()</strong><br/>               <strong class="ku hj">.</strong>map<strong class="ku hj">(</strong>Shape<strong class="ku hj">::</strong>perimeter<strong class="ku hj">)</strong><br/>               <strong class="ku hj">.</strong>reduce<strong class="ku hj">((</strong>a<strong class="ku hj">,</strong> b<strong class="ku hj">)</strong> <strong class="ku hj">-&gt;</strong> Double<strong class="ku hj">.</strong>sum<strong class="ku hj">(</strong>a<strong class="ku hj">,</strong> b<strong class="ku hj">))</strong><br/>               <strong class="ku hj">.</strong>orElseGet<strong class="ku hj">(()</strong> <strong class="ku hj">-&gt;</strong> <strong class="ku hj">(double)</strong> 0<strong class="ku hj">);</strong><br/><strong class="ku hj">}</strong></span></pre><h1 id="4790" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">10.当重写equals时重写hashCode</h1><p id="8506" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">因其值而相等的对象称为<a class="ae ks" href="https://martinfowler.com/bliki/ValueObject.html" rel="noopener ugc nofollow" target="_blank">值对象</a>。例如金钱、时间。如果值相同，这些类必须覆盖<code class="du ld le lf ku b">equals</code>方法以返回true。其他库通常使用<code class="du ld le lf ku b"><a class="ae ks" href="https://javarevisited.blogspot.com/2013/05/java-mistake-3-using-instead-of-equals.html" rel="noopener ugc nofollow" target="_blank">equals</a></code> <a class="ae ks" href="https://javarevisited.blogspot.com/2013/05/java-mistake-3-using-instead-of-equals.html" rel="noopener ugc nofollow" target="_blank"> </a>方法进行比较和相等检查；因此，超驰<code class="du ld le lf ku b">equals</code>是必要的。每个Java对象都有一个散列码值，以区别于其他对象。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="baa6" class="ky jq hi ku b fi kz la l lb lc"><strong class="ku hj">class</strong> <strong class="ku hj">Coin</strong> <strong class="ku hj">{</strong><br/>    <strong class="ku hj">private</strong> <strong class="ku hj">final</strong> <strong class="ku hj">int</strong> value<strong class="ku hj">;</strong></span><span id="b300" class="ky jq hi ku b fi lv la l lb lc">    Coin<strong class="ku hj">(int</strong> value<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>        <strong class="ku hj">this.</strong>value <strong class="ku hj">=</strong> value<strong class="ku hj">;</strong><br/>    <strong class="ku hj">}</strong></span><span id="02ee" class="ky jq hi ku b fi lv la l lb lc">    @Override<br/>    <strong class="ku hj">public</strong> <strong class="ku hj">boolean</strong> <strong class="ku hj">equals(</strong>Object o<strong class="ku hj">)</strong> <strong class="ku hj">{</strong><br/>        <strong class="ku hj">if</strong> <strong class="ku hj">(this</strong> <strong class="ku hj">==</strong> o<strong class="ku hj">)</strong> <strong class="ku hj">return</strong> <strong class="ku hj">true;</strong><br/>        <strong class="ku hj">if</strong> <strong class="ku hj">(</strong>o <strong class="ku hj">==</strong> <strong class="ku hj">null</strong> <strong class="ku hj">||</strong> getClass<strong class="ku hj">()</strong> <strong class="ku hj">!=</strong> o<strong class="ku hj">.</strong>getClass<strong class="ku hj">())</strong> <strong class="ku hj">return</strong> <strong class="ku hj">false;</strong><br/>        Coin coin <strong class="ku hj">=</strong> <strong class="ku hj">(</strong>Coin<strong class="ku hj">)</strong> o<strong class="ku hj">;</strong><br/>        <strong class="ku hj">return</strong> value <strong class="ku hj">==</strong> coin<strong class="ku hj">.</strong>value<strong class="ku hj">;</strong><br/>    <strong class="ku hj">}</strong><br/><strong class="ku hj">}</strong></span></pre><p id="928a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，我们只覆盖了<code class="du ld le lf ku b">Object</code>的<code class="du ld le lf ku b">equals</code>方法。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="b970" class="ky jq hi ku b fi kz la l lb lc">HashMap<strong class="ku hj">&lt;</strong>Coin<strong class="ku hj">,</strong> Integer<strong class="ku hj">&gt;</strong> coinCount <strong class="ku hj">=</strong> <strong class="ku hj">new</strong> HashMap<strong class="ku hj">&lt;</strong>Coin<strong class="ku hj">,</strong> Integer<strong class="ku hj">&gt;()</strong> <strong class="ku hj">{{</strong><br/>  put<strong class="ku hj">(new</strong> Coin<strong class="ku hj">(</strong>1<strong class="ku hj">),</strong> 5<strong class="ku hj">);</strong><br/>  put<strong class="ku hj">(new</strong> Coin<strong class="ku hj">(</strong>5<strong class="ku hj">),</strong> 2<strong class="ku hj">);</strong><br/><strong class="ku hj">}};</strong></span><span id="e6b9" class="ky jq hi ku b fi lv la l lb lc"><em class="lg">//update count for 1 rupee coin<br/></em>coinCount<strong class="ku hj">.</strong>put<strong class="ku hj">(new</strong> Coin<strong class="ku hj">(</strong>1<strong class="ku hj">),</strong> 7<strong class="ku hj">);</strong></span><span id="b899" class="ky jq hi ku b fi lv la l lb lc">coinCount<strong class="ku hj">.</strong>size<strong class="ku hj">();</strong> <em class="lg">// 3 🤯 why?</em></span></pre><p id="5c14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们希望<code class="du ld le lf ku b">coinCount</code>将1卢比硬币的数量更新为7，因为我们覆盖了equals。但是<code class="du ld le lf ku b"><a class="ae ks" href="https://www.java67.com/2013/02/10-examples-of-hashmap-in-java-programming-tutorial.html" rel="noopener ugc nofollow" target="_blank">HashMap</a></code>在内部检查两个对象的散列码是否相等，然后通过<code class="du ld le lf ku b">equals</code>方法继续测试相等性。两个不同的对象可能有也可能没有相同的散列码，但是两个相同的对象必须总是有相同的散列码，如<code class="du ld le lf ku b">hashCode</code>方法的契约所定义的。因此，首先检查哈希代码是提前退出的条件。这意味着必须重写<code class="du ld le lf ku b">equals</code>和<code class="du ld le lf ku b">hashCode</code>方法来表示相等。</p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="49d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你编写或审查Java代码，DeepSource可以帮助你自动化代码审查，并为你节省大量时间。只需在资源库的根目录下添加一个<code class="du ld le lf ku b">.deepsource.toml</code>文件，DeepSource就会立即提取该文件进行扫描。该扫描将发现代码中的改进空间，并通过有用的描述帮助您修复它们。</p><p id="1615" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ks" href="https://deepsource.io/signup/?utm_source=medium&amp;utm_medium=organic&amp;utm_campaign=contentdistribution&amp;utm_term=javacodereview" rel="noopener ugc nofollow" target="_blank">报名</a>自己看吧！</p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="5c62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lg">原载于</em> <a class="ae ks" href="https://deepsource.io/blog/java-code-review-guidelines/?utm_source=medium&amp;utm_medium=organic&amp;utm_campaign=contentdistribution&amp;utm_term=javacodereview" rel="noopener ugc nofollow" target="_blank"> <em class="lg"> DeepSource博客</em> </a> <em class="lg">。</em></p></div></div>    
</body>
</html>