<html>
<head>
<title>Is it possible to Authenticate without exchanging passwords or tokens?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">是否可以不交换密码或令牌进行身份验证？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/authenticate-without-passwords-or-tokens-cf68eeb4deef?source=collection_archive---------3-----------------------#2022-12-30">https://medium.com/javarevisited/authenticate-without-passwords-or-tokens-cf68eeb4deef?source=collection_archive---------3-----------------------#2022-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9e5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kerberos本地主机</p><p id="ee03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们总是习惯于使用一个<strong class="ih hj">用户名—密码</strong>或者某种<strong class="ih hj">令牌</strong> <em class="jd">交换</em>机制发生在被授权方之间<em class="jd">建立</em> <a class="ae je" href="https://javarevisited.blogspot.com/2018/01/how-to-enable-http-basic-authentication-spring-security-java-xml-configuration.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jd">认证</em> </strong> </a>。但是，如果我们不用明确地交换它们也能达到同样的效果呢？</p><p id="743c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来探索一下Kerberos。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/4fee6361d8411008c05ff5ce9dd6c3f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0dL31V2u6XSoalPb"/></div></div><p class="jr js et er es jt ju bd b be z dx translated">由<a class="ae je" href="https://unsplash.com/@brookecagle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布鲁克·卡吉尔</a>在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="6dc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你<em class="jd">只对<strong class="ih hj">技术演示</strong>部分</em>感兴趣，<em class="jd">如何跳过</em>至<a class="ae je" href="##547b" rel="noopener ugc nofollow">？</a></p><h2 id="d4e5" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">内容</h2><ul class=""><li id="98d5" class="kq kr hi ih b ii ks im kt iq ku iu kv iy kw jc kx ky kz la bi translated"><a class="ae je" href="#237e" rel="noopener ugc nofollow">什么？</a></li><li id="5996" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><a class="ae je" href="#c841" rel="noopener ugc nofollow">为什么？</a></li><li id="9d0f" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><a class="ae je" href="#e229" rel="noopener ugc nofollow">行话</a></li><li id="8441" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><a class="ae je" href="#1a0b" rel="noopener ugc nofollow">涉及的工具和实体</a></li><li id="e8f8" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">如何？<br/>-<a class="ae je" href="#5d65" rel="noopener ugc nofollow">-</a><br/>-<a class="ae je" href="#47e4" rel="noopener ugc nofollow">实现</a><br/>a .<a class="ae je" href="#2239" rel="noopener ugc nofollow">Kerberos前</a> <br/> b. <a class="ae je" href="#f551" rel="noopener ugc nofollow">添加Kerberos配置</a><br/>c .<a class="ae je" href="#7366" rel="noopener ugc nofollow">Kerberos后</a></li><li id="5434" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><a class="ae je" href="#b630" rel="noopener ugc nofollow">问&amp;答</a></li></ul><blockquote class="lg lh li"><p id="237e" class="if ig jd ih b ii ij ik il im in io ip lj ir is it lk iv iw ix ll iz ja jb jc hb bi translated">什么？</p></blockquote><p id="a8f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它是一种网络<a class="ae je" rel="noopener" href="/javarevisited/oauth-and-misconceptions-fe2005fecd72#f5f6">认证</a>协议，使用<a class="ae je" rel="noopener" href="/@suriyaprakhash/cryptography-algorithms-e86ce7e2bb9b#0584">对称密钥密文</a> y将客户端登录到<strong class="ih hj">系统</strong>或<strong class="ih hj">服务。</strong></p><blockquote class="lg lh li"><p id="c841" class="if ig jd ih b ii ij ik il im in io ip lj ir is it lk iv iw ix ll iz ja jb jc hb bi translated">为什么？</p></blockquote><p id="915f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它有助于<em class="jd">认证</em> <strong class="ih hj">，而无需在两个相关<strong class="ih hj">客户端</strong>和<strong class="ih hj">服务器</strong>之间传递任何密码</strong>。</p><p id="5020" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae je" href="#547b" rel="noopener ugc nofollow">回答之前如何</a>？，我们需要从理论的角度来理解它。</p><blockquote class="lg lh li"><p id="e229" class="if ig jd ih b ii ij ik il im in io ip lj ir is it lk iv iw ix ll iz ja jb jc hb bi translated">行话</p></blockquote><p id="0fc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在开始之前，我们可能需要了解一些<a class="ae je" href="https://web.mit.edu/kerberos/kfw-4.1/kfw-4.1/kfw-4.1-help/html/kerberos_terminology.htm" rel="noopener ugc nofollow" target="_blank">术语</a>。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lm"><img src="../Images/24339520a9d866bac26470a52abc6139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LRNockXCXx0nHRsV"/></div></div><p class="jr js et er es jt ju bd b be z dx translated">照片由<a class="ae je" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米卡·鲍梅斯特</a>在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h2 id="970a" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">领域</h2><p id="3b99" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated"><strong class="ih hj">组资源</strong>和<strong class="ih hj">标识</strong>，通常用<strong class="ih hj">域</strong>表示。<em class="jd">如</em> <em class="jd">庄家</em>。M<em class="jd">TB.COM代表银行家</em>内<em class="jd"> M &amp; T银行。</em></p><h2 id="9c44" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">校长</h2><p id="6547" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">代表<strong class="ih hj">用户</strong>或<strong class="ih hj">服务</strong>的唯一身份。</p><ul class=""><li id="502f" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated">根据访问分组，用户主要名称<em class="jd">如suriya@MTB.COM</em>或<em class="jd">suriya@BANKER.MTB.COM</em>。</li><li id="c2f6" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">SPN—服务主体名称，例如host/machine1.mtb.com@MTB。计算机输出缩微胶片</li></ul><h2 id="755d" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">认证服务器</h2><p id="438f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">顾名思义，它根据数据库对<a class="ae je" href="#9c44" rel="noopener ugc nofollow">请求的主体</a>进行身份验证，并向客户端提供<a class="ae je" href="#6d57" rel="noopener ugc nofollow"> TGT </a></p><h2 id="6d57" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated"><strong class="ak">赠票票</strong></h2><p id="3eef" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">这就像我们在入口处售票柜台得到的游乐园票带。从技术上讲，这是一个加密的数据块。</p><h2 id="e164" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">票据授予服务器</h2><p id="b1ac" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">这是服务器使用客户端之前获得的<a class="ae je" href="#6d57" rel="noopener ugc nofollow"> TGT </a>向请求访问服务的客户端发出<a class="ae je" href="#f57e" rel="noopener ugc nofollow">服务票</a>。</p><h2 id="f57e" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated"><strong class="ak">服务票</strong></h2><p id="70d0" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">这就像一张我们需要在乘车柜台购买的票，我们可能想要在不同的乘车柜台购买不同的票。从技术上讲，这也是一个加密的数据块。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><a href="https://javarevisited.blogspot.com/2021/02/spring-security-interview-questions-answers-java.html"><div class="er es lt"><img src="../Images/886e3c4cc1f4981a59b5ff7745764459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*uZDwfJWiG5p1gH-HqNQEcA.png"/></div></a><p class="jr js et er es jt ju bd b be z dx translated">图片来自<a class="ae je" href="https://en.wikipedia.org/wiki/Kerberos_(protocol)" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></figure><blockquote class="lg lh li"><p id="1a0b" class="if ig jd ih b ii ij ik il im in io ip lj ir is it lk iv iw ix ll iz ja jb jc hb bi translated">涉及的工具和实体</p></blockquote><h2 id="b01c" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">KDC</h2><p id="2e66" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated"><a class="ae je" href="https://www.oreilly.com/library/view/kerberos-the-definitive/0596004036/ch02s04s03.html#:~:text=The%20Kerberos%20Key%20Distribution%20Center,and%20the%20Ticket%20Granting%20Server.#test-content-id" rel="noopener ugc nofollow" target="_blank">密钥分发中心</a>由配置的<a class="ae je" href="#970a" rel="noopener ugc nofollow">域</a>内的<a class="ae je" href="https://www.oreilly.com/library/view/kerberos-the-definitive/0596004036/ch02s04s03.html#:~:text=The%20Kerberos%20Key%20Distribution%20Center,and%20the%20Ticket%20Granting%20Server.#test-content-id" rel="noopener ugc nofollow" target="_blank">三个逻辑组件</a>组成，</p><ul class=""><li id="a6e5" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated">所有<a class="ae je" href="#9c44" rel="noopener ugc nofollow">主体</a>及其<a class="ae je" rel="noopener" href="/javarevisited/exploring-java-keystore-keys-9eb4805fa4ec#a198">加密密钥</a>的<a class="ae je" href="#5882" rel="noopener ugc nofollow">数据库</a></li><li id="33f3" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><a class="ae je" href="#755d" rel="noopener ugc nofollow">认证服务器</a></li><li id="31ad" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><a class="ae je" href="#e164" rel="noopener ugc nofollow">票证授予服务器</a></li></ul><h2 id="b5e2" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">卡德明</h2><p id="3033" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated"><a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.12/doc/admin/admin_commands/kadmin_local.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Kadmin </strong> </a>是一个<a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.12/doc/admin/admin_commands/kadmin_local.html" rel="noopener ugc nofollow" target="_blank">命令行接口</a>，允许远程管理<a class="ae je" href="https://web.mit.edu/Kerberos/krb5-1.12/doc/admin/database.html" rel="noopener ugc nofollow" target="_blank">数据库</a>，其中<a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.12/doc/admin/admin_commands/kadmin_local.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> kadmin.local </strong> </a>将用于在KDC服务器内管理数据库。</p><h2 id="62e6" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">Kinit &amp; Klist</h2><p id="7738" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated"><a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/kinit.html" rel="noopener ugc nofollow" target="_blank"> Kinit </a>通常被Kerberos客户端用来<strong class="ih hj">获取</strong>和<strong class="ih hj">缓存</strong>请求<a class="ae je" href="#6d57" rel="noopener ugc nofollow"> <strong class="ih hj"> <em class="jd">票</em> </strong> </a>给被请求<a class="ae je" href="#9c44" rel="noopener ugc nofollow"> <em class="jd">主体</em> </a> <em class="jd">。</em></p><p id="6024" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/klist.html" rel="noopener ugc nofollow" target="_blank"> Klist </a>是用于从本地凭证缓存中列出<a class="ae je" href="#9c44" rel="noopener ugc nofollow"> <em class="jd">主体</em> </a> <em class="jd"> </em>的工具。</p><h2 id="e5b4" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">键盘</h2><p id="b59f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">它是一个<strong class="ih hj">密钥表文件</strong>，包含一对Kerberos主体和名为密钥的加密密码。</p><blockquote class="lg lh li"><p id="547b" class="if ig jd ih b ii ij ik il im in io ip lj ir is it lk iv iw ix ll iz ja jb jc hb bi translated">怎么会？</p></blockquote><p id="5ee1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用<a class="ae je" href="https://web.mit.edu/kerberos/" rel="noopener ugc nofollow" target="_blank"> MIT Kerberos </a>来演示认证过程。</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="96ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们开始行动吧。</p><h1 id="5d65" class="lw jw hi bd jx lx ly lz kb ma mb mc kf md me mf ki mg mh mi kl mj mk ml ko mm bi translated">先决条件</h1><p id="d294" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">可能需要了解以下内容，</p><ul class=""><li id="e99e" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><a class="ae je" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="2190" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><a class="ae je" href="https://ubuntu.com/" rel="noopener ugc nofollow" target="_blank"> Ubuntu </a></li><li id="f604" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><a class="ae je" href="https://httpd.apache.org/" rel="noopener ugc nofollow" target="_blank">阿帕奇httpd </a></li></ul><h1 id="47e4" class="lw jw hi bd jx lx ly lz kb ma mb mc kf md me mf ki mg mh mi kl mj mk ml ko mm bi translated">履行</h1><p id="10cb" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">我们将使用<strong class="ih hj">KERBEROS.COM</strong>作为<a class="ae je" href="#970a" rel="noopener ugc nofollow">领域</a>。</p><p id="feb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将旋转下表中的3个容器/服务器/节点，</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="mn lv l"/></div></figure><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es mo"><img src="../Images/c0503222467fad580150ce9ab5d1b098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y3jCs_UdfDaWDxZZ"/></div></div><p class="jr js et er es jt ju bd b be z dx translated">亚历山大·杜默在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h2 id="2239" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">在Kerberos之前</h2><ul class=""><li id="257a" class="kq kr hi ih b ii ks im kt iq ku iu kv iy kw jc kx ky kz la bi translated"><strong class="ih hj">阿帕奇服务器:</strong>旋转<strong class="ih hj">阿帕奇服务器</strong></li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="8848" class="mu jw hi mq b be mv mw l mx my">docker run --name apache-server --hostname apacheserver.kerberos.com -it ubuntu</span></pre><ul class=""><li id="4663" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> apache-server: </strong>安装apache2 httpd</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="10d8" class="mu jw hi mq b be mv mw l mx my">apt install apache2</span></pre><ul class=""><li id="3861" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><a class="ae je" href="https://javarevisited.blogspot.com/2017/01/12-essential-apache-web-server-interview-questions-answers-java-linux.html" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Apache-serve</strong></a><strong class="ih hj">r:</strong>启动服务器</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="dab7" class="mu jw hi mq b be mv mw l mx my">service apache2 start</span></pre><ul class=""><li id="54d8" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> apache-server: </strong>检查本地</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="b5c5" class="mu jw hi mq b be mv mw l mx my">curl localhost:80</span></pre><ul class=""><li id="5a25" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj">Kerberos-客户端:</strong>旋转客户端机器，</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="81db" class="mu jw hi mq b be mv mw l mx my">docker run --name kerberos-client --hostname client.kerberos.com -it ubuntu</span></pre><ul class=""><li id="b544" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj">Kerberos-客户端:</strong>curl<strong class="ih hj">apacheserver.kerberos.com</strong>检查连接</li></ul><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es mz"><img src="../Images/74204753660edf1606ff501c7b539f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jwt6cxdW73ykfk8HUgv68A.jpeg"/></div></div><p class="jr js et er es jt ju bd b be z dx translated">检查<strong class="bd jx"> kerberos客户端</strong>和<strong class="bd jx"> apache服务器</strong>之间的连接</p></figure><h2 id="f551" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">添加Kerberos配置</h2><p id="e99c" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">因此，从<strong class="ih hj">客户端</strong>到<strong class="ih hj">服务器</strong>的<em class="jd">实际连接</em>是成功的。下面是我们将在<strong class="ih hj"> kdc服务器</strong>中做的事情，</p><ul class=""><li id="b525" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated">安装<strong class="ih hj"> kdc </strong>和<strong class="ih hj">管理服务器</strong></li><li id="7099" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">创建一个<a class="ae je" href="#9c44" rel="noopener ugc nofollow">用户主体</a>、<em class="jd">apacheuser@KERBEROS.COM—</em>用于<strong class="ih hj"> kerberos客户端</strong>。</li><li id="8178" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">创建一个<a class="ae je" href="#9c44" rel="noopener ugc nofollow">服务主体</a>、<em class="jd">HTTP/apacheserver.kerberos.com@KERBEROS.COM—</em>，用于<strong class="ih hj"> apache-server </strong>。</li><li id="cd7c" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">为<a class="ae je" href="#9c44" rel="noopener ugc nofollow"> SPN </a> <em class="jd">创建一个<a class="ae je" href="#e5b4" rel="noopener ugc nofollow"> <strong class="ih hj"> keytab </strong> </a>文件，复制到</em>Apache-server。</li><li id="fedb" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">在<strong class="ih hj"> kerberos客户端中创建一个<a class="ae je" href="#6d57" rel="noopener ugc nofollow">票据授予票据</a>。</strong></li></ul><p id="691f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae je" href="#b01c" rel="noopener ugc nofollow"> KDC数据库</a>中。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es na"><img src="../Images/a2fba7b227ede0adcc814050795f2e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mN3R6YMn_EBzcUs_"/></div></div><p class="jr js et er es jt ju bd b be z dx translated">约书亚·科尔曼在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ecdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们继续做吧，</p><ul class=""><li id="e7d9" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> kdc-server: </strong>旋转<strong class="ih hj"> kdc-server </strong></li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="563b" class="mu jw hi mq b be mv mw l mx my">docker run --name kdc-server --hostname kdc.kerberos.com -it ubuntu</span></pre><ul class=""><li id="bcad" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj">KDC-服务器:</strong>安装<strong class="ih hj"> kdc </strong>和<strong class="ih hj">管理服务器</strong></li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="83b8" class="mu jw hi mq b be mv mw l mx my">apt install krb5-kdc krb5-admin-server</span></pre><p id="87ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出现提示时，提供以下信息，</p><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="ab0d" class="mu jw hi mq b be mv mw l nb my">Default Kerberos version 5 <strong class="mq hj"><em class="jd">realm</em></strong>: <strong class="mq hj">KERBEROS.COM</strong><br/><strong class="mq hj"><em class="jd">Kerberos servers</em></strong> for your realm: <strong class="mq hj">kdc.kerberos.com</strong><br/><strong class="mq hj"><em class="jd">Administrative server</em></strong> for your Kerberos realm: <strong class="mq hj">kdc.kerberos.com</strong></span></pre><p id="e012" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保<strong class="ih hj"><em class="jd">/etc/krb5 . conf</em></strong><em class="jd"/>符合以下要点，</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="mn lv l"/></div></figure><ul class=""><li id="00e3" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> kdc-server: </strong>创建一个<a class="ae je" href="#970a" rel="noopener ugc nofollow">新领域</a>，确保<strong class="ih hj"> krb5.conf </strong>的设置正常，</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="1c85" class="mu jw hi mq b be mv mw l mx my">krb5_newrealm</span></pre><p id="9fea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当提示输入<strong class="ih hj"> kdc主密钥</strong>时，输入<strong class="ih hj"> <em class="jd"> kdc </em> </strong>，这是<a class="ae je" href="#b01c" rel="noopener ugc nofollow"> KDC数据库</a>的<em class="jd">密码</em>。</p><ul class=""><li id="04c7" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> kdc-server: </strong>运行<strong class="ih hj"> kadmin.local </strong>添加<a class="ae je" href="#9c44" rel="noopener ugc nofollow">用户&amp;服务主体</a>，</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="df8f" class="mu jw hi mq b be mv mw l mx my">addprinc apacheuser</span></pre><p id="2c09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当提示输入上述用户的密码时，<em class="jd">例如apacheuser </em></p><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="7253" class="mu jw hi mq b be mv mw l mx my">addprinc -randkey HTTP/apacheserver.kerberos.com</span></pre><p id="8f0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面没有提示输入密码，因为我们对<a class="ae je" href="#9c44" rel="noopener ugc nofollow"> SPN </a>使用的是<strong class="ih hj">随机密钥</strong>。</p><ul class=""><li id="7d8b" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> kdc-server: </strong>列出要验证的数据库，</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="1f1e" class="mu jw hi mq b be mv mw l mx my">list_principals</span></pre><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es nc"><img src="../Images/6c47412efd8671dac6dde709264c06fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmGPDJI88jI87WMxU_b30g.jpeg"/></div></div><p class="jr js et er es jt ju bd b be z dx translated"><a class="ae je" href="#b5e2" rel="noopener ugc nofollow"> kadmin.local </a>列出来自<a class="ae je" href="#b01c" rel="noopener ugc nofollow"> KDC数据库</a>的<a class="ae je" href="#9c44" rel="noopener ugc nofollow">主体</a></p></figure><ul class=""><li id="7f07" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated">kdc-server: 为HTTP/apacheserver.kerberos.com创建一个<a class="ae je" href="#e5b4" rel="noopener ugc nofollow"> keytab </a></li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="95c6" class="mu jw hi mq b be mv mw l mx my">ktadd HTTP/apacheserver.kerberos.com</span></pre><p id="3e0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在<strong class="ih hj"> kdc-server </strong>中创建一个<a class="ae je" href="#e5b4" rel="noopener ugc nofollow"> keytab </a>文件，命名为<strong class="ih hj"><em class="jd">/etc/krb5 . keytab</em></strong></p><ul class=""><li id="81aa" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> apache-server: </strong>将<strong class="ih hj"> kdc-server </strong>中的<a class="ae je" href="#e5b4" rel="noopener ugc nofollow"> keytab </a>文件复制并重命名为<strong class="ih hj"><em class="jd">/etc/Kerberos . keytab</em></strong></li></ul><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es nd"><img src="../Images/e4eeb146bb296f49d0ffeb32b52afa86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCqNY4uxyUTAS_GfArwGvw.jpeg"/></div></div><p class="jr js et er es jt ju bd b be z dx translated">重命名<a class="ae je" href="#e5b4" rel="noopener ugc nofollow"> keytab </a>文件<strong class="bd jx"> apache-server </strong></p></figure><ul class=""><li id="1290" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> apache-server: </strong>安装<a class="ae je" href="https://modauthkerb.sourceforge.net/" rel="noopener ugc nofollow" target="_blank">libapache 2-mod-auth-kerb</a>包</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="3db9" class="mu jw hi mq b be mv mw l mx my">apt-get install libapache2-mod-auth-kerb</span></pre><p id="acb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出现提示时，提供以下信息，</p><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="dea9" class="mu jw hi mq b be mv mw l nb my">Default Kerberos version 5 <strong class="mq hj"><em class="jd">realm</em></strong>: <strong class="mq hj">KERBEROS.COM</strong><br/><strong class="mq hj"><em class="jd">Kerberos servers</em></strong> for your realm: <strong class="mq hj">kdc.kerberos.com</strong><br/><strong class="mq hj"><em class="jd">Administrative server</em></strong> for your Kerberos realm: <strong class="mq hj">kdc.kerberos.com</strong></span></pre><ul class=""><li id="a508" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> apache-server: </strong>更新apache配置，如下所示，以反映KDC配置，</li></ul><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="mn lv l"/></div><p class="jr js et er es jt ju bd b be z dx translated">检查<strong class="ak">位置标签</strong>的krb变化</p></figure><ul class=""><li id="664f" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> apache-server: </strong>重启apache2服务器以选择更改，</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="e150" class="mu jw hi mq b be mv mw l mx my">service apache2 restart</span></pre><ul class=""><li id="9db7" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> kerberos-client: </strong>现在尝试从客户端访问<strong class="ih hj">apacheserver.kerberos.com</strong>，</li></ul><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es ne"><img src="../Images/3c25980e99520dacf031aa06681ccfb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wXNxmbvtUFaFjwsIRh5iLw.jpeg"/></div></div><p class="jr js et er es jt ju bd b be z dx translated">我们得到401未经授权</p></figure><p id="12f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，<strong class="ih hj"> apache-server </strong>中的配置看起来正常，导致<strong class="ih hj"> 401未经授权。</strong></p><ul class=""><li id="bfe4" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> kerberos-client: </strong>在客户端安装<a class="ae je" href="https://packages.debian.org/stretch/krb5-user" rel="noopener ugc nofollow" target="_blank"> krb5-user </a></li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="c364" class="mu jw hi mq b be mv mw l mx my">apt-get install krb5-user</span></pre><p id="86b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出现提示时，提供以下信息，</p><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="a92a" class="mu jw hi mq b be mv mw l nb my">Default Kerberos version 5 <strong class="mq hj"><em class="jd">realm</em></strong>: <strong class="mq hj">KERBEROS.COM</strong><br/><strong class="mq hj"><em class="jd">Kerberos servers</em></strong> for your realm: <strong class="mq hj">kdc.kerberos.com</strong><br/><strong class="mq hj"><em class="jd">Administrative server</em></strong> for your Kerberos realm: <strong class="mq hj">kdc.kerberos.com</strong></span></pre><p id="f4a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们差不多完成了，现在让我们在<strong class="ih hj"> kerberos客户端中创建并生成一个<a class="ae je" href="#6d57" rel="noopener ugc nofollow">票据授予票据</a>。</strong></p><ul class=""><li id="2ab2" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> kerberos-client: </strong>使用<a class="ae je" href="#62e6" rel="noopener ugc nofollow"> kinit </a>生成<a class="ae je" href="#6d57" rel="noopener ugc nofollow">票授予票</a></li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="6ea1" class="mu jw hi mq b be mv mw l mx my">kinit apacheuser</span></pre><p id="f9c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面已经创建了一个临时的<a class="ae je" href="#6d57" rel="noopener ugc nofollow">TGT</a><strong class="ih hj"><em class="jd">/tmp/krb5 cc _ 0</em></strong>按照<strong class="ih hj"> kdc-server中的默认配置设置为过期。</strong></p><p id="262e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae je" href="#62e6" rel="noopener ugc nofollow"> klist </a>验证，</p><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="5c80" class="mu jw hi mq b be mv mw l mx my">klist</span></pre><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es nf"><img src="../Images/61ea3cb0aee22cd9febae5354daaacea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FE3N0FQGPhX9-VSaX5P4cw.jpeg"/></div></div><p class="jr js et er es jt ju bd b be z dx translated"><a class="ae je" href="#62e6" rel="noopener ugc nofollow"> kinit </a>和<a class="ae je" href="#62e6" rel="noopener ugc nofollow"> klist </a></p></figure><ul class=""><li id="a4d4" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated"><strong class="ih hj"> kerberos-client: </strong>通过将<strong class="ih hj"><em class="jd">/tmp/krb5 cc _ 0</em></strong>设置为<strong class="ih hj"> KRB5CCNAME </strong>使其对kerberos可见</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="01fe" class="mu jw hi mq b be mv mw l mx my">export KRB5CCNAME=/tmp/krb5cc_0</span></pre><h2 id="7366" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">Kerberos之后</h2><ul class=""><li id="1b86" class="kq kr hi ih b ii ks im kt iq ku iu kv iy kw jc kx ky kz la bi translated"><strong class="ih hj"> kerberos-client: </strong>现在试试<strong class="ih hj"> curl </strong> ing与<em class="jd"/><a class="ae je" href="https://curl.se/mail/archive-2019-02/0001.html" rel="noopener ugc nofollow" target="_blank"><em class="jd">—negotiate</em></a>，</li></ul><pre class="jg jh ji jj fd mp mq mr bn ms mt bi"><span id="753f" class="mu jw hi mq b be mv mw l mx my">curl --negotiate -u : apacheserver.kerberos.com</span></pre><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es ng"><img src="../Images/b8c66ef16345dc0a7eedfbbb0e2de985.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AmXxxHZL3dzvfRL3LrRIsA.jpeg"/></div></div><p class="jr js et er es jt ju bd b be z dx translated"><strong class="bd jx">答对了</strong>现在<strong class="bd jx">通过了认证</strong>，我们可以看到html文件了</p></figure><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es nh"><img src="../Images/a71d652ea6d9f73afde1dd7c214c7499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4X8scdTnRZ6GfVRx"/></div></div><p class="jr js et er es jt ju bd b be z dx translated">本杰明·戴维斯在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><blockquote class="lg lh li"><p id="b630" class="if ig jd ih b ii ij ik il im in io ip lj ir is it lk iv iw ix ll iz ja jb jc hb bi translated">问答？</p></blockquote><h2 id="0fc7" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">看起来我们在这里使用密码，不是吗？</h2><p id="20da" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">是的，我们是。但是它只是存储在<strong class="ih hj"> kerberos客户端</strong>中，用于<a class="ae je" href="https://medium.suriyaprakhash.com/cryptography-algorithms-e86ce7e2bb9b#720a" rel="noopener ugc nofollow" target="_blank">加密</a>和<a class="ae je" href="https://medium.suriyaprakhash.com/cryptography-algorithms-e86ce7e2bb9b#720a" rel="noopener ugc nofollow" target="_blank">解密</a>，并且在认证过程中不会通过网络传输。</p><p id="1ad5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查<a class="ae je" href="#7366" rel="noopener ugc nofollow"> curl命令</a>，我们没有传递任何类似于<strong class="ih hj">令牌</strong>或<strong class="ih hj">密码</strong>的东西，不像<a class="ae je" rel="noopener" href="/javarevisited/oauth-and-misconceptions-fe2005fecd72"> oauth </a>或其他授权机制。我们只是使用一个<a class="ae je" href="https://curl.se/docs/manpage.html#--negotiate" rel="noopener ugc nofollow" target="_blank">协商</a>标志来启用<a class="ae je" href="https://en.wikipedia.org/wiki/SPNEGO" rel="noopener ugc nofollow" target="_blank"> SPNEGO </a>认证机制，该机制又使用<a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.14/doc/index.html" rel="noopener ugc nofollow" target="_blank"> MIT Kerberos库的</a> <a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.14/doc/appdev/gssapi.html#initiator-credentials" rel="noopener ugc nofollow" target="_blank"> GSS-API <strong class="ih hj"> <em class="jd">客户端</em> </strong>应用程序</a>与<a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.14/doc/index.html" rel="noopener ugc nofollow" target="_blank"> MIT Kerberos库的</a> <a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.14/doc/appdev/gssapi.html#acceptor-names" rel="noopener ugc nofollow" target="_blank"> GSS-API <strong class="ih hj"> <em class="jd">服务器</em> </strong>应用程序</a>进行安全通信</p><h2 id="6691" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">如何避免到期时手动输入密码？</h2><p id="2e07" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">实现它有不同的方法。一种方法是使用<a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.12/doc/admin/admin_commands/ktutil.html" rel="noopener ugc nofollow" target="_blank"> ktutil </a>工具。我在这里有一个单独的帖子来解释它，</p><div class="ni nj ez fb nk nl"><a href="https://medium.suriyaprakhash.com/avoid-entering-passwords-to-fetch-ticket-granting-ticket-d37704248503" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab dw"><div class="nn ab no cl cj np"><h2 class="bd hj fi z dy nq ea eb nr ed ef hh bi translated">避免输入密码来获取票证授予票证</h2><div class="ns l"><h3 class="bd b fi z dy nq ea eb nr ed ef dx translated">Kerberos本地主机</h3></div><div class="nt l"><p class="bd b fp z dy nq ea eb nr ed ef dx translated">medium.suriyaprakhash.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jp nl"/></div></div></a></div><h2 id="bc7d" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">为什么是Keytabs？</h2><p id="4ca7" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">它们克服了脚本中没有<em class="jd">明文密码</em>的安全需求。</p><h2 id="2e9a" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">这里的票是什么？</h2><p id="5e90" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">票证是加密的数据块。他们有两把钥匙，</p><ul class=""><li id="80ba" class="kq kr hi ih b ii ij im in iq lq iu lr iy ls jc kx ky kz la bi translated">票证密钥—在<strong class="ih hj"> Kerberos基础架构</strong>和<strong class="ih hj">服务</strong>之间共享</li><li id="5dca" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">会话密钥—在<strong class="ih hj">用户</strong>和<strong class="ih hj">服务</strong>之间共享</li></ul><p id="790e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用<a class="ae je" href="#62e6" rel="noopener ugc nofollow"> kinit </a>或<a class="ae je" href="https://web.mit.edu/kerberos/krb5-1.4/krb5-1.4.1/doc/krb5-admin/Adding-Principals-to-Keytabs.html" rel="noopener ugc nofollow" target="_blank"> ktadd </a>获取它们，并使用<a class="ae je" href="#62e6" rel="noopener ugc nofollow"> klist </a>查看它们。</p><h2 id="d17f" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">这里的交流是怎么发生的？</h2><p id="83a8" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated"><a class="ae je" href="https://web.mit.edu/kerberos/" rel="noopener ugc nofollow" target="_blank"> MIT Kerberos </a>使用<a class="ae je" href="https://packages.debian.org/stretch/krb5-user" rel="noopener ugc nofollow" target="_blank"> krb5-user </a>检测环境变量，对其进行检查，并通过<a class="ae je" href="#755d" rel="noopener ugc nofollow"> keytab </a>获得一个<a class="ae je" href="#6d57" rel="noopener ugc nofollow"> TGT </a>，请求一个服务票并传递给<a class="ae je" href="https://curl.se/" rel="noopener ugc nofollow" target="_blank"> curl </a>。</p><h2 id="5882" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">这里Active directory是如何关联的？</h2><p id="a9bd" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">开源实现，包括<a class="ae je" href="https://kerberos.org/dist/" rel="noopener ugc nofollow" target="_blank"> MIT </a>和<a class="ae je" href="https://github.com/heimdal/" rel="noopener ugc nofollow" target="_blank"> Heimdal </a>，将这个数据库保存在<a class="ae je" href="#b01c" rel="noopener ugc nofollow"> KDC的</a>文件系统上的一个专门的轻量级数据库文件中。然而，<a class="ae je" href="https://learn.microsoft.com/en-us/windows-server/security/windows-authentication/windows-authentication-overview" rel="noopener ugc nofollow" target="_blank"> Windows </a>将该数据库保存在<a class="ae je" href="https://en.wikipedia.org/wiki/Active_Directory" rel="noopener ugc nofollow" target="_blank">活动目录</a>中，即其<a class="ae je" href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" rel="noopener ugc nofollow" target="_blank"> LDAP </a>存储中。</p><h2 id="4566" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">它可以用于单点登录吗？</h2><p id="c19a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">是的。它正在我们的日常生活中使用，我们甚至没有注意到它。查看<a class="ae je" href="https://support.apple.com/guide/deployment/kerberos-single-sign-on-extension-depe6a1cda64/web#:~:text=The%20Kerberos%20Single%20Sign-on,%2C%20apps%2C%20and%20file%20servers" rel="noopener ugc nofollow" target="_blank">苹果</a>、<a class="ae je" href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy-configure-single-sign-on-with-kcd" rel="noopener ugc nofollow" target="_blank">微软</a>、<a class="ae je" href="https://docs.oracle.com/cd/E57185_01/OPUSC/kerberos_single_sign-on.htm#OPUSC-hss_auth_setup_56" rel="noopener ugc nofollow" target="_blank">甲骨文</a>使用Kerberos的实现。我们也可以基于<a class="ae je" href="https://web.mit.edu/kerberos/" rel="noopener ugc nofollow" target="_blank"> MIT Kerberos </a>实现我们自己的SSO。</p><h2 id="0f36" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">它与其他服务一起工作吗？</h2><p id="32c2" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">是的。比如说<a class="ae je" href="https://github.com/stnoonan/spnego-http-auth-nginx-module" rel="noopener ugc nofollow" target="_blank"> nginx </a>，<a class="ae je" href="https://dev.mysql.com/doc/mysql-security-excerpt/8.0/en/kerberos-pluggable-authentication.html" rel="noopener ugc nofollow" target="_blank"> mysql </a>，<a class="ae je" href="https://learn.microsoft.com/en-us/sql/connect/jdbc/using-kerberos-integrated-authentication-to-connect-to-sql-server?view=sql-server-ver16" rel="noopener ugc nofollow" target="_blank"> mssql </a>，<a class="ae je" href="https://docs.spring.io/spring-security-kerberos/docs/current/reference/htmlsingle/#introduction" rel="noopener ugc nofollow" target="_blank"> spring </a>等等。但是配置会根据服务而变化。查看他们各自的文档以获取更多信息。</p><p id="db7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在这里上传了同样的实现视频，</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="6458" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在评论区发表任何问题。我会试着把它们和答案一起放在这里。</p><p id="7f48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">祝本地主机运行愉快！</p></div></div>    
</body>
</html>