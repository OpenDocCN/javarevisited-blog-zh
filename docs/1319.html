<html>
<head>
<title>Spring Bean Life Cycle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">春豆生命周期</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/spring-bean-life-cycle-6c20411d717a?source=collection_archive---------1-----------------------#2021-06-15">https://medium.com/javarevisited/spring-bean-life-cycle-6c20411d717a?source=collection_archive---------1-----------------------#2021-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/cb8f8f2645bd8fe8957130f9313d9c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*10eelZ5H3H0CNUMpRwx8RA.jpeg"/></div></figure><p id="0e26" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这个故事中，我们将讨论春豆的生命周期。任何对象的生命周期都意味着它何时以及如何出生，在其生命周期中如何表现，何时以及如何死亡。在spring中创建的对象实例也有生命周期。</p><blockquote class="jk jl jm"><p id="1088" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">春豆是什么意思？ <br/> Spring bean是由Spring IoC容器管理的java类的对象实例。</p></blockquote><figure class="js jt ju jv fd ij er es paragraph-image"><a href="https://www.java67.com/2021/10/pring-bean-example-what-does-bean-annotation-does.html"><div class="er es jr"><img src="../Images/d5bf4be96eb321d188d7e1e2d411fdc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hYEB_jkLc0yb6BB9D-LS1g.png"/></div></a><p class="jw jx et er es jy jz bd b be z dx translated">比恩的具体化过程</p></figure><p id="564c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">容器通过调用bean的构造函数来实例化bean，然后填充其属性。Aware超级接口通过回调指定bean是否有资格被声明。Aware接口通常被框架使用，很少被spring开发者使用。</p><p id="3ebb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">BeanNameAware:使对象知道容器中的bean定义。这个接口可以应用于希望知道bean名称的bean。</p><p id="217d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">BeanFactoryAware:为bean实例提供所属工厂的回调。这样我们就可以访问创建该对象的BeanFactory。</p><p id="7db8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="jn">让我们在练习中使用Aware接口</em> </strong></p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="66c1" class="kf kg hi kb b fi kh ki l kj kk">public class AwareInterfaceImpl implements BeanNameAware, BeanFactoryAware <em class="jn">{<br/><br/>  </em>@Override<br/>  public void setBeanFactory<em class="jn">(</em>BeanFactory beanFactory<em class="jn">) </em>throws BeansException <em class="jn">{<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"beanInstance is singleton : " + beanFactory.isSingleton<em class="jn">(</em>"beanInstance"<em class="jn">))</em>;<br/>  <em class="jn">}<br/><br/>  </em>@Override<br/>  public void setBeanName<em class="jn">(</em>String beanName<em class="jn">) {<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"bean name is " + beanName<em class="jn">)</em>;<br/>  <em class="jn">}<br/>}</em></span></pre><p id="ce0b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以用两种方式执行bean配置。可以是xml文件，也可以是java类。</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="32e8" class="kf kg hi kb b fi kh ki l kj kk"><em class="jn">&lt;?</em>xml version="1.0" encoding="UTF-8"<em class="jn">?&gt;<br/><br/>&lt;</em>beans <br/>       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br/>       xsi:schemaLocation="http://www.springframework.org/schema/beans<br/>     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"<em class="jn">&gt;<br/><br/>    &lt;</em>bean id="beanInstance" class="com.beanlifecycle.springbeanlifecycle.bean.AwareInterfaceImpl"<em class="jn">&gt;<br/>    &lt;/</em>bean<em class="jn">&gt;<br/>&lt;/</em>beans<em class="jn">&gt;</em></span></pre></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><pre class="ka kb kc kd aw ke bi"><span id="3f98" class="kf kg hi kb b fi ks kt ku kv kw ki l kj kk">@Configuration<br/>public class BootConfiguration <em class="jn">{<br/><br/>  </em>// if no name is assigned, it uses the method name by default.<br/>  @Bean<em class="jn">(</em>name = "beanInstance"<em class="jn">)<br/>  </em>public AwareInterfaceImpl beanInstance<em class="jn">() {<br/>    </em>return new AwareInterfaceImpl<em class="jn">()</em>;<br/>  <em class="jn">}<br/><br/>}</em></span></pre><p id="7fd8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，让我们编写将加载bean.xml的spring root main类。Spring IoC用<a class="ae kx" href="http://twitter.com/Configuration" rel="noopener ugc nofollow" target="_blank"> @Configuration </a>类为我们做到了这一点。</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="1769" class="kf kg hi kb b fi kh ki l kj kk">@SpringBootApplication<br/>public class SpringBeanLifeCycleApplication <em class="jn">{<br/><br/>  </em>public static void main<em class="jn">(</em>String<em class="jn">[] </em>args<em class="jn">) {<br/>    </em>SpringApplication.<em class="jn">run(</em>SpringBeanLifeCycleApplication.class, args<em class="jn">)</em>;<br/><br/>   AbstractApplicationContext context1 =<br/>    new ClassPathXmlApplicationContext<em class="jn">(</em>"beans.xml"<em class="jn">)</em>;<br/>AwareInterfaceImpl springBean = <em class="jn">(</em>AwareInterfaceImpl<em class="jn">) </em>context1.getBean<em class="jn">(</em>"beanInstance"<em class="jn">)</em>;<br/>context1.close<em class="jn">()</em>;<br/>    <br/>  <em class="jn">}<br/>}</em></span></pre><blockquote class="jk jl jm"><p id="66f6" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">控制台输出:<br/> bean名称为beanInstance <br/> beanInstance为singleton : true</p></blockquote></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="9a5d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">预初始化(BeanPostProcessor) </strong></p><p id="28bf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它允许与在Spring容器调用初始化方法之前或之后创建的bean实例进行交互。BeanPostProcessor接口包含两个方法。</p><p id="25a5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="jn">postprocessbeforeininitial ization</em></strong><em class="jn">:</em>Spring在感知接口之后，任何bean的初始化回调之前调用此方法。</p><p id="408c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="jn">postProcessAfterInitialization</em></strong>:Spring在任何bean初始化回调后调用此方法。</p><p id="ed6f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们开始创建一个名为ProductBean的bean。</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="8dd5" class="kf kg hi kb b fi kh ki l kj kk">public class ProductBean implements InitializingBean <em class="jn">{<br/>  </em>private String productName;<br/><br/>  public ProductBean<em class="jn">() {<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"ProductBean constructor called."<em class="jn">)</em>;<br/>  <em class="jn">}<br/><br/>  </em>public String getProductName<em class="jn">() {<br/>    </em>return productName;<br/>  <em class="jn">}<br/><br/>  </em>public void setProductName<em class="jn">(</em>String productName<em class="jn">) {<br/>    </em>this.productName = productName;<br/>  <em class="jn">}<br/><br/>  </em>@Override<br/>  public String toString<em class="jn">() {<br/>    </em>return "ProductBean{" +<br/>        "productName='" + productName + '\'' +<br/>        '}';<br/>  <em class="jn">}<br/><br/>  </em>@Override<br/>  public void afterPropertiesSet<em class="jn">() </em>throws Exception <em class="jn">{<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"ProductBean.afterPropertiesSet() method"<em class="jn">)</em>;<br/>  <em class="jn">}<br/>}</em></span></pre><p id="123e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们将创建BeanPostProcessorImpl</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="5f4c" class="kf kg hi kb b fi kh ki l kj kk">public class BeanPostProcessorImpl implements BeanPostProcessor <em class="jn">{<br/><br/>  </em>@Override<br/>  public Object postProcessBeforeInitialization<em class="jn">(</em>Object bean, String beanName<em class="jn">) </em>throws BeansException <em class="jn">{<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"Post Process Before Initialization method is called : Bean Name " + beanName<em class="jn">)</em>;<br/>    return bean;<br/>  <em class="jn">}<br/><br/>  </em>@Override<br/>  public Object postProcessAfterInitialization<em class="jn">(</em>Object bean, String beanName<em class="jn">) </em>throws BeansException <em class="jn">{<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"Post Process After Initialization method is called : Bean Name " + beanName<em class="jn">)</em>;<br/>    return bean;<br/>  <em class="jn">}<br/>}</em></span></pre><p id="957e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">ProductBean实现了BeanPostProcessor接口，并覆盖了postprocessbeforeininitialization()和postProcessAfterInitialization()方法。</p><p id="66dc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jn"> beans.xml </em></p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="33db" class="kf kg hi kb b fi kh ki l kj kk"><em class="jn">&lt;?</em>xml version="1.0" encoding="UTF-8"<em class="jn">?&gt;<br/><br/>&lt;</em>beans <br/>       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br/>       xsi:schemaLocation="http://www.springframework.org/schema/beans<br/>     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"<em class="jn">&gt;<br/>    <br/>    &lt;</em>bean id="productBean" class="com.beanlifecycle.springbeanlifecycle.bean.ProductBean"<em class="jn">&gt;<br/>    &lt;</em>property name="productName" value="product name"<em class="jn">&gt;&lt;/</em>property<em class="jn">&gt;<br/>&lt;/</em>bean<em class="jn">&gt;<br/><br/>&lt;</em>bean id="productBeanPostProcessor" class=<br/>"com.beanlifecycle.springbeanlifecycle.bean.BeanPostProcessorImpl"<em class="jn">/&gt;<br/>&lt;/</em>beans<em class="jn">&gt;</em></span></pre><p id="1a89" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">主类</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="f6ff" class="kf kg hi kb b fi kh ki l kj kk">@SpringBootApplication<br/>public class SpringBeanLifeCycleApplication <em class="jn">{<br/><br/>  </em>public static void main<em class="jn">(</em>String<em class="jn">[] </em>args<em class="jn">) {<br/>    </em>SpringApplication.<em class="jn">run(</em>SpringBeanLifeCycleApplication.class, args<em class="jn">)</em>;<br/><br/>    AbstractApplicationContext context2 =<br/>        new ClassPathXmlApplicationContext<em class="jn">(</em>"beans.xml"<em class="jn">)</em>;<br/>    ProductBean productBean = <em class="jn">(</em>ProductBean<em class="jn">) </em>context2.getBean<em class="jn">(</em>"productBean"<em class="jn">)</em>;<br/>    context2.registerShutdownHook<em class="jn">()</em>;<br/>  <em class="jn">}<br/>}</em></span></pre><blockquote class="jk jl jm"><p id="8868" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">控制台输出:<br/>调用了ProductBean构造函数。<br/>初始化方法调用前的后处理:Bean名称productBean<br/>product Bean . afterpropertiesset()方法<br/>初始化方法调用后的后处理:Bean名称product Bean</p></blockquote></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="356a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">初始化Bean和DisposableBean回调接口</strong></p><p id="4fde" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们可以提到几种方法。我们可以调用自定义的init和/或destroy方法，或者实现以编程方式进行init和destroy的接口。</p><p id="4fc7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">通过编程方式</strong></p><p id="106f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Spring提供了以下两个回调接口:</p><p id="4f53" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">initializing bean:initializing bean接口包括afterPropertiesSet()方法来编写初始化逻辑。设置属性后，容器调用此方法。</p><p id="48ed" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">DisposableBean:它包含destroy()方法。在Spring容器释放bean后工作。</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="f241" class="kf kg hi kb b fi kh ki l kj kk">public class BeanInstance implements InitializingBean,     DisposableBean <em class="jn">{<br/>  </em>private String var;<br/><br/>  public String getVar<em class="jn">() {<br/>    </em>return var;<br/>  <em class="jn">}<br/><br/>  </em>public void setVar<em class="jn">(</em>String var<em class="jn">) {<br/>    </em>this.var = var;<br/>  <em class="jn">}<br/><br/>  </em>@Override<br/>  public void destroy<em class="jn">() </em>throws Exception <em class="jn">{<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"BeanInstance.destroy() method called"<em class="jn">)</em>;<br/>  <em class="jn">}<br/><br/>  </em>@Override<br/>  public void afterPropertiesSet<em class="jn">() </em>throws Exception <em class="jn">{<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"BeanInstance.afterPropertiesSet() method called"<em class="jn">)</em>;<br/>  <em class="jn">}<br/>}</em></span></pre><p id="a55a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">beans.xml</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="e81a" class="kf kg hi kb b fi kh ki l kj kk"><em class="jn">&lt;</em>bean id="beanInstance" class="com.beanlifecycle.springbeanlifecycle.bean.BeanInstance"<em class="jn">&gt;<br/>    &lt;</em>property name="var" value="BeanInstance Starting"<em class="jn">/&gt;<br/>&lt;/</em>bean<em class="jn">&gt;</em></span></pre><p id="0a4f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">主类</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="b785" class="kf kg hi kb b fi kh ki l kj kk">@SpringBootApplication<br/>public class SpringBeanLifeCycleApplication <em class="jn">{<br/><br/>  </em>public static void main<em class="jn">(</em>String<em class="jn">[] </em>args<em class="jn">) {<br/>    </em>SpringApplication.<em class="jn">run(</em>SpringBeanLifeCycleApplication.class, args<em class="jn">)</em>;<br/><br/>ApplicationContext context3 =<br/>  new ClassPathXmlApplicationContext<em class="jn">(</em>"beans.xml"<em class="jn">)</em>;<br/>BeanInstance beanInstance = <em class="jn">(</em>BeanInstance<em class="jn">) </em>context3.getBean<em class="jn">(</em>"beanInstance"<em class="jn">)</em>;<br/>System.<em class="jn">out</em>.println<em class="jn">(</em>"BeanInstance.getVar()" + beanInstance.getVar<em class="jn">())</em>;<br/><em class="jn">((</em>AbstractApplicationContext<em class="jn">) </em>context3<em class="jn">)</em>.registerShutdownHook<em class="jn">()</em>;<br/><br/>  <em class="jn">}<br/>}</em></span></pre><blockquote class="jk jl jm"><p id="ab7c" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">控制台输出:<br/>bean instance . afterpropertiesset()方法调用<br/>bean instance . getvar()bean instance启动<br/> BeanInstance.destroy()方法调用</p></blockquote><blockquote class="ky"><p id="3f55" class="kz la hi bd lb lc ld le lf lg lh jj dx translated">不推荐使用InitializingBean和DisposableBean接口，因为这将使您的代码与Spring紧密耦合。更好的方法是在bean配置文件中指定init-method和destroy-method属性。</p></blockquote></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="033a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">自定义初始化和销毁方法</strong></p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="ae2e" class="kf kg hi kb b fi kh ki l kj kk">public class CustomBean <em class="jn">{<br/>  </em>private String var;<br/><br/>  public CustomBean<em class="jn">() {<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"CustomBean constructor called"<em class="jn">)</em>;<br/>  <em class="jn">}<br/><br/>  </em>public String getVar<em class="jn">() {<br/>    </em>return var;<br/>  <em class="jn">}<br/><br/>  </em>public void setVar<em class="jn">(</em>String var<em class="jn">) {<br/>    </em>this.var = var;<br/>  <em class="jn">}<br/><br/>  </em>public void destroy<em class="jn">() {<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"Custom destroy method called"<em class="jn">)</em>;<br/>  <em class="jn">}<br/>  </em>public void init<em class="jn">() {<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"Custom init method called"<em class="jn">)</em>;<br/>  <em class="jn">}<br/><br/>  </em>@Override<br/>  public String toString<em class="jn">() {<br/>    </em>return "CustomBean{" +<br/>        "var='" + var + '\'' +<br/>        '}';<br/>  <em class="jn">}<br/>}</em></span></pre><p id="1bcd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">beans.xml</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="6721" class="kf kg hi kb b fi kh ki l kj kk"><em class="jn">&lt;</em>bean id="customBean"<br/>      class="com.beanlifecycle.springbeanlifecycle.bean.CustomBean"<br/>      init-method="init"<br/>      destroy-method="destroy"<em class="jn">&gt;<br/>    &lt;</em>property name="var" value="Hello world! "<em class="jn">/&gt;<br/>&lt;/</em>bean<em class="jn">&gt;</em></span></pre><p id="d4b7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">主类</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="d9a9" class="kf kg hi kb b fi kh ki l kj kk">@SpringBootApplication<br/>public class SpringBeanLifeCycleApplication <em class="jn">{<br/><br/>  </em>public static void main<em class="jn">(</em>String<em class="jn">[] </em>args<em class="jn">) {<br/>    </em>SpringApplication.<em class="jn">run(</em>SpringBeanLifeCycleApplication.class, args<em class="jn">)</em>;<br/><br/>    AbstractApplicationContext context4 =<br/>    new ClassPathXmlApplicationContext<em class="jn">(</em>"beans.xml"<em class="jn">)</em>;<br/>CustomBean customBean = <em class="jn">(</em>CustomBean<em class="jn">) </em>context4.getBean<em class="jn">(</em>"customBean"<em class="jn">)</em>;<br/>context4.registerShutdownHook<em class="jn">()</em>;<br/><br/>  <em class="jn">}<br/>}</em></span></pre><blockquote class="jk jl jm"><p id="67b9" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">控制台输出:<br/>自定义Bean构造函数调用<br/>自定义init方法调用<br/>自定义destroy方法调用</p></blockquote></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="a80d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">使用注释</strong></p><p id="d12c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以在spring容器启动时调用自定义init()方法，在关闭容器时调用自定义destroy()方法。</p><p id="2272" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先创建您的java bean类。</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="93d4" class="kf kg hi kb b fi kh ki l kj kk">public class SpringBean <em class="jn">{<br/><br/>  </em>public SpringBean<em class="jn">() {<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"SpringBean instance created"<em class="jn">)</em>;<br/>  <em class="jn">}<br/><br/>  </em>// works automatically when the bean is instantiated<br/>  @PostConstruct<br/>  public void init<em class="jn">() </em>throws Exception <em class="jn">{<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"init() method that executed @PostConstruct"<em class="jn">)</em>;<br/>  <em class="jn">}<br/><br/>  </em>// works automatically after Spring Container releases the bean(when Spring container is closed)<br/>  @PreDestroy<br/>  public void destroy<em class="jn">() </em>throws Exception <em class="jn">{<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"destroy() method that executed @PreDestroy"<em class="jn">)</em>;<br/>  <em class="jn">}<br/><br/>  </em>public void close<em class="jn">() {<br/>    </em>System.<em class="jn">out</em>.println<em class="jn">(</em>"Closing resources"<em class="jn">)</em>;<br/>  <em class="jn">}<br/>}</em></span></pre><p id="fc34" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">配置类</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="0846" class="kf kg hi kb b fi kh ki l kj kk">@Configuration<br/>public class BootConfiguration <em class="jn">{<br/>  <br/>  </em>@Bean<br/>  @Scope<em class="jn">(</em>value = "singleton"<em class="jn">)<br/>  </em>public SpringBean myBean<em class="jn">() {<br/>    </em>return new SpringBean<em class="jn">()</em>;<br/>  <em class="jn">}<br/>  <br/>}</em></span></pre><p id="35be" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们不需要显式地将我的bean指定为singleton，因为默认范围是singleton。但是我这样指定是为了简单地展示原型作用域之间的区别。</p><p id="8d4f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">主类</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="3834" class="kf kg hi kb b fi kh ki l kj kk">AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext<em class="jn">()</em>;<br/>ctx.register<em class="jn">(</em>BootConfiguration.class<em class="jn">)</em>;<br/>ctx.refresh<em class="jn">()</em>;<br/><br/>SpringBean obj1 = ctx.getBean<em class="jn">(</em>SpringBean.class<em class="jn">)</em>;<br/>System.<em class="jn">out</em>.println<em class="jn">(</em>obj1.hashCode<em class="jn">())</em>;<br/><br/>SpringBean obj2 = ctx.getBean<em class="jn">(</em>SpringBean.class<em class="jn">)</em>;<br/>System.<em class="jn">out</em>.println<em class="jn">(</em>obj2.hashCode<em class="jn">())</em>;<br/><br/>ctx.close<em class="jn">()</em>;</span></pre><blockquote class="jk jl jm"><p id="d5ba" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">控制台输出:<br/> SpringBean实例创建的<br/> init()方法执行了<a class="ae kx" href="http://twitter.com/PostConstruct" rel="noopener ugc nofollow" target="_blank">@ post construct</a><br/>1924802798<br/>1924802798<br/>destroy()方法执行了<a class="ae kx" href="http://twitter.com/PreDestroy" rel="noopener ugc nofollow" target="_blank"> @PreDestroy </a> <br/>关闭资源</p></blockquote><p id="cb6f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Bean初始化后调用<a class="ae kx" href="http://twitter.com/PostConstruct" rel="noopener ugc nofollow" target="_blank"> @PostConstruct </a>方法。上下文关闭时也会调用<a class="ae kx" href="http://twitter.com/PreDestroy" rel="noopener ugc nofollow" target="_blank"> @PreDestroy </a>方法。beans的哈希代码是相同的，是单例范围导致了这种情况。</p><p id="ba83" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们通过尝试用prototype作用域初始化和销毁注释来结束我们的文章。我们只需要在配置类中将bean范围值更新为原型。</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="5e04" class="kf kg hi kb b fi kh ki l kj kk">@Bean<br/>@Scope<em class="jn">(</em>value = "prototype"<em class="jn">)<br/></em>public SpringBean myBean<em class="jn">() {<br/>  </em>return new SpringBean<em class="jn">()</em>;<br/><em class="jn">}</em></span></pre><blockquote class="jk jl jm"><p id="4828" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">控制台输出:<br/> SpringBean实例创建了执行<a class="ae kx" href="http://twitter.com/PostConstruct" rel="noopener ugc nofollow" target="_blank">@ post construct</a><br/>332498651<br/>spring bean实例创建了执行<a class="ae kx" href="http://twitter.com/PostConstruct" rel="noopener ugc nofollow" target="_blank">@ post construct</a><br/>1869177530的<br/> init()方法</p></blockquote><blockquote class="ky"><p id="44c7" class="kz la hi bd lb lc ld le lf lg lh jj dx translated">总结一下spring中bean的生命周期，当程序运行时，Spring容器启动，然后根据请求创建bean。当spring容器关闭时，bean被销毁。这个循环由Spring IoC管理。</p></blockquote></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="68eb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae kx" href="https://github.com/yunusbgrynk/spring-bean-life-cycle" rel="noopener ugc nofollow" target="_blank">源代码链接</a></p><p id="4bc8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">【参考资料:<br/><a class="ae kx" href="https://www.geeksforgeeks.org/" rel="noopener ugc nofollow" target="_blank">geeksforgeeks.org</a><br/><a class="ae kx" href="https://springframework.guru/spring-bean-lifecycle/" rel="noopener ugc nofollow" target="_blank">spring framework . guru</a><br/><a class="ae kx" href="https://docs.spring.io/" rel="noopener ugc nofollow" target="_blank">docs . spring . io</a></p></div></div>    
</body>
</html>