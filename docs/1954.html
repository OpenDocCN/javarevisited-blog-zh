<html>
<head>
<title>Controlling electronics with JBang on the Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JBang在Raspberry Pi上控制电子设备</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/controlling-electronics-with-jbang-on-the-raspberry-pi-3c290c465abd?source=collection_archive---------1-----------------------#2022-02-16">https://medium.com/javarevisited/controlling-electronics-with-jbang-on-the-raspberry-pi-3c290c465abd?source=collection_archive---------1-----------------------#2022-02-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="94e7" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">JBang是什么？</h1><p id="9311" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">正如他们的<a class="ae kb" href="https://www.jbang.dev/" rel="noopener ugc nofollow" target="_blank">网站</a>所描述的:</p><p id="d26b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="kh"> JBang让学生、教育工作者和专业开发人员以前所未有的轻松创建、编辑和运行独立的纯源代码Java程序。</em></p><p id="eb79" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="kh">想在没有设置的情况下即时学习、探索或使用Java？<br/>你喜欢</em> <a class="ae kb" rel="noopener" href="/javarevisited/10-best-places-to-learn-java-online-for-free-ce5e713ab5b2"> <em class="kh"> Java </em> </a> <em class="kh">但是使用</em><a class="ae kb" rel="noopener" href="/javarevisited/10-best-python-3-courses-on-udemy-ddd4e3ec5dbf"><em class="kh">Python</em></a><em class="kh">，</em><a class="ae kb" rel="noopener" href="/javarevisited/6-best-resources-to-learn-groovy-and-grails-for-java-developers-18c04e88fa8a"><em class="kh">Groovy</em></a><em class="kh">，</em><a class="ae kb" rel="noopener" href="/javarevisited/top-5-courses-to-learn-kotlin-in-2020-dfc3fa7706d8"><em class="kh">Kotlin</em></a><em class="kh">或者类似的语言进行脚本、实验和探索吗？<br/>有没有想过能够在任何地方运行Java，而不需要任何或非常简单的设置？<br/>曾经试过Java 11+支持运行。java文件直接放在您的shell中，但是觉得有点太麻烦了？</em></p><p id="63ca" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="kh"> JBang让你做到这一切！</em></p><h1 id="7110" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">录像</h1><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="06e9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">此视频向您展示了本页进一步描述的所有步骤。</p><h1 id="c3c3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">准备一份覆盆子馅饼</h1><p id="e0a1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对于本手册，您可以使用以下方法:</p><ul class=""><li id="9e7f" class="kp kq hi jf b jg kc jk kd jo kr js ks jw kt ka ku kv kw kx bi translated">拿一个SD卡(最低8Gb)</li><li id="2c2b" class="kp kq hi jf b jg ky jk kz jo la js lb jw lc ka ku kv kw kx bi translated">使用Raspberry Pi Imager工具将“Raspberry Pi OS (32位)”写入此SD卡</li><li id="4337" class="kp kq hi jf b jg ky jk kz jo la js lb jw lc ka ku kv kw kx bi translated">将SD卡插入您的Raspberry Pi板</li><li id="0115" class="kp kq hi jf b jg ky jk kz jo la js lb jw lc ka ku kv kw kx bi translated">开机并等待操作系统启动(它可能会重新启动一次，以将SD卡上的分区调整到最大可用大小)</li><li id="de1b" class="kp kq hi jf b jg ky jk kz jo la js lb jw lc ka ku kv kw kx bi translated">打开终端并确认<a class="ae kb" href="https://www.youtube.com/watch?v=g4rPdPxNb5w" rel="noopener ugc nofollow" target="_blank"> Java </a>还不可用(除非您选择了“Raspberry Pi OS Full (32位)”版本)</li></ul><pre class="ki kj kk kl fd ld le lf lg aw lh bi"><span id="9f95" class="li ig hi le b fi lj lk l ll lm">$ java -version <br/>bash: java: command not found</span></pre><h1 id="a19d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">安装JBang</h1><p id="9980" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">正如在<a class="ae kb" href="https://www.jbang.dev/download/" rel="noopener ugc nofollow" target="_blank">jbang.dev/download</a>中所描述的，安装JBang就足够了，即使你还没有安装Java，因为JBang也会处理这些。</p><pre class="ki kj kk kl fd ld le lf lg aw lh bi"><span id="cb24" class="li ig hi le b fi lj lk l ll lm">$ curl -Ls https://sh.jbang.dev | bash -s - app setup <br/>$ java -version <br/>openjdk version "11.0.14" 2022-01-18 <br/>OpenJDK Runtime Environment Temurin-11.0.14+9 (build 11.0.14+9) <br/>OpenJDK Server VM Temurin-11.0.14+9 (build 11.0.14+9, mixed mode)</span></pre><h1 id="1569" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">最小JBang示例</h1><p id="fab9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一个最小的JBang Java文件看起来像下面的代码块，注意特殊的第一行，它欺骗系统将它作为脚本运行，同时仍然是有效的Java代码。</p><pre class="ki kj kk kl fd ld le lf lg aw lh bi"><span id="1931" class="li ig hi le b fi lj lk l ll lm">///usr/bin/env jbang "$0" "$@" ; exit $? <br/><br/>class HelloWorld {<br/>    public static void main(String[] args) {<br/>        if(args.length==0) {<br/>            System.out.println("Hello World!");<br/>        } else {<br/>            System.out.println("Hello " + args[0]);<br/>        }<br/>    }<br/>}</span></pre><p id="f6bc" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">通过将该文件另存为<code class="du ln lo lp le b">HelloWorld.java</code>,可以从以下内容开始:</p><pre class="ki kj kk kl fd ld le lf lg aw lh bi"><span id="0764" class="li ig hi le b fi lj lk l ll lm">$ jbang HelloWorld.java <br/>Hello World!</span></pre><h1 id="50a3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">JBang Pi4J示例</h1><p id="bf2a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您的项目需要依赖项——Pi4J项目就是这种情况——您可以<a class="ae kb" href="https://www.jbang.dev/documentation/guide/latest/dependencies.html" rel="noopener ugc nofollow" target="_blank">在java文件中用下面的gradle-style locators格式</a>定义它们，例如:<code class="du ln lo lp le b">//DEPS com.pi4j:pi4j-core:2.1.1</code>。</p><p id="7a87" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">以下示例基于<a class="ae kb" href="https://pi4j.com/getting-started/minimal-example-application/" rel="noopener ugc nofollow" target="_blank">“最小示例应用”</a>，并使用带有按钮和LED的相同接线。通过使用JBang，我们可以用一个文件运行这个项目，而不需要一个完整的<a class="ae kb" rel="noopener" href="/javarevisited/6-best-maven-courses-for-beginners-in-2020-23ea3cba89"> Maven </a>或<a class="ae kb" rel="noopener" href="/javarevisited/5-best-gradle-courses-and-books-to-learn-in-2021-93f49ce8ff8e"> Gradle </a>项目，也不需要编译Java代码。</p><figure class="ki kj kk kl fd km er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/05/top-5-courses-and-books-to-learn-gradle.html#axzz6fk6WjYD0"><div class="er es lq"><img src="../Images/dfa9f6e80f5074197223f98b0e40e563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBkn3rdIegswK-aIff0qQg.png"/></div></a><p class="lt lu et er es lv lw bd b be z dx translated">最小Pi4J示例应用程序的布线</p></figure><p id="fcf4" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">用以下内容创建一个新文件<code class="du ln lo lp le b">JBangPi4JExample.java</code>:</p><pre class="ki kj kk kl fd ld le lf lg aw lh bi"><span id="6e94" class="li ig hi le b fi lj lk l ll lm">///usr/bin/env jbang "$0" "$@" ; exit $?<br/>//DEPS org.slf4j:slf4j-api:1.7.35<br/>//DEPS org.slf4j:slf4j-simple:1.7.35<br/>//DEPS com.pi4j:pi4j-core:2.1.1<br/>//DEPS com.pi4j:pi4j-plugin-raspberrypi:2.1.1<br/>//DEPS com.pi4j:pi4j-plugin-pigpio:2.1.1<br/><br/>import com.pi4j.Pi4J;<br/>import com.pi4j.io.gpio.digital.DigitalInput;<br/>import com.pi4j.io.gpio.digital.DigitalOutput;<br/>import com.pi4j.io.gpio.digital.DigitalState;<br/>import com.pi4j.io.gpio.digital.PullResistance;<br/>import com.pi4j.util.Console;<br/><br/>class JBangPi4JExample {<br/><br/>    private static final int PIN_BUTTON = 24; // PIN 18 = BCM 24<br/>    private static final int PIN_LED = 22; // PIN 15 = BCM 22<br/><br/>    private static int pressCount = 0;<br/>    <br/>    public static void main(String[] args) throws Exception {<br/><br/>        final var console = new Console();<br/>        <br/>        var pi4j = Pi4J.newAutoContext();<br/>        <br/>        var ledConfig = DigitalOutput.newConfigBuilder(pi4j)<br/>                .id("led")<br/>                .name("LED Flasher")<br/>                .address(PIN_LED)<br/>                .shutdown(DigitalState.LOW)<br/>                .initial(DigitalState.LOW)<br/>                .provider("pigpio-digital-output");<br/>        var led = pi4j.create(ledConfig);<br/><br/>        var buttonConfig = DigitalInput.newConfigBuilder(pi4j)<br/>                .id("button")<br/>                .name("Press button")<br/>                .address(PIN_BUTTON)<br/>                .pull(PullResistance.PULL_DOWN)<br/>                .debounce(3000L)<br/>                .provider("pigpio-digital-input");<br/>        var button = pi4j.create(buttonConfig);<br/>        button.addListener(e -&gt; {<br/>            if (e.state() == DigitalState.LOW) {<br/>                pressCount++;<br/>                console.println("Button was pressed for the " <br/>                    + pressCount + "th time");<br/>            }<br/>        });<br/><br/>        while (pressCount &lt; 5) {<br/>            if (led.equals(DigitalState.HIGH)) {<br/>                console.println("LED low");<br/>                led.low();<br/>            } else {<br/>                console.println("LED high");<br/>                led.high();<br/>            }<br/>            Thread.sleep(500 / (pressCount + 1));<br/>        }<br/>        <br/>        pi4j.shutdown();<br/>    }<br/>}</span></pre><p id="76aa" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">不需要任何进一步的配置、安装、依赖项下载或编译，我们现在应该能够运行以下代码:</p><pre class="ki kj kk kl fd ld le lf lg aw lh bi"><span id="db32" class="li ig hi le b fi lj lk l ll lm">$ jbang JBangPi4JExample.java<br/><br/>[jbang] Building jar...<br/><br/>[main] INFO com.pi4j.Pi4J - New auto context<br/>[main] INFO com.pi4j.Pi4J - New context builder<br/>[main] INFO com.pi4j.platform.impl.DefaultRuntimePlatforms - adding platform to managed platform map [id=raspberrypi; name=RaspberryPi Platform; priority=5; class=com.pi4j.plugin.raspberrypi.platform.RaspberryPiPlatform]<br/>[main] WARN com.pi4j.library.pigpio.impl.PiGpioNativeImpl - PIGPIO ERROR: PI_INIT_FAILED; pigpio initialisation failed</span></pre><p id="0fea" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">啊，错误…？！但这是一个已知的！此时，pig Pio——与Gpio交互的底层原生库——需要被称为<code class="du ln lo lp le b">sudo</code>。这是不理想的，我们正在研究如何可以返工。但是，通过一些额外的步骤，这可以很容易地解决！</p><p id="6ffa" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">首先，我们需要用<code class="du ln lo lp le b">which jbang</code>为当前用户找出JBang安装在哪里。这个完整路径可以用来从那个位置启动JBang，而不是JBang为<code class="du ln lo lp le b">pi</code>用户自动创建的快捷方式<code class="du ln lo lp le b">jbang</code>(在本例中)。由于Java是由JBang为<code class="du ln lo lp le b">pi</code>用户安装的，所以它需要为<code class="du ln lo lp le b">sudo</code>用户再次安装，但这也是由JBang自动处理的。</p><pre class="ki kj kk kl fd ld le lf lg aw lh bi"><span id="b1f9" class="li ig hi le b fi lj lk l ll lm">$ which jbang<br/>/home/pi/.jbang/bin/jbang<br/><br/>$ sudo /home/pi/.jbang/bin/jbang JBangPi4JExample.java<br/>Downloading JDK 11. Be patient, this can take several minutes...<br/><br/>[main] INFO com.pi4j.Pi4J - New auto context<br/>[main] INFO com.pi4j.Pi4J - New context builder<br/>[main] INFO com.pi4j.platform.impl.DefaultRuntimePlatforms - adding platform to managed platform map [id=raspberrypi; name=RaspberryPi Platform; priority=5; class=com.pi4j.plugin.raspberrypi.platform.RaspberryPiPlatform]<br/>[main] INFO com.pi4j.util.Console - LED high<br/>[main] INFO com.pi4j.util.Console - LED low<br/>[main] INFO com.pi4j.util.Console - LED low<br/>[Thread-0] INFO com.pi4j.util.Console - Button was pressed for the 1th time<br/>[main] INFO com.pi4j.util.Console - LED high<br/>[main] INFO com.pi4j.util.Console - LED low<br/>[main] INFO com.pi4j.util.Console - LED high<br/>[Thread-2] INFO com.pi4j.util.Console - Button was pressed for the 2th time<br/>[main] INFO com.pi4j.util.Console - LED low<br/>[main] INFO com.pi4j.util.Console - LED high<br/>...<br/>[main] INFO com.pi4j.util.Console - LED high<br/>[main] INFO com.pi4j.util.Console - LED low<br/>[Thread-8] INFO com.pi4j.util.Console - Button was pressed for the 5th time</span></pre><p id="dbae" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">是的，我们有一个工作示例，有依赖关系，不需要编译任何东西！</p><p id="6f3c" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">这两个命令甚至可以结合使用，使事情变得更加简单，让您只需使用以下命令即可启动应用程序:</p><pre class="ki kj kk kl fd ld le lf lg aw lh bi"><span id="60b5" class="li ig hi le b fi lj lk l ll lm">$ sudo `which jbang` JBangPi4JExample.java</span></pre><h1 id="2172" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="e9c2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">JBang是运行(单个文件)Java文件的好方法，可以帮助您在Raspberry Pi上快速开始使用Pi4J，并且是试验电子学和Java的理想入门方法。</p><p id="76ee" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">感谢<a class="ae kb" href="https://twitter.com/maxandersen" rel="noopener ugc nofollow" target="_blank"> Max Rydahl Andersen </a>和众多贡献者创造了JBang，并提出了 <code class="du ln lo lp le b"><a class="ae kb" href="https://github.com/jbangdev/jbang/discussions/1229" rel="noopener ugc nofollow" target="_blank">sudo</a></code> <a class="ae kb" href="https://github.com/jbangdev/jbang/discussions/1229" rel="noopener ugc nofollow" target="_blank">如何与JBang </a>结合的<a class="ae kb" href="https://github.com/jbangdev/jbang/discussions/1229" rel="noopener ugc nofollow" target="_blank">解决方案。</a></p></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><p id="e9f1" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="kh">最初发表于</em><a class="ae kb" href="https://pi4j.com/documentation/building/jbang/" rel="noopener ugc nofollow" target="_blank"><em class="kh">https://pi4j.com</em></a><em class="kh">。</em></p></div></div>    
</body>
</html>