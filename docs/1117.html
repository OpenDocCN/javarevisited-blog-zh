<html>
<head>
<title>Beefing Up Redshift Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">增强红移性能</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/beefing-up-redshift-performance-aa6970af0af4?source=collection_archive---------1-----------------------#2021-04-02">https://medium.com/javarevisited/beefing-up-redshift-performance-aa6970af0af4?source=collection_archive---------1-----------------------#2021-04-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/68082c8d33e3c470c93bd3872da57849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PHtxSdZUF3Za9uVc"/></div></div></figure><p id="30c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">MPP是任何数据仓库和大数据用例的必备工具。由于其易用性、性能和可扩展性，亚马逊红移超越了其领域内的所有同行。优化很容易被称为数据仓库和大数据世界中的关键步骤。</p><p id="1b3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">附带的红移原语优化技术将有助于解决不均衡的查询性能。</p><h1 id="99f4" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">优先压缩</h1><p id="77a4" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">压缩会在顶层影响红移集群的性能。挤压的重要影响是:</p><ol class=""><li id="e796" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated"><strong class="is hj">降低存储利用率</strong>。</li></ol><p id="f5d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对列的压缩显著降低了数据的大小。即..红移群集使用较少的磁盘</p><p id="5a1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2。提高查询性能</strong>。</p><p id="4226" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据扫描和连接将是高效，因为涉及较少的I/O操作。</p><p id="dfa3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">选择压缩编码</strong></p><p id="b722" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为列类型选择正确的编码对于表的性能至关重要。如果列有许多不重复的值或者列字符数较少，建议跳过编码，因为解压缩开销的影响会大于优化带来的好处。</p><p id="db92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果连续的列值变化或相差一个<br/>字节，就像唯一的连续整数一样，Delta编码会做得更好。</p><p id="d961" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> AZ64 </strong>是一种AWS属性编码算法，在存储和输出中对数字、日期和时间数据类型都很有效，因为它使用SIMD进行并行处理。</p><p id="4158" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">跟随这个<a class="ae la" href="https://docs.aws.amazon.com/redshift/latest/dg/Examples__compression_encodings_in_CREATE_TABLE_statements.html" rel="noopener ugc nofollow" target="_blank">文档</a>可以对编码有一个清晰的了解</p><p id="a540" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">测试压力</strong></p><p id="fe90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<strong class="is hj">“分析压缩”</strong>语句分析现有表的压缩效果</p><blockquote class="lb lc ld"><p id="bb98" class="iq ir le is b it iu iv iw ix iy iz ja lf jc jd je lg jg jh ji lh jk jl jm jn hb bi translated">将数据加载到redshift时，始终建议使用Copy命令并将COMPUPDATE设置为on，因为它会应用自动压缩。</p></blockquote><h1 id="ab47" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">物化列</strong></h1><p id="ea20" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">对于可以预见的查询模式或经常重复的查询，最好使用<a class="ae la" href="https://www.java67.com/2012/11/what-is-difference-between-view-vs-materialized-view-database-sql.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">物化视图</strong> </a>。下游应用程序可以查询/读取预先计算的物化视图中可用的数据，而不是对大型表运行资源密集型查询。</p><p id="f73e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基本可以肯定的是，基表中的数据会随着时间发生变化，运行<strong class="is hj">“刷新物化视图”</strong>来刷新物化视图。</p><p id="fb5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">物化视图的好处是红移表和外部<br/>表都能够存储<a class="ae la" href="https://javarevisited.blogspot.com/2011/10/selct-command-sql-query-example.html" rel="noopener ugc nofollow" target="_blank">选择查询</a>的结果集。<br/>引用物化视图会更有效，因为它们<br/>更喜欢使用预先计算的结果，而不是访问外部表。</p><p id="3528" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">水绿色</strong></p><p id="92b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">AWS红移的新功能目前处于预览阶段，但承诺运行红移查询的速度将比同类产品快10倍。Aqua拥有<a class="ae la" rel="noopener" href="/javarevisited/5-best-aws-courses-for-beginners-and-experienced-developers-to-learn-in-2021-563212409fbd?source=rss-bb36d8439904------2&amp;utm_source=dlvr.it&amp;utm_medium=linkedin"> AWS </a>专门设计的数据处理器，它还充当缓存缓冲和子查询卸载系统，减少红移集群的工作负载，使其更加高效。AQUA运行某些重复查询，并预先对数据集进行预处理，将其交付给Redshift。</p><h1 id="eec2" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">警惕DistKey的使用</strong></h1><p id="57ba" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">当在基于“均匀”和“键”的分布之间进行选择时需要小心，因为基于键的分布可能会导致特定查询上的数据偏斜和不均匀的查询性能，这些查询可能需要与另一个不在同一位置的键进行联接。</p><h1 id="f947" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">复制压缩数据</strong></h1><p id="71c9" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">将数据复制到Amazon Redshift的首选方式是copy命令，因为它利用了Redshift的MPP架构来传输数据。复制命令可用于各种来源的文件，如EMR、<a class="ae la" rel="noopener" href="/javarevisited/7-best-aws-s3-and-dynamodb-courses-for-beginners-in-2021-a8a44b6066da"> DynamoDB、</a>和<a class="ae la" href="https://www.java67.com/2020/08/top-5-courses-to-learn-aws-s3-and-dynamoDB-in-depth.html" rel="noopener ugc nofollow" target="_blank"> S3 </a>。</p><p id="593b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">加载大量数据时在S3压缩文件将实现三个目标:</p><ol class=""><li id="7121" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated">更快地将文件上传到S3</li><li id="098f" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn kw kx ky kz bi translated">降低S3存储利用率(成本)</li><li id="a5a6" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn kw kx ky kz bi translated">更快的加载过程，因为压缩解压缩可以在读取文件时发生。</li></ol><h1 id="11ed" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">红移光谱</strong></h1><p id="b483" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">随着数据量的增长，维护数据仓库系统将变得复杂。Redshift提供了一个全面的服务来减少集群中不常使用的数据，并根据需要从AWS S3加载这些数据。这有助于用户控制成本，并允许以最小的负载保持红移集群。</p><h1 id="ef42" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">统计的重要性</h1><p id="b4af" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">Redshift有自己的查询执行引擎，它使用关于表的统计信息来构建查询执行计划。基于这些统计数据，查询执行引擎从它生成的许多执行计划中挑选出优化的计划。因此，总是建议经常分析该表。然而，运行分析的频率应该仅在进行基于成本的分析之后才算出来，因为这是一项成本高昂的操作。</p><h1 id="d7ce" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">创建定制工作量管理器(WLM)队列</h1><p id="9ab8" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">很容易，红移查询性能最重要的组成部分是高效管理Amazon红移工作负载管理器。Redshift中的查询将在排队模型中运行。默认的WLM配置在大多数情况下都派不上用场。定制这些WLM工作负载有其优势:</p><ol class=""><li id="fd5a" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated">能够横向扩展工作负载，提供足够的资源(例如并发性和内存)</li><li id="d813" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn kw kx ky kz bi translated">针对不同类型的工作负载分离查询和工作负载</li></ol><p id="97f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Amazon Redshift允许用户定义多达8个队列，总共有多达50个插槽来分隔工作负载。通过设置队列分配规则，可以将查询路由到某些队列中。</p><p id="bd91" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于WLM配置，建议遵循以下流程:</p><ol class=""><li id="1753" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated">独立用户</li><li id="86f7" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn kw kx ky kz bi translated">定义工作负载</li><li id="c06c" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn kw kx ky kz bi translated">将用户分组到工作负载中</li><li id="7e58" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn kw kx ky kz bi translated">选择每个队列的插槽计数和内存百分比</li></ol><h1 id="d014" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">使用短查询加速(SQA)</h1><p id="d1c0" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">数据分析师/科学家总是需要混合使用大大小小的查询，这是很常见的。在这些场景中，执行这些小查询比等待密集查询更有意义。利用机器学习<a class="ae la" href="https://becominghuman.ai/top-10-courses-to-learn-tensorflow-for-machine-learning-in-2020-39a31e7cd84b" rel="noopener ugc nofollow" target="_blank">的短查询加速</a>加速这些短查询的执行。</p><h2 id="5152" class="ln jp hi bd jq lo lp lq ju lr ls lt jy jb lu lv kc jf lw lx kg jj ly lz kk ma bi translated"><strong class="ak">区域地图&amp;分类键</strong></h2><p id="4305" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">区域映射马克斯红移通过快速包含或排除数据来更快地执行查询，而无需实际查看数据。这还会减少节点的I/O。但是，如果数据没有排序，这不会产生任何影响，因为区域图对每个块的最小-最大范围起作用，如果数据没有排序，这些范围将会重叠。</p><h2 id="d582" class="ln jp hi bd jq lo lp lq ju lr ls lt jy jb lu lv kc jf lw lx kg jj ly lz kk ma bi translated">高效查询</h2><p id="0a06" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">另一件要看的事情是你的查询效率。例如，如果您使用查询来扫描整个数据集，您可能无法充分利用您的计算资源。</p><p id="ea3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编写性能查询的一些技巧:</p><ul class=""><li id="08b3" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn mb kx ky kz bi translated">如果可能，请远离<code class="du mc md me mf b"><a class="ae la" href="https://www.java67.com/2014/09/difference-between-union-vs-union-all-in-SQL.html" rel="noopener ugc nofollow" target="_blank">UNION</a></code> <a class="ae la" href="https://www.java67.com/2014/09/difference-between-union-vs-union-all-in-SQL.html" rel="noopener ugc nofollow" target="_blank"> </a>。</li><li id="00f3" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn mb kx ky kz bi translated">尽可能指定多级条件句。</li><li id="eb39" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn mb kx ky kz bi translated">利用<code class="du mc md me mf b"><a class="ae la" href="https://www.periscopedata.com/blog/explain-and-other-tools-for-query-optimization.html" rel="noopener ugc nofollow" target="_blank">EXPLAIN</a></code>了解查询执行计划和成本。</li></ul><h2 id="6207" class="ln jp hi bd jq lo lp lq ju lr ls lt jy jb lu lv kc jf lw lx kg jj ly lz kk ma bi translated">杂项优化</h2><ul class=""><li id="e5da" class="kr ks hi is b it km ix kn jb mg jf mh jj mi jn mb kx ky kz bi translated"><strong class="is hj">纵向扩展集群。</strong>在高峰时期，如果发现查询性能较慢，就向集群中添加更多的节点。</li><li id="f18d" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn mb kx ky kz bi translated"><strong class="is hj">调度真空。</strong>如果在红移集群上有频繁的更新和删除操作，为了回收被标记为删除的行所占用的磁盘空间，为你的红移集群安排一次定期的清空。</li><li id="c75f" class="kr ks hi is b it li ix lj jb lk jf ll jj lm jn mb kx ky kz bi translated"><strong class="is hj">使用红移顾问:</strong>总是建议从红移顾问那里获得一些帮助，因为它的建议将有助于提高集群的效率，因为这些建议是从对运行数据的统计和观察中得出的。</li></ul><p id="4164" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">结论</strong></p><p id="5a80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尽管这篇文章有助于您了解红移的大多数原始调优操作，但仍然像任何其他AWS产品一样，通过密切观察AWS博客来了解AWS红移的所有最新变化和新功能总是好的，并重新发明以实现红移的最大化。</p></div></div>    
</body>
</html>