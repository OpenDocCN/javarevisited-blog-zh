# 基于主干的开发的先决条件

> 原文：<https://medium.com/javarevisited/prerequisites-for-trunk-based-development-b60e5912e844?source=collection_archive---------3----------------------->

![](img/c6dd8c8a5171a63ace125f736d0b7525.png)

树干。

基于主干的开发是一种极限编程源代码控制技术，在这种技术中，开发人员在他们的源代码控制/版本控制工具(通常是 [git](/javarevisited/11-best-online-places-to-learn-git-for-beginners-in-2021-6dc2b7c6ef48) )中直接开发和维护软件的主要分支，也称为“主干”，而不需要创建额外的分支，也不需要合并它们。

在这篇文章中，我将谈论一些优势，并解释在我们选择这种策略之前，我们需要记住的一些先决条件。

**这很简单** 这是一种非常简单的技术，没有分支，从技术的角度来看，开发人员所要做的就是提交代码，并将代码推送到同一个分支。

**减少同步/合并问题的机会** 当我们在分支上工作时，我们经常需要意识到我们需要不时地同步我们的分支，以防发生变化。在基于主干的开发中，由于源代码控制工具中的层次较少，因此在不同步的代码中工作的可能性显著降低。这意味着更少的合并问题。

**快速集成** 在基于主干的开发中，因为我们不需要做拉请求，所以集成往往会更快。先到先得。在我们推进到主干之前，我们没有中间分支，这增加了流程的复杂性，也降低了交付速度

在我的职业生涯中，到目前为止，我发现在很多情况下，测试人员和 QA 专家在处理分支时会感到非常困惑。他们想要测试一些东西，但是他们不确定应该从哪个分支获取代码，也不确定应该从哪个分支获取依赖项。因为在基于主干的开发中，主干总是绿色的，所以测试人员可以放心，他们测试的是最新的。

**更高的代码质量** 所以我们根本没有创建[分支](http://javarevisited.blogspot.sg/2013/04/difference-between-trunk-tags-and-branch-svn-cvs-git-scm-subversion.html#axzz538VTwUNp)。如果我们打破了一些东西，我们需要立即修复它，因为建设将变红。管道将会停止。测试人员将无法测试，操作人员也无法部署。基于主干的开发要求高质量，因为为了避免破坏，我们必须首先在本地运行我们的测试，并确保在我们推进之前一切正常。

**共享所有权和标记** 一旦团队对主干的当前状态感到满意，就可以选择创建标记。我们可以尽可能频繁地创建这些标签，并且总会有一些稳定的东西供测试人员或运营人员使用。重要的是基于主干迫使整个团队对正在发生的事情有更好的认识。

为了成功地进行基于主干的开发，我们需要真正好的自动化测试，尤其是验收测试。这种技术迫使我们对业务分析师的需求非常好奇，并让他们不断地参与到发现、制作和更新需求的过程中。基于主干的开发所需要的这种高度的跨学科协作对于共享知识和解决问题(如果有的话)来说是非常好的。

许多实践基于主干开发的团队也根据经验进行结对编程。这是因为通过结对编程，我们有了一个更直接的持续的代码审查，这对于基于主干的开发来说是必不可少的。

如你所见，基于主干的开发很简单，但是非常强大。但由于多种原因，并不是每个公司和团队都有能力做到这一点。在这里，我总结了一些需求，在我看来，这些需求对于任何考虑基于主干的开发的团队来说都是强制性的。

**自动化测试，没有借口** 团队必须进行自动化测试，如果我把它推得更远一点，我会说验收测试至少在集成级别也是必须的(也许通过一个单独的验收测试工具应用程序)。在进行基于主干的开发时，我们不能依赖直觉。我们不能偷懒，跳过一些测试，我们需要尽可能多地以自动化的方式进行测试。我们不能允许我们的业务分析师不告诉我们一些事情就跑掉，我们也不能不提问，因为所有这些问题都将成为某种自动化测试。如果出于某种原因，我们的团队对本段中提到的任何一点都不满意，那么基于主干的开发可能会有风险。我的建议是多关注自动化测试，尤其是验收测试。

**不同的代码评审方法** 想想看，如果你不创建一个分支，然后做一个拉请求。那么代码是如何评审的呢？在严格的基于主干的开发中，在代码被推送之前，评审人员需要与编写代码的开发人员坐在一起。所以复习总是两人一组。

我有时看到一些人创建了一个补丁并分享它，但这不是重点。重点是让人们一起对代码进行评论，并确保它在被推入“主干”之前运行良好。

由于这个原因，正如我前面提到的，许多实践基于主干的开发的团队也实践结对编程，因为评审总是在进行中。一些团队更进一步，即使他们进行结对编程，他们也会在一个特性的实现过程中交换结对，这样更多的眼睛可以观察到，更多的知识和意识可以被分享。

如果你的团队对结对编程不满意，你仍然可以做基于主干的开发，但是协作评审过程是重要的，不应该跳过。即使你的团队中充满了编程巨星，也不建议在没有额外的一双眼睛的情况下推进。

TDD 会很棒
我们不能说为了实践基于主干的开发就需要 TDD。但是因为我们非常重视代码质量。鼓励 TDD 真的很好。老实说，结对和做 [TDD](/javarevisited/5-courses-to-learn-junit-and-mockito-in-2019-best-of-lot-f217d8b93688) 很有趣，我不明白为什么这么多人讨厌它。

由于一个非常简单的原因，当进行基于主干的开发时，在我们的代码中拥有特性标志/切换是非常重要的。很多时候，开发比交付的其他过程要快，所以特性需要保持休眠状态。在一个开关后面有一个休眠特性要比在一个单独的分支中容易得多，这就是为什么如果我们要进行基于主干的开发，这是我们需要理解的一个重要的先决条件。

**建立监控或通知系统** 办公桌轮用是一种“时尚”，很多公司都喜欢这么做。这很好，但如果我们不打算坐在一起并有一个构建监视器，我们需要确保所有团队成员都订阅了他们各自应用程序的管道通知。一个很好的实践是在 slack 和 jenkins 之间进行集成，将通知发送给团队的渠道和进行最后一次推送的开发人员。

**小团队** 在进行基于主干的开发时，根据我的经验，我观察到拥有一个较大系统的某个部分的较小团队，比方说在一个子业务领域内分组的一些微服务，往往比拥有整个或大部分系统的大团队表现得更好。

这就是基于主干的开发，简而言之，这是先决条件。记住，**没有分支！**你有什么想法？你试过吗？怎么样了？请在评论中让我知道。