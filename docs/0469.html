<html>
<head>
<title>CI/CD with Travis CI &amp; Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Travis CI和Terraform的CI/CD</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/ci-cd-with-travisci-terraform-62145090efa5?source=collection_archive---------2-----------------------#2020-06-01">https://medium.com/javarevisited/ci-cd-with-travisci-terraform-62145090efa5?source=collection_archive---------2-----------------------#2020-06-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f825" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用TravisCI和Terraform免费设置CI/CD管道以自动创建基础设施所需的一切</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c96690be8df54eca63926cab7496610c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JEjxIlDGJQDs9epbmrnDww.jpeg"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">图像由<a class="ae jt" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae jt" href="https://unsplash.com/@yancymin" rel="noopener ugc nofollow" target="_blank"> Yancy Min </a>拍摄</p></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="eb2e" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">什么是CI/CD</h1><p id="5177" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">持续集成(CI)和持续部署(CD)是一组操作原则(在敏捷方法中最流行)，允许您更频繁、更可靠地交付代码变更，而不需要额外的交互。这对开发团队的意义在于，它允许您专注于提供商业价值，而不是专注于软件生命周期的操作部分。</p><p id="322f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">坚果壳中的过程:</p><p id="103a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> CI </strong> : <code class="du le lf lg lh b">Build -&gt; Package -&gt; Test</code></p><p id="705b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> CD </strong> : <code class="du le lf lg lh b">Deploy output from CI across all environments</code></p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="ca79" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">向GitHub授权Travis CI</h1><p id="2fb6" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">首先，转到<a class="ae jt" href="http://travis-ci.com" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>并点击<code class="du le lf lg lh b">SIGN IN WITH GITHUB</code>按钮(<strong class="ih hj"> <em class="li">注</em> </strong> <em class="li">:您的存储库必须是公共的，您才能使用这个服务</em>)。您应该会看到一个授权屏幕，要求您授予Travis从您的GitHub帐户读取数据的权限</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://medium.com/javarevisited/top-10-free-courses-to-learn-maven-jenkins-and-docker-for-java-developers-51fa7a1e66f6?source=collection_home---4------3-----------------------"><div class="er es lj"><img src="../Images/307b368b914db6b5795ba1f7dc24e0fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*358kJ_rLUKnL7izgBWeuYg.png"/></div></a><p class="jp jq et er es jr js bd b be z dx translated">授权特拉维斯·CI</p></figure><p id="93ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您授权了Travis，您将被带到您的仪表板，您可以开始连接您的存储库。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="5070" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">连接存储库</h1><p id="373e" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">此时，您将需要一个AWS IAM用户设置，具有编程访问权限和相关凭据。如果你还没有这些，看看上周关于如何用<a class="ae jt" rel="noopener" href="/javarevisited/top-15-online-courses-to-learn-docker-kubernetes-and-aws-for-fullstack-developers-and-devops-d8cc4f16e773"> AWS </a>设置Terraform的教程。</p><div class="lk ll ez fb lm ln"><a rel="noopener follow" target="_blank" href="/devops-dudes/setting-up-terraform-with-amazon-web-services-aws-afb2fde6cf18"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">使用AWS设置Terraform</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">借助AWS和Terraform，您可以获得设置、部署和自动化工作流程所需的一切</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">medium.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb jn ln"/></div></div></a></div><p id="c567" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Travis仪表板的最左侧，您会看到一个带有<code class="du le lf lg lh b">+</code>按钮的<code class="du le lf lg lh b">My Repositories</code>面板，单击它可以添加一个新的存储库</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mc"><img src="../Images/04a3f81c8a3aa1d26ae1db24b4c381cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*68R2KqoEm3q8-n8WLFQx2g.png"/></div><p class="jp jq et er es jr js bd b be z dx translated">添加新的存储库</p></figure><p id="fbb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的存储库没有出现在列表中(现在或将来)，您可能需要进行一次性同步来添加它</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://medium.com/javarevisited/top-15-online-courses-to-learn-docker-kubernetes-and-aws-for-fullstack-developers-and-devops-d8cc4f16e773"><div class="er es md"><img src="../Images/efbbcee62f12121d1d32ea52a5603a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uUlOARoHagPDr9ylhTe01A.png"/></div></a><p class="jp jq et er es jr js bd b be z dx translated">同步你的GitHub库</p></figure><p id="32ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们必须将AWS IAM凭证添加到builds环境变量中。从您的<code class="du le lf lg lh b">Dashboard</code>-&gt;-<code class="du le lf lg lh b">More options </code>-&gt;-<code class="du le lf lg lh b">Settings</code>中选择您的资源库</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://medium.com/hackernoon/top-5-online-courses-to-crack-amazon-web-service-aws-solutions-architect-associate-exam-saa-c01-c667514ca72?source=---------15------------------"><div class="er es me"><img src="../Images/f16cf51ae315fa2a19e2b93ddf0344ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pF7FOk0OgDEhTn_Fyrtsog.png"/></div></a><p class="jp jq et er es jr js bd b be z dx translated">构建设置</p></figure><p id="1ddc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向下滚动到<code class="du le lf lg lh b">Environment Variables</code>部分，在这里添加您的访问/密钥(<strong class="ih hj"> <em class="li">注:</em> </strong> <em class="li">密钥必须与下面的名称</em>匹配)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/f5990472bbc893e1452d8f92fbc91fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R9dfbaKlzTYdWEtlohE6Nw.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">添加AWS机密/访问密钥</p></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="8963" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">添加Travis YML配置</h1><p id="30a2" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">Travis让我们能够使用YML config定义您的管道，这样您就再也不用担心手动交互了。作为开发过程的一部分，这给了您通过代码为您拥有的每个存储库定义新管道的灵活性</p><p id="3e18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的库的根目录下创建一个名为<code class="du le lf lg lh b">.travis.yml</code>的新文件，并用以下内容填充它(完整的命令列表可以在<a class="ae jt" href="https://docs.travis-ci.com/user/customizing-the-build" rel="noopener ugc nofollow" target="_blank">这里找到</a>)</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mg mh l"/></div><p class="jp jq et er es jr js bd b be z dx translated">travis.yml</p></figure><p id="06bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经有了YML，让我们将代码推送到GitHub，然后开始创建Pull请求(PR)</p><pre class="je jf jg jh fd mi lh mj mk aw ml bi"><span id="1a71" class="mm kc hi lh b fi mn mo l mp mq">git add . <br/>git commit -m "Initial commit of Travis CI configuration" <br/>git push -u origin feature/travis-ci-build</span></pre></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="e0da" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">创建拉取请求</h1><p id="f4e7" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">在你的库的GitHub界面中点击<code class="du le lf lg lh b">Compare &amp; pull request</code></p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://medium.com/@javinpaul/top-10-free-courses-to-learn-git-and-github-best-of-lot-967aa314ea"><div class="er es mr"><img src="../Images/4e241078ab7847d872e9f73f6faad877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vfdQPF703J1mZ0-4wlTWcQ.png"/></div></a><p class="jp jq et er es jr js bd b be z dx translated">打开新的PR</p></figure><p id="7326" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它应该自动默认为您最近提交的分支，但如果没有，请从下拉列表中选择它。接下来，给你的公关一个标题，描述，然后点击<code class="du le lf lg lh b">Create pull request</code>按钮。</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://medium.com/javarevisited/11-essential-skills-to-become-software-developer-in-2020-c617e293e90e?source=extreme_sidebar---------0-2----------------------"><div class="er es ms"><img src="../Images/672d159c51a25e662e32f7325fc9066b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LdW-oT8WGtK0CuP9E5doww.png"/></div></a><p class="jp jq et er es jr js bd b be z dx translated">创建公关</p></figure><p id="9da5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦创建了Pull请求，GitHub将向Travis发送一个通知，这将按照我们的YML定义触发一个新的构建步骤。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/102d2813a734dfde435837d6dc02a48c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vMl5vBLe51meCGha1NNXfw.png"/></div></div><p class="jp jq et er es jr js bd b be z dx translated">CI合并检查</p></figure><p id="42be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在上面看到，只有当我们的CI流程已经验证了一个成功的构建时，合并才会完成。这阻止了您合并在生产系统中不起作用的代码——所以习惯这种处理拉请求的方式是一个好习惯。如果您现在前往Travis仪表板，您将看到您的构建正在运行，然后您可以跟踪日志中的输出！</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="5468" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">部署到AWS</h1><p id="68a1" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">因此，我们已经定义了一个构建计划，并成功地设置了在创建新PR时运行该计划。一旦你确认了Terraform的<code class="du le lf lg lh b">Plan</code>阶段的输出，并对将要应用的更改感到满意，点击<code class="du le lf lg lh b">Merge pull request</code>按钮。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mu"><img src="../Images/b82e18c10f691353627ef6eaefc0fcdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*s33uX1kA8iri-Qe5UEkc1w.png"/></div><p class="jp jq et er es jr js bd b be z dx translated">合并PR</p></figure><p id="3eeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在记住，我们只想在我们的构建管道中执行PR的<code class="du le lf lg lh b">Plan</code>阶段，而<code class="du le lf lg lh b">Apply</code>阶段在我们合并时出现。因此，再次前往您的Travis仪表板，您应该会看到它执行另一个构建，但这一次实际上是部署更改！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mv"><img src="../Images/42b1a855d9ee74a28d25f8706ad73c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*CJu_OsrZOdzHQlLpXHjRag.png"/></div><p class="jp jq et er es jr js bd b be z dx translated">成功部署到AWS</p></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="ad5e" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h1><p id="6061" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">现在您已经集成了您的存储库，您可以为您开始的每个项目都这样做了！您已经可以看到在未来构建、测试和部署您的代码时，它将为您节省多少时间，所以从现在开始，尝试将它作为您开发生命周期的一部分。</p><p id="15a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请在下面的评论中让我知道你对这种风格的教程的看法，并请对未来教程的任何改进提出建议。下周见！</p><h1 id="3781" class="kb kc hi bd kd ke mw kg kh ki mx kk kl km my ko kp kq mz ks kt ku na kw kx ky bi translated">资源</h1><p id="dc77" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated"><strong class="ih hj">特拉维斯·茨</strong>:【https://travis-ci.com/signin】T2</p><p id="f15e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://docs.travis-ci.com/user/customizing-the-build<strong class="ih hj">特拉维斯构建命令</strong>:<a class="ae jt" href="https://docs.travis-ci.com/user/customizing-the-build" rel="noopener ugc nofollow" target="_blank">T7】</a></p><p id="a173" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">用AWS设置terra form</strong>:<a class="ae jt" rel="noopener" href="/startupchronicles/setting-up-terraform-with-amazon-web-services-aws-afb2fde6cf18">https://medium . com/startup chronicles/Setting-up-terra form-with-Amazon-we B- services-AWS-af B2 FDE 6 cf 18</a></p><p id="05ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Travis YML Config</strong>:<a class="ae jt" href="https://gist.github.com/startupchronicles/9f1dd05ebb5f37e30075de2094cf53ae" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/startup chronicles/9 f1 DD 05 ebb 5 f 37 e 30075 de 2094 cf 53 AE</a></p></div></div>    
</body>
</html>