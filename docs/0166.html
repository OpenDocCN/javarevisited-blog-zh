<html>
<head>
<title>Authentication using JSON Web Tokens (part II)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JSON Web令牌进行身份验证(第二部分)</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/authentication-using-json-web-tokens-part-ii-b21455692a0b?source=collection_archive---------0-----------------------#2019-11-03">https://medium.com/javarevisited/authentication-using-json-web-tokens-part-ii-b21455692a0b?source=collection_archive---------0-----------------------#2019-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1c8e" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Spring Boot应用程序的一个实现，它利用JWT身份验证来保护公开的REST API</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/fb941422ebe6fa1607ea0614ea467e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z505OxfockdXf8JT"/></div></div><p class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@arifriyanto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿里夫·里扬托</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://medium.com/javarevisited/10-advanced-spring-boot-courses-for-experienced-java-developers-5e57606816bd?source=collection_home---4------0-----------------------"><div class="er es jo"><img src="../Images/f18ddb505b4a6819e90b936db6733082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9wiZqTwxeGuY8iDWotRkpw.png"/></div></a><p class="jj jk et er es jl jm bd b be z dx translated">作者图片</p></figure><p id="977d" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在上一篇文章中，我介绍了JSON web令牌以及如何使用它进行身份验证。在您阅读本文之前，我更愿意先看一下。</p><div class="kl km ez fb kn ko"><a rel="noopener follow" target="_blank" href="/@bhanuka.16/authentication-using-json-web-tokens-part-i-4f2eeaca22d7"><div class="kp ab dw"><div class="kq ab kr cl cj ks"><h2 class="bd hj fi z dy kt ea eb ku ed ef hh bi translated">使用JSON Web令牌进行身份验证(第一部分)</h2><div class="kv l"><h3 class="bd b fi z dy kt ea eb ku ed ef dx translated">在这篇文章中，我将解释JSON web令牌以及如何在认证中使用它。</h3></div><div class="kw l"><p class="bd b fp z dy kt ea eb ku ed ef dx translated">medium.com</p></div></div><div class="kx l"><div class="ky l kz la lb kx lc jh ko"/></div></div></a></div><p id="9786" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在本文中，我将向您展示如何实现一个<a class="ae jn" rel="noopener" href="/javarevisited/10-free-spring-boot-tutorials-and-courses-for-java-developers-53dfe084587e?source=collection_home---4------7-----------------------"> Spring Boot应用程序</a>，它利用JWT认证来保护一个公开的REST API。对于演示，将有一个硬编码的用户名和密码。</p><p id="8771" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">该项目将如下。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ld"><img src="../Images/251629a98870695fa59d91e3f9871aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*8E___gtn4fhPclSKgJ2VXw.png"/></div><p class="jj jk et er es jl jm bd b be z dx translated">作者图片</p></figure><p id="51b4" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">您可以使用下面的链接获得该演示的源代码。</p><div class="kl km ez fb kn ko"><a href="https://github.com/bhanukad610/JwtAuthentication" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab dw"><div class="kq ab kr cl cj ks"><h2 class="bd hj fi z dy kt ea eb ku ed ef hh bi translated">bhanukad610/JwtAuthentication</h2><div class="kv l"><h3 class="bd b fi z dy kt ea eb ku ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="kw l"><p class="bd b fp z dy kt ea eb ku ed ef dx translated">github.com</p></div></div><div class="kx l"><div class="le l kz la lb kx lc jh ko"/></div></div></a></div><p id="6f34" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我将在演示中解释它是如何发生的。让我们从<code class="du lf lg lh li b">WebsecurityConfig </code>文件开始。</p><h1 id="72f4" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated"><strong class="ak"> WebsecurityConfig </strong></h1><p id="629a" class="pw-post-body-paragraph jp jq hi jr b js mb ij ju jv mc im jx jy md ka kb kc me ke kf kg mf ki kj kk hb bi translated">它是定义所有安全配置的地方。这个类是由<a class="ae jn" rel="noopener" href="/javarevisited/top-10-courses-to-learn-spring-security-and-oauth2-with-spring-boot-for-java-developers-8f0222d6066d?source=---------5-----------------------"> Spring Security的</a>web Security configure接口实现的。它提供默认的安全配置，并允许其他类通过重写它的方法来扩展它和自定义安全配置。</p><p id="5e19" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj">用户详细信息服务</strong></p><p id="be16" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><code class="du lf lg lh li b">UserDetailsService </code>是一个接口，它有一个基于用户名加载用户的方法。</p><p id="ce58" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj">JwtAuthenticationEntryPoint</strong></p><p id="20ec" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><code class="du lf lg lh li b">JwtAuthenticationEntryPoint </code>用于将401未授权错误返回给试图在没有正确身份验证的情况下访问受保护资源的客户端。</p><p id="b79a" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">只定义令牌返回的允许请求，所有其他请求都经过身份验证。使用了不会用于存储用户状态的无状态会话。然后添加<code class="du lf lg lh li b">JwtRequestFilter </code>来验证请求头中的令牌。</p><h1 id="7378" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated"><strong class="ak"> JwtRequestFilter </strong></h1><p id="7be4" class="pw-post-body-paragraph jp jq hi jr b js mb ij ju jv mc im jx jy md ka kb kc me ke kf kg mf ki kj kk hb bi translated">JwtRequestFilter是负责从所有请求的授权头中读取JWT身份验证令牌的类。它使用<code class="du lf lg lh li b">JwtUserDetailsService</code>加载与令牌相关联的用户详细信息。令牌生成和验证是使用<code class="du lf lg lh li b">JwtTokenService </code>类完成的。</p><p id="84df" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj"> JwtTokenService </strong></p><p id="43ff" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在这里定义令牌的声明，如颁发者、过期、主题和ID，并使用HS512算法和application.properties文件中定义的密钥对JWT进行签名。令牌的验证也在这里完成。</p><h1 id="5f8e" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated"><strong class="ak"> AuthController </strong></h1><p id="83a2" class="pw-post-body-paragraph jp jq hi jr b js mb ij ju jv mc im jx jy md ka kb kc me ke kf kg mf ki kj kk hb bi translated">AuthController是公开用于身份验证的POST API的控制器。POST API获取主体中的用户名和密码，并通过<strong class="jr hj"> AuthService </strong>验证用户名和密码。如果凭证有效，使用<strong class="jr hj"> JWTTokenService </strong>创建一个JWT令牌并提供给客户端。</p><p id="21c7" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj"> HelloController </strong>是用于公开<a class="ae jn" href="https://www.java67.com/2018/02/3-books-and-courses-to-learn-restful-web-services-with-spring.html" rel="noopener ugc nofollow" target="_blank"> GET REST API </a>的控制器类，如果请求具有有效的令牌，客户端可以访问该API。</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="8b2e" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">现在启动<a class="ae jn" href="https://www.java67.com/2018/06/top-15-spring-boot-interview-questions-answers-java-jee-programmers.html" rel="noopener ugc nofollow" target="_blank"> Spring Boot应用</a>。</p><ol class=""><li id="668c" class="mn mo hi jr b js jt jv jw jy mp kc mq kg mr kk ms mt mu mv bi translated">创建对“/security/token”的POST请求。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://medium.com/javarevisited/why-spring-is-the-best-framework-for-developing-rest-apis-in-java-784590e484a4?source=collection_home---4------0-----------------------"><div class="er es mw"><img src="../Images/00b9f6843186f4ee4b856bf8908f48c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_lybRp9fPGcNFCfmwmUog.png"/></div></a><p class="jj jk et er es jl jm bd b be z dx translated">作者图片</p></figure><p id="73da" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">2.使用上面在授权头中生成的令牌访问localhost:8080/hello/call。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/9667144cb1197bc117b2a201e5d068a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-MQz1C1_qLC7zMwbQzZC6w.png"/></div></div><p class="jj jk et er es jl jm bd b be z dx translated">作者图片</p></figure><p id="dbcb" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我希望您了解如何实现一个<a class="ae jn" rel="noopener" href="/hackernoon/top-5-spring-boot-and-spring-cloud-books-for-java-developers-75df155dcedc"> Spring Boot应用程序</a>，它利用JWT认证来保护一个公开的<a class="ae jn" rel="noopener" href="/javarevisited/top-5-books-and-courses-to-learn-restful-web-services-in-java-using-spring-mvc-and-spring-boot-79ec4b351d12?source=---------17------------------"> REST API </a>。感谢您的阅读！</p></div></div>    
</body>
</html>