<html>
<head>
<title>The most easiest SpringCloud tutorial ever | Chapter 2: Service consumer (rest+ribbon) (Finchley version)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有史以来最简单的SpringCloud教程|第二章:服务消费者(rest+ribbon) (Finchley版)</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/the-simplest-springcloud-tutorial-in-history-chapter-2-service-consumer-rest-ribbon-finchley-279f80d4ee02?source=collection_archive---------0-----------------------#2022-05-01">https://medium.com/javarevisited/the-simplest-springcloud-tutorial-in-history-chapter-2-service-consumer-rest-ribbon-finchley-279f80d4ee02?source=collection_archive---------0-----------------------#2022-05-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2fc65721a9e936965695cec108f8927c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5UCTd850LLp6dI02RerzxA.jpeg"/></div></div></figure><p id="e6ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated"><span class="l jp jq jr bm js jt ju jv jw di">在</span>上一篇文章中，我谈到了服务的注册和登记。在<a class="ae jx" href="https://javarevisited.blogspot.com/2021/09/microservices-design-patterns-principles.html" rel="noopener ugc nofollow" target="_blank">微服务架构</a>中，发现部门独立服务，服务与服务之间的通信基于http restful。<a class="ae jx" rel="noopener" href="/javarevisited/5-best-courses-to-learn-spring-cloud-and-microservices-1ddea1af7012">春云</a>有业务服务调用方法，一种是ribbon+template，另一种是ribbon+rest。</p><ol class=""><li id="d18c" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn kd ke kf kg bi translated"><strong class="is hj">丝带介绍</strong></li></ol><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="b58d" class="kq kr hi km b fi ks kt l ku kv">Ribbon is a client side load balancer which gives you a lot of control over the behaviour of HTTP and TCP clients. Feign already uses Ribbon, so if you are using <a class="ae jx" href="http://twitter.com/FeignClient" rel="noopener ugc nofollow" target="_blank">@FeignClient</a> then this section also applies.</span></pre><p id="a774" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Ribbon是一个负载均衡客户端，可以很好的控制http和tcp的一些行为。默认情况下，Feign集成ribbon。</p><p id="ae7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认情况下，ribbon已经实现了这些配置beans:</p><ul class=""><li id="6463" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn kw ke kf kg bi translated">IClientConfig ribbonClientConfig:DefaultClientConfigImpl</li><li id="825c" class="jy jz hi is b it kx ix ky jb kz jf la jj lb jn kw ke kf kg bi translated">I rule ribbon rule:ZoneAvoidanceRule</li><li id="d568" class="jy jz hi is b it kx ix ky jb kz jf la jj lb jn kw ke kf kg bi translated">IPing ribbonPing: NoOpPing</li><li id="bc38" class="jy jz hi is b it kx ix ky jb kz jf la jj lb jn kw ke kf kg bi translated">服务器列表ribbonServerList:ConfigurationBasedServerList</li><li id="c2e2" class="jy jz hi is b it kx ix ky jb kz jf la jj lb jn kw ke kf kg bi translated">服务器列表过滤器ribbonServerListFilter:ZonePreferenceServerListFilter</li><li id="798f" class="jy jz hi is b it kx ix ky jb kz jf la jj lb jn kw ke kf kg bi translated">iload balancer ribbonLoadBalancer:zoneawareloadbancer</li></ul><p id="4b96" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2。准备工作</strong></p><p id="24f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文基于上一篇文章的项目，启动eureka-server项目；启动service-hi项目，其端口为8762；将service-hi配置文件的端口改为8763，并启动它，然后你会发现:service-hi在eureka-server中注册了2个实例，相当于一个小集群。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/02/top-5-spring-microservices-courses-with-spring-boot-and-spring-cloud.html"><div class="er es lc"><img src="../Images/ae1c97b210bd0b8233158f5678ecc542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5nN7M6txnd43JBbg.png"/></div></a></figure><p id="acdc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 3。构建服务消费者</strong></p><p id="6939" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个新的spring-boot项目，并将其命名为:service-ribbon；<br/>在其pom.xml中，它继承了父pom文件并引入了以下依赖关系:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="f159" class="kq kr hi km b fi ks kt l ku kv">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;project ae jx" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank"&gt;http://maven.apache.org/POM/4.0.0" xmlns:xsi="<a class="ae jx" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>"<br/>         xsi:schemaLocation="<a class="ae jx" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/POM/4.0.0</a> <a class="ae jx" href="http://maven.apache.org/xsd/maven-4.0.0.xsd" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;<br/>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><span id="ab77" class="kq kr hi km b fi ld kt l ku kv">&lt;groupId&gt;com.forezp&lt;/groupId&gt;<br/>    &lt;artifactId&gt;service-ribbon&lt;/artifactId&gt;<br/>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br/>    &lt;packaging&gt;jar&lt;/packaging&gt;</span><span id="69aa" class="kq kr hi km b fi ld kt l ku kv">&lt;name&gt;service-ribbon&lt;/name&gt;<br/>    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;</span><span id="b769" class="kq kr hi km b fi ld kt l ku kv">&lt;parent&gt;<br/>        &lt;groupId&gt;com.forezp&lt;/groupId&gt;<br/>        &lt;artifactId&gt;sc-f-chapter2&lt;/artifactId&gt;<br/>        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br/>    &lt;/parent&gt;</span><span id="ad1f" class="kq kr hi km b fi ld kt l ku kv">&lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;</span><span id="75c5" class="kq kr hi km b fi ld kt l ku kv">&lt;/project&gt;</span></pre><p id="d1d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在项目的配置文件中，指定服务的注册地址为<a class="ae jx" href="http://localhost:8761/eureka/" rel="noopener ugc nofollow" target="_blank">http://localhost:8761/eureka/</a>，程序名为service-ribbon，程序端口为8764。配置文件application.yml如下所示:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="232d" class="kq kr hi km b fi ks kt l ku kv">eureka:<br/>  client:<br/>    serviceUrl:<br/>      defaultZone: <a class="ae jx" href="http://localhost:8761/eureka/" rel="noopener ugc nofollow" target="_blank">http://localhost:8761/eureka/</a><br/>server:<br/>  port: 8764<br/>spring:<br/>  application:<br/>    name: service-ribbon</span></pre><p id="55b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在项目的启动类中，通过<a class="ae jx" href="https://www.java67.com/2018/12/top-5-spring-cloud-annotations-for-java.html" rel="noopener ugc nofollow" target="_blank"> @EnableDiscoveryClient向服务中心注册；</a>并将bean: <a class="ae jx" href="https://javarevisited.blogspot.com/2022/05/how-to-set-accept-header-on-spring.html" rel="noopener ugc nofollow" target="_blank"> restTemplate </a>注入到程序的ioc中；并使用@LoadBalanced注释来指示此restRemplate启用了负载平衡。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3527" class="kq kr hi km b fi ks kt l ku kv"><a class="ae jx" href="http://twitter.com/SpringBootApplicatio" rel="noopener ugc nofollow" target="_blank">@SpringBootApplicatio</a>n<br/><a class="ae jx" href="http://twitter.com/EnableEurekaClient" rel="noopener ugc nofollow" target="_blank">@EnableEurekaClient</a><br/><a class="ae jx" href="http://twitter.com/EnableDiscoveryClien" rel="noopener ugc nofollow" target="_blank">@EnableDiscoveryClien</a>t<br/>public class ServiceRibbonApplication {</span><span id="f30e" class="kq kr hi km b fi ld kt l ku kv">public static void main(String[] args) {<br/>        SpringApplication.run( ServiceRibbonApplication.class, args );<br/>    }</span><span id="60de" class="kq kr hi km b fi ld kt l ku kv"><a class="ae jx" href="http://twitter.com/Bean" rel="noopener ugc nofollow" target="_blank">@Bean</a><br/>    <a class="ae jx" href="http://twitter.com/LoadBalanced" rel="noopener ugc nofollow" target="_blank">@LoadBalanced</a><br/>    RestTemplate restTemplate() {<br/>        return new RestTemplate();<br/>    }</span><span id="448e" class="kq kr hi km b fi ld kt l ku kv">}</span></pre><p id="b8ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编写一个测试类HelloService，通过ioc容器注入的<a class="ae jx" href="https://javarevisited.blogspot.com/2022/03/how-to-send-json-via-post-request-using.html" rel="noopener ugc nofollow" target="_blank"> restTemplate </a>消费service-hi服务的“/hi”接口。这里我们直接用程序名替换具体的url地址。在功能区中，它将基于服务名称。选择一个具体的服务实例，根据服务实例请求时，用具体的url替换服务名。代码如下:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="c90e" class="kq kr hi km b fi ks kt l ku kv"><a class="ae jx" href="http://twitter.com/Service" rel="noopener ugc nofollow" target="_blank">@Service</a><br/>public class HelloService {</span><span id="d523" class="kq kr hi km b fi ld kt l ku kv"><a class="ae jx" href="http://twitter.com/Autowired" rel="noopener ugc nofollow" target="_blank">@Autowired</a><br/>    RestTemplate restTemplate;</span><span id="3192" class="kq kr hi km b fi ld kt l ku kv">public String hiService(String name) {<br/>        return restTemplate.getForObject("<a class="ae jx" href="http://SERVICE-HI/hi?name=" rel="noopener ugc nofollow" target="_blank">http://SERVICE-HI/hi?name=</a>"+name,String.class);<br/>    }</span><span id="e1bb" class="kq kr hi km b fi ld kt l ku kv">}</span></pre><p id="437e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">写一个<a class="ae jx" href="https://javarevisited.blogspot.com/2021/09/how-to-return-different-http-status-from-sprnig-mvc-controller.html" rel="noopener ugc nofollow" target="_blank">控制器</a>，在控制器中使用调用HelloService的方法。代码如下:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="74db" class="kq kr hi km b fi ks kt l ku kv"><a class="ae jx" href="http://twitter.com/RestController" rel="noopener ugc nofollow" target="_blank">@RestController</a><br/>public class HelloControler {</span><span id="4d37" class="kq kr hi km b fi ld kt l ku kv"><a class="ae jx" href="http://twitter.com/Autowired" rel="noopener ugc nofollow" target="_blank">@Autowired</a><br/>    HelloService helloService;</span><span id="7ae7" class="kq kr hi km b fi ld kt l ku kv"><a class="ae jx" href="http://twitter.com/GetMapping" rel="noopener ugc nofollow" target="_blank">@GetMapping</a>(value = "/hi")<br/>    public String hi(<a class="ae jx" href="http://twitter.com/RequestParam" rel="noopener ugc nofollow" target="_blank">@RequestParam</a> String name) {<br/>        return helloService.hiService( name );<br/>    }<br/>}</span></pre><p id="5627" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">访问<a class="ae jx" href="http://localhost:8764/hi?name=forezp" rel="noopener ugc nofollow" target="_blank"> http://localhost:8764/hi？name=forezp </a>在浏览器上多次，浏览器交替显示:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="c4e8" class="kq kr hi km b fi ks kt l ku kv">hi forezp,i am from port:8762</span><span id="326d" class="kq kr hi km b fi ld kt l ku kv">hi forezp,i am from port:8763</span></pre><p id="065c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这说明当我们调用rest template . getforobject("<a class="ae jx" href="http://SERVICE-HI/hi?name=" rel="noopener ugc nofollow" target="_blank">http://SERVICE-HI/HI？name= </a> "+name，String.class)方法，我们做了负载均衡，在不同的端口上访问服务实例。</p><p id="967f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 4。这时的结构</strong></p><figure class="kh ki kj kk fd ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2022/04/difference-between-graphql-and-rest-api.html"><div class="er es le"><img src="../Images/5fe27f3e162a13f7a51babb93f5a9789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/0*UufSlGnoL8Ctp_4i"/></div></a></figure><p id="11aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一个服务注册表，eureka服务器，端口8761</p><p id="e2ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">service-hi项目使用端口8762和8763运行两个实例，这两个端口分别在服务注册中心注册。</p><p id="5f23" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">sercvice-ribbon端口是8764，在服务注册中心注册</p><p id="16e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">sercvice-ribbon通过restTemplate调用service-hi的hi接口时，因为与ribbon的负载均衡，会依次调用service-hi的hi接口:8762和8763端口；</p><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/javarevisited/21-spring-mvc-rest-interview-questions-answers-for-beginners-and-experienced-developers-21ad3d4c9b82"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">10大春季MVC + REST面试问题解答适合初学者和有经验的开发者</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">大家好。如果你正在准备Java和Spring面试或Spring认证，并经常寻找一些…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw io li"/></div></div></a></div><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/javarevisited/top-10-rest-interview-questions-for-java-and-spring-developers-1611e3b78029"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">Java和Spring开发人员的10大REST面试问题</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">这些是Java和Spring开发者快速准备的最好的REST面试问题</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="lx l lt lu lv lr lw io li"/></div></div></a></div><div class="lf lg ez fb lh li"><a rel="noopener follow" target="_blank" href="/javarevisited/13-topics-you-should-prepare-for-your-next-spring-boot-interview-5f2993a04ff5"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">你应该为2022年的下一次Spring Boot面试准备的13个话题</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">你应该为下一次Java和Spring Boot面试准备的13个基本主题的列表和学习资源…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="ly l lt lu lv lr lw io li"/></div></div></a></div></div></div>    
</body>
</html>