<html>
<head>
<title>Spring Cloud Config Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring云配置服务器</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/spring-cloud-config-server-4175fd819e7e?source=collection_archive---------1-----------------------#2021-09-12">https://medium.com/javarevisited/spring-cloud-config-server-4175fd819e7e?source=collection_archive---------1-----------------------#2021-09-12</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><p id="1ae3" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><em class="je"> Spring Cloud配置服务器开发</em></p><figure class="jg jh ji jj fe jk es et paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="es et jf"><img src="../Images/966a385de05b8476ffbb49ed91b9936a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xWHZlWG7By0xG8-Y"/></div></div><p class="jr js eu es et jt ju bd b be z dy translated"><a class="ae jv" href="https://unsplash.com/@sendi_r_gibran?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">森迪·纪伯伦</a>在<a class="ae jv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="e361" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">有很多关于Spring Boot和Spring Cloud开发细节的网站和帖子，但这篇帖子将只讨论实现和一些关于我做了什么以及为什么这样做的笔记。</p><h2 id="bfc3" class="jw jx hj bd jy jz ka kb kc kd ke kf kg ir kh ki kj iv kk kl km iz kn ko kp kq bi translated">配置服务器项目</h2><p id="afbb" class="pw-post-body-paragraph ig ih hj ii b ij kr il im in ks ip iq ir kt it iu iv ku ix iy iz kv jb jc jd hc bi translated">如果您不希望使用git，而是使用本地路径作为属性文件的位置，那么您应该在config server项目中的spring概要文件中添加“<strong class="ii hk"> native </strong>”:</p><pre class="jg jh ji jj fe kw kx ky kz aw la bi"><span id="cfc7" class="jw jx hj kx b fj lb lc l ld le">spring.profiles.active=native,dev</span></pre><p id="3967" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这是我的配置服务器项目的最终application.properties文件:</p><pre class="jg jh ji jj fe kw kx ky kz aw la bi"><span id="58b4" class="jw jx hj kx b fj lb lc l ld le">server.port=8888<br/>spring.application.name=senoritadev-config-service<br/><br/>spring.profiles.active=native,dev</span></pre><p id="2456" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">使项目成为配置“服务器”的是这种依赖性:</p><pre class="jg jh ji jj fe kw kx ky kz aw la bi"><span id="0cfc" class="jw jx hj kx b fj lb lc l ld le">&lt;dependency&gt;<br/>   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>   &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</span></pre><p id="35fd" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">不要忘记将<a class="ae jv" href="https://www.java67.com/2018/12/top-5-spring-cloud-annotations-for-java.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ii hk"> @EnableConfigServer </strong>注释</a>添加到您的应用程序类中:</p><pre class="jg jh ji jj fe kw kx ky kz aw la bi"><span id="9db8" class="jw jx hj kx b fj lb lc l ld le">@SpringBootApplication<br/>@EnableConfigServer<br/>public class ConfigServerApplication {<br/><br/>   public static void main(String[] args) {<br/>      SpringApplication.<em class="je">run</em>(ConfigServerApplication.class, args);<br/>   }<br/><br/>}</span></pre><h2 id="f189" class="jw jx hj bd jy jz ka kb kc kd ke kf kg ir kh ki kj iv kk kl km iz kn ko kp kq bi translated">您的主要项目:</h2><p id="1ec2" class="pw-post-body-paragraph ig ih hj ii b ij kr il im in ks ip iq ir kt it iu iv ku ix iy iz kv jb jc jd hc bi translated">在早期版本中，您需要创建一个名为“bootstrap.properties”的单独属性文件，并将下面添加的属性添加到该文件中。“bootstrap.properties”文件与“application.properties”不同，因为它是在主应用程序上下文之前加载的。</p><p id="1bdd" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">因此，转到您将使用这些属性的主项目，并将spring.application.name添加到您的“application.properties”中。</p><pre class="jg jh ji jj fe kw kx ky kz aw la bi"><span id="0a0b" class="jw jx hj kx b fj lb lc l ld le">spring.config.import=optional:configserver:http://localhost:8888<br/>spring.application.name=senoritadev-batch-jobs<br/>spring.profiles.active=dev</span></pre><p id="3e08" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">您需要在properties中的config url前面添加“optional ”,这样即使出现故障，您的主应用程序仍将启动并运行。</p><p id="1bff" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">之后，在您的主项目中，只需添加这个依赖项(因为您的主项目是配置服务器的客户端)。</p><pre class="jg jh ji jj fe kw kx ky kz aw la bi"><span id="0a42" class="jw jx hj kx b fj lb lc l ld le">&lt;dependency&gt;<br/>   &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>   &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</span></pre></div><div class="ab cl lf lg gq lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hc hd he hf hg"><h2 id="7a4a" class="jw jx hj bd jy jz ka kb kc kd ke kf kg ir kh ki kj iv kk kl km iz kn ko kp kq bi translated">配置服务器中主项目的应用程序属性</h2><p id="d9f2" class="pw-post-body-paragraph ig ih hj ii b ij kr il im in ks ip iq ir kt it iu iv ku ix iy iz kv jb jc jd hc bi translated">在您的配置服务器项目中，添加一个名为“senoritadev-batch-jobs<strong class="ii hk">-dev</strong>的文件。属性”与配置服务器自己的application.properties文件处于同一级别。注意我是怎么给文件名的:my-batch-app-name+"<strong class="ii hk">-dev</strong>"+"属性”。您可以添加默认的“senoritadev-batch-jobs . properties”以及(环境)配置文件名称(如senoritadev-batch-jobs<strong class="ii hk">-test</strong>)。属性，高级批处理作业<strong class="ii hk">-预编程</strong>。属性等。).</p><figure class="jg jh ji jj fe jk"><div class="bz dz l di"><div class="lm ln l"/></div></figure></div><div class="ab cl lf lg gq lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hc hd he hf hg"><h2 id="15ae" class="jw jx hj bd jy jz ka kb kc kd ke kf kg ir kh ki kj iv kk kl km iz kn ko kp kq bi translated">句法</h2><p id="0a83" class="pw-post-body-paragraph ig ih hj ii b ij kr il im in ks ip iq ir kt it iu iv ku ix iy iz kv jb jc jd hc bi translated">你可以在这里看到属性键application.properties <a class="ae jv" href="https://mkyong.com/spring-boot/spring-boot-configurationproperties-example/" rel="noopener ugc nofollow" target="_blank">的语法示例。"."用于分组，而“-”相当于Java类中的大写(“job-count”映射到“jobCount”)。</a></p></div><div class="ab cl lf lg gq lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hc hd he hf hg"><h2 id="7e28" class="jw jx hj bd jy jz ka kb kc kd ke kf kg ir kh ki kj iv kk kl km iz kn ko kp kq bi translated">配置类</h2><p id="4651" class="pw-post-body-paragraph ig ih hj ii b ij kr il im in ks ip iq ir kt it iu iv ku ix iy iz kv jb jc jd hc bi translated">最好有一个单独的config类来保存你的属性(在你的主项目中),而不是像在你的类中那样。</p><p id="89eb" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">对于关注点分离和更新策略来说，这都是一个很好的实践。当您更新属性值并进行刷新以应用时(稍后将提到刷新)，使用这些值的类可能会在刷新期间互相阻塞。</p><p id="5f26" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">然而，带有@ConfigurationProperties注释的单个配置bean是更快刷新上下文的有效方式。</p><p id="7caf" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">你可以在这里阅读背景<a class="ae jv" href="https://gist.github.com/dsyer/a43fe5f74427b371519af68c5c4904c7" rel="noopener ugc nofollow" target="_blank">发生的事情。</a></p><figure class="jg jh ji jj fe jk"><div class="bz dz l di"><div class="lm ln l"/></div></figure></div><div class="ab cl lf lg gq lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hc hd he hf hg"><h2 id="fea8" class="jw jx hj bd jy jz ka kb kc kd ke kf kg ir kh ki kj iv kk kl km iz kn ko kp kq bi translated">获取/刷新值</h2><p id="3b02" class="pw-post-body-paragraph ig ih hj ii b ij kr il im in ks ip iq ir kt it iu iv ku ix iy iz kv jb jc jd hc bi translated">要在配置服务器端更新后刷新项目使用的属性值(手动，不使用Spring Cloud配置):</p><p id="47fb" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">获取项目属性</p><pre class="jg jh ji jj fe kw kx ky kz aw la bi"><span id="10fc" class="jw jx hj kx b fj lb lc l ld le">curl -L -X GET ‘http://localhost:8888/senoritadev-batch-jobs/dev'</span></pre><p id="bff6" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">在编辑senoritadev-batch-jobs-dev . properties之后，使用这个<a class="ae jv" href="https://www.java67.com/2017/10/how-to-test-restful-web-services-using.html" rel="noopener ugc nofollow" target="_blank"> cURL请求</a>在你的项目端刷新(8081是你的主项目的服务器端口)。作为对此POST请求的响应，发送添加/更新的属性列表。</p><pre class="jg jh ji jj fe kw kx ky kz aw la bi"><span id="6be2" class="jw jx hj kx b fj lb lc l ld le">curl -L -X POST ‘http://127.0.0.1:8081/actuator/refresh' \<br/>-H ‘Content-Type: application/json’ \<br/> — data-raw ‘’</span></pre></div><div class="ab cl lf lg gq lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hc hd he hf hg"><p id="fa80" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">可以访问我的微服务项目(用Spring Cloud实现)GitHub url获取样例代码:</p><div class="lr ls fa fc lt lu"><a href="https://github.com/senoritadeveloper01/nils-spring-microservices" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dx"><div class="lw ab lx cl cj ly"><h2 class="bd hk fj z dz lz eb ec ma ee eg hi bi translated">GitHub-senoritadeveloper 01/nils-spring-微服务:一个微型Spring Boot微服务项目</h2><div class="mb l"><h3 class="bd b fj z dz lz eb ec ma ee eg dy translated">这是一个由Spring Boot和Spring Cloud使用Java版本16开发的示例微服务项目。命名…</h3></div><div class="mc l"><p class="bd b fq z dz lz eb ec ma ee eg dy translated">github.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi jp lu"/></div></div></a></div></div><div class="ab cl lf lg gq lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hc hd he hf hg"><p id="22bb" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">编码快乐！</p></div></div>    
</body>
</html>