<html>
<head>
<title>SpringBoot Security with JWT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JWT的斯普林波特安全公司</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/springboot-security-with-jwt-fca1446790ba?source=collection_archive---------0-----------------------#2020-01-22">https://medium.com/javarevisited/springboot-security-with-jwt-fca1446790ba?source=collection_archive---------0-----------------------#2020-01-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2e48f611faa1bf27db55de54e7238a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mh7W-CpUDspp_SL52SN7aw.png"/></div></div></figure><p id="05b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我将展示如何使用JWT令牌——JSON Web令牌来实现项目spring安全性。</p><p id="20b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何使用JWT: </strong>用户名+密码+ JSON map+ Base64 + key +有效期</p><p id="ae94" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">工作原理:</strong>当用户第一次使用用户名+密码登录时，系统将交换回访问令牌，这个令牌代表一个JSON映射，包含所有用户信息，如用户配置文件、角色和权限，用Base64编码，用私钥签名。收到令牌后，用户可以一直使用它，直到它自己过期。</p><p id="5a63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">好处:</strong>JWT令牌是无状态的。这意味着服务器可以将令牌解密为用户信息状态，并且不需要使用该令牌从数据库中进行额外的查找。这对于减少服务器上的负载是一个巨大的好处。这种方法在全世界被广泛使用。</p><h1 id="5d95" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">技术</h1><p id="4a4a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">你应该具备基础知识，熟悉java8和spring-boot。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="4551" class="la jp hi kw b fi lb lc l ld le"><em class="lf"># Technologies<br/><br/></em><strong class="kw hj">- </strong>Spring boot 2 <br/>- Spring Secruity<br/><strong class="kw hj">- </strong>JWT jjwt<br/><strong class="kw hj">- </strong>Mysql<br/><strong class="kw hj">- </strong>Database JPA</span></pre><h1 id="69d7" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">项目结构</h1><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="fcbc" class="la jp hi kw b fi lb lc l ld le">springboot2-jwt<br/>|-- README.md<br/>|-- pom.xml<br/>|-- src<br/>|   `-- main<br/>|       |-- java<br/>|       |   `-- com<br/>|       |       `-- sma<br/>|       |           `-- <strong class="kw hj">security</strong><br/>|       |               |-- Application.java<br/>|       |               |-- <strong class="kw hj">config</strong><br/>|       |               |   |-- JwtAuthenticationEntryPoint.java<br/>|       |               |   |-- JwtRequestFilter.java<br/>|       |               |   |-- JwtTokenService.java<br/>|       |               |   `-- WebSecurityConfig.java<br/>|       |               |-- <strong class="kw hj">controller</strong><br/>|       |               |   |-- JwtTokenController.java<br/>|       |               |   `-- TestController.java<br/>|       |               |-- <strong class="kw hj">dao</strong><br/>|       |               |   `-- UserRepository.java<br/>|       |               |-- <strong class="kw hj">exception</strong><br/>|       |               |   `-- GlobalExceptionHandler.java<br/>|       |               |-- <strong class="kw hj">json</strong><br/>|       |               |   |-- JwtResponse.java<br/>|       |               |   `-- UserDTO.java<br/>|       |               |-- <strong class="kw hj">model</strong><br/>|       |               |   `-- UserEntity.java<br/>|       |               `-- <strong class="kw hj">service</strong><br/>|       |                   `-- JwtUserDetailsService.java<br/>|       `-- <strong class="kw hj">resources</strong><br/>|           `-- application.yml</span></pre><h1 id="59a9" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">POM文件依赖关系</h1><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="c7d5" class="la jp hi kw b fi lb lc l ld le">spring-boot-starter-parent (version 2.2.2.RELEASE)<br/>spring-boot-starter-web<br/>spring-boot-starter-security<br/>spring-boot-starter-data-jpa<br/>jjwt (0.9.1)<br/>mysql<br/>lombok</span><span id="3eed" class="la jp hi kw b fi lg lc l ld le">see more details : <a class="ae lh" href="https://github.com/sophea/springboot2-jwt/blob/master/pom.xml" rel="noopener ugc nofollow" target="_blank">pom.xml</a></span></pre><div class="li lj ez fb lk ll"><a href="https://javarevisited.blogspot.com/2019/03/top-5-course-to-learn-apache-maven-for.html" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">Java开发人员学习Apache Maven的前5门课程——最好的</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">Apache Maven或通常称为“Maven”，是Java程序员的一个基本工具。它允许您构建…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">javarevisited.blogspot.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz io ll"/></div></div></a></div><h1 id="979c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">安全配置</h1><p id="eef0" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这个配置定义了spring安全性、密码编码器和JWT令牌认证</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="ma mb l"/></div><p class="mc md et er es me mf bd b be z dx translated">配置</p></figure><h1 id="6842" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">JWT滤波器</h1><p id="75a9" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">此过滤器用于验证用户发送的access_token是否有效。</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="ma mb l"/></div><p class="mc md et er es me mf bd b be z dx translated">JwtRequestFilter.java</p></figure><h1 id="2137" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">JwtTokenService</h1><p id="a20e" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">此类服务用于生成令牌，从令牌中提取用户信息，以及验证令牌和到期时间。</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="ma mb l"/></div><p class="mc md et er es me mf bd b be z dx translated">JwtTokenService.java</p></figure><h1 id="a37e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">jwtuserdetaileservice</h1><p id="7c1a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">该类用于查询用户名/在数据库中保存新用户。</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="ma mb l"/></div><p class="mc md et er es me mf bd b be z dx translated">jwtuserdetaileservice</p></figure><h1 id="b364" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">休息控制器</strong></h1><p id="b5d5" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">假设我们使用JTW令牌为登录和注册新用户创建REST-API</p><p id="64fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个JwtTokenController.java类有两个API</p><ul class=""><li id="2c40" class="mg mh hi is b it iu ix iy jb mi jf mj jj mk jn ml mm mn mo bi translated">登录API的POST/auth/token #</li><li id="3214" class="mg mh hi is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo bi translated">注册新用户的帖子/注册号码</li></ul><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><h1 id="1d87" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">仓库—道</strong></h1><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="98eb" class="la jp hi kw b fi lb lc l ld le">package com.sma.security.dao;<br/><br/>import com.sma.security.model.UserEntity;<br/>import org.springframework.data.jpa.repository.JpaRepository;<br/>import org.springframework.stereotype.Repository;<br/><br/>@Repository<br/>public interface UserRepository extends JpaRepository&lt;UserEntity, Long&gt; {<br/><br/>    UserEntity findByUsername(String username);<br/><br/>}</span></pre><h1 id="28d8" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">域用户实体</h1><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="6cbc" class="la jp hi kw b fi lb lc l ld le">package com.sma.security.model;<br/><br/>import com.fasterxml.jackson.annotation.JsonIgnore;<br/>import lombok.Data;<br/>import javax.persistence.*;<br/><br/>@Entity<br/>@Table(name = "user")<br/>@Data<br/>public class UserEntity {<br/><br/>    @Id<br/>    @GeneratedValue(strategy = GenerationType.<em class="lf">IDENTITY</em>)<br/>    private long id;<br/>    @Column<br/>    private String username;<br/>    @Column<br/>    @JsonIgnore<br/>    private String password;<br/><br/>}</span></pre><h1 id="9728" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">数据库Mysql</h1><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/2b463b0ab00eddcbc1ca24da3b1a8bf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*WQP2LKAgblvYl0jr4u8Esw.png"/></div><p class="mc md et er es me mf bd b be z dx translated">数据库mysql —用户表</p></figure><h1 id="b169" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">资源属性(application.yml)</h1><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="4cfc" class="la jp hi kw b fi lb lc l ld le"><strong class="kw hj">jwt</strong>:<br/>    <strong class="kw hj">secret</strong>: jwtsecretkey<br/><strong class="kw hj">spring</strong>:<br/>    <strong class="kw hj">datasource</strong>:<br/>        <strong class="kw hj">password</strong>: password<br/>        <strong class="kw hj">platform</strong>: mysql<br/>        <strong class="kw hj">url</strong>: jdbc:mysql://localhost/jwt?createDatabaseIfNotExist=true&amp;autoReconnect=true&amp;useSSL=false<br/>        <strong class="kw hj">username</strong>: root<br/>    <strong class="kw hj">jpa</strong>:<br/>        <strong class="kw hj">hibernate</strong>:<br/>            <strong class="kw hj">ddl-auto</strong>: update</span></pre><h1 id="56d0" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">REST APIs测试</h1><ul class=""><li id="6c26" class="mg mh hi is b it km ix kn jb mv jf mw jj mx jn ml mm mn mo bi translated">注册新用户</li></ul><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="e6b3" class="la jp hi kw b fi lb lc l ld le">curl -X POST \<br/>  http://localhost:8080/register \<br/>  -H 'content-type: application/json' \<br/>  -d '{"username":"test","password":"password"}'</span></pre><ul class=""><li id="802d" class="mg mh hi is b it iu ix iy jb mi jf mj jj mk jn ml mm mn mo bi translated">登录API以交换令牌</li></ul><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="f3ea" class="la jp hi kw b fi lb lc l ld le">curl -X POST \<br/>  http://localhost:8080/auth/token \<br/>  -H 'content-type: application/json' \<br/>  -d '{ "username":"test", "password":"password"}'</span><span id="3f2f" class="la jp hi kw b fi lg lc l ld le">response back {<br/>    "token": "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ0ZXN0IiwiUk9MRVMiOlsiUk9MRV9VU0VSIl0sImV4cCI6MTU3ODE3ODI5NSwiaWF0IjoxNTc4MTYwMjk1fQ.gDMuDfp1_1kv729HrOWCskTm4rNCm7SSoniqDHZuRD5H1uUtFzbiktN9NVaTNaTvp14UqGavQygKhO3pTFOQJg"<br/>}</span></pre><ul class=""><li id="5d2f" class="mg mh hi is b it iu ix iy jb mi jf mj jj mk jn ml mm mn mo bi translated">无登录API curl<a class="ae lh" href="http://localhost:8080/test" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/test</a></li><li id="4793" class="mg mh hi is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo bi translated">登录API curl<a class="ae lh" href="http://locathost:8080/secure" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/secure</a></li></ul><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="9969" class="la jp hi kw b fi lb lc l ld le">curl -X GET <a class="ae lh" href="http://localhost:8080/secure" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/secure</a> -H '<!-- -->Authorization<!-- -->: <!-- -->Bearer<!-- --> eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ0ZXN0IiwiUk9MRVMiOlsiUk9MRV9VU0VSIl0sImV4cCI....'</span></pre><h1 id="54d3" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="d260" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">希望这篇文章能帮到你，扩大你的知识面。</p><p id="3dae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果这篇文章是有帮助的，请支持按下<strong class="is hj">按钮</strong>并帮助其他读者到达这个故事。</p><p id="2d4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章的完整源代码可以在GitHub 上找到<a class="ae lh" href="https://github.com/sophea/springboot2-jwt" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="li lj ez fb lk ll"><a rel="noopener follow" target="_blank" href="/javarevisited/10-advanced-spring-boot-courses-for-experienced-java-developers-5e57606816bd"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">面向有经验的Java开发人员的10门高级Spring Boot课程</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">高级Spring Boot课程为有经验的Java开发人员学习Spring Boot测试，云和容器…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">medium.com</p></div></div><div class="lu l"><div class="my l lw lx ly lu lz io ll"/></div></div></a></div><div class="li lj ez fb lk ll"><a rel="noopener follow" target="_blank" href="/javarevisited/top-5-courses-to-learn-microservices-in-java-and-spring-framework-e9fed1ba804d"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">学习Java和Spring框架中微服务的前5门课程</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">微服务是软件开发领域的新术语，尤其是在Java方面，但它已经在实践中…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">medium.com</p></div></div><div class="lu l"><div class="mz l lw lx ly lu lz io ll"/></div></div></a></div></div></div>    
</body>
</html>