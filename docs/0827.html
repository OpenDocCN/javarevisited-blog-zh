<html>
<head>
<title>CI/CD Workflow for Spring Boot Applications on Kubernetes via Skaffold</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes via Skaffold上Spring Boot应用的CI/CD工作流</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/skaffolding-springboot-application-dbfbc463e558?source=collection_archive---------1-----------------------#2020-12-07">https://medium.com/javarevisited/skaffolding-springboot-application-dbfbc463e558?source=collection_archive---------1-----------------------#2020-12-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if"><p id="c99d" class="ig ih hi bd ii ij ik il im in io ip dx translated">在本文中，我们将学习如何使用Skaffold为部署到Kubernetes的Spring Boot应用程序创建本地CI/CD工作流。</p></blockquote><figure class="ir is it iu iv iw er es paragraph-image"><div class="er es iq"><img src="../Images/2fd029a2472b89739c96dc3234c967a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*XGum1jZ2EUbVujKI_R8rZA.png"/></div><p class="iz ja et er es jb jc bd b be z dx translated">图像源Skaffold</p></figure><p id="12e1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">众所周知，用Kubernetes开发应用程序很麻烦。这就是围绕它开发一个生态系统的原因，以便开发人员可以专注于对他们最重要的事情，即编写代码。在这篇文章中，我将介绍由谷歌开发的另一个工具Skaffold。</p><h2 id="af3e" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">那么斯卡福德到底是什么？</h2><blockquote class="if"><p id="13fc" class="ig ih hi bd ii ij kw kx ky kz la ip dx translated">Skaffold处理构建、推送和部署应用程序的工作流。</p></blockquote><h2 id="715e" class="kb kc hi bd kd ke lb kg kh ki lc kk kl jo ld kn ko js le kq kr jw lf kt ku kv bi translated">它试图解决什么问题？</h2><p id="7c49" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ip hb bi translated">正如我之前说过的，用<a class="ae ka" rel="noopener" href="/javarevisited/7-free-online-courses-to-learn-kubernetes-in-2020-3b8a68ec7abc"> Kubernetes </a>开发应用程序并不是一件容易的事情，这就是Skaffold发挥作用的地方，因为它简化了在Kubernetes上运行的应用程序的开发和部署。它管理整个工作流程，当您在本地或远程<a class="ae ka" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-jenkins-docker-and-kubernetes-for-devops-in-2020-best-of-lot-62a0541ffeb3">Kubernetes</a>集群上开发和部署应用程序时，您可以获得即时反馈。</p><figure class="lm ln lo lp fd iw er es paragraph-image"><div class="er es ll"><img src="../Images/c56c4685b1f515e4f8c42b5e80c6aea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*EaQd3mLLRO9rjuUuW4v8mw.png"/></div><p class="iz ja et er es jb jc bd b be z dx translated">图片来源谷歌</p></figure></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h2 id="7b5c" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">斯卡福德福利</h2><p id="fa11" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ip hb bi translated">以下是使用Skaffold的一些好处。</p><ul class=""><li id="c56c" class="lx ly hi jf b jg jh jk jl jo lz js ma jw mb ip mc md me mf bi translated"><strong class="jf hj">轻量级</strong></li></ul><p id="f0f0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">它只是一个客户端实用程序，所以不需要设置集群或维护任何东西。</p><ul class=""><li id="153e" class="lx ly hi jf b jg jh jk jl jo lz js ma jw mb ip mc md me mf bi translated"><strong class="jf hj">轻松分享</strong></li></ul><p id="4538" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">在你的团队成员中分享非常容易，因为你只需要做以下事情就可以开始了。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="2e68" class="kb kc hi mh b fi ml mm l mn mo">git clone<br/>skaffold run</span></pre><ul class=""><li id="f174" class="lx ly hi jf b jg jh jk jl jo lz js ma jw mb ip mc md me mf bi translated"><strong class="jf hj">易于开发</strong></li></ul><p id="bcf5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">要使你的应用程序容器化，甚至在本地，你必须做很多事情。对于您的本地开发，您可能会在Kubernetes<a class="ae ka" rel="noopener" href="/javarevisited/top-15-online-courses-to-learn-docker-kubernetes-and-aws-for-fullstack-developers-and-devops-d8cc4f16e773">上构建、推送、然后部署您的应用程序。</a></p><p id="024e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">还有一组不同的命令(docker blah，kubectl blah blah，等等。)以及您在工作流程的每个阶段使用的工具。</p><p id="9af8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">有了Skaffold，你只需要一个神奇的命令<code class="du mp mq mr mh b">skaffold run or skaffold dev</code>，你就是黄金。这并不意味着你不依赖那些需要你构建和部署应用到Kubernetes的工具。只是当您只运行一个命令时，开发要容易得多。</p><p id="ce00" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">好的。理论到此为止，我们开始吧。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h2 id="2d86" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">剖析Spring Boot应用程序</h2><p id="7486" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ip hb bi translated">在本教程中，我将使用一个<a class="ae ka" rel="noopener" href="/javarevisited/10-free-spring-boot-tutorials-and-courses-for-java-developers-53dfe084587e?source=collection_home---4------7-----------------------"> SpringBoot </a>应用程序，当通过/states REST端点访问该应用程序时，它会显示印度各州及其首府。该应用程序使用内存中的H2数据库，该数据库在应用程序开始时插入行，并将其保存在内存中。源代码可以在这里<a class="ae ka" href="https://github.com/yrashish/indian-states" rel="noopener ugc nofollow" target="_blank">获得。</a></p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h2 id="0bfb" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">先决条件</h2><p id="8a0f" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ip hb bi translated">对于此演示，需要安装以下软件。</p><ol class=""><li id="56ae" class="lx ly hi jf b jg jh jk jl jo lz js ma jw mb ip ms md me mf bi translated">安装<a class="ae ka" href="https://skaffold.dev/docs/install/" rel="noopener ugc nofollow" target="_blank"> Skaffold </a></li><li id="3db8" class="lx ly hi jf b jg mt jk mu jo mv js mw jw mx ip ms md me mf bi translated">为<a class="ae ka" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank"> Mac </a>安装Docker桌面</li><li id="c4a5" class="lx ly hi jf b jg mt jk mu jo mv js mw jw mx ip ms md me mf bi translated">安装<a class="ae ka" href="https://v1-18.docs.kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank"> kubectl </a></li><li id="293b" class="lx ly hi jf b jg mt jk mu jo mv js mw jw mx ip ms md me mf bi translated">Minikube(可选)</li></ol><p id="11df" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">我用过macOS，但是你可以自由使用任何你喜欢的或者有经验的操作系统。我提到Minikube安装是可选的，因为如果你已经安装了<a class="ae ka" rel="noopener" href="/javarevisited/10-free-courses-to-learn-docker-and-devops-for-frontend-developers-691ac7652cee"> Docker </a> desktop，你可以通过以下步骤启用Kubernetes。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h2 id="3806" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">使用Docker Desktop for Mac启用Kubernetes</h2><ul class=""><li id="74d2" class="lx ly hi jf b jg lg jk lh jo my js mz jw na ip mc md me mf bi translated">前往Docker菜单栏中的偏好设置，然后点按Kubernetes标签。点击复选框启用Kubernetes，并将默认编排器切换到<a class="ae ka" href="https://javarevisited.blogspot.com/2020/06/top-5-courses-to-learn-kubernetes-for-devops-and-certification.html" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>。启用Kubernetes需要一些时间。</li><li id="c705" class="lx ly hi jf b jg mt jk mu jo mv js mw jw mx ip mc md me mf bi translated">一旦它被启用，你会在你的<a class="ae ka" href="https://javarevisited.blogspot.com/2019/05/top-5-courses-to-learn-docker-and-kubernetes-for-devops.html" rel="noopener ugc nofollow" target="_blank"> Docker </a>菜单栏上看到如下内容。您还应该将上下文更改为docker-desktop。</li></ul><figure class="lm ln lo lp fd iw er es paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="er es nb"><img src="../Images/c9b1ced48a10858a58bff234f7a1c2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pNQYxhptcnRbyqUE.png"/></div></div><p class="iz ja et er es jb jc bd b be z dx translated"><em class="ng"> Kubernetes启用</em></p></figure><figure class="lm ln lo lp fd iw er es paragraph-image"><div class="er es nh"><img src="../Images/54c3254f46c1d00246d16e6c3e536bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/0*CPv9HMgGeW2oGtBq.png"/></div><p class="iz ja et er es jb jc bd b be z dx translated"><em class="ng"> Kubernetes运行</em></p></figure><figure class="lm ln lo lp fd iw er es paragraph-image"><div class="er es ni"><img src="../Images/6215a31ab23fced6e817f36ae544ab8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/0*_XZRiX3E-2KWCyPP.png"/></div><p class="iz ja et er es jb jc bd b be z dx translated"><em class="ng">上下文设置为docker-desktop </em></p></figure></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h2 id="d267" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">【Skaffold入门</h2><ul class=""><li id="874f" class="lx ly hi jf b jg lg jk lh jo my js mz jw na ip mc md me mf bi translated"><strong class="jf hj">使用<em class="nj"> skaffold init </em>命令</strong></li></ul><p id="7185" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">从Skaffold开始，你需要一个<code class="du mp mq mr mh b">skaffold.yaml</code>文件。为此，我们可以运行下面的命令。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="6cc8" class="kb kc hi mh b fi ml mm l mn mo"><em class="nj">skaffold init</em></span></pre><p id="537a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">但是，您将会看到下面的错误消息。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="7568" class="kb kc hi mh b fi ml mm l mn mo">skaffold init<br/>one or more valid builder configuration (Dockerfile or Jib configuration) must be present to build images with skaffold; please provide at least one build config and try again or run `skaffold init --skip-build`</span></pre><p id="38e6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">这个错误似乎是不言自明的，即Skaffold正在您的项目中寻找Dockerfile或Jib配置。</p><p id="63e7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">Skaffold目前支持以下构建器。</p><ol class=""><li id="7c68" class="lx ly hi jf b jg jh jk jl jo lz js ma jw mb ip ms md me mf bi translated"><a class="ae ka" href="https://skaffold.dev/docs/pipeline-stages/builders/docker/" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="93e6" class="lx ly hi jf b jg mt jk mu jo mv js mw jw mx ip ms md me mf bi translated"><a class="ae ka" href="https://skaffold.dev/docs/pipeline-stages/builders/jib/" rel="noopener ugc nofollow" target="_blank">三角帆</a>(带<code class="du mp mq mr mh b">--XXenableJibInit</code>旗)</li><li id="e479" class="lx ly hi jf b jg mt jk mu jo mv js mw jw mx ip ms md me mf bi translated"><a class="ae ka" href="https://skaffold.dev/docs/pipeline-stages/builders/buildpacks/" rel="noopener ugc nofollow" target="_blank">构建包</a>(带有<code class="du mp mq mr mh b">--XXenableBuildpacksInit</code>标志)</li></ol><p id="05fd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">因此，为了解决这个错误，我将在pom.xml文件中添加Jib maven插件。如果你想知道什么是Jib及其用法，你可以阅读我以前的文章。您可以通过将以下内容复制/粘贴到pom.xml文件来启用Jib支持。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="8ee7" class="kb kc hi mh b fi ml mm l mn mo">&lt;plugin&gt;<br/>   &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;<br/>   &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;<br/>   &lt;version&gt;2.7.0&lt;/version&gt;<br/>   &lt;configuration&gt;<br/>      &lt;from&gt;<br/>         &lt;image&gt;gcr.io/distroless/java:11&lt;/image&gt;<br/>      &lt;/from&gt;<br/>      &lt;to&gt;<br/>         &lt;image&gt;registry.hub.docker.com/hiashish/indian-states&lt;/image&gt;<br/>      &lt;/to&gt;<br/>   &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="9e64" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">根据官方<a class="ae ka" href="https://skaffold.dev/docs/pipeline-stages/init/" rel="noopener ugc nofollow" target="_blank">文件</a>。</p><blockquote class="nk nl nm"><p id="098e" class="jd je nj jf b jg jh ji jj jk jl jm jn nn jp jq jr no jt ju jv np jx jy jz ip hb bi translated"><code class="du mp mq mr mh b">skaffold</code> init也能识别Maven和Gradle项目，并且会自动建议<code class="du mp mq mr mh b"><a class="ae ka" href="https://skaffold.dev/docs/pipeline-stages/builders/#/local#jib-maven-and-gradle" rel="noopener ugc nofollow" target="_blank">jib</a></code>构建器。目前<code class="du mp mq mr mh b">jib</code>伪像检测默认禁用，但可以使用标志<code class="du mp mq mr mh b">--XXenableJibInit</code>启用。</p></blockquote><p id="a121" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">现在用<code class="du mp mq mr mh b"><em class="nj">--XXenableJibInit. </em></code>运行<code class="du mp mq mr mh b">skaffold init</code>，但是，它将再次失败，并显示以下错误。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="0a7e" class="kb kc hi mh b fi ml mm l mn mo">skaffold init --XXenableJibInit<br/>one or more valid Kubernetes manifests are required to run skaffold</span></pre><p id="cdad" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">因为我们还没有创建Kubernetes清单(部署、pod、服务等。)Skaffold有一个已知的<a class="ae ka" href="https://github.com/GoogleContainerTools/skaffold/issues/1651" rel="noopener ugc nofollow" target="_blank">问题</a>，为了解决这个错误，我们必须使用下面的<code class="du mp mq mr mh b">kubectl </code>命令手动创建它们。</p><p id="c79f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated"><em class="nj">创建部署</em></p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="e5f7" class="kb kc hi mh b fi ml mm l mn mo">kubectl create deployment states --image=docker.io/hiashish/indian-states --dry-run -oyaml</span><span id="6f81" class="kb kc hi mh b fi nq mm l mn mo">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  creationTimestamp: null<br/>  labels:<br/>    app: states<br/>  name: states<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: states<br/>  strategy: {}<br/>  template:<br/>    metadata:<br/>      creationTimestamp: null<br/>      labels:<br/>        app: states<br/>    spec:<br/>      containers:<br/>        - image: docker.io/hiashish/indian-states<br/>          name: indian-states<br/>          resources: {}<br/>status: {}</span></pre><p id="9c0c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated"><em class="nj">创建服务</em></p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="cef5" class="kb kc hi mh b fi ml mm l mn mo">kubectl expose deployment states --type=NodePort --port=8080 --dry-run -oyaml</span><span id="83df" class="kb kc hi mh b fi nq mm l mn mo">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  creationTimestamp: null<br/>  labels:<br/>    app: states<br/>  name: states<br/>spec:<br/>  ports:<br/>    - port: 8080<br/>      protocol: TCP<br/>      targetPort: 8080<br/>  selector:<br/>    app: states<br/>  type: NodePort<br/>status:<br/>  loadBalancer: {}</span></pre><p id="d8d1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">我们现在已经创建了部署和服务。请确保将上述命令的输出复制到<code class="du mp mq mr mh b">k8s</code>目录下的YAML文件中。</p><p id="5ffd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">现在运行<code class="du mp mq mr mh b">skaffold init --XXenableJibInit</code></p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="f727" class="kb kc hi mh b fi ml mm l mn mo">skaffold init --XXenableJibInit</span><span id="d9d0" class="kb kc hi mh b fi nq mm l mn mo">apiVersion: skaffold/v2beta10<br/>kind: Config<br/>metadata:<br/>  name: indian-states<br/>build:<br/>  artifacts:<br/>  - image: docker.io/hiashish/indian-states<br/>    jib:<br/>      project: com.example:indian-states<br/>deploy:<br/>  kubectl:<br/>    manifests:<br/>    - k8s/mydeployment.yaml<br/>    - k8s/myservice.yaml</span><span id="feb6" class="kb kc hi mh b fi nq mm l mn mo">Do you want to write this configuration to skaffold.yaml? [y/n]: y<br/>Configuration skaffold.yaml was written<br/>You can now run [skaffold build] to build the artifacts<br/>or [skaffold run] to build and deploy<br/>or [skaffold dev] to enter development mode, with auto-redeploy</span></pre><p id="fdcc" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">最后，<code class="du mp mq mr mh b">skaffold.yaml</code>文件被创建。</p><ul class=""><li id="a9b6" class="lx ly hi jf b jg jh jk jl jo lz js ma jw mb ip mc md me mf bi translated"><strong class="jf hj">使用<em class="nj"> skaffold dev </em>命令</strong></li></ul><p id="fb34" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">现在，我们已经完成了开始持续构建和部署Kubernetes应用程序所需的设置。现在，我们可以简单地运行下面的命令，在本地启动我们的<a class="ae ka" href="https://javarevisited.blogspot.com/2018/09/top-5-jenkins-courses-for-java-and-DevOps-Programmers.html" rel="noopener ugc nofollow" target="_blank"> CI/CD工作流</a>。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="a681" class="kb kc hi mh b fi ml mm l mn mo">skaffold dev<br/>Listing files to watch...<br/> - docker.io/hiashish/indian-states<br/>Generating tags...<br/> - docker.io/hiashish/indian-states -&gt; docker.io/hiashish/indian-states:31ff588-dirty<br/>Checking cache...<br/> - docker.io/hiashish/indian-states: Found Locally<br/>Tags used in deployment:<br/> - docker.io/hiashish/indian-states -&gt; docker.io/hiashish/indian-states:43f7c470a60b876c7579ed3041b64024b774e9808851ad83b6817701d0188cc5<br/>Starting deploy...<br/> - deployment.apps/states created<br/> - service/states created<br/>Waiting for deployments to stabilize...<br/> - deployment/states is ready.<br/>Deployments stabilized in 2.710870355s<br/>Press Ctrl+C to exit<br/>Watching for changes...<br/>[indian-states] <br/>[indian-states]   .   ____          _            __ _ _<br/>[indian-states]  /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \<br/>[indian-states] ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \<br/>[indian-states]  \\/  ___)| |_)| | | | | || (_| |  ) ) ) )<br/>[indian-states]   '  |____| .__|_| |_|_| |_\__, | / / / /<br/>[indian-states]  =========|_|==============|___/=/_/_/_/<br/>[indian-states]  :: Spring Boot ::                (v2.4.0)<br/>[indian-states] <br/>[indian-states] 2020-12-07 17:43:54.919  INFO 1 --- [           main] c.e.i.IndianStatesApplication            : Starting IndianStatesApplication using Java 11.0.6 on states-6f5bb746b6-9sglw with PID 1 (/app/classes started by root in /)<br/>[indian-states] 2020-12-07 17:43:54.938  INFO 1 --- [           main] c.e.i.IndianStatesApplication            : No active profile set, falling back to default profiles: default<br/>[indian-states] 2020-12-07 17:43:57.607  INFO 1 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JDBC repositories in DEFAULT mode.<br/>[indian-states] 2020-12-07 17:43:57.670  INFO 1 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 35 ms. Found 0 JDBC repository interfaces.<br/>[indian-states] 2020-12-07 17:44:00.130  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)<br/>[indian-states] 2020-12-07 17:44:00.189  INFO 1 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]<br/>[indian-states] 2020-12-07 17:44:00.196  INFO 1 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.39]<br/>[indian-states] 2020-12-07 17:44:00.387  INFO 1 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext<br/>[indian-states] 2020-12-07 17:44:00.388  INFO 1 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 5249 ms<br/>[indian-states] 2020-12-07 17:44:01.673  INFO 1 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...<br/>[indian-states] 2020-12-07 17:44:02.375  INFO 1 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.<br/>[indian-states] 2020-12-07 17:44:03.216  INFO 1 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'<br/>[indian-states] 2020-12-07 17:44:04.050  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''<br/>[indian-states] 2020-12-07 17:44:04.095  INFO 1 --- [           main] c.e.i.IndianStatesApplication            : Started IndianStatesApplication in 10.782 seconds (JVM running for 12.991)</span></pre><p id="11a0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">如您所见，应用程序现在已经构建并部署到本地Kubernetes集群。我们首先必须使用<code class="du mp mq mr mh b">kubectl </code>命令检查我们的应用程序的<code class="du mp mq mr mh b">NodePort</code>,以便在本地访问应用程序。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="a4fb" class="kb kc hi mh b fi ml mm l mn mo">kubectl get all</span><span id="2489" class="kb kc hi mh b fi nq mm l mn mo">NAME                          READY   STATUS    RESTARTS   AGE</span><span id="c9ed" class="kb kc hi mh b fi nq mm l mn mo">pod/states-7c55b8d5b6-vx5hq   1/1     Running   0          5m47s</span><span id="93ab" class="kb kc hi mh b fi nq mm l mn mo">NAME                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><span id="e0ed" class="kb kc hi mh b fi nq mm l mn mo">service/kubernetes   ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          21h</span><span id="32f2" class="kb kc hi mh b fi nq mm l mn mo">service/states       NodePort    10.110.135.236   &lt;none&gt;        8080:30925/TCP   5m47s</span><span id="73b2" class="kb kc hi mh b fi nq mm l mn mo">NAME                     READY   UP-TO-DATE   AVAILABLE   AGE</span><span id="28d4" class="kb kc hi mh b fi nq mm l mn mo">deployment.apps/states   1/1     1            1           5m48s</span><span id="3a61" class="kb kc hi mh b fi nq mm l mn mo">NAME                                DESIRED   CURRENT   READY   AGE</span><span id="b3a6" class="kb kc hi mh b fi nq mm l mn mo">replicaset.apps/states-7c55b8d5b6   1         1         1       5m48s</span></pre><p id="dbf9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated"><code class="du mp mq mr mh b">NodePort</code>分配给我们的申请是30925。让我们调用应用程序的/states REST端点，看看会发生什么。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="4973" class="kb kc hi mh b fi ml mm l mn mo">curl localhost:30925/states</span><span id="6c61" class="kb kc hi mh b fi nq mm l mn mo">[{"name":"Andra Pradesh","capital":"Hyderabad"},{"name":"Arunachal Pradesh","capital":"Itangar"},{"name":"Assam","capital":"Dispur"},{"name":"Bihar","capital":"Patna"},{"name":"Chhattisgarh","capital":"Raipur"},{"name":"Goa","capital":"Panaji"},{"name":"Gujarat","capital":"Gandhinagar"},{"name":"Haryana","capital":"Chandigarh"},{"name":"Himachal Pradesh","capital":"Shimla"},{"name":"Jharkhand","capital":"Ranchi"},{"name":"Karnataka","capital":"Bangalore"},{"name":"Kerala","capital":"Thiruvananthapuram"},{"name":"Madhya Pradesh","capital":"Bhopal"},{"name":"Maharashtra","capital":"Mumbai"},{"name":"Manipur","capital":"Imphal"},{"name":"Meghalaya","capital":"Shillong"},{"name":"Mizoram","capital":"Aizawi"},{"name":"Nagaland","capital":"Kohima"},{"name":"Orissa","capital":"Bhubaneshwar"},{"name":"Rajasthan","capital":"Jaipur"},{"name":"Sikkim","capital":"Gangtok"},{"name":"Tamil Nadu","capital":"Chennai"},{"name":"Telangana","capital":"Hyderabad"},{"name":"Tripura","capital":"Agartala"},{"name":"Uttaranchal","capital":"Dehradun"},{"name":"Uttar Pradesh","capital":"Lucknow"},{"name":"West Bengal","capital":"Kolkata"},{"name":"Punjab","capital":"Chandigarh"}]</span></pre><p id="148f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">这看起来棒极了！！！</p><p id="efeb" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">让我们做一个小的代码更改，看看Skaffold能否重新触发整个工作流。我将把部署YAML文件中的<code class="du mp mq mr mh b">replicas</code>从1改为2，看看Skaffold是否可以用增加的<code class="du mp mq mr mh b">replicas</code>重新部署应用程序。</p><p id="ff69" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated"><em class="nj">应用程序重新部署</em></p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="7477" class="kb kc hi mh b fi ml mm l mn mo">Tags used in deployment:<br/> - docker.io/hiashish/indian-states -&gt; docker.io/hiashish/indian-states:43f7c470a60b876c7579ed3041b64024b774e9808851ad83b6817701d0188cc5<br/>Starting deploy...<br/> - deployment.apps/states configured<br/>Waiting for deployments to stabilize...<br/> - deployment/states is ready.<br/>Deployments stabilized in 4.109550864s<br/>Watching for changes...<br/>[indian-states] <br/>[indian-states]   .   ____          _            __ _ _<br/>[indian-states]  /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \<br/>[indian-states] ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \<br/>[indian-states]  \\/  ___)| |_)| | | | | || (_| |  ) ) ) )<br/>[indian-states]   '  |____| .__|_| |_|_| |_\__, | / / / /<br/>[indian-states]  =========|_|==============|___/=/_/_/_/<br/>[indian-states]  :: Spring Boot ::                (v2.4.0)<br/>[indian-states]</span></pre><p id="515a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">现在再次检查我们使用kubectl的应用程序的<code class="du mp mq mr mh b">replicaset</code>。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="8064" class="kb kc hi mh b fi ml mm l mn mo">kubectl get all<br/>NAME                          READY   STATUS    RESTARTS   AGE</span><span id="ee43" class="kb kc hi mh b fi nq mm l mn mo">pod/states-7c55b8d5b6-br9zx   1/1     Running   0          20s</span><span id="ffbd" class="kb kc hi mh b fi nq mm l mn mo">pod/states-7c55b8d5b6-vx5hq   1/1     Running   0          16m</span><span id="f992" class="kb kc hi mh b fi nq mm l mn mo">NAME                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><span id="afc6" class="kb kc hi mh b fi nq mm l mn mo">service/kubernetes   ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          21h</span><span id="8fee" class="kb kc hi mh b fi nq mm l mn mo">service/states       NodePort    10.110.135.236   &lt;none&gt;        8080:30925/TCP   16m</span><span id="63e9" class="kb kc hi mh b fi nq mm l mn mo">NAME                     READY   UP-TO-DATE   AVAILABLE   AGE</span><span id="54d0" class="kb kc hi mh b fi nq mm l mn mo">deployment.apps/states   2/2     2            2           16m</span><span id="6e0f" class="kb kc hi mh b fi nq mm l mn mo">NAME                                DESIRED   CURRENT   READY   AGE</span><span id="8b44" class="kb kc hi mh b fi nq mm l mn mo">replicaset.apps/states-7c55b8d5b6   2         2         2       16m</span></pre><p id="4d72" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">如您所见，在重新部署后，副本数量增加到了预期的2个。</p><ul class=""><li id="6184" class="lx ly hi jf b jg jh jk jl jo lz js ma jw mb ip mc md me mf bi translated"><strong class="jf hj">使用<em class="nj"> skaffold run </em>命令</strong></li></ul><p id="6687" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">这与<code class="du mp mq mr mh b">skaffold dev</code>相似，但主要区别在于<code class="du mp mq mr mh b">skaffold.yaml</code>中描述的工作流只执行一次。建议在您的生产工作流程中使用。</p><h2 id="c2e9" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">使用云壳</h2><p id="d137" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ip hb bi translated">如果您已经在本地安装了所有需要的依赖项(docker、minikube、skaffold ),那么就可以了，否则您可以跳过安装部分，正如我在前面的先决条件部分所描述的，使用Google的Cloud <a class="ae ka" href="https://cloud.google.com/shell" rel="noopener ugc nofollow" target="_blank"> Shell </a>来复制您的本地Kubernetes环境。</p><p id="db27" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">云壳提供了一个基于浏览器的终端/CLI和编辑器，它预装了Skaffold、Minikube和Docker，并且是免费的。</p><p id="f181" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">只需运行以下命令就可以了。确保docker和minikube在云壳环境中启动并运行。</p><pre class="lm ln lo lp fd mg mh mi mj aw mk bi"><span id="8e3e" class="kb kc hi mh b fi ml mm l mn mo">git clone <a class="ae ka" href="https://github.com/yrashish/indian-states`" rel="noopener ugc nofollow" target="_blank">https://github.com/yrashish/indian-states</a><br/>skaffold dev</span></pre><p id="eec3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">以下是来自云壳的截图。</p><figure class="lm ln lo lp fd iw er es paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="er es nr"><img src="../Images/f5f0fac3b3a8af890b82e5ab071c6e9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OdsWKSPYHoMcDA-RdAPIbw.png"/></div></div><p class="iz ja et er es jb jc bd b be z dx translated">云壳</p></figure><figure class="lm ln lo lp fd iw er es paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="er es ns"><img src="../Images/a6bfd7f47a292d2b09d63bff5fd543d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0umnxvMScABG5p9ULt_TA.png"/></div></div><p class="iz ja et er es jb jc bd b be z dx translated">输出</p></figure><p id="a86a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ip hb bi translated">正如你在上面看到的，我们也能够用云壳运行我们的Spring Boot应用程序，并得到预期的输出。</p><h2 id="7bfc" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">结论</h2><p id="b2e6" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ip hb bi translated">在本文中，我只是介绍了Skaffold提供的一些特性。还有许多其他值得关注的特性，比如用于调试的端口转发、健康检查和模板化部署配置等。对于Kubernetes应用程序的持续部署，值得考虑Skaffold。</p><h2 id="bd00" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">支持我</h2><p id="0386" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ip hb bi translated">如果你喜欢你刚刚读到的，你可以给我买杯咖啡。</p><figure class="lm ln lo lp fd iw er es paragraph-image"><a href="https://www.buymeacoffee.com/meashish"><div class="er es nt"><img src="../Images/6d60b235fcc46a4bd696b90e886419ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*Dpw8-hNGI2fDmosV4E8DVQ.png"/></div></a></figure><h2 id="208f" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated"><strong class="ak">延伸阅读</strong></h2><p id="deb1" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ip hb bi translated">也可以看看我之前的一些<a class="ae ka" href="https://ashish-choudhary.medium.com/containerizing-springboot-application-with-jib-716daa3e0850" rel="noopener">文章</a>。</p></div></div>    
</body>
</html>