<html>
<head>
<title>How to test out Java Virtual Threads (Project Loom)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何测试Java虚拟线程(Project Loom)</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/how-to-test-out-java-virtual-threads-project-loom-2029428aeada?source=collection_archive---------1-----------------------#2022-06-13">https://medium.com/javarevisited/how-to-test-out-java-virtual-threads-project-loom-2029428aeada?source=collection_archive---------1-----------------------#2022-06-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/06/top-5-java-multithreading-and-concurrency-courses-experienced-programmers.html"><div class="er es if"><img src="../Images/ff2f7bc58d9e4a4bbf74a5216ea4d836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vb8lapQ1VS0TZx6AHRbxIg.png"/></div></a></figure><p id="151a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在当前的Java版本中，可以创建的线程数量非常有限，更不用说<a class="ae jk" href="https://www.java67.com/2019/06/right-way-to-create-start-and-stop-new-thread-java-example-tutorial.html" rel="noopener ugc nofollow" target="_blank">创建新线程</a>的开销了。这是因为Java中的一个线程对应于操作系统上的一个本机线程。通常使用某种线程池来调度许多任务的执行。对于IO繁重的任务，这仍然是非常低效的。</p><p id="44cb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了克服这个问题，<a class="ae jk" href="https://openjdk.java.net/projects/loom/" rel="noopener ugc nofollow" target="_blank"> Project Loom </a>引入了<em class="jl">虚拟线程</em>和<a class="ae jk" href="https://openjdk.java.net/jeps/425" rel="noopener ugc nofollow" target="_blank"> JEP 425 </a>。这些是线程<strong class="io hj">的轻量级版本</strong>，其行为就像普通的Java线程一样，<strong class="io hj">但是你可以创建任意多的线程</strong>。它们不绑定到某个操作系统线程，但是可以连接到操作系统线程或从操作系统线程分离。</p><p id="4be0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了测试你的程序是否能从新的虚拟线程中获益以及获益多少，你必须从官方OpenJDK站点<a class="ae jk" href="https://jdk.java.net/19/" rel="noopener ugc nofollow" target="_blank">安装JDK 19(早期访问),或者如果你使用SDKMAN！通过<br/> <code class="du jm jn jo jp b">sdk install java 19.ea.XXX-open</code> ( <em class="jl">用当前版本</em>替换XXX)安装即可。这是因为JDK 19包括</a><a class="ae jk" href="https://openjdk.java.net/jeps/425" rel="noopener ugc nofollow" target="_blank"> JEP 425 </a>作为<a class="ae jk" href="https://openjdk.java.net/jeps/12" rel="noopener ugc nofollow" target="_blank">预览功能</a>。</p><p id="7ed1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果尚未设置，请将JDK 19 eap设置为您的默认JDK。在命令行中检查版本时，应该会显示类似如下的内容:</p><blockquote class="jq jr js"><p id="913a" class="im in jl io b ip iq ir is it iu iv iw jt iy iz ja ju jc jd je jv jg jh ji jj hb bi translated">$ Java-version<br/>open JDK version " 19-ea " 2022–09–20</p></blockquote><p id="cdb2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在来测试一下，你可以创建你的第一个程序，如下图<em class="jl">Main.java</em>:</p><figure class="jw jx jy jz fd ij"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="7656" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">由于虚拟线程是一个预览特性，当编译你的程序时，你需要添加特殊的标志<code class="du jm jn jo jp b">—- enable-preview</code>和<code class="du jm jn jo jp b">--release</code>。<br/>在命令行中，执行以下命令:</p><p id="23b0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du jm jn jo jp b">javac --enable-preview --release 19 Main.java</code></p><p id="271c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将把你的程序编译成Java字节码。这现在可以通过再次使用预览标志来执行:</p><p id="32dd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du jm jn jo jp b">java --enable-preview Main</code></p><p id="881b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">输出应该类似于:</p><blockquote class="jq jr js"><p id="79de" class="im in jl io b ip iq ir is it iu iv iw jt iy iz ja ju jc jd je jv jg jh ji jj hb bi translated">来自virtual thread[# 21]/runnable @ ForkJoinPool-1-worker-1的Hello World</p></blockquote><p id="87ef" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在是时候转换你自己的程序来使用虚拟线程了。如果您已经在使用<a class="ae jk" href="https://javarevisited.blogspot.com/2013/07/how-to-create-thread-pools-in-java-executors-framework-example-tutorial.html" rel="noopener ugc nofollow" target="_blank"> executor服务模式</a>来调度任务，那么您可以通过使用新的util函数<em class="jl">executors . newvirtualthreadpertaskmexecutor()来轻松替换您的executor定义。</em>这创建了一个总是启动一个新的轻量级线程而不是有限大小的线程池(不再需要)的执行器。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="c174" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您还想使用<a class="ae jk" rel="noopener" href="/javarevisited/7-best-courses-to-learn-intellij-idea-for-beginners-and-experienced-java-programmers-2e9aa9bb0c05">智能集成环境</a>中的预览功能，请务必将您的项目设置为使用<em class="jl">文件- &gt;项目结构- &gt; SDK </em>下的JDK 19</p><figure class="jw jx jy jz fd ij er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/09/top-5-courses-to-learn-intellij-idea-java-and-android-development.html"><div class="er es kj"><img src="../Images/a2409a2398b6e529fafebb29f99bca70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ZdhNjAtVT1OCGFTWIeOBA.png"/></div></a></figure><p id="978a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后在IDE的Java编译器首选项中添加编译器参数:</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kk"><img src="../Images/2541af6e1cc96baa8f4e386feaf55e51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R6wUnSxLV8WA_bewSBNazw.png"/></div></div><p class="kp kq et er es kr ks bd b be z dx translated">(发布标志通常已经在第一个复选框中自动设置)</p></figure><p id="3048" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要运行程序，首先添加<a class="ae jk" href="https://www.java67.com/2016/08/10-jvm-options-for-java-production-application.html" rel="noopener ugc nofollow" target="_blank"> VM选项</a>，然后设置预览标志，编辑运行配置。</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kt"><img src="../Images/b9bb2a34d03517bd2d6ab5daef5e9d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R80AwhMwOlzh2D6jHYQ9cg.png"/></div></div></figure><p id="cbf5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，您应该能够在IntelliJ IDE中运行虚拟线程了。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="1aa4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下一步做什么？看看<a class="ae jk" href="https://openjdk.java.net/jeps/428" rel="noopener ugc nofollow" target="_blank"> JEP 428结构化并发</a>，它也即将推出，使处理并发任务变得更容易。</p><div class="ku kv ez fb kw kx"><a rel="noopener follow" target="_blank" href="/javarevisited/the-java-programmer-roadmap-f9db163ef2c2"><div class="ky ab dw"><div class="kz ab la cl cj lb"><h2 class="bd hj fi z dy lc ea eb ld ed ef hh bi translated">2022年Java程序员路线图</h2><div class="le l"><h3 class="bd b fi z dy lc ea eb ld ed ef dx translated">2022年成为Java开发人员的图解指南，包含相关课程的链接</h3></div><div class="lf l"><p class="bd b fp z dy lc ea eb ld ed ef dx translated">medium.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll ik kx"/></div></div></a></div></div></div>    
</body>
</html>