<html>
<head>
<title>Do You Know Why Local Variables Are Thread-safe in Java?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你知道为什么局部变量在Java中是线程安全的吗？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/do-you-know-why-local-variables-are-thread-safe-in-java-latest-e4f98e013ac?source=collection_archive---------1-----------------------#2022-12-28">https://medium.com/javarevisited/do-you-know-why-local-variables-are-thread-safe-in-java-latest-e4f98e013ac?source=collection_archive---------1-----------------------#2022-12-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="48f1" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">JAVA多线程——线程安全变量</h2><div class=""/><div class=""><h2 id="7e70" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">多线程环境中局部变量的线程安全。</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/29e38ebb9ed3867db261ccc102fba581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WhR0GNM_wrfEawQ4HfU2ZQ.jpeg"/></div></div><p class="js jt et er es ju jv bd b be z dx translated"><strong class="bd jw">照片由</strong> <a class="ae jx" href="https://unsplash.com/@clemhlrdt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <strong class="bd jw"> Clément H </strong> </a> <strong class="bd jw">上</strong> <a class="ae jx" href="https://unsplash.com/s/photos/java-programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <strong class="bd jw"> Unsplash </strong> </a></p></figure></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="4638" class="pw-post-body-paragraph kf kg hi kh b ki kj is kk kl km iv kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">多线程是java编程中的基本概念之一。了解多线程总是有好处的，因为它有助于您编写和调试基于多线程的大型应用程序。</p><p id="36ad" class="pw-post-body-paragraph kf kg hi kh b ki kj is kk kl km iv kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">在这篇文章中，我将通过例子解释<strong class="kh hs"> <em class="lb">为什么局部变量是线程安全的。</em>T15】</strong></p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="48e1" class="lc ld hi bd jw le lf lg lh li lj lk ll ix lm iy ln ja lo jb lp jd lq je lr ls bi translated">线程堆栈和堆:</h1><p id="ad07" class="pw-post-body-paragraph kf kg hi kh b ki lt is kk kl lu iv kn ko lv kq kr ks lw ku kv kw lx ky kz la hb bi translated">首先，Java虚拟机将自己的内存分为<strong class="kh hs"> <em class="lb">栈</em> </strong> <em class="lb">和</em> <strong class="kh hs"> <em class="lb">堆</em> </strong> <em class="lb">内存</em>。</p><blockquote class="ly"><p id="4650" class="lz ma hi bd mb mc md me mf mg mh la dx translated">它将所有对象存储在堆上，并将本地原语和本地对象引用存储在堆栈上。</p></blockquote><p id="a8d4" class="pw-post-body-paragraph kf kg hi kh b ki mi is kk kl mj iv kn ko mk kq kr ks ml ku kv kw mm ky kz la hb bi translated"><strong class="kh hs"> <em class="lb">最重要的是，每个线程包括主线程都有自己的私有栈。</em> </strong> <strong class="kh hs"> <em class="lb">在其栈(基本上是线程栈)上，存储了局部原语和局部引用变量。</em> </strong></p><p id="d2e3" class="pw-post-body-paragraph kf kg hi kh b ki kj is kk kl km iv kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">因此，一个线程不与任何其他线程共享其局部变量，因为这些局部变量和引用在该线程的私有堆栈内。因此局部变量总是线程安全的。 </p><h1 id="48a0" class="lc ld hi bd jw le mn lg lh li mo lk ll ix mp iy ln ja mq jb lp jd mr je lr ls bi translated">让我们举一个简单的例子来理解这一点:</h1><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="ms mt l"/></div><p class="js jt et er es ju jv bd b be z dx translated"><strong class="ak">局部变量的线程安全</strong></p></figure><h1 id="c84f" class="lc ld hi bd jw le mn lg lh li mo lk ll ix mp iy ln ja mq jb lp jd mr je lr ls bi translated">上面程序的输出:</h1><pre class="jh ji jj jk fd mu mv mw bn mx my bi"><span id="0b3c" class="mz ld hi mv b be na nb l nc nd">counter : -2066897874 count : 1775146445<br/>counter : 170327989 count : -1649657772</span></pre><p id="6472" class="pw-post-body-paragraph kf kg hi kh b ki kj is kk kl km iv kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">在上面的例子中，在第11行，创建了<em class="lb"> ThreadExample </em>的实例，在接下来的两行(第12行和第13行)，创建了两个线程对象，并在第14行和第15行开始。这些线程将执行同一个实例<em class="lb">【thread example】</em>的<strong class="kh hs"><em class="lb">run</em></strong><em class="lb"/>方法。</p><p id="8b2a" class="pw-post-body-paragraph kf kg hi kh b ki kj is kk kl km iv kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">当这两个线程执行run方法时，它们在自己的私有堆栈中创建自己的本地<strong class="kh hs"> count </strong>变量副本。由于这些堆栈是私有的，两个线程不能共享同一个<strong class="kh hs">计数</strong>变量的副本。因此它是线程安全的。此外，<strong class="kh hs">计数</strong>变量被赋予一个随机整数，因此不太可能将相同的整数赋予<strong class="kh hs">计数</strong>变量。</p><p id="51c2" class="pw-post-body-paragraph kf kg hi kh b ki kj is kk kl km iv kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">但是两个线程都引用了threadExample类的同一个实例<strong class="kh hs"><em class="lb">【thread example】</em></strong>。这个实例在堆上，因此它的字段<strong class="kh hs">计数器</strong>也在堆上。所以在堆上只有一个字段计数器的副本在这两个线程之间共享。因此线程之间有可能发生冲突，并可能导致争用情况。这就是为什么<strong class="kh hs">计数器</strong>字段不是线程安全的。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="62de" class="pw-post-body-paragraph kf kg hi kh b ki kj is kk kl km iv kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated"><strong class="kh hs"> <em class="lb">目前就这些。我希望这篇文章能让你明白为什么局部变量是线程安全的。</em>T13】</strong></p><p id="ad23" class="pw-post-body-paragraph kf kg hi kh b ki kj is kk kl km iv kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated"><strong class="kh hs"> <em class="lb">这里</em> </strong>  <strong class="kh hs"> <em class="lb">你可以联系我</em> </strong> <a class="ae jx" rel="noopener" href="/@basecs101"> <strong class="kh hs"> <em class="lb">。</em> </strong></a></p></div></div>    
</body>
</html>