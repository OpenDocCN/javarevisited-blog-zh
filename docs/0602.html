<html>
<head>
<title>Converting HTML into PDF in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Java将HTML转换成PDF</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/html-to-pdf-in-java-using-flying-saucer-f73b70d9014d?source=collection_archive---------0-----------------------#2020-07-24">https://medium.com/javarevisited/html-to-pdf-in-java-using-flying-saucer-f73b70d9014d?source=collection_archive---------0-----------------------#2020-07-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d310" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用开源库:Jsoup和飞碟</h2></div><p id="1369" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最近遇到了使用免费的开源库将HTML文件转换成Java的PDF文件的需求。在这篇文章中，我将带你完成我的设置过程:</p><ul class=""><li id="d86c" class="jt ju hi iz b ja jb jd je jg jv jk jw jo jx js jy jz ka kb bi translated">使用自制软件安装<a class="ae kc" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-maven-jenkins-and-docker-for-java-developers-51fa7a1e66f6?source=collection_home---4------3-----------------------"> Maven </a>并配置$JAVA_HOME</li><li id="337f" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated">在IntelliJ 中建立一个Maven项目，并安装我们代码所需的jar</li><li id="4822" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated">将HTML转换成PDF的代码</li></ul><h1 id="b3fe" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">安装和配置Maven</h1><p id="5ca6" class="pw-post-body-paragraph ix iy hi iz b ja la ij jc jd lb im jf jg lc ji jj jk ld jm jn jo le jq jr js hb bi translated">如果你还没有安装<a class="ae kc" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制软件</a>。然后我们会用家酿安装<a class="ae kc" href="https://javarevisited.blogspot.com/2019/03/top-5-course-to-learn-apache-maven-for.html#axzz645Kt2tH8" rel="noopener ugc nofollow" target="_blank"> Maven </a>。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5e6a" class="lo kj hi lk b fi lp lq l lr ls">brew install maven</span></pre><p id="5b44" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将下面一行添加到<strong class="iz hj"> ~/。bash_profile </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="a4f4" class="lo kj hi lk b fi lp lq l lr ls">export JAVA_HOME=$(/usr/libexec/java_home)</span></pre><p id="709d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后在终端中运行:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="b80e" class="lo kj hi lk b fi lp lq l lr ls">source ~/.bash_profile</span></pre><p id="4a87" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检查<code class="du lt lu lv lk b">$JAVA_HOME</code>设置是否正确:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="1647" class="lo kj hi lk b fi lp lq l lr ls">echo $JAVA_PATH</span></pre><p id="cfb5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这应该会给出类似于<strong class="iz hj">/Library/Java/JavaVirtualMachines/adopt open JDK-13 . 0 . 1 . JDK/Contents/Home</strong>的内容</p><h1 id="d615" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">在IntelliJ中配置Maven项目</h1><p id="8d72" class="pw-post-body-paragraph ix iy hi iz b ja la ij jc jd lb im jf jg lc ji jj jk ld jm jn jo le jq jr js hb bi translated">在IntelliJ中创建新项目并选择<a class="ae kc" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-maven-jenkins-and-docker-for-java-developers-51fa7a1e66f6?source=collection_home---4------3-----------------------"> Maven </a>。从这一步开始，您可能会遇到两个常见错误，我将向您展示如何解决它们。</p><h2 id="7f54" class="lo kj hi bd kk lw lx ly ko lz ma mb ks jg mc md ku jk me mf kw jo mg mh ky mi bi translated">错误:不支持发布版本</h2><p id="70f7" class="pw-post-body-paragraph ix iy hi iz b ja la ij jc jd lb im jf jg lc ji jj jk ld jm jn jo le jq jr js hb bi translated">在<code class="du lt lu lv lk b">src/main/java</code>中创建一个Java文件，并让它打印出<strong class="iz hj"> Hello World！</strong></p><p id="9473" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行程序，你可能会遇到错误<code class="du lt lu lv lk b">Error:java: error: release version 5 not supported</code>如果你使用的是JDK 8+。在Dev.to 上有一个关于解决这个错误的帖子。</p><p id="315b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<strong class="iz hj"> pom.xml </strong>文件中添加以下几行:(JDK 8为1.8，JDK 11为1.11，JDK 13为1.13等。)我用的是JDK 13。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="6987" class="lo kj hi lk b fi lp lq l lr ls">&lt;properties&gt;<br/>    &lt;maven.compiler.source&gt;1.13&lt;/maven.compiler.source&gt;<br/>    &lt;maven.compiler.target&gt;1.13&lt;/maven.compiler.target&gt;<br/>&lt;/properties&gt;</span></pre><p id="e147" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Shift + Cmd + A(在Mac上)或“帮助”&gt;“查找操作”来调出“操作”菜单。键入<strong class="iz hj">重新导入所有Maven项目。</strong></p><p id="562f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在重新运行Java程序，确保<strong class="iz hj"> Hello World </strong>被正确打印。</p><p id="9ac8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，让我们将我们的<a class="ae kc" rel="noopener" href="/javarevisited/5-free-html-and-css-courses-to-learn-front-end-web-development-online-8b04517c6ecb?source=collection_home---4------0-----------------------"> HTML </a>到PDF代码依赖的jar文件添加到<strong class="iz hj"> pom.xml中。</strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="44e5" class="lo kj hi lk b fi lp lq l lr ls">&lt;dependencies&gt;<br/>    &lt;!-- <a class="ae kc" href="https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-core" rel="noopener ugc nofollow" target="_blank">https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-core</a> --&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.xhtmlrenderer&lt;/groupId&gt;<br/>        &lt;artifactId&gt;flying-saucer-core&lt;/artifactId&gt;<br/>        &lt;version&gt;9.1.20&lt;/version&gt;<br/>    &lt;/dependency&gt;</span><span id="ffe4" class="lo kj hi lk b fi mj lq l lr ls">    &lt;!-- <a class="ae kc" href="https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf-openpdf" rel="noopener ugc nofollow" target="_blank">https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf-openpdf</a> --&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.xhtmlrenderer&lt;/groupId&gt;<br/>        &lt;artifactId&gt;flying-saucer-pdf-openpdf&lt;/artifactId&gt;<br/>        &lt;version&gt;9.1.20&lt;/version&gt;<br/>    &lt;/dependency&gt;</span><span id="6939" class="lo kj hi lk b fi mj lq l lr ls">&lt;/dependencies&gt;</span></pre><h2 id="5051" class="lo kj hi bd kk lw lx ly ko lz ma mb ks jg mc md ku jk me mf kw jo mg mh ky mi bi translated">Maven错误:无效的目标版本</h2><p id="c117" class="pw-post-body-paragraph ix iy hi iz b ja la ij jc jd lb im jf jg lc ji jj jk ld jm jn jo le jq jr js hb bi translated">在IntelliJ的终端中，运行以下命令来安装依赖项。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="ba92" class="lo kj hi lk b fi lp lq l lr ls">mvn install</span></pre><p id="0021" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这可能会失败，并显示一条错误消息<code class="du lt lu lv lk b">error: invalid target release: 1.13</code>。这篇<a class="ae kc" href="https://javarevisited.blogspot.com/2018/12/how-to-fix-invalid-target-release-17-18-error-in-maven.html#axzz5kyUBax4O" rel="noopener ugc nofollow" target="_blank">博文</a>对此有一个解决方案。</p><p id="42de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将以下插件添加到<strong class="iz hj"> pom.xml </strong>并<strong class="iz hj">重新导入所有Maven项目。</strong>注意，<code class="du lt lu lv lk b">source</code>和<code class="du lt lu lv lk b">target</code>应该是JDK 8的1.8，JDK 10的1.10，但是JDK 11的11，JDK 12的12，<a class="ae kc" href="https://dev.to/javinpaul/6-mini-courses-and-tutorials-to-learn-new-java-features-from-jdk-8-to-jdk-13-1dij" rel="noopener ugc nofollow" target="_blank"> JDK 13的13 </a>等等。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="d4c9" class="lo kj hi lk b fi lp lq l lr ls">&lt;build&gt;<br/>    &lt;plugins&gt;<br/>        &lt;plugin&gt;<br/>            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;<br/>            &lt;version&gt;3.8.1&lt;/version&gt;<br/>            &lt;configuration&gt;<br/>                &lt;source&gt;13&lt;/source&gt;<br/>                &lt;target&gt;13&lt;/target&gt;<br/>            &lt;/configuration&gt;<br/>        &lt;/plugin&gt;<br/>    &lt;/plugins&gt;<br/>&lt;/build&gt;</span></pre><p id="7eae" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后<code class="du lt lu lv lk b">mvn install</code>应该没有错误地完成。</p><h1 id="0dc6" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">将HTML转换为PDF</h1><p id="1e85" class="pw-post-body-paragraph ix iy hi iz b ja la ij jc jd lb im jf jg lc ji jj jk ld jm jn jo le jq jr js hb bi translated">我们需要两步:首先，用<a class="ae kc" href="http://javarevisited.blogspot.sg/2014/09/how-to-parse-html-file-in-java-jsoup-example.html#axzz57nN5jeqk" rel="noopener ugc nofollow" target="_blank"> Jsoup </a>把HTML转换成XHTML。第二，用<a class="ae kc" href="https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf" rel="noopener ugc nofollow" target="_blank">飞碟</a>把XHTML转换成PDF。XHTML与HTML的不同之处在于，XHTML是HTML在语法上更严格的版本。例如，XHTML不允许像<code class="du lt lu lv lk b">&lt;img src=''&gt;</code>这样的自结束标签。</p><h2 id="f438" class="lo kj hi bd kk lw lx ly ko lz ma mb ks jg mc md ku jk me mf kw jo mg mh ky mi bi translated">HTML到XHTML</h2><p id="3163" class="pw-post-body-paragraph ix iy hi iz b ja la ij jc jd lb im jf jg lc ji jj jk ld jm jn jo le jq jr js hb bi translated">将Jsoup作为依赖项添加到<strong class="iz hj"> pom.xml </strong>:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="68e7" class="lo kj hi lk b fi lp lq l lr ls">&lt;dependency&gt;<br/>    &lt;groupId&gt;org.jsoup&lt;/groupId&gt;<br/>    &lt;artifactId&gt;jsoup&lt;/artifactId&gt;<br/>    &lt;version&gt;1.13.1&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="e534" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导入j组:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="e8ca" class="lo kj hi lk b fi lp lq l lr ls">import org.jsoup.Jsoup;<br/>import org.jsoup.nodes.Document;</span></pre><p id="5ce7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个将HTML转换为XHTML的方法:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="ca52" class="lo kj hi lk b fi lp lq l lr ls">private static String htmlToXhtml(String html) {<br/>    Document document = Jsoup.parse(html);<br/>    document.outputSettings().syntax(Document.OutputSettings.Syntax.xml);<br/>    return document.html();<br/>}</span></pre><h2 id="096d" class="lo kj hi bd kk lw lx ly ko lz ma mb ks jg mc md ku jk me mf kw jo mg mh ky mi bi translated">XHTML到PDF</h2><p id="0217" class="pw-post-body-paragraph ix iy hi iz b ja la ij jc jd lb im jf jg lc ji jj jk ld jm jn jo le jq jr js hb bi translated">将飞碟作为依赖项添加到<strong class="iz hj"> pom.xml </strong>:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="204d" class="lo kj hi lk b fi lp lq l lr ls">&lt;dependency&gt;<br/>    &lt;groupId&gt;org.xhtmlrenderer&lt;/groupId&gt;<br/>    &lt;artifactId&gt;flying-saucer-core&lt;/artifactId&gt;<br/>    &lt;version&gt;9.1.20&lt;/version&gt;<br/>&lt;/dependency&gt;<br/><br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.xhtmlrenderer&lt;/groupId&gt;<br/>    &lt;artifactId&gt;flying-saucer-pdf-openpdf&lt;/artifactId&gt;<br/>    &lt;version&gt;9.1.20&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="ea32" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">进口飞碟:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="53ee" class="lo kj hi lk b fi lp lq l lr ls">import org.xhtmlrenderer.pdf.ITextRenderer;<br/>import java.io.*; // for file I/O</span></pre><p id="5a11" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建将XHTML转换为PDF的方法:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="b1bd" class="lo kj hi lk b fi lp lq l lr ls">private static void xhtmlToPdf(String xhtml, String outFileName) throws IOException {<br/>    File output = new File(outFileName);<br/>    ITextRenderer iTextRenderer = new ITextRenderer();<br/>    iTextRenderer.setDocumentFromString(xhtml);<br/>    iTextRenderer.layout();<br/>    OutputStream os = new FileOutputStream(output);<br/>    iTextRenderer.createPDF(os);<br/>    os.close();<br/>}</span></pre><p id="ac57" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者，您可以注册HTML中使用的自定义字体。在第<code class="du lt lu lv lk b">ITextRenderer iTextRenderer = new ITextRenderer();</code>行之后，添加:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="ddb2" class="lo kj hi lk b fi lp lq l lr ls">FontResolver resolver = iTextRenderer.getFontResolver();<br/>iTextRenderer.getFontResolver().addFont("MyFont.ttf", true);</span></pre><h2 id="a1ed" class="lo kj hi bd kk lw lx ly ko lz ma mb ks jg mc md ku jk me mf kw jo mg mh ky mi bi translated">将两种方法结合起来</h2><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="ebb7" class="lo kj hi lk b fi lp lq l lr ls">public static void main(String[] args) throws IOException {<br/>    String html = "&lt;h1&gt;hello&lt;/h1&gt;";<br/>    String xhtml = htmlToXhtml(html);<br/>    xhtmlToPdf(xhtml, "output.pdf");<br/>}</span></pre><p id="ea2b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我下载了一个叫做<a class="ae kc" href="https://www.dafont.com/butterfly-8.font" rel="noopener ugc nofollow" target="_blank"> Butterfly.ttf </a>的字体，用在我的HTML里。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="0d0d" class="lo kj hi lk b fi lp lq l lr ls">&lt;head&gt;<br/>    &lt;style&gt;<br/>    <a class="ae kc" href="http://twitter.com/font" rel="noopener ugc nofollow" target="_blank">@font</a>-face {<br/>        font-family: "Butterfly";<br/>        src: url("Butterfly.ttf");<br/>    }<br/>    .butterfly {<br/>        font-family: "Butterfly";<br/>    }<br/>    &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="2489" class="lo kj hi lk b fi mj lq l lr ls">&lt;body&gt;<br/>    &lt;h1&gt;Hello world&lt;/h1&gt;<br/>    &lt;img src="<a class="ae kc" href="https://www.w3schools.com/w3css/img_lights.jpg" rel="noopener ugc nofollow" target="_blank">https://www.w3schools.com/w3css/img_lights.jpg</a>"&gt;<br/>    &lt;p&gt;Regular text&lt;/p&gt;<br/>    &lt;p style="color:red"&gt;Red text&lt;/p&gt;<br/>    &lt;b&gt;Bold text&lt;/b&gt;<br/>    &lt;p class="butterfly"&gt;Fancy font&lt;/p&gt;<br/>&lt;/body&gt;</span></pre><figure class="lf lg lh li fd ml er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mk"><img src="../Images/00e11b4cac97d2d04c1b708fcef95c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4qX3YbH-l8fUv4CFl8btQ.png"/></div></div><p class="ms mt et er es mu mv bd b be z dx translated">上面HTML的输出(作者:Lynn Zheng)</p></figure><h2 id="61ab" class="lo kj hi bd kk lw lx ly ko lz ma mb ks jg mc md ku jk me mf kw jo mg mh ky mi bi translated"><a class="ae kc" href="https://gist.github.com/RuolinZheng08/2ea8902f3316bf51c3555dce4a2dff5f" rel="noopener ugc nofollow" target="_blank">完整代码</a></h2><figure class="lf lg lh li fd ml"><div class="bz dy l di"><div class="mw mx l"/></div></figure></div></div>    
</body>
</html>