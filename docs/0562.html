<html>
<head>
<title>How to create an Immutable List, Set, and Map in Java?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Java中创建一个不可变的列表、集合和映射？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/how-to-create-an-immutable-list-list-and-map-in-java-5ac1254c128?source=collection_archive---------0-----------------------#2020-07-02">https://medium.com/javarevisited/how-to-create-an-immutable-list-list-and-map-in-java-5ac1254c128?source=collection_archive---------0-----------------------#2020-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9d87" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">每个Java开发人员都应该知道的Java 9特性</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fjava-the-complete-java-developer-course%2F"><div class="er es ix"><img src="../Images/69505d02a770776115e47b79f59bd8cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2cVKCO_t53wvUe_1lHMWg.png"/></div></a></figure><p id="df60" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">大家好，今天，我将分享我最喜欢的Java 9特性<strong class="jh hj">“集合的工厂方法”</strong>，它是JEP 269的一部分。</p><p id="7d44" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果你曾经在Groovy或者Kotlin中工作过，你就会知道使用集合文字创建一个包含元素的列表是多么容易，就像创建一个包含1，2，3的列表一样，你可以简单地编写。</p><p id="9593" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">不幸的是，Java还不支持这一点，但是在JDK 9中，工厂收集方法已经得到了改进，差不多就是这样了。JDK在基本的集合接口上添加了类似于<code class="du kc kd ke kf b">of()</code>的<a class="ae kb" href="http://javarevisited.blogspot.sg/2017/02/5-difference-between-constructor-and-factory-method-in-java.html" rel="noopener ugc nofollow" target="_blank">静态工厂方法</a>，你可以用它来创建一个条目列表。</p><p id="4d1a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它允许你在一行中创建一个列表、集合和一个值映射，就像你在<a class="ae kb" href="http://www.java67.com/2017/12/10-programming-languages-to-learn-in.html" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>、<a class="ae kb" href="http://javarevisited.blogspot.sg/2018/01/10-reasons-to-learn-scala-programming.html#axzz550Ppgfxg" rel="noopener ugc nofollow" target="_blank"> Scala </a>或<a class="ae kb" href="http://javarevisited.blogspot.sg/2016/09/10-basic-differences-between-java-and-groovy-programming.html#axzz560Mbbw3w" rel="noopener ugc nofollow" target="_blank"> Groovy </a>中所做的一样:</p><pre class="iy iz ja jb fd kg kf kh ki aw kj bi"><span id="b052" class="kk kl hi kf b fi km kn l ko kp"><strong class="kf hj">List&lt;String&gt; list = List.of("Java", "Kotlin", "Groovy");</strong></span></pre><p id="3bb9" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">但是唯一的问题是你可以创建一个不可修改的或者<strong class="jh hj">不可修改的列表、集合或者映射。</strong></p><p id="49db" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">由<code class="du kc kd ke kf b">of()</code>静态工厂方法返回的<code class="du kc kd ke kf b">List</code>、<code class="du kc kd ke kf b">Set</code>或<code class="du kc kd ke kf b">Map </code>在结构上是不可变的，这意味着一旦添加了元素，就不能添加、删除或更改元素。</p><p id="5b99" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">调用任何mutator方法都会导致抛出一个<code class="du kc kd ke kf b">UnsupportedOperationException</code>。但是，如果所包含的元素本身是可变的，这可能会导致集合的行为不一致，或者其内容似乎发生了变化。</p><p id="4b12" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">顺便说一句，如果你不熟悉Java 9和最近版本中添加的新API变化，那么我建议你先学习一门全面的最新Java课程，比如Udemy上的<a class="ae kb" href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fjava-the-complete-java-developer-course%2F" rel="noopener ugc nofollow" target="_blank"> <strong class="jh hj">完整的Java MasterClass </strong> </a>。</p><div class="kq kr ez fb ks kt"><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fjava-the-complete-java-developer-course%2F" rel="noopener  ugc nofollow" target="_blank"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">完整的Java软件开发人员大师班(针对Java 10)</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">你刚刚在网上偶然发现了最完整、最深入的Java编程课程。拥有超过260，000名学生…</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">udemy.com</p></div></div><div class="lc l"><div class="ld l le lf lg lc lh jd kt"/></div></div></a></div><p id="2610" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它涵盖了Java开发人员的所有重要主题，并定期更新到最新的Java版本。它也很便宜，你可以在一年四季的几次Udemy flash销售中只花10美元就能买到。</p><h1 id="cf21" class="li kl hi bd lj lk ll lm ln lo lp lq lr io ls ip lt ir lu is lv iu lw iv lx ly bi translated">如何在Java 8及之前版本中创建不可变列表、集合、映射？</h1><p id="8ef4" class="pw-post-body-paragraph jf jg hi jh b ji lz ij jk jl ma im jn jo mb jq jr js mc ju jv jw md jy jz ka hb bi translated">这与您在JDK 6或7中创建的<a class="ae kb" href="http://javarevisited.blogspot.sg/2012/07/create-read-only-list-map-set-example-java.html#axzz55lrMRnNC" rel="noopener ugc nofollow" target="_blank">不可修改列表</a>相同，如下所示:</p><pre class="iy iz ja jb fd kg kf kh ki aw kj bi"><span id="bb11" class="kk kl hi kf b fi km kn l ko kp"><strong class="kf hj">List&lt;String&gt; listOfString = new List&lt;&gt;();</strong></span><span id="3f95" class="kk kl hi kf b fi me kn l ko kp"><strong class="kf hj">listOfString.add("Java");</strong></span><span id="60da" class="kk kl hi kf b fi me kn l ko kp"><strong class="kf hj">listOfString.add("Kotlin");</strong></span><span id="49bc" class="kk kl hi kf b fi me kn l ko kp"><strong class="kf hj">listOfString.add("Groovy");</strong></span><span id="b910" class="kk kl hi kf b fi me kn l ko kp"><strong class="kf hj">listOfString.add("Scala");</strong></span><span id="f507" class="kk kl hi kf b fi me kn l ko kp"><strong class="kf hj">listOfString = Collections.unmodifiableList(listOfString);</strong></span></pre><p id="5d32" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">由<code class="du kc kd ke kf b">unmodifiableList()</code>方法返回的列表也不支持add、remove或set操作，如果你调用它们，就会抛出一个<code class="du kc kd ke kf b">UnsupportedOperationException</code>。</p><p id="8a62" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">两个代码片段之间的唯一区别是，以前，创建一个不可变的集合需要6行以上的代码，比如不可变的列表、集合或映射，但是现在只需要一行代码就可以完成。</p><p id="ad2a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">List接口上也有几个重载版本的<code class="du kc kd ke kf b">List.of()</code>可用，比如允许你创建1-10个元素的不可变列表和一个<a class="ae kb" href="http://javarevisited.blogspot.sg/2011/09/variable-argument-in-java5-varargs.html#axzz560Mbbw3w" rel="noopener ugc nofollow" target="_blank">可变参数方法</a>，它允许你创建任意数量元素的列表。</p><p id="8de6" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对于<code class="du kc kd ke kf b">Set.of()</code>和<code class="du kc kd ke kf b">Map.of()</code>方法也是如此。下面是一个在Java 9中创建不可变集合的例子:</p><pre class="iy iz ja jb fd kg kf kh ki aw kj bi"><span id="ad9a" class="kk kl hi kf b fi km kn l ko kp">Set&lt;Integer&gt; primes = Set.of(2,3,5,7);</span></pre><p id="76cd" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您可以看到，只用一行代码就可以创建一个不可变的集合。类似地，为了创建不可变的地图，JDK 9提供了两种方法— <code class="du kc kd ke kf b">Map.of(K k1, V v1)</code>和<code class="du kc kd ke kf b">Map.ofEntries()</code>。通过使用这两个，您可以创建一个不可变条目的映射(参见Sander Mak的<a class="ae kb" href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fjava-9-whats-new" rel="noopener ugc nofollow" target="_blank">Java 9中的新特性</a>)来了解更多这方面的内容。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=562016.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fwhats-new-in-java-9%2F"><div class="er es mf"><img src="../Images/af8c88d835e30f28ee98dccb37c0c2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*uK8GJmWMaY7ob8O4.jpg"/></div></a></figure><p id="828b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这个方法被重载来创建最多10个键-值对的映射，但是如果您需要一个更大的映射，那么您应该使用<code class="du kc kd ke kf b">Map.ofEntries()</code>方法。</p><p id="94fe" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对了，你知道这个功能是怎么实现的吗？以及为什么之前没有？</p><p id="182c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果你看一下JDK 9代码或者Javadocs，那么你会发现这个特性是通过在Java集合框架的关键接口上添加静态工厂方法来实现的，比如<code class="du kc kd ke kf b">List</code>、<code class="du kc kd ke kf b">Set</code>和<code class="du kc kd ke kf b">Map</code>。</p><p id="6396" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这在JDK 8之前是不可能的，因为在接口上添加一个方法意味着破坏它所有的客户端——而且接口上不允许静态方法。随着接口上<a class="ae kb" href="http://javarevisited.blogspot.sg/2014/07/default-defender-or-extension-method-of-Java8-example-tutorial.html#axzz560Mbbw3w" rel="noopener ugc nofollow" target="_blank">默认</a>和<a class="ae kb" href="http://javarevisited.blogspot.sg/2013/11/difference-between-static-vs-non-static-method-java.html#axzz560Mbbw3w" rel="noopener ugc nofollow" target="_blank">静态方法</a>的引入，Java 8中的情况发生了变化，这为评估JDK API铺平了道路。</p><p id="f6a0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我希望将来会有更多类似的魅力，让使用JDK API变得更加容易。</p><p id="6b9d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">此外，适用于不同集合使用的规则在使用这些工厂方法时也适用(正如您所期望的)。</p><p id="1f77" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">因此，在创建集合时不能传递重复的元素，因为<em class="mg">集合不允许重复</em>。</p><p id="f497" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">类似地，创建映射时不能传递重复键，因为映射不允许重复键。如果你这样做，那么一个<code class="du kc kd ke kf b">IllegalArgumentException </code>将被抛出</p><p id="cf9b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">此外，您不能将一个<code class="du kc kd ke kf b">null </code>值传递给集合工厂方法。</p><p id="eb5e" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">以上就是关于<strong class="jh hj">如何在Java 9 </strong>中创建不可变列表、集合和映射的全部内容。集合上的静态方法确实使得使用Java集合API变得更加容易，至少它现在类似于<a class="ae kb" rel="noopener" href="/javarevisited/top-5-courses-to-learn-kotlin-in-2020-dfc3fa7706d8"> Kotlin </a>或<a class="ae kb" rel="noopener" href="/javarevisited/6-best-resources-to-learn-groovy-and-grails-for-java-developers-18c04e88fa8a"> Groovy </a>所提供的。JDK 9充满了这些有用的特性，请继续关注更多这样的文章。</p><p id="85fc" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您迫不及待，请查看Java 9中的新特性<a class="ae kb" href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=562016.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fwhats-new-in-java-9%2F" rel="noopener ugc nofollow" target="_blank">——模块和更多 </a>，它很好地概述了JDK 9的所有特性。</p><p id="9cf4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">其他<strong class="jh hj">文章你可能喜欢</strong>探索<br/> <a class="ae kb" href="https://javarevisited.blogspot.com/2019/10/the-java-developer-roadmap.html" rel="noopener ugc nofollow" target="_blank">完整的Java开发者路线图</a><br/><a class="ae kb" href="http://javarevisited.blogspot.sg/2017/12/10-things-java-programmers-should-learn.html#axzz53ENLS1RB" rel="noopener ugc nofollow" target="_blank">Java和Web开发者应该学习的10件事</a><br/><a class="ae kb" href="http://javarevisited.blogspot.sg/2018/01/10-unit-testing-and-integration-tools-for-java-programmers.html" rel="noopener ugc nofollow" target="_blank">Java开发者应该知道的10个测试工具</a> <br/> <a class="ae kb" href="http://javarevisited.blogspot.sg/2018/04/top-5-java-frameworks-to-learn-in-2018_27.html" rel="noopener ugc nofollow" target="_blank"> 5个框架Java开发者应该学习的5门课程</a> <br/> <a class="ae kb" href="http://javarevisited.blogspot.sg/2017/12/top-5-courses-to-learn-big-data-and.html" rel="noopener ugc nofollow" target="_blank">学习Java中的大数据和Apache Spark</a><br/><a class="ae kb" href="https://javarevisited.blogspot.com/2018/09/10-devops-courses-for-experienced-java-developers.html" rel="noopener ugc nofollow" target="_blank">10门课程学习DevOps for Java开发者</a> <br/> <a class="ae kb" href="http://www.java67.com/2018/02/10-books-java-developers-should-read-in.html" rel="noopener ugc nofollow" target="_blank"> 10本书 </a><br/><a class="ae kb" href="http://javarevisited.blogspot.sg/2017/03/10-tools-used-by-java-programming-Developers.html#axzz55lrMRnNC" rel="noopener ugc nofollow" target="_blank">Java开发人员在日常工作中使用的10个工具</a> <br/> <a class="ae kb" href="https://javarevisited.blogspot.com/2018/05/10-tips-to-become-better-java-developer.html" rel="noopener ugc nofollow" target="_blank">成为更好的Java开发人员的10个技巧</a> <br/> <a class="ae kb" rel="noopener" href="/javarevisited/top-10-frameworks-full-stack-java-developers-can-learn-in-2020-5995021401e5"> 10个框架全栈Java开发人员应该学习的</a> <br/> <a class="ae kb" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-spring-framework-for-java-developers-639db9348d25">我最喜欢的免费课程学习Spring framework</a><br/><a class="ae kb" rel="noopener" href="/javarevisited/10-advanced-spring-boot-courses-for-experienced-java-developers-5e57606816bd?source=collection_home---4------0-----------------------">Java开发人员的10门高级Spring Boot课程</a></p><p id="0a25" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">感谢阅读这篇文章！如果你喜欢这篇文章，那么请分享给你的朋友和同事。此外，如果您有任何问题或反馈，请在下面的评论中留言！</p><div class="kq kr ez fb ks kt"><a rel="noopener follow" target="_blank" href="/javarevisited/top-5-java-online-courses-for-beginners-best-of-lot-1e1e240a758"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">深入学习Java的10大课程</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">如果你是计算机科学专业的毕业生，或者想学习Java并且正在寻找一些很棒的资源，比如…</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">medium.com</p></div></div><div class="lc l"><div class="mh l le lf lg lc lh jd kt"/></div></div></a></div><div class="kq kr ez fb ks kt"><a rel="noopener follow" target="_blank" href="/javarevisited/these-are-the-highest-paying-tech-jobs-programmers-can-aim-to-increase-their-pay-c59e1eeb6904"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">这些是薪酬最高的技术工作，程序员可以提高他们的薪酬</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">以及获得这些工作所需技能的资源链接</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">medium.com</p></div></div><div class="lc l"><div class="mi l le lf lg lc lh jd kt"/></div></div></a></div><div class="kq kr ez fb ks kt"><a rel="noopener follow" target="_blank" href="/javarevisited/top-10-free-courses-to-learn-maven-jenkins-and-docker-for-java-developers-51fa7a1e66f6"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">Java开发人员学习Maven、Jenkins和Docker的10大免费课程</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">Maven和Jenkins是Java世界中最流行的两个工具。Maven帮助组织您的项目并提供…</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">medium.com</p></div></div><div class="lc l"><div class="mj l le lf lg lc lh jd kt"/></div></div></a></div></div></div>    
</body>
</html>