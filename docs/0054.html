<html>
<head>
<title>JVM WebService in 10MB? - Micronaut Microservice Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10MB 的 JVM WebService？- Micronaut 微服务示例</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/jvm-webservice-in-10mb-micronaut-microservice-example-749755976680?source=collection_archive---------0-----------------------#2019-04-21">https://medium.com/javarevisited/jvm-webservice-in-10mb-micronaut-microservice-example-749755976680?source=collection_archive---------0-----------------------#2019-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="12c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">如果你正在使用 Spring Boot 开发微服务，你应该知道每次 JVM 启动需要多少时间。在这个无服务器技术的新时代，人们正在谈论在几毫秒甚至更短的时间内产生新的服务器，让我们看看如何利用 Micronaut 及其 CLI 来创建运行在&lt; 10MB 内存中的高效微服务。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/bfe7afd3af960aca543b9b93b8418a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tIQuPxb4NxhWWW5EUese9w.png"/></div></div></figure><p id="148d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://micronaut.io" rel="noopener ugc nofollow" target="_blank"> Micronaut </a> —是由 Graeme Rocher 和他的团队【OCI<a class="ae jq" href="https://objectcomputing.com" rel="noopener ugc nofollow" target="_blank">的团队构建了 Grails 框架】创建的开源框架</a></p><h1 id="bdf7" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">证明文件</h1><p id="37cb" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我花更多的时间阅读文档，而不是查看实际的实现代码。Micronaut 文档对于一个非常新的框架来说是非常优秀的，它有大量的文档，其中还内置了反馈。虽然大多数特性几乎与 Spring Boot 的<a class="ae jq" href="http://www.java67.com/2019/01/top-5-spring-boot-annotations-java-programmers-should-know.html" rel="noopener ugc nofollow" target="_blank">相似，但 Micronaut 直接使用 JSR 的规范作为其实现模式。</a></p><h1 id="a071" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">准时到提前</h1><p id="b925" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">Micronaut 与当前版本的 Spring Boot(撰写本文时为 2.1+版本)的不同之处在于更快的启动时间。大多数不再使用 JVM 语言的开发人员抱怨内存占用和体系结构会大大降低 JVM 的性能。</p><p id="d4cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Android 平台通过利用提前编译(AOC 参考—<a class="ae jq" href="https://www.infoq.com/news/2014/07/ahead-of-time-compiler-os" rel="noopener ugc nofollow" target="_blank">InfoQ</a>2014 年 7 月)解决了更快的启动时间，这为他们的应用程序实现超级快速的启动时间铺平了道路。</p><p id="4eff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Micronaut 使用 AOC，这为无服务器的未来创造了使用 Java 框架的新的有效方法。</p><h1 id="b43e" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">命令行界面(CLI)</h1><p id="4073" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">更不用说来自<code class="du ku kv kw kx b">grails-cli</code>的灵感了，<code class="du ku kv kw kx b">micronaut-cli</code>提供了丰富的特性来创建控制器、beans 和模型类，以及它们对应的自动生成测试代码的测试类——几乎解决了大多数框架遗漏的测试代码生成问题。</p><h2 id="6f74" class="ky js hi bd jt kz la lb jx lc ld le kb iq lf lg kf iu lh li kj iy lj lk kn ll bi translated">装置</h2><p id="b7e7" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">如果您使用的是 Mac，请遵循此处<a class="ae jq" href="https://docs.micronaut.io/latest/guide/index.html#installHomebrew" rel="noopener ugc nofollow" target="_blank">的步骤</a> <br/>如果您使用的是基于 Unix 的系统，请遵循此处<a class="ae jq" href="https://docs.micronaut.io/latest/guide/index.html#installSdkman" rel="noopener ugc nofollow" target="_blank">的步骤</a>。<br/>如果您使用的是 Windows，请从<a class="ae jq" href="https://docs.micronaut.io/latest/guide/index.html#installWindows" rel="noopener ugc nofollow" target="_blank">开始执行步骤</a> <br/>一旦安装完毕，<code class="du ku kv kw kx b">cli </code>就可以作为<code class="du ku kv kw kx b">mn</code>引用</p><h2 id="d4b2" class="ky js hi bd jt kz la lb jx lc ld le kb iq lf lg kf iu lh li kj iy lj lk kn ll bi translated">用法(mn 帮助)</h2><pre class="jf jg jh ji fd lm kx ln lo aw lp bi"><span id="ff50" class="ky js hi kx b fi lq lr l ls lt">create-app<!-- --> — Creates an application<br/>create-cli-app<!-- --> — Creates a command line application<br/>create-federation<!-- --> — Creates a federation of services<br/>create-function<!-- --> — Creates a serverless function application<br/>create-profile<!-- --> — Creates a profile</span></pre><h1 id="9b38" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">创建我们的第一个微机器人服务</h1><p id="0d3c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">使用<code class="du ku kv kw kx b">micronaut cli</code>，让我们开始创建第一个<code class="du ku kv kw kx b">micronaut </code>应用程序。</p><p id="7b9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">mn create-app micronaut-example</code></p><p id="fb38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到一个名为<code class="du ku kv kw kx b">micronaut-example</code>的新文件夹，其结构如下:</p><pre class="jf jg jh ji fd lm kx ln lo aw lp bi"><span id="6c8f" class="ky js hi kx b fi lq lr l ls lt"><a class="ae jq" href="/Users/apple/Downloads/micronaut-example" rel="noopener ugc nofollow" target="_blank">micronaut-example</a><br/>├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/Dockerfile" rel="noopener ugc nofollow" target="_blank">Dockerfile</a><br/>├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/build.gradle" rel="noopener ugc nofollow" target="_blank">build.gradle</a><br/>├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/gradle/" rel="noopener ugc nofollow" target="_blank">gradle</a><br/>│   └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/gradle/wrapper/" rel="noopener ugc nofollow" target="_blank">wrapper</a><br/>│       ├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/gradle/wrapper/gradle-wrapper.jar" rel="noopener ugc nofollow" target="_blank">gradle-wrapper.jar</a><br/>│       └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/gradle/wrapper/gradle-wrapper.properties" rel="noopener ugc nofollow" target="_blank">gradle-wrapper.properties</a><br/>├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/gradlew" rel="noopener ugc nofollow" target="_blank">gradlew</a><br/>├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/gradlew.bat" rel="noopener ugc nofollow" target="_blank">gradlew.bat</a><br/>├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/micronaut-cli.yml" rel="noopener ugc nofollow" target="_blank">micronaut-cli.yml</a><br/>└── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/" rel="noopener ugc nofollow" target="_blank">src</a><br/>    ├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/main/" rel="noopener ugc nofollow" target="_blank">main</a><br/>    │   ├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/main/java/" rel="noopener ugc nofollow" target="_blank">java</a><br/>    │   │   └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/main/java/micronaut/" rel="noopener ugc nofollow" target="_blank">micronaut</a><br/>    │   │       └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/main/java/micronaut/example/" rel="noopener ugc nofollow" target="_blank">example</a><br/>    │   │           └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/main/java/micronaut/example/Application.java" rel="noopener ugc nofollow" target="_blank">Application.java</a><br/>    │   └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/main/resources/" rel="noopener ugc nofollow" target="_blank">resources</a><br/>    │       ├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/main/resources/application.yml" rel="noopener ugc nofollow" target="_blank">application.yml</a><br/>    │       └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/main/resources/logback.xml" rel="noopener ugc nofollow" target="_blank">logback.xml</a><br/>    └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/test/" rel="noopener ugc nofollow" target="_blank">test</a><br/>        └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/test/java/" rel="noopener ugc nofollow" target="_blank">java</a><br/>            └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/test/java/micronaut/" rel="noopener ugc nofollow" target="_blank">micronaut</a><br/>                └── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/src/test/java/micronaut/example/" rel="noopener ugc nofollow" target="_blank">example</a></span></pre><p id="eb4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下 cli 使用<a class="ae jq" href="http://www.java67.com/2018/04/10-tools-java-developers-should-learn.html" rel="noopener ugc nofollow" target="_blank"> Gradle </a>，如果你想使用<a class="ae jq" href="http://www.java67.com/2018/02/6-free-maven-and-jenkins-online-courses-for-java-developers.html" rel="noopener ugc nofollow" target="_blank"> Maven </a>作为构建工具，你可以使用<code class="du ku kv kw kx b">mn create-app micronaut-example --build maven</code></p><p id="2459" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您进入项目目录，cli 就会变成 micronaut 项目特定的 cli，并提供不同的选项(<code class="du ku kv kw kx b">mn help</code>或<code class="du ku kv kw kx b">mn --help</code>):</p><pre class="jf jg jh ji fd lm kx ln lo aw lp bi"><span id="5325" class="ky js hi kx b fi lq lr l ls lt">create-bean - Creates a singleton bean<br/>create-job - Creates a job with scheduled method<br/>create-client - Creates a client interface<br/>create-controller - Creates a controller and associated test<br/>create-websocket-client - Creates a Websocket client<br/>create-websocket-server - Creates a Websocket server</span></pre><p id="c77f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建一个新的控制器来公开一个 Hello REST 端点</p><p id="1d73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">mn create-controller HelloController</code></p><p id="9ca2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，创建了 2 个类</p><pre class="jf jg jh ji fd lm kx ln lo aw lp bi"><span id="f1ed" class="ky js hi kx b fi lq lr l ls lt">src/main/java/micronaut/example/HelloController.java<br/>src/test/java/micronaut/example/HelloControllerTest.java</span></pre><p id="0319" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">HelloController.java</code>和<code class="du ku kv kw kx b">HelloControllerTest.java</code>的内容如下:</p><pre class="jf jg jh ji fd lm kx ln lo aw lp bi"><span id="cff9" class="ky js hi kx b fi lq lr l ls lt">package micronaut.example;</span><span id="6c9d" class="ky js hi kx b fi lu lr l ls lt">import io.micronaut.http.annotation.Controller;<br/>import io.micronaut.http.annotation.Get;<br/>import io.micronaut.http.HttpStatus;</span><span id="ecad" class="ky js hi kx b fi lu lr l ls lt">@Controller(“/hello”)<br/>public class HelloController {</span><span id="d959" class="ky js hi kx b fi lu lr l ls lt">@Get(“/”)<br/>public HttpStatus index() {<br/>   return HttpStatus.OK;<br/>  }<br/>}</span></pre></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><pre class="lm kx ln lo aw lp bi"><span id="9703" class="ky js hi kx b fi mc md me mf mg lr l ls lt">package micronaut.example;</span><span id="3bef" class="ky js hi kx b fi lu lr l ls lt">import io.micronaut.context.ApplicationContext;<br/>import io.micronaut.http.HttpStatus;<br/>import io.micronaut.http.client.RxHttpClient;<br/>import io.micronaut.runtime.server.EmbeddedServer;<br/>import org.junit.Test;</span><span id="7760" class="ky js hi kx b fi lu lr l ls lt">import static org.junit.Assert.assertEquals;</span><span id="3dee" class="ky js hi kx b fi lu lr l ls lt">public class HelloControllerTest {</span><span id="3d6e" class="ky js hi kx b fi lu lr l ls lt">   @Test<br/>   public void testIndex() throws Exception {<br/>     try(EmbeddedServer server = ApplicationContext.run(EmbeddedServer.class)) {<br/>         try(RxHttpClient client = server.getApplicationContext().createBean(RxHttpClient.class, server.getURL())) {</span><span id="d118" class="ky js hi kx b fi lu lr l ls lt">              assertEquals(HttpStatus.OK, client.toBlocking().exchange("/hello").status());</span><span id="04e8" class="ky js hi kx b fi lu lr l ls lt">         }<br/>     }<br/>   }<br/>}</span></pre><p id="f47a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似于<a class="ae jq" href="http://www.java67.com/2018/06/5-best-courses-to-learn-spring-boot-in.html" rel="noopener ugc nofollow" target="_blank"> Spring Boot </a>，我们可以通过简单地使用<code class="du ku kv kw kx b">./gradlew clean build</code>构建项目来创建 fat jars。在构建目录下，您可以找到 2 个不同的 jar。</p><pre class="jf jg jh ji fd lm kx ln lo aw lp bi"><span id="5c62" class="ky js hi kx b fi lq lr l ls lt"><a class="ae jq" href="/Users/apple/Downloads/micronaut-example/build/libs" rel="noopener ugc nofollow" target="_blank">micronaut-example/build/libs</a><br/>├── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/build/libs/micronaut-example-0.1-all.jar" rel="noopener ugc nofollow" target="_blank">micronaut-example-0.1-all.jar</a><br/>└── <a class="ae jq" href="/Users/apple/Downloads/micronaut-example/build/libs/micronaut-example-0.1.jar" rel="noopener ugc nofollow" target="_blank">micronaut-example-0.1.jar</a></span></pre><p id="aa99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">micronaut-example-0.1-all.jar</code>具备启动示例服务器所需的所有条件。</p><p id="ea48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用下面的命令<br/> <code class="du ku kv kw kx b">java -Xmx10M -jar micronaut-example-0.1-all.jar</code>启动内存为 10MB 的 JVM</p><p id="1c70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到服务器在<code class="du ku kv kw kx b"><a class="ae jq" href="http://localhost:8080/." rel="noopener ugc nofollow" target="_blank">http://localhost:8080/</a></code>启动并运行。如果要使用不同的端口，请使用属性对其进行配置。</p><h1 id="4e13" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">使用 JConsole 的虚拟机图</h1><p id="9b12" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">使用 JConsole，让我们连接到 Micronaut JVM，先睹为快堆的大小。<code class="du ku kv kw kx b">jconsole</code>与 OpenJDK 打包在一起，可以直接从<code class="du ku kv kw kx b">java/bin</code>文件夹启动。</p><p id="705d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 JConsole 启动期间，我们需要选择需要连接的 JVM 进程。在我们的例子中，选择 micronaut JVM。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mh"><img src="../Images/8731149029acedc1b6434bfe4a450515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*xRg3mwE9ArkraSTR4-bObQ.png"/></div><p class="mi mj et er es mk ml bd b be z dx translated">JConsole 启动屏幕</p></figure><p id="4e3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦连接上，我们可以看到<a class="ae jq" href="http://www.java67.com/2016/08/10-jvm-options-for-java-production-application.html" rel="noopener ugc nofollow" target="_blank"> JVM </a>的堆图的大小——它的内存不到 9Mb！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mm"><img src="../Images/efcff8ebdeca2de7d6f32b1559810d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n6GVkTusmiHXhBc9gU4wLA.png"/></div></div><p class="mi mj et er es mk ml bd b be z dx translated">Micronaut JVM 的堆大小</p></figure><h1 id="81b8" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">将来的</h1><p id="b97d" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">有了 Spring 社区创建的强大生态系统，很难用这些新框架来颠覆企业世界。我对微型机器人的未来充满希望。我正在等待其他框架(尤其是 Spring)采用提前编译来减少启动时间。</p><p id="ee89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">本文根据我在</em><a class="ae jq" href="https://www.youtube.com/TechPrimers" rel="noopener ugc nofollow" target="_blank"><em class="jd">tech primers</em></a>中同一主题的 <a class="ae jq" href="https://www.youtube.com/watch?v=YYvY9pc3Shw" rel="noopener ugc nofollow" target="_blank"> <em class="jd"> youtube 视频</em> </a> <em class="jd"/></p></div></div>    
</body>
</html>