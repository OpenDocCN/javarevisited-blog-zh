<html>
<head>
<title>Introducing KoolKits — OSS Debugging Toolkits for Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes的KoolKits——OSS调试工具包简介</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/introducing-koolkits-oss-debugging-toolkits-for-kubernetes-296b000990ea?source=collection_archive---------1-----------------------#2022-03-01">https://medium.com/javarevisited/introducing-koolkits-oss-debugging-toolkits-for-kubernetes-296b000990ea?source=collection_archive---------1-----------------------#2022-03-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c11a51aa367f158c4ff640e257eb0491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3YYNZu1yWZgWbJRMRfd97g.png"/></div></div></figure><p id="53f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">KoolKits(<strong class="is hj">K</strong>ubernetes t<strong class="is hj">ool kits</strong>)是高度固执己见的、特定于语言的、包含调试容器镜像的电池，用于Kubernetes 。在实践中，如果您在一个不熟悉的shell中进行艰难的调试会话时遇到困难，那么您应该在生产pod上安装它们。</p><p id="1ee0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简单介绍一下背景，请注意这些容器图像旨在与新的<code class="du jp jq jr js b"><a class="ae jo" href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-running-pod/#ephemeral-container" rel="noopener ugc nofollow" target="_blank">kubectl debug</a></code> <a class="ae jo" href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-running-pod/#ephemeral-container" rel="noopener ugc nofollow" target="_blank">功能</a>一起使用，该功能会启动<a class="ae jo" href="https://kubernetes.io/docs/concepts/workloads/pods/ephemeral-containers/" rel="noopener ugc nofollow" target="_blank">临时容器</a>进行交互式故障排除。KoolKit将由<code class="du jp jq jr js b">kubectl debug</code>拉出，作为pod中的一个容器，并且能够访问与原始容器相同的进程名称空间。</p><p id="e316" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为生产容器通常是<a class="ae jo" href="https://cloud.google.com/architecture/best-practices-for-building-containers#remove_unnecessary_tools" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">而不是</strong> </a>光秃秃的，所以使用KoolKit可以让您<strong class="is hj">使用电动工具</strong>进行故障排除，而不是依赖由于最初构建生产映像的人的慷慨(或粗心)而留下的东西。</p><p id="9161" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个KoolKit中的工具都是精心挑选的，你可以在下面的中阅读更多关于整个项目背后的动机。</p><p id="7846" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你只是想看看好东西，可以在GitHub 上查看完整的项目<a class="ae jo" href="https://github.com/lightrun-platform/koolkits" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="bbe0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">调试Kubernetes很难</h1><p id="1596" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">了解Kubernetes pod内部的情况并不容易。</p><p id="bbc7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，您的应用程序不再是一个单一的实体——它由多个单元组成，为水平扩展而复制，有时甚至分散在多个集群中。</p><p id="bb11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，要使用本地工具(如调试器)访问您的应用程序，您需要处理讨厌的网络问题，如发现和端口转发，这会降低此类工具的使用速度。</p><p id="73e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">而且，分布式系统世界的皇冠上的宝石——改变正在运行的pod的状态或完全停止它(例如，当放置一个<a class="ae jo" href="https://javarevisited.blogspot.com/2011/07/java-debugging-tutorial-example-tips.html#axzz6bYzaddcE" rel="noopener ugc nofollow" target="_blank">断点</a>时)可能会导致系统的其他部分发生级联故障，这将加剧现有的问题。</p><h1 id="610f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">KoolKits背后的动机</h1><p id="b112" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">Lightrun在构建时就考虑到了Kubernetes我们在多个pod、多个集群甚至多个云中工作。我们很早就明白，通过使用正确的工具来打包一个punch对于故障排除开发人员来说是一个巨大的动力来源——我们认为我们会以某种方式找到一种方法来回报社区——这就是我们如何想到KoolKits的想法。</p><p id="4222" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们深入一下，解释一下为什么KoolKits非常有用:</p><p id="1b19" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有一个<a class="ae jo" href="https://cloud.google.com/blog/products/containers-kubernetes/kubernetes-best-practices-how-and-why-to-build-small-container-images" rel="noopener ugc nofollow" target="_blank">众所周知的Kubernetes最佳实践</a>指出应该构建<strong class="is hj">小型</strong>容器映像。出于几个不同的原因，这是有意义的:</p><ol class=""><li id="6899" class="kw kx hi is b it iu ix iy jb ky jf kz jj la jn lb lc ld le bi translated">构建映像将消耗更少的资源(即CI工时)</li><li id="c9cb" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated">拉图片将花费更少的时间(谁愿意为这么多的入口付费呢？)</li><li id="9810" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated">更少的东西意味着暴露于安全漏洞的表面区域更少，在这个<a class="ae jo" href="https://en.wikipedia.org/wiki/Log4Shell" rel="noopener ugc nofollow" target="_blank">世界中，甚至无操作日志记录都不再安全</a></li></ol><p id="6a63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">也有很多工具可以帮助您不需要做太多繁重的工作就能达到目的:</p><ol class=""><li id="f8ef" class="kw kx hi is b it iu ix iy jb ky jf kz jj la jn lb lc ld le bi translated"><a class="ae jo" href="https://hub.docker.com/_/alpine" rel="noopener ugc nofollow" target="_blank"> Alpine Linux </a>基础映像超级小</li><li id="0ab4" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated"><a class="ae jo" href="https://github.com/GoogleContainerTools/distroless" rel="noopener ugc nofollow" target="_blank">disloses Docker images</a>更进一步，删除除运行时之外的所有内容</li><li id="0ab8" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated"><a class="ae jo" href="https://docs.docker.com/develop/develop-images/multistage-build/" rel="noopener ugc nofollow" target="_blank"> Docker多阶段构建</a>帮助创建精简的最终产品映像</li></ol><p id="34bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您试图调试这些容器中发生的事情时，问题就出现了。通过使用一个小的产品映像，你就放弃了大量的工具，而这些工具在你思考应用程序中的问题时是非常有价值的。</p><p id="c2e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过使用KoolKit，您可以在不牺牲工具质量的情况下享受小型产品映像的好处——每个KoolKit都包含针对它所代表的特定运行时精心挑选的工具，此外还有一组针对基于Linux的系统的更通用的工具。</p><p id="410a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lk"> P.S. KoolKits的灵感来源于</em> <code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/huazhihao/kubespy" rel="noopener ugc nofollow" target="_blank"><em class="lk">kubespy</em></a></code> <em class="lk">和</em> <code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/nicolaka/netshoot" rel="noopener ugc nofollow" target="_blank"><em class="lk">netshoot</em></a></code> <em class="lk">。</em></p><h1 id="f5a9" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">考虑</h1><p id="8993" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">在构建这些图像的过程中，我们做了很多决定——下面列出了我们考虑的一些事情。</p><h1 id="3ab2" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">图像尺寸</h1><p id="4463" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">KoolKits Docker图像倾向于运行，嗯，而不是<strong class="is hj">大</strong>。</p><p id="dd2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">KoolKits旨在下载一次，保存在集群的Docker注册表中，然后根据需要立即作为容器启动。因为它们不是用来持续拉动的，因为它们是用来装满好吃的东西的，这是我们愿意忍受的副作用。</p><h1 id="de71" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用Ubuntu基本图像</h1><p id="bbce" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">很难创建一个真正苗条的图像的部分原因是因为我们决定使用完整的Ubuntu 20.04系统作为每个KoolKit的基础。这主要是因为我们希望在集群内部复制与本地调试相同的环境。</p><p id="437c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，这意味着不要用Alpine替代你习惯使用的普通Ubuntu包。实际上，这意味着我们有办法在每个KoolKit中包含没有Alpine版本的工具。</p><h1 id="0324" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用语言版本管理器</h1><p id="f11b" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">每个KoolKit都(尽可能地)使用语言版本管理器，而不是依赖于特定语言的发行版。这样做是为了让您能够轻松地安装旧的运行时版本，并且允许您根据需要在运行时版本之间随意切换(例如，为了获得只针对特定运行时版本而存在的工具的特定版本)。</p><h1 id="e00d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">可用的KoolKits</h1><p id="cce0" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">repo中的每个文件夹都包含KoolKit后面的docker文件和调试映像的简短说明。所有的怪人都是基于<code class="du jp jq jr js b"><a class="ae jo" href="https://hub.docker.com/layers/ubuntu/library/ubuntu/20.04/images/sha256-57df66b9fc9ce2947e434b4aa02dbe16f6685e20db0c170917d4a1962a5fe6a9?context=explore" rel="noopener ugc nofollow" target="_blank">ubuntu:20.04</a></code>的基础形象，因为真实的人需要真实的贝壳。</p><p id="bbe2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可用的KoolKits列表:</p><ol class=""><li id="2d6c" class="kw kx hi is b it iu ix iy jb ky jf kz jj la jn lb lc ld le bi translated"><code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/lightrun-platform/koolkits/blob/main/jvm/README.md" rel="noopener ugc nofollow" target="_blank">koolkit-jvm</a></code>–采用OpenJDK 17.0.2 &amp;相关工具(包括<code class="du jp jq jr js b">jabba</code>便于版本管理和Maven 3.8.4)</li><li id="b66d" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated"><code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/lightrun-platform/koolkits/blob/main/node/README.MD" rel="noopener ugc nofollow" target="_blank">koolkit-node</a></code>–节点16.13.1 &amp;相关工具(包括<code class="du jp jq jr js b">nvm</code>以方便版本管理)</li><li id="fe20" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated"><code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/lightrun-platform/koolkits/blob/main/python/README.md" rel="noopener ugc nofollow" target="_blank">koolkit-python</a></code>–Python 3 . 10 . 2&amp;相关工具(包括<code class="du jp jq jr js b">pyenv</code>，方便版本管理)</li></ol><p id="89c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，您实际上不必自己构建它们——所有的KoolKits都在<a class="ae jo" href="https://hub.docker.com/repository/docker/lightruncom/koolkits" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>上公开托管，并且免费提供。</p><h1 id="ee8a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">KoolKits来了</h1><ul class=""><li id="094b" class="kw kx hi is b it kr ix ks jb ll jf lm jj ln jn lo lc ld le bi translated">全新的，Go 1.17.7 KoolKit</li><li id="32a3" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lo lc ld le bi translated">JVM KoolKit — <code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/uber-common/jvm-profiler" rel="noopener ugc nofollow" target="_blank">jvm-profiler</a></code>，<code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/giltene/jHiccup" rel="noopener ugc nofollow" target="_blank">jHiccup</a></code>支持</li><li id="3fb3" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lo lc ld le bi translated">Node.js KoolKit — <code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/nodejs/llnode" rel="noopener ugc nofollow" target="_blank">llnode</a></code>，<code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/sfninja/thetool" rel="noopener ugc nofollow" target="_blank">thetool</a></code>支持</li><li id="2f9d" class="kw kx hi is b it lf ix lg jb lh jf li jj lj jn lo lc ld le bi translated">Python KoolKit — <code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/CCExtractor/vardbg" rel="noopener ugc nofollow" target="_blank">vardbg</a></code>，<code class="du jp jq jr js b"><a class="ae jo" href="https://github.com/jmdana/memprof" rel="noopener ugc nofollow" target="_blank">memprof</a></code>支持</li></ul><h1 id="489d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">贡献</h1><p id="d62c" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">我们非常乐意为任何图像添加我们遗漏的工具——只需<a class="ae jo" href="https://github.com/lightrun-platform/koolkits/pulls" rel="noopener ugc nofollow" target="_blank">打开一个拉取请求</a>或<a class="ae jo" href="https://github.com/lightrun-platform/koolkits/issues" rel="noopener ugc nofollow" target="_blank">一个问题</a>来建议一个。</p></div></div>    
</body>
</html>