<html>
<head>
<title>Javax Validation and groups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Javax验证和组</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/javax-validation-and-groups-acd9a1fb1091?source=collection_archive---------0-----------------------#2021-03-16">https://medium.com/javarevisited/javax-validation-and-groups-acd9a1fb1091?source=collection_archive---------0-----------------------#2021-03-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8e5311d5d9d414631ebf2678470c1856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZM6nklC0SAuzo9V3"/></div></div><p class="iq ir et er es is it bd b be z dx translated">米歇尔·勒恩斯在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="35ce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">简而言之，Javax验证使用两组主要注释</p><ul class=""><li id="3d2a" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">确保验证发生的注释，如<strong class="ix hj"><em class="kc">@有效</em> </strong>或<em class="kc">@有效</em></li><li id="da22" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated">注释，表示要对值强制执行的约束类型，如<strong class="ix hj"> <em class="kc"> @NotNull </em> </strong>，<strong class="ix hj"> <em class="kc"> @Pattern </em> </strong></li></ul><p id="0e85" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们在项目中不使用Spring框架，hibernate validator将是JSR验证规范最常见的实现。</p><h2 id="efaa" class="ki kj hi bd kk kl km kn ko kp kq kr ks jg kt ku kv jk kw kx ky jo kz la lb lc bi translated">@Valid和@Validated是如何工作的？</h2><p id="9d4f" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">当一个参数用<strong class="ix hj"> <em class="kc"> @Valid </em> </strong>注释时，Java会知道这个对象需要被验证，类内部声明的所有约束都会被求值。</p><p id="c9e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们使用一个具有很少约束的简单模型，如<strong class="ix hj"> <em class="kc"> @NotEmpty，@Min </em> </strong>定义的:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="6a4f" class="ki kj hi ln b fi lr ls l lt lu">package com.mimr.model;</span><span id="9b82" class="ki kj hi ln b fi lv ls l lt lu">import com.fasterxml.jackson.annotation.JsonCreator;<br/>import com.fasterxml.jackson.annotation.JsonProperty;</span><span id="cf4a" class="ki kj hi ln b fi lv ls l lt lu">import javax.validation.constraints.*;</span><span id="36b8" class="ki kj hi ln b fi lv ls l lt lu">public class Word {</span><span id="cd25" class="ki kj hi ln b fi lv ls l lt lu">    @NotEmpty<br/>    private String id;<br/>    private Language language;<br/>    @NotEmpty<br/>    @Size(min = 1)<br/>    private String originalWord;<br/>    private String translatedWord;<br/>    @Email<br/>    private String addedBy;</span><span id="8215" class="ki kj hi ln b fi lv ls l lt lu">    @JsonCreator<br/>    public Word(@JsonProperty("id") String id,<br/>                @JsonProperty("language") Language language,<br/>                @JsonProperty("originalWord") String originalWord,<br/>                @JsonProperty("translatedWord") String translatedWord,<br/>                @JsonProperty("addedBy") String addedBy) {<br/>        this.id = id;<br/>        this.language = language;<br/>        this.originalWord = originalWord;<br/>        this.translatedWord = translatedWord;<br/>        this.addedBy = addedBy;<br/>    }</span><span id="923e" class="ki kj hi ln b fi lv ls l lt lu">// Getters<br/>}</span></pre><p id="c7f2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了在反序列化发生时启用验证，例如当一个端点正在接收一个带有请求体的请求时，我们将用<strong class="ix hj"> <em class="kc"> @Valid </em> </strong>注释对请求体进行注释</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="1e7f" class="ki kj hi ln b fi lr ls l lt lu">package com.mimr.resource;</span><span id="2bc9" class="ki kj hi ln b fi lv ls l lt lu">import com.mimr.model.Word;</span><span id="57fa" class="ki kj hi ln b fi lv ls l lt lu">import javax.validation.Valid;<br/>import javax.ws.rs.Consumes;<br/>import javax.ws.rs.POST;<br/>import javax.ws.rs.Path;<br/>import javax.ws.rs.Produces;<br/>import javax.ws.rs.core.MediaType;<br/>import javax.ws.rs.core.Response;</span><span id="8746" class="ki kj hi ln b fi lv ls l lt lu">@Path("/api/word/")<br/>@Consumes(MediaType.<em class="kc">APPLICATION_JSON</em>)<br/>@Produces(MediaType.<em class="kc">APPLICATION_JSON</em>)<br/>public class WordResource {</span><span id="f85a" class="ki kj hi ln b fi lv ls l lt lu">    @POST<br/>    public Response createWord( @Valid Word word){<br/>        return Response.<em class="kc">ok</em>().build();<br/>    }</span></pre><p id="1564" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们向端点发出下面的请求时，我们将收到一个错误，因为请求中的“originalWord”为空。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="a73d" class="ki kj hi ln b fi lr ls l lt lu">POST /api/word/ HTTP/1.1<br/>Host: localhost:8080<br/>Content-Type: application/json</span><span id="af00" class="ki kj hi ln b fi lv ls l lt lu">{<br/>  "id": "id1",<br/>  "language": "DEUTSCH",<br/>  "originalWord": "",<br/>  "translatedWord": "Hello",<br/>  "addedBy": "<a class="ae iu" href="mailto:mrlreni@gmail.com" rel="noopener ugc nofollow" target="_blank">xyz@gmail.com</a>"<br/>}</span></pre><p id="680c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">收到以下响应:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="fbfb" class="ki kj hi ln b fi lr ls l lt lu">{"errors":["originalWord must not be empty","originalWord size must be between 1 and 2147483647"]}</span></pre><h2 id="7292" class="ki kj hi bd kk kl km kn ko kp kq kr ks jg kt ku kv jk kw kx ky jo kz la lb lc bi translated">验证组:</h2><p id="1a71" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">当我们将同一个模型用于多个操作(如创建或更新)时，我们可能希望根据需要对同一个模型进行不同的验证。</p><p id="0bd1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，如果我们想使用Word.java来创建和更新一个word对象，我们可能不想在创建它时将id字段作为强制字段。</p><p id="7aa8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里的解决方案是创建一个验证组，并使用它只对更新操作进行验证。</p><ol class=""><li id="0adc" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js lw jz ka kb bi translated"><strong class="ix hj"> <em class="kc">创建验证组:</em> </strong></li></ol><p id="0357" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">验证组只不过是一个简单的<a class="ae iu" href="https://javarevisited.blogspot.com/2012/01/what-is-marker-interfaces-in-java-and.html" rel="noopener ugc nofollow" target="_blank">标记接口</a>。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="fe07" class="ki kj hi ln b fi lr ls l lt lu">package com.mimr.validation;</span><span id="959a" class="ki kj hi ln b fi lv ls l lt lu">public interface Update {<br/>}</span></pre><p id="a650" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.<strong class="ix hj"> <em class="kc">通过用验证组</em> </strong>标记约束来更新模型</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="060b" class="ki kj hi ln b fi lr ls l lt lu">public class Word {</span><span id="9228" class="ki kj hi ln b fi lv ls l lt lu">    @NotEmpty(groups = {Update.class})<br/>    private String id;<br/>    private Language language;<br/>    <br/>//<br/>..<br/>//</span></pre><p id="5fa6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.<strong class="ix hj"> <em class="kc">使用@Validated注释有选择地强制验证</em> </strong></p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="f8dd" class="ki kj hi ln b fi lr ls l lt lu">public class WordResource {</span><span id="15ad" class="ki kj hi ln b fi lv ls l lt lu">    @POST<br/>    @Path("create")<br/>    public Response createWord( @Valid Word word){<br/>        return Response.<em class="kc">ok</em>().build();<br/>    }</span><span id="f4be" class="ki kj hi ln b fi lv ls l lt lu">    @POST<br/>    @Path("update")<br/>    public Response updateWord( @Validated(Update.class) Word word){<br/>        return Response.<em class="kc">ok</em>().build();<br/>    }</span></pre><p id="e10b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，对id的验证只针对更新操作。</p></div></div>    
</body>
</html>