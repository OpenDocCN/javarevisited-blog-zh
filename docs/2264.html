<html>
<head>
<title>4 Reasons Why You Should Use Java Optional — or Not?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么你应该选择使用Java的4个理由？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/4-reasons-why-you-should-use-java-optional-or-not-4e44d51a9645?source=collection_archive---------1-----------------------#2022-07-24">https://medium.com/javarevisited/4-reasons-why-you-should-use-java-optional-or-not-4e44d51a9645?source=collection_archive---------1-----------------------#2022-07-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1596f7601e70e286f217d978d80824e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_ji4VZdleshGrRbh41B5g.jpeg"/></div></div><p class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://ro.pinterest.com/beerdom/" rel="noopener ugc nofollow" target="_blank"> Pinterest </a>上的<a class="ae iu" href="https://ro.pinterest.com/beerdom/" rel="noopener ugc nofollow" target="_blank">马克·比尔登</a>拍摄的照片</p></figure><p id="dce5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">战斗很激烈。开发者们已经筋疲力尽了。</p><p id="0649" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">争论是双向的。每一方都有成堆的尸体躺在地上，被烧毁或倒塌。</p><p id="4a95" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">围绕电子邮件、合并请求和Zoom Calls展开了战争，但没有明显的赢家。<strong class="ix hj">让我们一劳永逸地解决可选之战吧！</strong></p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="0f3b" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">概观</h1><p id="cda2" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><strong class="ix hj">我们可以使用</strong> <a class="ae iu" href="https://javarevisited.blogspot.com/2017/04/10-examples-of-optional-in-java-8.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">可选类</strong> </a> <strong class="ix hj">包装我们的数据，避免经典的<em class="ld">空检查</em>和一些<em class="ld">试捕</em>块。</strong></p><p id="b38f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我们将能够链接方法调用，并拥有更流畅的功能性代码。</p><p id="f860" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另一方面，滥用它会导致性能下降和代码混乱。</p><p id="111c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将探索一些需要防范空值的常见用例。对于它们中的每一个，我们将决定是否可以使用<a class="ae iu" href="https://www.java67.com/2018/06/java-8-optional-example-ispresent-orElse-get.html" rel="noopener ugc nofollow" target="_blank"><em class="ld"/></a>来简化我们的代码，或者我们是否应该坚持使用<a class="ae iu" href="https://javarevisited.blogspot.com/2017/01/how-to-check-for-null-values-in-sql.html" rel="noopener ugc nofollow" target="_blank">经典的空检查</a>。</p><p id="24a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ld"> PS:对于代码片段，我们将通过以下方法使用AccountRepository类:</em></p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="31b0" class="ln kb hi lj b fi lo lp l lq lr">public <em class="ld">Account </em><strong class="lj hj">get</strong>(String username);<br/><br/>public <em class="ld">Optional&lt;Account&gt;</em> <strong class="lj hj">find</strong>(String username);</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="7fc4" class="ln kb hi bd kc ls lt lu kg lv lw lx kk jg ly lz ko jk ma mb ks jo mc md kw me bi translated">1.可选的方法返回类型👍</h2><p id="92af" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">使用Optional的一种方法是在返回之前包装数据——如果它可能为null的话。这种方式很快被<a class="ae iu" rel="noopener" href="/javarevisited/5-best-spring-data-jpa-courses-for-java-developers-45e6438be3c9"><em class="ld">springdata JPA</em></a><em class="ld">等开发者和框架采用。</em></p><p id="0778" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，调用者会意识到结果可能是空的。此外，这给了调用者一些灵活性:例如，如果可选的是空的，它允许他容易地抛出一个定制的异常。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="8163" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，<strong class="ix hj">如果我们需要对检索到的数据执行额外的检查，Optional为它提供了一个很好的API</strong>。</p><p id="bd41" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们来看一些场景，并比较这两种解决方案:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="7d16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以注意到if语句的表达式越来越长，越来越难读。对于这些用例，我们可以利用可选API中的<a class="ae iu" href="https://www.java67.com/2014/04/java-8-stream-examples-and-tutorial.html" rel="noopener ugc nofollow" target="_blank"> <em class="ld">过滤器</em>和<em class="ld">映射</em>方法</a>。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="fad2" class="ln kb hi bd kc ls lt lu kg lv lw lx kk jg ly lz ko jk ma mb ks jo mc md kw me bi translated">2.包装吸气剂👍</h2><p id="5515" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">从上面的代码片段中我们可以注意到，<em class="ld"> Account </em>类公开了一个<em class="ld">getmembershipopoptional()</em>方法。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="2807" class="ln kb hi lj b fi lo lp l lq lr">Optional&lt;Membership&gt; getMembershipOptional() {<br/>    return Optional.<em class="ld">ofNullable</em>(membership);<br/>}</span></pre><p id="e65a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ld">当然，这不是实际的getter或者membership字段。但这只是因为我对所有的例子都使用了相同的数据模型。在一个真实的项目中，我们要么有经典的getter，要么有返回可选的getter，但不能两者都有。</em></p><p id="9b24" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">从商业角度来看，让getters返回可选对于那些<em class="ld"> null </em>是有效值的字段来说是一个很好的实践。</strong></p><p id="00a1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为这将帮助我们丰富我们的领域模型，我们不应该把它应用到DTO对象。这样，我们也将避免潜在的<a class="ae iu" href="https://www.java67.com/2020/05/15-java-serialization-interview-questions-answers.html" rel="noopener ugc nofollow" target="_blank">序列化问题。</a></p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="e310" class="ln kb hi bd kc ls lt lu kg lv lw lx kk jg ly lz ko jk ma mb ks jo mc md kw me bi translated">3.为非常简单的逻辑包装局部变量👎</h2><p id="88d5" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><strong class="ix hj">在<em class="ld">可选的</em>中包装变量仅仅是为了利用其API进行简单的操作，这已经开始成为一种</strong> <a class="ae iu" href="http://javarevisited.blogspot.sg/2015/10/what-is-double-brace-initialization-in-java-example-anti-pattern.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">常见的反模式。</strong>T25】</a></p><p id="b245" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，使用Optional just来内联if语句:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="eac8" class="ln kb hi lj b fi lo lp l lq lr">Optional.<em class="ld">ofNullable</em>(account)<br/>    .ifPresent(acc -&gt; processAccount(acc));</span></pre><p id="d873" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里使用<em class="ld">可选</em>并没有带来任何价值。在这种情况下，我们应该无耻地使用<a class="ae iu" href="https://javarevisited.blogspot.com/2016/01/how-to-check-if-string-is-not-null-and-empty-in-java-example.html" rel="noopener ugc nofollow" target="_blank"> <em class="ld">经典的空值检查</em> </a>:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="41b0" class="ln kb hi lj b fi lo lp l lq lr">if (account != null) {<br/>    processAccount(account);<br/>}</span></pre><p id="8b82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们再看一个不需要使用Optional的例子:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="3968" class="ln kb hi lj b fi lo lp l lq lr">var accountType = Optional.<em class="ld">ofNullable</em>(account)<br/>    .map(acc -&gt; acc.getAccountType())<br/>    .orElse(<em class="ld">DEFAULT_ACCOUNT_TYPE</em>);</span></pre><p id="0cf8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">类似地，我们可以使用经典的if语句或三元运算符来<a class="ae iu" href="https://www.java67.com/2020/03/how-to-write-clean-code-using-java-8.html" rel="noopener ugc nofollow" target="_blank">使这段代码更具可读性</a>。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="0610" class="ln kb hi bd kc ls lt lu kg lv lw lx kk jg ly lz ko jk ma mb ks jo mc md kw me bi translated">4.可选字段和方法参数👎</h2><p id="5c58" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">Optional并不意味着用来包装类字段。这将导致在不需要的地方创建对象，如果重复使用，会导致性能下降。</p><p id="8b55" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">况且<em class="ld">可选</em>类不是<em class="ld">可序列化</em>。因此，<strong class="ix hj">具有<em class="ld">可选的</em>字段会导致序列化问题</strong>。</p><p id="5d53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，使用<em class="ld">可选</em>作为方法参数的<strong class="ix hj">也可以被认为是反模式</strong>。</p><p id="42c1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设我们有以下方法签名:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="6627" class="ln kb hi lj b fi lo lp l lq lr">createAccount(String userName, Optional&lt;Membership&gt; membership)</span></pre><p id="1dc2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果是这种情况，并且<em class="ld">成员资格</em>参数可以为空，我相信简单地用它的两个版本重载该方法会更好。</p><p id="171c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这样，我们可以在需要的地方正确地检查和验证方法的<em class="ld">成员资格</em>参数:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="a52c" class="ln kb hi lj b fi lo lp l lq lr">createAccount(String userName);<br/>createAccount(String userName, Membership membership);</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="6882" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">结论</h1><p id="b004" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">正如我们在本文中一起看到的，<em class="ld">可选的</em>类可以为我们的域模型<em class="ld">(通过getters) </em>带来表现性和一定程度的安全性。</p><p id="f4fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是，如果使用不当，会导致糟糕的设计和代码混乱。因此，开发人员都认为应该完全避免这种情况。</p><p id="0114" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我的观点是，通过在团队中建立一些<em class="ld">可靠的</em>规则和一些适当的代码审查，<em class="ld">可选的</em>对于Java开发人员来说是一个很好的特性。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/289501a5cc4276492ea7f23de79c27bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*emlPhSC9oGYjas8B"/></div></div><p class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@awmleer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡晨</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></p></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="eb9a" class="ln kb hi bd kc ls lt lu kg lv lw lx kk jg ly lz ko jk ma mb ks jo mc md kw me bi translated">资源</h2><p id="391c" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">有很多关于这个话题的文章。如果你想更深入地研究这个主题，在我看来，这里有一些最好的:</p><ul class=""><li id="4ad9" class="mi mj hi ix b iy iz jc jd jg mk jk ml jo mm js mn mo mp mq bi translated"><a class="ae iu" href="https://victorrentea.ro/blog/avoiding-null-pointer-exception/" rel="noopener ugc nofollow" target="_blank">避免NullPointerException </a> <em class="ld">作者Victor Rentea </em></li><li id="2d14" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated">迈克尔·恩斯特的可选类型 <em class="ld">再好不过了</em></li><li id="8d8a" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated">可选，所有自行车棚之母<em class="ld">斯图尔特·马克斯</em></li><li id="0240" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated">Java中可选的10个例子</li></ul><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mw mg l"/></div></figure></div></div>    
</body>
</html>