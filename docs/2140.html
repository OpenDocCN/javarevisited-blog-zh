<html>
<head>
<title>Spring Boot with AWS S3 Bucket from zero to useful</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot用AWS S3斗从零到有用</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/spring-boot-with-aws-s3-bucket-from-zero-to-useful-c0895ab26aaa?source=collection_archive---------0-----------------------#2022-05-27">https://medium.com/javarevisited/spring-boot-with-aws-s3-bucket-from-zero-to-useful-c0895ab26aaa?source=collection_archive---------0-----------------------#2022-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4817" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建和读取的实用实现。AWS云中的txt文件</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/815186eedf65c6fac568aa1a709df347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XUf_-fG-ClgQFjrx.jpeg"/></div></div></figure><p id="765c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好，今天我会留下一个关于亚马逊S3服务以及如何结合<a class="ae jp" rel="noopener" href="/javarevisited/10-advanced-spring-boot-courses-for-experienced-java-developers-5e57606816bd"> Spring Boot </a>使用的总结。这个想法是做一个关于服务和一些实际例子使用的可能性的演示。</p><h2 id="4390" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">亚马逊s3概述</h2><p id="312c" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">亚马逊简单存储服务是一个无限规模的对象存储服务。</p><p id="beb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在谈论<a class="ae jp" rel="noopener" href="/javarevisited/7-best-aws-s3-and-dynamodb-courses-for-beginners-in-2021-a8a44b6066da">亚马逊S3 </a>时有一些概念:</p><ul class=""><li id="7fdb" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">桶:这些是目录，有一个全局唯一的名字</li><li id="64eb" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">对象:这些文件有一个键，这个键是完整的路径。例如s3://my-bucket/my-file.txt</li></ul><p id="c6f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象的最大大小为5TB，如果上载大于5GB，则必须使用多部分上载。</p><ul class=""><li id="3342" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">版本控制:在时段层启用。同一个键覆盖并递增版本:1，2，3…这是对文件进行版本控制的最佳实践。<br/>在木桶的“属性”下，你可以启用这个。</li><li id="effa" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">S3还可以维护静态网站，并使它们在互联网上可用。如果返回的是HTTP 403(禁止的)，最好查看一下策略，确保它允许公共访问。</li></ul><h2 id="a554" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">S3存储类</h2><p id="9280" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated"><strong class="ih hj">亚马逊S3标准</strong></p><ul class=""><li id="5543" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">该类用于一般用途；</li><li id="65cd" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">跨多个可用性区域的99.99999999%的对象弹性；</li><li id="dda3" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">用于经常访问的数据。</li></ul><p id="6a17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">亚马逊S3标准版—不常访问</strong></p><ul class=""><li id="b3bc" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">用于访问频率较低但需要快速访问的数据；</li><li id="8fa8" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">99.99%可用性；</li><li id="b3dd" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">与S3标准相比，成本更低；</li><li id="a574" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">用于灾难恢复备份。</li></ul><p id="2d3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">亚马逊S3一区</strong></p><ul class=""><li id="2583" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">用于不经常访问的数据；</li><li id="33b4" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">它在单个AZ(可用性区域)中具有99.999999999%的耐久性；</li><li id="1dbf" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">用于存储本地数据副本或可重新创建的数据的辅助备份。</li></ul><p id="92ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">亚马逊S3冰川即时检索</strong></p><ul class=""><li id="584c" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">类用来归档东西，所以成本低；</li><li id="cc66" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">此处的数据存储时间必须至少为90天；</li><li id="7cf7" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">毫秒级恢复非常适合每季度访问一次的数据。</li></ul><p id="d198" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">亚马逊S3冰川灵活检索</strong></p><ul class=""><li id="9902" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">也是用来存档东西的类，所以成本低；</li><li id="aa19" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">这里的数据存储时间也必须至少为90天；</li><li id="9f95" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">适合一年访问1 ~ 2次，异步检索的数据；</li><li id="cff8" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">恢复时间从几分钟到几小时不等。</li></ul><p id="ccea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">亚马逊S3冰川深层档案</strong></p><ul class=""><li id="4269" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">它具有长达12小时的数据恢复时间，适用于每年可访问1至2次的数据；</li><li id="b75e" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">跨多个可用性区域提供99.999999999%的对象弹性；</li><li id="adb6" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">数据恢复可能需要12个小时。</li></ul><p id="11d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">亚马逊S3智能分层</strong></p><p id="5d06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个非常有趣的案例。此存储类别通过根据访问频率自动将数据移动到最经济高效的层，自动降低存储成本。</p><p id="9fce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，由于日常生活中的低访问权限，可以将对象移动到低访问权限层。如果以后访问该对象，它将被移回频繁访问的层。</p><ul class=""><li id="5388" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">多个可用性区域中99.999999999%的对象的持久性；</li><li id="9c04" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">它有一个小的监测和自动水平每月收费；</li></ul><h2 id="5214" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">通过AWS控制台创建S3</h2><p id="0e4c" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">是时候创建一个桶了，非常简单，只需搜索“s3”，然后点击“创建桶”。</p><p id="6127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有些数据是必需的，名称字段在整个AWS中必须是唯一的，而不仅仅是您的帐户。该字段标记如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://www.youtube.com/watch?v=30YWIPQtW10"><div class="er es jd"><img src="../Images/0519fae974eaf7f7abe472339f8e4ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rsRg_xNAwq_ZR1LS.png"/></div></a></figure><p id="fbb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于我上面提到的版本控制，在创建时可以激活:</p><figure class="je jf jg jh fd ji er es paragraph-image"><a href="https://www.youtube.com/watch?v=YP4zNBdUlos"><div class="er es le"><img src="../Images/cb7ba2417efb7a766903b1a288493e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bBSq43WtLA549_UmmpMJCA.png"/></div></a></figure><p id="1a4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建bucket的另一种方法是使用AWS SDK(软件开发工具包),它提供了使用程序创建资源的工具。下面我将展示一些使用<a class="ae jp" rel="noopener" href="/javarevisited/10-best-places-to-learn-java-online-for-free-ce5e713ab5b2"> Java </a>和<a class="ae jp" rel="noopener" href="/javarevisited/10-free-spring-boot-tutorials-and-courses-for-java-developers-53dfe084587e"> Spring Boot </a>的简单方法。</p><h2 id="4223" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">正在生成访问凭据</h2><p id="85ac" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">第一步是创建用于访问<a class="ae jp" rel="noopener" href="/javarevisited/5-best-aws-courses-for-beginners-and-experienced-developers-to-learn-in-2021-563212409fbd"> AWS服务</a>的安全凭证。</p><p id="0279" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，查找IAM服务，并在用户(不要用root)中使用“安全凭证”选项</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/1ceac054f2b18aa6facc58019a96c02c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XImP0WQJbHssO_6c9htgSQ.png"/></div></div></figure><h2 id="9078" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">设置Spring Boot项目</h2><p id="9498" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">在这里，我将创建一个项目来创建和维护。亚马逊s3上的txt文件。</p><p id="d81f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我首先将AWS依赖关系放在项目上:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="c2d2" class="jq jr hi lh b fi ll lm l ln lo">&lt;dependency&gt;<br/>   &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;<br/>   &lt;artifactId&gt;aws-java-sdk&lt;/artifactId&gt;<br/>   &lt;version&gt;1.11.163&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="112b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样，我们将可以访问一系列的类和方法来与AWS服务进行交互。</p><p id="0ac6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将通过创建如下配置类来开始配置客户端访问:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="accf" class="jq jr hi lh b fi ll lm l ln lo">@Configuration<br/>public class AWSConfig {<br/><br/>    public AWSCredentials credentials() {<br/>        AWSCredentials credentials = new BasicAWSCredentials(<br/>                "accesskey",<br/>                "secretKey"<br/>        );<br/>        return credentials;<br/>    }<br/><br/>    @Bean<br/>    public AmazonS3 amazonS3() {<br/>        AmazonS3 s3client = AmazonS3ClientBuilder<br/>                .<em class="lp">standard</em>()<br/>                .withCredentials(new AWSStaticCredentialsProvider(credentials()))<br/>                .withRegion(Regions.<em class="lp">US_EAST_1</em>)<br/>                .build();<br/>        return s3client;<br/>    }<br/><br/>}</span></pre><p id="6f84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在“accesskey”和“secretkey”中，每个用户将把他们在IAM中生成的安全凭证放入其中。</p><p id="16d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样做之后，一些动作是可能的，我为它们创建了一个服务类。</p><p id="bd61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">桶级操作:</strong></p><p id="4b24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建存储桶:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="9385" class="jq jr hi lh b fi ll lm l ln lo">public void createS3Bucket(String bucketName) {<br/>    if(amazonS3Client.doesBucketExist(bucketName)) {<br/>        <em class="lp">log</em>.info("Bucket name already in use. Try another name.");<br/>        return;<br/>    }<br/>    amazonS3Client.createBucket(bucketName);<br/>}</span></pre><p id="8a3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列表存储桶:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="484d" class="jq jr hi lh b fi ll lm l ln lo">public List&lt;Bucket&gt; listBuckets(){<br/>    return amazonS3Client.listBuckets();<br/>}</span></pre><p id="6c41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除存储桶:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="25ec" class="jq jr hi lh b fi ll lm l ln lo">public void deleteBucket(String bucketName){<br/>    try {<br/>        amazonS3Client.deleteBucket(bucketName);<br/>    } catch (AmazonServiceException e) {<br/>        <em class="lp">log</em>.error(e.getErrorMessage());<br/>        return;<br/>    }<br/>}</span></pre><p id="cf85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">对象级动作:</strong></p><p id="50ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将物体放入桶中:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="e3fe" class="jq jr hi lh b fi ll lm l ln lo">public void putObject(String bucketName, BucketObjectRepresentaion representation, boolean publicObject) throws IOException {<br/><br/>    String objectName = representation.getObjectName();<br/>    String objectValue = representation.getText();<br/><br/>    File file = new File("." + File.<em class="lp">separator </em>+ objectName);<br/>    FileWriter fileWriter = new FileWriter(file, false);<br/>    PrintWriter printWriter = new PrintWriter(fileWriter);<br/>    printWriter.println(objectValue);<br/>    printWriter.flush();<br/>    printWriter.close();<br/><br/>    try {<br/>        var putObjectRequest = new PutObjectRequest(bucketName, objectName, file).withCannedAcl(CannedAccessControlList.<em class="lp">PublicRead</em>);<br/>        amazonS3Client.putObject(putObjectRequest);<br/>    } catch (Exception e){<br/>        <em class="lp">log</em>.error("Some error has ocurred.");<br/>    }<br/><br/>}</span></pre><p id="266b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列出所有对象的名称:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="c94c" class="jq jr hi lh b fi ll lm l ln lo">public List&lt;S3ObjectSummary&gt; listObjects(String bucketName){<br/>    ObjectListing objectListing = amazonS3Client.listObjects(bucketName);<br/>    return objectListing.getObjectSummaries();<br/>}</span></pre><p id="8c08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载一个对象:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="7658" class="jq jr hi lh b fi ll lm l ln lo">public void downloadObject(String bucketName, String objectName){<br/>    S3Object s3object = amazonS3Client.getObject(bucketName, objectName);<br/>    S3ObjectInputStream inputStream = s3object.getObjectContent();<br/>    try {<br/>        FileUtils.<em class="lp">copyInputStreamToFile</em>(inputStream, new File("." + File.<em class="lp">separator </em>+ objectName));<br/>    } catch (IOException e) {<br/>        <em class="lp">log</em>.error(e.getMessage());<br/>    }<br/>}</span></pre><p id="f0ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于上面的下载，我使用了Apache依赖项，这使得I/O更加容易:</p><p id="edbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除对象:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="6b4d" class="jq jr hi lh b fi ll lm l ln lo">public void deleteObject(String bucketName, String objectName){<br/>    amazonS3Client.deleteObject(bucketName, objectName);<br/>}</span></pre><p id="e7d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除多个对象:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="ab27" class="jq jr hi lh b fi ll lm l ln lo">public void deleteMultipleObjects(String bucketName, List&lt;String&gt; objects){<br/>    DeleteObjectsRequest delObjectsRequests = new DeleteObjectsRequest(bucketName)<br/>            .withKeys(objects.toArray(new String[0]));<br/>    amazonS3Client.deleteObjects(delObjectsRequests);<br/>}</span></pre><p id="bbaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在两个桶之间移动物体:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="b653" class="jq jr hi lh b fi ll lm l ln lo">public void moveObject(String bucketSourceName, String objectName, String bucketTargetName){<br/>    amazonS3Client.copyObject(<br/>            bucketSourceName,<br/>            objectName,<br/>            bucketTargetName,<br/>            objectName<br/>    );<br/>}</span></pre><p id="646c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我创建了一个控制器来测试这段代码:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="bcf8" class="jq jr hi lh b fi ll lm l ln lo">@RestController<br/>@RequestMapping(value = "/buckets/")<br/>@RequiredArgsConstructor<br/>public class ControllerTests {<br/><br/>    private final S3Service s3Service;<br/><br/>    @PostMapping(value = "/{bucketName}")<br/>    public void createBucket(@PathVariable String bucketName){<br/>        s3Service.createS3Bucket(bucketName);<br/>    }<br/><br/>    @GetMapping<br/>    public List&lt;String&gt; listBuckets(){<br/>        var buckets = s3Service.listBuckets();<br/>        var names = buckets.stream().map(Bucket::getName).collect(Collectors.toList());<br/>        return names;<br/>    }<br/><br/>    @DeleteMapping(value = "/{bucketName}")<br/>    public void deleteBucket(@PathVariable String bucketName){<br/>        s3Service.deleteBucket(bucketName);<br/>    }<br/><br/>    @PostMapping(value = "/{bucketName}/objects")<br/>    public void createObject(@PathVariable String bucketName, @RequestBody BucketObjectRepresentaion representaion) throws IOException {<br/>        s3Service.putObject(bucketName, representaion);<br/>    }<br/><br/>    @GetMapping(value = "/{bucketName}/objects/{objectName}")<br/>    public File downloadObject(@PathVariable String bucketName, @PathVariable String objectName) throws IOException {<br/>        s3Service.downloadObject(bucketName, objectName);<br/>        return new File("./" + objectName);<br/>    }<br/><br/>    @PatchMapping(value = "/{bucketName}/objects/{objectName}/{bucketSource}")<br/>    public void moveObject(@PathVariable String bucketName, @PathVariable String objectName, @PathVariable String bucketSource) throws IOException {<br/>        s3Service.moveObject(bucketName, objectName, bucketSource);<br/>    }<br/><br/>}</span></pre><p id="fdb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">测试</strong> <br/>到目前为止我们有以下操作:</p><p id="247f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">发布</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/bucket-name</a>创建一个桶。</p><p id="efb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">删除</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/bucket-name</a>删除一个桶。</p><p id="5e0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">GET</strong>:<a class="ae jp" href="http://localhost:8080/buckets/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/</a>列出所有桶。</p><p id="f699" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">POST</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name/objects" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/bucket-name/objects</a>用下面的正文创建一个对象:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="0fe6" class="jq jr hi lh b fi ll lm l ln lo">{<br/>    "objectName": "object-name.txt",<br/>    "text": "value of object"<br/>}</span></pre><p id="be7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">GET</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name/objects/object-name.txt" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/bucket-name/objects/object-name . txt</a>按名称取对象并下载。</p><p id="0856" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">GET</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name/objects/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/bucket-name/objects/</a>列出已有的对象。</p><p id="3b95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">删除</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name/objects/object-name" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/bucket/bucket-name/objects/object-name</a>删除一个对象。</p><p id="2d38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">删除</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name/objects/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/bucket-name/objects/</a>用以下正文一次删除多个对象:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="acf2" class="jq jr hi lh b fi ll lm l ln lo">["nome-objeto-1.txt", "nome-objeto-2.txt"]</span></pre><p id="44df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">打补丁</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name/objects/object-name.txt/bucket-name2" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/bucket-name/objects/object-name . txt/bucket-name 2</a>在两个桶之间移动一个对象。</p><p id="0c31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">公有vs私有</strong></p><p id="83c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，您可能已经注意到，bucket和对象都是通过公共访问创建的，对吗？</p><p id="1a74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是可以通过私人访问来创建它们。CannedAccessControlList枚举可用于此目的:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="2a6d" class="jq jr hi lh b fi ll lm l ln lo">public enum CannedAccessControlList {<br/>    <em class="lp">Private</em>("private"),<br/>    <em class="lp">PublicRead</em>("public-read"),<br/>    <em class="lp">PublicReadWrite</em>("public-read-write"),<br/>    <em class="lp">AuthenticatedRead</em>("authenticated-read"),<br/>    <em class="lp">LogDeliveryWrite</em>("log-delivery-write"),<br/>    <em class="lp">BucketOwnerRead</em>("bucket-owner-read"),<br/>    <em class="lp">BucketOwnerFullControl</em>("bucket-owner-full-control"),<br/>    <em class="lp">AwsExecRead</em>("aws-exec-read");<br/><br/>    private final String cannedAclHeader;<br/><br/>    private CannedAccessControlList(String cannedAclHeader) {<br/>        this.cannedAclHeader = cannedAclHeader;<br/>    }<br/><br/>    public String toString() {<br/>        return this.cannedAclHeader;<br/>    }<br/>}</span></pre><p id="6304" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我将只使用public和private，实现可能如下所示:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="1a7d" class="jq jr hi lh b fi ll lm l ln lo">public void putObject(String bucketName, BucketObjectRepresentaion representation, boolean publicObject) throws IOException {<br/><br/>    String objectName = representation.getObjectName();<br/>    String objectValue = representation.getText();<br/><br/>    File file = new File("." + File.<em class="lp">separator </em>+ objectName);<br/>    FileWriter fileWriter = new FileWriter(file, false);<br/>    PrintWriter printWriter = new PrintWriter(fileWriter);<br/>    printWriter.println(objectValue);<br/>    printWriter.flush();<br/>    printWriter.close();<br/><br/>    try {<br/>        if(publicObject) {<br/>            var putObjectRequest = new PutObjectRequest(bucketName, objectName, file).withCannedAcl(CannedAccessControlList.<em class="lp">PublicRead</em>);<br/>            amazonS3Client.putObject(putObjectRequest);<br/>        } else {<br/>            var putObjectRequest = new PutObjectRequest(bucketName, objectName, file).withCannedAcl(CannedAccessControlList.<em class="lp">Private</em>);<br/>            amazonS3Client.putObject(putObjectRequest);<br/>        }<br/>    } catch (Exception e){<br/>        <em class="lp">log</em>.error("Some error has ocurred.");<br/>    }<br/><br/>}</span></pre><p id="e6cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与此同时，我还改变了<a class="ae jp" href="https://javarevisited.blogspot.com/2022/05/how-to-return-json-xml-or-thymeleaf-.html" rel="noopener ugc nofollow" target="_blank">控制器</a>用于测试:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="6628" class="jq jr hi lh b fi ll lm l ln lo">@PostMapping(value = "/{bucketName}")<br/>public void createBucket(@PathVariable String bucketName, @RequestParam boolean publicBucket){<br/>    s3Service.createS3Bucket(bucketName, publicBucket);<br/>}</span></pre><p id="0ecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样，我就可以选择创建一个具有<a class="ae jp" href="https://javarevisited.blogspot.com/2012/10/difference-between-private-protected-public-package-access-java.html" rel="noopener ugc nofollow" target="_blank">公共或私有访问权限</a>的对象。我在创建桶时做了同样的事情:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="a947" class="jq jr hi lh b fi ll lm l ln lo">public void putObject(String bucketName, BucketObjectRepresentaion representation, boolean publicObject) throws IOException {<br/><br/>    String objectName = representation.getObjectName();<br/>    String objectValue = representation.getText();<br/><br/>    File file = new File("." + File.<em class="lp">separator </em>+ objectName);<br/>    FileWriter fileWriter = new FileWriter(file, false);<br/>    PrintWriter printWriter = new PrintWriter(fileWriter);<br/>    printWriter.println(objectValue);<br/>    printWriter.flush();<br/>    printWriter.close();<br/><br/>    try {<br/>        if(publicObject) {<br/>            var putObjectRequest = new PutObjectRequest(bucketName, objectName, file).withCannedAcl(CannedAccessControlList.<em class="lp">PublicRead</em>);<br/>            amazonS3Client.putObject(putObjectRequest);<br/>        } else {<br/>            var putObjectRequest = new PutObjectRequest(bucketName, objectName, file).withCannedAcl(CannedAccessControlList.<em class="lp">Private</em>);<br/>            amazonS3Client.putObject(putObjectRequest);<br/>        }<br/>    } catch (Exception e){<br/>        <em class="lp">log</em>.error("Some error has ocurred.");<br/>    }<br/><br/>}</span></pre><p id="52ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">测试用的<a class="ae jp" href="https://javarevisited.blogspot.com/2022/05/how-to-validate-incoming-payload-on-spring-.html" rel="noopener ugc nofollow" target="_blank">控制器</a>:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="044e" class="jq jr hi lh b fi ll lm l ln lo">@PostMapping(value = "/{bucketName}/objects")<br/>public void createObject(@PathVariable String bucketName, @RequestBody BucketObjectRepresentaion representaion, @RequestParam boolean publicObject) throws IOException {<br/>    s3Service.putObject(bucketName, representaion, publicObject);<br/>}</span></pre><p id="6536" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些请求看起来像这样:</p><p id="3dda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">POST</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name/objects?publicObject=true" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/buckets/bucket-name/objects？publicObject=true </a>用下面的主体创建一个对象:</p><pre class="je jf jg jh fd lg lh li lj aw lk bi"><span id="bbf7" class="jq jr hi lh b fi ll lm l ln lo">{<br/>    "objectName": "object-name.txt",<br/>        "text": "value of object"<br/>}</span></pre><p id="f291" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">帖子</strong>:<a class="ae jp" href="http://localhost:8080/buckets/bucket-name?publicBucket=true" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/bucket/bucket-name？publicBucket=true </a>创建一个存储桶。</p><p id="ed6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此代码是功能性的概念证明，可在此处参考:<a class="ae jp" href="https://github.com/mmarcosab/s3-example" rel="noopener ugc nofollow" target="_blank">https://github.com/mmarcosab/s3-example</a></p><div class="lq lr ez fb ls lt"><a rel="noopener follow" target="_blank" href="/javarevisited/21-spring-mvc-rest-interview-questions-answers-for-beginners-and-experienced-developers-21ad3d4c9b82"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">10大春季MVC + REST面试问题解答适合初学者和有经验的开发者</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">大家好。如果你正在准备Java和Spring面试或Spring认证，并经常寻找一些…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">medium.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh jn lt"/></div></div></a></div><div class="lq lr ez fb ls lt"><a rel="noopener follow" target="_blank" href="/javarevisited/top-22-skills-professional-java-programmers-can-learn-in-2022-to-upgrade-themselves-bc3da73d7491"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">2022年Java程序员和架构师可以学习的25项基本技能</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">Java开发人员可以在2022年学习的22项基本技术技能，以进一步改善他们的形象，并成为…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">medium.com</p></div></div><div class="mc l"><div class="mi l me mf mg mc mh jn lt"/></div></div></a></div><div class="lq lr ez fb ls lt"><a rel="noopener follow" target="_blank" href="/javarevisited/the-java-programmer-roadmap-f9db163ef2c2"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">2022年Java程序员路线图</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">2022年成为Java开发人员的图解指南，包含相关课程的链接</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">medium.com</p></div></div><div class="mc l"><div class="mj l me mf mg mc mh jn lt"/></div></div></a></div></div></div>    
</body>
</html>