<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/javarevisited/multithreading-in-springbatch-d1166e5ad25c?source=collection_archive---------2-----------------------#2021-01-13">https://medium.com/javarevisited/multithreading-in-springbatch-d1166e5ad25c?source=collection_archive---------2-----------------------#2021-01-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><p id="4e79" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">SpringBatch中的多线程</p><figure class="ig ih ii ij fd ik er es paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="er es if"><img src="../Images/8c32314935845d899c14b47b55ffe1d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GVsYNsPHPM2XtIBM80bu3A.png"/></div></div></figure><p id="d0c2" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">Spring批处理作业允许我们执行非交互式批量处理。此外，它还提供同步和异步处理。</p><p id="c793" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">由于SpringBatch作业通常涉及处理大量的数据，因此异步执行可能是个好主意，除非顺序处理是必不可少的。</p><p id="2a41" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">这可以通过两种方式实现。</p><p id="726a" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">通过使给定步骤内的数据处理异步</p><p id="9573" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">通过使作业异步，即步骤的异步执行</p><p id="183d" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj ir">异步步进</strong></p><p id="f729" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">通过在步骤配置中指定任务执行器，可以使步骤中的数据处理异步进行。</p><figure class="ig ih ii ij fd ik er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/05/top-5-courses-to-learn-spring-boot-in.html#axzz6jaweW3o1"><div class="er es is"><img src="../Images/628dfb5b7765737ef8c5e4dedb0a78fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FhfujScJCmhHKFztSZaWGw.png"/></div></a></figure><p id="fe7c" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">对于配置<a class="ae it" rel="noopener" href="/javarevisited/8-best-multithreading-and-concurrency-courses-for-experienced-java-developers-8acfd3b25094">多线程</a>步骤，通常使用<code class="du iu iv iw ix b">SimpleAsyncTaskExecutor </code>或<code class="du iu iv iw ix b">ThreadPoolTaskExecutor </code></p><p id="7314" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">当一个步骤被配置为异步时，读取和处理记录块没有特定的顺序。</p><figure class="ig ih ii ij fd ik er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/06/top-5-java-multithreading-and-concurrency-courses-experienced-programmers.html"><div class="er es iy"><img src="../Images/6c475be162d1acda1ac2ca23af20f7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*qY2oXDkrH5u4FYAI1JmRFg.png"/></div></a></figure><p id="decd" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">例如，如果一个步骤同步处理1的块中的上述记录，它将以下面的方式处理记录1，2，3，4。</p><p id="60ef" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">然而，如果这些记录被异步处理，它们可以以任何方式被处理。例如，它们可以全部同时处理，或者1，2可以并行处理，其余的按顺序处理，反之亦然。</p><p id="4564" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">数据块可以以任何顺序处理，并且块内的数据本身可能不是连续的。</p><p id="30a2" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">对于异步步骤，并行处理的程度取决于许多因素，例如<a class="ae it" href="https://javarevisited.blogspot.sg/2013/07/how-to-create-thread-pools-in-java-executors-framework-example-tutorial.html#ixzz5EAhFySdA" rel="noopener ugc nofollow" target="_blank">线程池中可用的线程数量、</a>节流限制等。</p><p id="2aca" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">这些可以通过配置taskExecutor进行定制，如下所示</p><figure class="ig ih ii ij fd ik er es paragraph-image"><a href="https://javarevisited.blogspot.com/2020/04/top-10-advanced-core-java-courses-for-experienced-developers.html#axzz6KyOHbmCo"><div class="er es is"><img src="../Images/413955afa40b43b3e2c9623b48591de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfYzhg_5lRGcx8bEbw6SLA.png"/></div></a></figure><figure class="ig ih ii ij fd ik er es paragraph-image"><a href="https://javarevisited.blogspot.com/2019/04/top-5-courses-to-learn-jvm-internals.html"><div class="er es is"><img src="../Images/b72ab16d7badb62121dc40dacc3a4ab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijiu1fyvCd4Ok54IVwKfCA.png"/></div></a></figure><p id="3e1b" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">因此<a class="ae it" rel="noopener" href="/javarevisited/6-multithreading-and-concurrency-books-every-java-programmer-should-read-b6a08d2aae54">步骤中的多线程</a>只能在步骤中数据处理的顺序不重要时使用。</p><p id="9727" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj ir">异步作业</strong></p><p id="869d" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">对于异步作业，步骤的顺序不是预先确定的，即执行步骤时没有特定的顺序。</p><p id="afe1" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">使一个SpringBatch作业异步包括在配置中声明一个<code class="du iu iv iw ix b">TaskExecutor </code>。</p><p id="69db" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">TaskExecutor可以定制为满足特定的需求，如下所示。</p><figure class="ig ih ii ij fd ik er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/02/top-5-spring-microservices-courses-with-spring-boot-and-spring-cloud.html"><div class="er es is"><img src="../Images/e4b7a02314bfc8ad8cbd89fa588780a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z2RjOPHxx_FLXXQ132jA8g.png"/></div></a></figure><p id="f56f" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">与可以与TaskExecutor的任何实现一起工作的异步步骤不同，异步作业需要像<code class="du iu iv iw ix b">SimpleAsyncTaskExecutor </code>这样的异步TaskExecutor或任何其他异步实现。</p><figure class="ig ih ii ij fd ik er es paragraph-image"><a href="https://www.java67.com/2017/11/top-5-free-core-spring-mvc-courses-learn-online.html"><div class="er es iz"><img src="../Images/a3a7c0dca4df2325446f70960ab1a7b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*nNzmvXSfOqgFjtNFRcqUxg.png"/></div></a></figure><p id="0eb3" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">通过创建和配置流，我们指定了作业必须并行执行的各个执行流。</p><p id="021f" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">在上面的示例步骤中，通过将每个步骤定义为单独的流程来并行执行1和2，因为每个流程在单独的<a class="ae it" href="https://javarevisited.blogspot.com/2014/07/top-50-java-multithreading-interview-questions-answers.html" rel="noopener ugc nofollow" target="_blank">执行线程</a>中执行。</p><p id="667e" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">但在现实世界中，并非一切都是黑白分明的。我们通常希望将两种行为结合起来，即在工作中顺序和并行执行步骤。</p><p id="3144" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">以下示例说明了如何实现这一点。</p><figure class="ig ih ii ij fd ik er es paragraph-image"><a href="https://www.java67.com/2018/06/5-best-courses-to-learn-spring-boot-in.html"><div class="er es ja"><img src="../Images/b315835be3d95360fbac8ae926fb0d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OF6dyz2sGM3W1egPpxSFlA.png"/></div></a></figure><p id="ef05" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">示例作业包含以下步骤。</p><p id="d9ff" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">第一步第二步第三步第四步。</p><p id="84cd" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">使用流，我们设法配置作业，以便</p><p id="297c" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj ir"> </strong>步骤1和步骤2连续运行。</p><p id="1d93" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj ir"> </strong>步骤3与(步骤1和步骤2)并行运行。</p><p id="4bff" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj ir"> </strong>第3步和第4步相继运行。(即步骤3完成后运行步骤4)</p></div></div>    
</body>
</html>