<html>
<head>
<title>5 Things to keep in mind while running a SQL query on production databases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在生产数据库上运行SQL查询时要记住的5件事</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/5-things-you-should-keep-in-mind-while-running-sql-queries-on-production-databases-bf29aa8d75da?source=collection_archive---------1-----------------------#2021-01-01">https://medium.com/javarevisited/5-things-you-should-keep-in-mind-while-running-sql-queries-on-production-databases-bf29aa8d75da?source=collection_archive---------1-----------------------#2021-01-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/22a006e58897bbc56b3cf37e34bfd7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*usceCKLWPyUnyynj"/></div></div><p class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@esteejanssens?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">埃斯特·扬森斯</a>拍摄的照片</p></figure><p id="9983" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你有没有遇到过这样的情况，一些看起来无害的行为导致了生产问题，而且时间太长了？我希望你没有，因为这肯定不是一次愉快的经历。</p><p id="3d89" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中一个看起来无害的动作是在生产数据库上运行<a class="ae iu" href="http://javarevisited.blogspot.sg/2012/12/how-to-find-second-highest-or-maximum-salary-sql.html" rel="noopener ugc nofollow" target="_blank"> SQL查询</a>。在我职业生涯的早期，我也遇到过这种情况，我删除了一些重复的配置，但一周后发现它停止向下游发布消息。</p><p id="4fdf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您在复杂的系统中工作时，该系统有如此多的组件、数百万行代码、数千种配置以及包含数百个表的许多数据库，您必须非常小心地对待您所做的任何事情。通常没有真正的方法来执行类似生产的测试，因此最好的办法是尽可能隔离和限制您的变更。<br/> <br/>总之，所有这些背景知识是因为今天我将与大家分享一些在查询生产或实时数据库时防止生产问题的技巧。</p><p id="d795" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于许多数据科学家不是SQL专家，但他们确实编写了<a class="ae iu" href="https://www.java67.com/2013/04/10-frequently-asked-sql-query-interview-questions-answers-database.html" rel="noopener ugc nofollow" target="_blank"> SQL查询</a>、<a class="ae iu" href="http://javarevisited.blogspot.sg/2013/02/-create-and-call-mysql-stored-procedure-database-sql-example-tutorial.html" rel="noopener ugc nofollow" target="_blank">存储过程</a>，并与测试和生产数据库进行交互，因此他们看似无害的操作很可能会导致生产问题。<br/> <br/>去年同一时间，我们遇到了这样一个事件，数据科学家的<strong class="ix hj">选择查询阻塞了生产中的一些流程</strong>。看似无害的SELECT查询锁定了一个表，该表是尝试更新和向同一个表中插入数据的过程所需要的。<br/> <br/>数据科学家在一天结束时运行查询，然后忘记了这件事，第二天早上才发现一些重要的工作还没有完成，它们从昨晚就开始运行了。最终，数据库管理员参与进来，他们切断了阻塞作业的连接，一切都恢复了。<br/> <br/>顺便说一下，如果你不熟悉<a class="ae iu" rel="noopener" href="/javarevisited/5-best-courses-to-learn-microsoft-sql-server-in-depth-e9f11b73c14a"> Microsoft SQL Server </a>和<a class="ae iu" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-microsoft-sql-server-and-oracle-database-in-2020-6708afcf4ad7"> T-SQL </a>，那么我还建议你参加一个综合课程，学习SQL Server基础知识以及如何使用T-SQL。如果你需要推荐，我建议你去Udemy上的Brewster Knowlton的<a class="ae iu" href="https://click.linksynergy.com/deeplink?id=JVFxdTr9V80&amp;mid=39197&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fmicrosoft-sql-for-beginners%2F" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">微软SQL初学者</strong> </a>在线课程。从SQL Server中的T-SQL和SQL查询开始是很棒的课程。</p><div class="jt ju ez fb jv jw"><a href="https://click.linksynergy.com/deeplink?id=JVFxdTr9V80&amp;mid=39197&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fmicrosoft-sql-for-beginners%2F" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">Microsoft SQL Server和T-SQL:从初级到高级</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">Brewster Knowlton曾在商业智能行业的各个方面工作过。具有丰富的写作经验…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">udemy.com</p></div></div><div class="kf l"><div class="kg l kh ki kj kf kk io jw"/></div></div></a></div><h1 id="2ff8" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">在生产数据库上运行SQL查询时要考虑的5件事</h1><p id="315f" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">嗯，这是数据科学家在花费很长时间时忘记取消查询的极端情况之一，但发生这种情况的可能性很高，特别是如果您有生产访问权限，并且不太了解数据库锁定。</p><p id="b4ed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最好是提高您对锁定和隔离级别的了解，但为了安全起见，在生产环境中运行SQL查询时，您也可以遵循以下提示:</p><h2 id="9d1b" class="lo km hi bd kn lp lq lr kr ls lt lu kv jg lv lw kz jk lx ly ld jo lz ma lh mb bi translated">1.总是使用NOLOCK选项进行查询</h2><p id="edc0" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">如果某个作业也在运行并试图更新您正在查询的同一个表，这可能会导致生产问题。通过说NOLOCK，您可以降低阻塞和死锁的风险，就像</p><pre class="mc md me mf fd mg mh mi mj aw mk bi"><span id="c565" class="lo km hi mh b fi ml mm l mn mo">SELECT Id, Name, Address from Employee with (NOLOCK) where Id= 2</span></pre><p id="1735" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您使用NOLOCK提示运行查询时，它会指示查询引擎不要发出共享锁，并且不支持排他锁。使用with NOLOCK选项时，可能会读取未提交的事务或在读取过程中回滚的一组页面。<br/> <br/>脏读是可能的。不过，值得注意的是，这个选项只适用于SELECT语句，对Microsoft SQL Server可用。请参阅Udemy上的<a class="ae iu" href="https://www.udemy.com/course/70-461-session-2-querying-microsoft-sql-server-2012/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">使用Transact-SQL </strong> </a>查询微软SWL服务器课程，了解更多关于表级和行级锁定的信息。</p><div class="jt ju ez fb jv jw"><a href="https://click.linksynergy.com/deeplink?id=JVFxdTr9V80&amp;mid=39197&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2F70-461-session-2-querying-microsoft-sql-server-2012%2F" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">70-461，761:使用Transact-SQL查询Microsoft SQL Server</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">点评”指导老师讲解的很详细。非常容易理解。”——琳达·沈《精品课程……</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">udemy.com</p></div></div><div class="kf l"><div class="mp l kh ki kj kf kk io jw"/></div></div></a></div></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h2 id="5abb" class="lo km hi bd kn lp lq lr kr ls lt lu kv jg lv lw kz jk lx ly ld jo lz ma lh mb bi translated">2.在备份或辅助数据库服务器中运行查询</h2><p id="6a8c" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">如果可能，总是在备份或辅助服务器上运行查询，而不是在主服务器上运行。只有当您因为觉得数据不是最新的而无法使用辅助服务器时，才使用主服务器，但底线是要避免在生产时间接触主服务器或主服务器。</p></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h2 id="7503" class="lo km hi bd kn lp lq lr kr ls lt lu kv jg lv lw kz jk lx ly ld jo lz ma lh mb bi translated">3.在生产环境中运行之前，在UAT/测试数据库上测试您的查询</h2><p id="fff9" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">这也是我以前在解释UNIX命令时可能告诉过你的规则。与在生产机器上运行之前应该在暂存箱上测试的<a class="ae iu" href="http://java67.blogspot.com/2012/10/unix-command-to-find-symbolic-link-or.html" rel="noopener ugc nofollow" target="_blank"> UNIX命令</a>类似，在生产中运行查询之前，也应该首先在QA或UAT环境上运行查询。这不仅给你一个很好的想法，还可以避免语法错误和生产中的意外错误。</p></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h2 id="7f4d" class="lo km hi bd kn lp lq lr kr ls lt lu kv jg lv lw kz jk lx ly ld jo lz ma lh mb bi translated">4.避免在工作时间接触生产数据库</h2><p id="1daf" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">如果您正在为一个系统工作，该系统有一些市场时段，如股票交易所，从早上9点到下午4点，那么您应该避免在这段时间接触您的生产数据库，并且只在市场时段之后运行您的查询。</p><p id="8449" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在市场时段，DB上有很多活动，您那些看起来无害的<a class="ae iu" href="http://javarevisited.blogspot.sg/2011/10/selct-command-sql-query-example.html" rel="noopener ugc nofollow" target="_blank">选择查询</a>很有可能会干扰它们。</p></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h2 id="d8ca" class="lo km hi bd kn lp lq lr kr ls lt lu kv jg lv lw kz jk lx ly ld jo lz ma lh mb bi translated">5.仔细检查您的SQL查询</h2><p id="1a80" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">如果您不是单独工作，并且有一些团队成员，您可以随时要求您的同事对您想要在生产中运行的查询进行四目检查。如果您可以从DBA那里查看您的查询，那就更好了。</p></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><p id="b53e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以上是在查询生产数据库时需要记住的一些<strong class="ix hj">重要提示。您还应该了解更多关于数据库如何执行SQL查询的信息，如索引如何工作、锁定如何工作、表扫描、行扫描、表级锁定或行级锁定等。</strong></p><p id="f84e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您很好地了解这些基础知识，您可以更确定地预测您的查询行为，并可能避免不愉快的意外。<br/> <br/>有一本书可以在这里帮到你，那就是马库斯·温南(Markus Winand)所著的《SQL性能讲解  <strong class="ix hj"> </strong>》，这本书将从数据科学家的角度让你对数据库有一个很好的了解。</p><div class="jt ju ez fb jv jw"><a href="http://www.amazon.com/Performance-Explained-Everything-Developers-about/dp/3950307826/?tag=javamysqlanta-20" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">SQL性能解释了开发人员需要了解的关于SQL性能的一切</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">Amazon.com上的SQL性能解释了开发人员需要了解的关于SQL性能的一切</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">www.amazon.com</p></div></div><div class="kf l"><div class="mx l kh ki kj kf kk io jw"/></div></div></a></div><blockquote class="my"><p id="3469" class="mz na hi bd nb nc nd ne nf ng nh js dx translated">你呢？在查询生产/实时数据库时，您需要遵循哪些提示或注意哪些事项？</p></blockquote><p id="c430" class="pw-post-body-paragraph iv iw hi ix b iy ni ja jb jc nj je jf jg nk ji jj jk nl jm jn jo nm jq jr js hb bi translated">您可能想探索的其他<strong class="ix hj">有用的编程资源</strong>有:</p><ul class=""><li id="3b0a" class="nn no hi ix b iy iz jc jd jg np jk nq jo nr js ns nt nu nv bi translated"><a class="ae iu" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-angular-framework-in-2020-bb62148c73d3">初学者学习棱角的10门免费课程</a></li><li id="7e07" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated"><a class="ae iu" href="https://javarevisited.blogspot.com/2018/10/the-2018-react-developer-roadmap.html" rel="noopener ugc nofollow" target="_blank">2023年React开发者路线图</a></li><li id="111a" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated"><a class="ae iu" rel="noopener" href="/javarevisited/can-you-learn-programming-and-become-a-web-developer-in-the-40s-and-50s-f9e117f32721">40多岁能学编码和Web开发吗？</a></li><li id="69d3" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated"><a class="ae iu" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-react-js-c14edbd3b35f">2023年学会反应的10门免费课程</a></li><li id="8e1f" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated">成为全栈式网络开发人员的10门最佳课程</li><li id="876a" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated">每个软件工程师都应该学习的10件事</li><li id="8a7f" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated"><a class="ae iu" rel="noopener" href="/javarevisited/top-10-online-courses-to-learn-node-js-in-depth-8ef0e31ca139">2023年我最喜欢学的课程node . js</a></li><li id="4c92" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated"><a class="ae iu" rel="noopener" href="/javarevisited/5-free-html-and-css-courses-to-learn-front-end-web-development-online-8b04517c6ecb?source=collection_home---4------0-----------------------">我最喜欢的学习HTML和CSS的免费课程</a></li><li id="8734" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated"><a class="ae iu" rel="noopener" href="/javarevisited/7-best-courses-to-learn-typescript-in-depth-58439e1ce729">2023年学习打字稿的前7门课程</a></li><li id="9ec3" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated"><a class="ae iu" rel="noopener" href="/javarevisited/7-free-courses-to-learn-bootstrap-for-web-designers-and-developers-5135215648f1"> 7门免费学习网页设计自举的课程</a></li><li id="468f" class="nn no hi ix b iy nw jc nx jg ny jk nz jo oa js ns nt nu nv bi translated"><a class="ae iu" rel="noopener" href="/better-programming/my-5-favorite-courses-to-learn-web-development-in-2019-a5e74167f8b2">我最喜欢的深入学习Web开发的课程</a></li></ul><p id="8676" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您阅读本文，如果您喜欢这些在生产环境中运行SQL查询的简单安全提示，请与您的朋友和同事分享。这很有帮助</p><p id="e363" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">附注</strong>——如果你正在寻找一些免费的课程来开始学习数据库和SQL基础知识，那么你应该查看Udemy上的<a class="ae iu" href="http://bit.ly/2BQuq2O" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">数据库和SQL查询简介</strong> </a>课程，它是完全免费的，你只需要一个免费的Udemy帐户就可以访问这门课程。</p><div class="jt ju ez fb jv jw"><a href="http://bit.ly/2BQuq2O" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">免费数据库管理教程-数据库和SQL查询介绍</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">我是一名程序员、经理、教育家和游戏玩家。我喜欢数据和分析。在我的日常工作中，我处理数据库…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">bit.ly</p></div></div><div class="kf l"><div class="ob l kh ki kj kf kk io jw"/></div></div></a></div></div></div>    
</body>
</html>