<html>
<head>
<title>Configuration Properties With Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kotlin的配置属性</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/configuration-properties-with-kotlin-10fe6176f4f1?source=collection_archive---------1-----------------------#2021-04-30">https://medium.com/javarevisited/configuration-properties-with-kotlin-10fe6176f4f1?source=collection_archive---------1-----------------------#2021-04-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="46b5" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何将Spring Boot配置属性与Kotlin数据类结合使用</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/93207d58a56c07d417764a9ec7ca8e6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uj3EkMl9aPVYk4_UAMgcJw.jpeg"/></div></div><p class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://unsplash.com/@flyd2069?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">飞:D </a>在<a class="ae jn" href="https://unsplash.com/s/photos/props?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="da55" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">自从在Spring Boot 2.2.0中引入了<code class="du kk kl km kn b">@ConstructorBinding</code>注释以来，通过使用基于构造函数的属性绑定来创建不可变的配置属性类已经成为可能。本文描述了如何结合使用<code class="du kk kl km kn b">@ConstructorBinding</code>和<a class="ae jn" href="https://kotlinlang.org/docs/data-classes.html" rel="noopener ugc nofollow" target="_blank"> Kotlin数据类</a>来创建不可变的、干净的、简洁的配置属性类。除了基础知识之外，我们还将了解:使用嵌套属性、设置默认值、处理验证以及创建属性列表。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="fc83" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">基础</h1><p id="26b7" class="pw-post-body-paragraph jo jp hi jq b jr ln ij jt ju lo im jw jx lp jz ka kb lq kd ke kf lr kh ki kj hb bi translated">让我们首先创建一个<code class="du kk kl km kn b">data class</code>来保存我们的属性。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="3ec1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du kk kl km kn b">@ConfigurationProperties(prefix = "person")</code>注释告诉Spring我们想要将外部属性绑定到这个类。<code class="du kk kl km kn b">@ConstructorBinding</code>注释表明配置属性应该通过构造函数参数而不是通过调用setters来绑定。</p><p id="ea97" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因为我们在<code class="du kk kl km kn b">@ConfigurationProperties</code>中指定了前缀<code class="du kk kl km kn b">person</code>，Spring将寻找<code class="du kk kl km kn b">person.name</code>和<code class="du kk kl km kn b">person.age</code>属性。我们需要声明这些属性，例如在一个<code class="du kk kl km kn b">application.properties</code>文件中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="e982" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，我们必须启用对<code class="du kk kl km kn b">@ConfigurationProperties</code>注释beans的支持。最简单的方法是使用<code class="du kk kl km kn b">@EnableConfigurationProperties</code>注释。就个人而言，我喜欢在主应用程序类上设置这个注释，但是将它设置到任何Spring管理的组件也可以。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="bcfb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此时运行应用程序将产生一个具有我们指定的名称和年龄的PersonProperties对象。</p><pre class="iy iz ja jb fd lu kn lv lw aw lx bi"><span id="6bb1" class="ly kw hi kn b fi lz ma l mb mc">PersonProperties(name=Don Draper, age=44)</span></pre></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="3a6e" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">嵌套属性</h1><p id="2f17" class="pw-post-body-paragraph jo jp hi jq b jr ln ij jt ju lo im jw jx lp jz ka kb lq kd ke kf lr kh ki kj hb bi translated">在使用配置属性类时，我经常遇到的一个问题是需要嵌套属性。幸运的是，<code class="du kk kl km kn b">@ConstructorBinding</code>注释类的嵌套成员也将通过它们的构造函数自动绑定。因此，向我们现有的<code class="du kk kl km kn b">PersonProperties</code>类添加一个<code class="du kk kl km kn b">Address</code>就像创建一个数据类并为我们新的<code class="du kk kl km kn b">person.address</code>属性声明值一样简单。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="2de6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此时运行应用程序将产生以下PersonProperties对象:</p><pre class="iy iz ja jb fd lu kn lv lw aw lx bi"><span id="89cb" class="ly kw hi kn b fi lz ma l mb mc">PersonProperties(name=Don Draper, age=44, address=Address(street=Arden Road, city=New York))</span></pre></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="45bc" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">默认值</h1><p id="cdca" class="pw-post-body-paragraph jo jp hi jq b jr ln ij jt ju lo im jw jx lp jz ka kb lq kd ke kf lr kh ki kj hb bi translated">您可能遇到的另一件事是需要有默认值的属性。设置默认值有几种方法，但是对于Kotlin，我更喜欢使用允许您为构造函数参数提供默认值的语言特性。</p><p id="9c07" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个例子展示了如何为<code class="du kk kl km kn b">hairColor</code>添加一个默认值为<code class="du kk kl km kn b">brown</code>的新属性。默认值可以通过在我们的<code class="du kk kl km kn b">.properties</code>文件中为属性(在本例中为<code class="du kk kl km kn b">person.hairColor</code>)指定一个值来覆盖。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="b38c" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">确认</h1><p id="ed79" class="pw-post-body-paragraph jo jp hi jq b jr ln ij jt ju lo im jw jx lp jz ka kb lq kd ke kf lr kh ki kj hb bi translated">由于有权访问属性文件的每个人都能够更改这些值，所以您可能希望进行一些验证，以确保没有错误的数据进入您的系统。这可以通过多种方式实现，但是对于Kotlin来说，我发现使用<code class="du kk kl km kn b">require</code>函数是最优雅的解决方案。</p><p id="eea7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我们的例子中，<code class="du kk kl km kn b">age</code>属性具有负值是没有意义的，我们可以如下验证这个要求:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="6024" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我们通过设置<code class="du kk kl km kn b">person.age=-10</code>来更新<code class="du kk kl km kn b">.properties</code>文件并运行应用程序，Spring将无法启动，因为我们为<code class="du kk kl km kn b">age</code>属性输入了一个无效值。</p><pre class="iy iz ja jb fd lu kn lv lw aw lx bi"><span id="3a20" class="ly kw hi kn b fi lz ma l mb mc">***************************<br/>APPLICATION FAILED TO START<br/>***************************</span><span id="176e" class="ly kw hi kn b fi md ma l mb mc">Description:</span><span id="1965" class="ly kw hi kn b fi md ma l mb mc">Failed to bind properties under ‘person’ to com.example.PersonProperties:</span><span id="9906" class="ly kw hi kn b fi md ma l mb mc">Reason: Age cannot be negative</span><span id="fb07" class="ly kw hi kn b fi md ma l mb mc">Action:</span><span id="94ba" class="ly kw hi kn b fi md ma l mb mc">Update your application’s configuration</span></pre></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="7142" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">列表</h1><p id="2a0b" class="pw-post-body-paragraph jo jp hi jq b jr ln ij jt ju lo im jw jx lp jz ka kb lq kd ke kf lr kh ki kj hb bi translated">有时有必要将属性定义为列表。Kotlin端不需要任何特殊的动作，因为Spring能够毫无问题地将属性绑定到一个列表。唯一略有不同的是您在<code class="du kk kl km kn b">.properties</code>文件中定义属性的方式。在我们示例的上下文中，我们可能想要添加一个<code class="du kk kl km kn b">Child</code>属性列表。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="ab32" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此时运行应用程序将产生一个带有2个子对象的<code class="du kk kl km kn b">PersonProperties </code>对象:</p><pre class="iy iz ja jb fd lu kn lv lw aw lx bi"><span id="438c" class="ly kw hi kn b fi lz ma l mb mc">PersonProperties(name=Don Draper, age=44, hairColor=brown, children=[Child(name=Sally Beth Draper), Child(name=Robert Draper)], address=Address(street=Arden Road, city=New York))</span></pre></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="2e91" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">结论</h1><p id="bc6e" class="pw-post-body-paragraph jo jp hi jq b jr ln ij jt ju lo im jw jx lp jz ka kb lq kd ke kf lr kh ki kj hb bi translated"><code class="du kk kl km kn b">@ConstructorBinding</code>的引入打开了将Kotlin数据类与Spring Boot配置属性结合使用的大门。再加上Kotlin语言的特性，比如构造函数参数的默认值和<code class="du kk kl km kn b">require</code>函数，这允许我们以优雅的方式声明不可变的配置属性。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="abe6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">感谢阅读。我希望这有所帮助。如果您有任何问题或反馈，请随时回复。</p></div></div>    
</body>
</html>