<html>
<head>
<title>How to prevent deleting files/directory accidentally in Unix system?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何防止在Unix系统中意外删除文件/目录？</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/how-to-prevent-deleting-files-directory-accidentally-in-unix-system-823fc82a3fac?source=collection_archive---------2-----------------------#2020-05-15">https://medium.com/javarevisited/how-to-prevent-deleting-files-directory-accidentally-in-unix-system-823fc82a3fac?source=collection_archive---------2-----------------------#2020-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class="if ig ez fb ih ii"><a href="https://github.com/sophea/bash-script-sample/blob/master/prevent_remove_file_folder_in_linux.txt" rel="noopener  ugc nofollow" target="_blank"><div class="ij ab dw"><div class="ik ab il cl cj im"><h2 class="bd hj fi z dy in ea eb io ed ef hh bi translated">sophea/bash-脚本-示例</h2><div class="ip l"><h3 class="bd b fi z dy in ea eb io ed ef dx translated">Permalink GitHub是5000多万开发人员的家园，他们一起工作来托管和审查代码、管理项目以及…</h3></div><div class="iq l"><p class="bd b fp z dy in ea eb io ed ef dx translated">github.com</p></div></div><div class="ir l"><div class="is l it iu iv ir iw ix ii"/></div></div></a></div><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es iy"><img src="../Images/faa6c76e52dfe4361cc67620d3f0fe64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2VXJKAEf7BHMSaQDHFpMlw.png"/></div></div></figure><p id="8fb9" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">默认情况下，<strong class="jl hj"> chattr </strong>命令在大多数现代Linux操作系统中都可用。<strong class="jl hj"> chattr </strong>命令的默认语法是:</p><blockquote class="kh ki kj"><p id="6cd6" class="jj jk kk jl b jm jn jo jp jq jr js jt kl jv jw jx km jz ka kb kn kd ke kf kg hb bi translated">chattr[操作员][开关][文件名]</p></blockquote><p id="3728" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">chattr有以下操作符。</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="8193" class="kt ku hi kp b fi kv kw l kx ky">The operator ‘+’ causes the selected attributes to be added to the existing attributes of the files.</span><span id="be62" class="kt ku hi kp b fi kz kw l kx ky">The operator ‘-‘ causes them to be removed.<br/>The operator ‘=’ causes them to be the only attributes that the files have.</span><span id="910d" class="kt ku hi kp b fi kz kw l kx ky">Chattr has different attributes namely — aAcCdDeijsStTu. Each letter applies a particular attributes to a file.</span><span id="64a4" class="kt ku hi kp b fi kz kw l kx ky">a — append only,<br/>A — no atime updates,<br/>c — compressed,<br/>C — no copy on write,<br/>d — no dump,<br/>D — synchronous directory updates,<br/>e — extent format,<br/>i — immutable,<br/>j — data journalling,<br/>P — project hierarchy,<br/>s — secure deletion,<br/>S — synchronous updates,<br/>t — no tail-merging,<br/>T — top of directory hierarchy,<br/>u — undeletable.</span><span id="fb13" class="kt ku hi kp b fi kz kw l kx ky">See more with<br/>$ man chattr</span></pre><p id="a3b3" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">在这篇文章中，我将讨论一些常用的属性<strong class="jl hj">【我】</strong>和<strong class="jl hj">【a】</strong>来防止删除文件和目录</p><h1 id="9b53" class="la ku hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">在Linux中防止文件被意外删除</h1><p id="0435" class="pw-post-body-paragraph jj jk hi jl b jm lx jo jp jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg hb bi translated">例如，我们创建一个如下所示的虚拟文件</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="158d" class="kt ku hi kp b fi kv kw l kx ky">$ touch file.txt <br/># or <br/>&gt; file.txt</span></pre><p id="de68" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">现在，我将应用<strong class="jl hj">“I”</strong>属性，使文件不可变。这意味着你不能删除，修改文件，即使你是文件的所有者和根用户。</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="73fa" class="kt ku hi kp b fi kv kw l kx ky">$ sudo chattr +i file.txt</span></pre><p id="5a15" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">您可以使用以下命令检查文件属性:</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="0aae" class="kt ku hi kp b fi kv kw l kx ky">$ lsattr file.txt</span><span id="6d3f" class="kt ku hi kp b fi kz kw l kx ky">— — i — — — — -e — — file.txt</span></pre><p id="675b" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">现在，尝试以普通用户或使用<strong class="jl hj"> sudo </strong>权限删除该文件。</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="ccdd" class="kt ku hi kp b fi kv kw l kx ky">$ rm file.txt<br/>rm: cannot remove ‘file.txt’: Operation not permitted</span><span id="b38d" class="kt ku hi kp b fi kz kw l kx ky">#try with sudo command:</span><span id="be1c" class="kt ku hi kp b fi kz kw l kx ky">$ sudo rm file.txt</span><span id="0a08" class="kt ku hi kp b fi kz kw l kx ky">rm: cannot remove ‘file.txt’: Operation not permitted</span></pre><h1 id="0c1e" class="la ku hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">要撤销属性，只需使用"-i "开关，如下所示。</h1><blockquote class="kh ki kj"><p id="2e7e" class="jj jk kk jl b jm jn jo jp jq jr js jt kl jv jw jx km jz ka kb kn kd ke kf kg hb bi translated">$ sudo chattr -i file.txt</p></blockquote><p id="a41b" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">现在，不可变属性已经被移除。现在，您可以根据需要修改或删除该文件。</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="72dd" class="kt ku hi kp b fi kv kw l kx ky">$ echo "Hello World!" &gt;&gt; file.txt</span><span id="cc34" class="kt ku hi kp b fi kz kw l kx ky">delete<br/>$ rm file.txt</span><span id="97c8" class="kt ku hi kp b fi kz kw l kx ky">//delete successfully</span></pre><h1 id="091a" class="la ku hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">在Linux中防止文件夹被意外删除和修改</h1><p id="7af1" class="pw-post-body-paragraph jj jk hi jl b jm lx jo jp jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg hb bi translated">创建一个名为dir1的目录，并在该目录下创建一个名为file.txt的文件。</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="99ef" class="kt ku hi kp b fi kv kw l kx ky">$mkdir dir1 &amp;&amp; touch dir1/file.txt</span></pre><p id="3b00" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">现在，使用以下命令使该目录及其内容(file.txt)不可变:</p><blockquote class="kh ki kj"><p id="0730" class="jj jk kk jl b jm jn jo jp jq jr js jt kl jv jw jx km jz ka kb kn kd ke kf kg hb bi translated"><em class="hi"> $ sudo chattr -R +i dir1 </em></p></blockquote><p id="aa51" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">在哪里，</p><blockquote class="kh ki kj"><p id="ccc8" class="jj jk kk jl b jm jn jo jp jq jr js jt kl jv jw jx km jz ka kb kn kd ke kf kg hb bi translated">-R将使dir1及其内容递归地不可变。<br/> +i使目录不可变。</p></blockquote><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="5580" class="kt ku hi kp b fi kv kw l kx ky">Now, try to delete the directory either as a normal user or using <strong class="kp hj">sudo </strong>user.</span><span id="270d" class="kt ku hi kp b fi kz kw l kx ky">$ rm -fr dir1<br/>$ sudo rm -fr dir1<br/>You will get the following output:</span><span id="a238" class="kt ku hi kp b fi kz kw l kx ky">rm: cannot remove ‘dir1/file.txt’: Operation not permitted</span></pre><h2 id="0afd" class="kt ku hi bd lb mc md me lf mf mg mh lj ju mi mj ln jy mk ml lr kc mm mn lv mo bi translated">要撤销属性，请运行:</h2><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="6409" class="kt ku hi kp b fi kv kw l kx ky">$sudo chattr -R -i dir1</span></pre><p id="630b" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">现在，您可以像往常一样删除或修改该目录的内容。</p><h1 id="95b7" class="la ku hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">防止文件和文件夹被意外删除，但允许在Linux中追加操作</strong></h1><p id="1817" class="pw-post-body-paragraph jj jk hi jl b jm lx jo jp jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg hb bi translated">我们现在知道如何防止文件和文件夹被意外删除和修改。</p><p id="2465" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">接下来，我们将防止删除文件和文件夹，但只允许以追加模式写入文件。也就是说你<strong class="jl hj"> <em class="kk">不能编辑、修改文件中已有的数据，重命名文件，删除文件</em> </strong>。您只能在追加模式下打开文件进行写入。</p><p id="25fe" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">要设置文件/目录的附加模式属性，我们需要执行以下操作:</p><blockquote class="kh ki kj"><p id="1dee" class="jj jk kk jl b jm jn jo jp jq jr js jt kl jv jw jx km jz ka kb kn kd ke kf kg hb bi translated">对于文件:$ sudo <strong class="jl hj"> chattr +a file.txt </strong></p><p id="c36c" class="jj jk kk jl b jm jn jo jp jq jr js jt kl jv jw jx km jz ka kb kn kd ke kf kg hb bi translated">对于目录:$ sudo <strong class="jl hj"> chattr -R +a dir1 </strong></p></blockquote><p id="a293" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">设置了“a”属性的文件/文件夹只能在追加模式下打开进行写入。</p><p id="2bc0" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">向文件中添加一些内容，以检查它是否工作。</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="9818" class="kt ku hi kp b fi kv kw l kx ky">$ echo ‘Hello World!’ &gt;&gt; file.txt<br/>$ echo ‘This is me!’ &gt;&gt; dir1/file.txt</span><span id="6518" class="kt ku hi kp b fi kz kw l kx ky">Check the file contents using cat command:</span><span id="dba2" class="kt ku hi kp b fi kz kw l kx ky">$ cat file.txt<br/>$ cat dir1/file.txt</span><span id="f796" class="kt ku hi kp b fi kz kw l kx ky">$ rm file.txt<br/>Output:</span><span id="01c5" class="kt ku hi kp b fi kz kw l kx ky">rm: cannot remove ‘file.txt’: Operation not permitted</span></pre><h2 id="266c" class="kt ku hi bd lb mc md me lf mf mg mh lj ju mi mj ln jy mk ml lr kc mm mn lv mo bi translated">让我们尝试删除文件夹:</h2><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="591a" class="kt ku hi kp b fi kv kw l kx ky">$ rm -fr dir1/<br/>Or try with sudo:</span><span id="3aaa" class="kt ku hi kp b fi kz kw l kx ky">$ sudo rm -fr dir1/</span><span id="de5e" class="kt ku hi kp b fi kz kw l kx ky">Sample output:<br/>rm: cannot remove ‘dir1/file.txt’: Operation not permitted</span></pre><h2 id="01f8" class="kt ku hi bd lb mc md me lf mf mg mh lj ju mi mj ln jy mk ml lr kc mm mn lv mo bi translated">#要删除属性和，请运行以下命令:</h2><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="a5a9" class="kt ku hi kp b fi kv kw l kx ky">For files:<br/>$ sudo chattr -R -a file.txt</span><span id="f4cd" class="kt ku hi kp b fi kz kw l kx ky">For directories: <br/>$ sudo chattr -R -a dir1/</span></pre><p id="c3c1" class="pw-post-body-paragraph jj jk hi jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">现在，您可以像往常一样删除或修改文件和文件夹。</p><h1 id="4c84" class="la ku hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">防止删除文件夹</h1><p id="a225" class="pw-post-body-paragraph jj jk hi jl b jm lx jo jp jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg hb bi translated">你可以创造。锁定文件并将属性+i设置到该文件。</p><pre class="iz ja jb jc fd ko kp kq kr aw ks bi"><span id="bec4" class="kt ku hi kp b fi kv kw l kx ky">$ mkdir dir1<br/>$ touch dir1/.lock<br/>$ chattr +i dir1/.lock</span><span id="f3d9" class="kt ku hi kp b fi kz kw l kx ky">##you can not delete the folder dir1 <br/>$rm -rf dir1</span><span id="86db" class="kt ku hi kp b fi kz kw l kx ky">output : rm: cannot remove ‘dir1/.lock’: Operation not permitted</span></pre><h1 id="42d1" class="la ku hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="ec34" class="pw-post-body-paragraph jj jk hi jl b jm lx jo jp jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg hb bi translated">希望这篇文章能帮助你获得知识。如果这篇文章有帮助，请支持按下<strong class="jl hj">按钮</strong>👏按钮，并与其他读者分享，以达到这个故事。</p><h2 id="cf6e" class="kt ku hi bd lb mc md me lf mf mg mh lj ju mi mj ln jy mk ml lr kc mm mn lv mo bi translated">你可能喜欢的其他文章</h2><div class="if ig ez fb ih ii"><a rel="noopener follow" target="_blank" href="/javarevisited/top-10-courses-to-learn-linux-command-line-in-2020-best-and-free-f3ee4a78d0c0"><div class="ij ab dw"><div class="ik ab il cl cj im"><h2 class="bd hj fi z dy in ea eb io ed ef hh bi translated">2020年学习Linux命令行的10大课程——最好的免费课程</h2><div class="ip l"><h3 class="bd b fi z dy in ea eb io ed ef dx translated">有没有想过为什么命令行仍然在使用，即使有数百种人性化的图形用户界面和工具…</h3></div><div class="iq l"><p class="bd b fp z dy in ea eb io ed ef dx translated">medium.com</p></div></div><div class="ir l"><div class="mp l it iu iv ir iw ix ii"/></div></div></a></div><div class="if ig ez fb ih ii"><a rel="noopener follow" target="_blank" href="/javarevisited/top-15-online-courses-to-learn-docker-kubernetes-and-aws-for-fullstack-developers-and-devops-d8cc4f16e773"><div class="ij ab dw"><div class="ik ab il cl cj im"><h2 class="bd hj fi z dy in ea eb io ed ef hh bi translated">为Fullstack开发人员和DevOps学习Docker、Kubernetes和AWS的15大在线课程…</h2><div class="ip l"><h3 class="bd b fi z dy in ea eb io ed ef dx translated">大家好，你可能听说过Docker和Kubernetes周围的嗡嗡声。他们从根本上改变了发展…</h3></div><div class="iq l"><p class="bd b fp z dy in ea eb io ed ef dx translated">medium.com</p></div></div><div class="ir l"><div class="mq l it iu iv ir iw ix ii"/></div></div></a></div><div class="if ig ez fb ih ii"><a rel="noopener follow" target="_blank" href="/javarevisited/10-free-python-tutorials-and-courses-from-google-microsoft-and-coursera-for-beginners-96b9ad20b4e6"><div class="ij ab dw"><div class="ik ab il cl cj im"><h2 class="bd hj fi z dy in ea eb io ed ef hh bi translated">谷歌、微软和Coursera为初学者提供的10个免费Python教程和课程</h2><div class="ip l"><h3 class="bd b fi z dy in ea eb io ed ef dx translated">大家好，如果你在这里，那么让我首先祝贺你做出了学习Python的正确决定…</h3></div><div class="iq l"><p class="bd b fp z dy in ea eb io ed ef dx translated">medium.com</p></div></div><div class="ir l"><div class="mr l it iu iv ir iw ix ii"/></div></div></a></div></div></div>    
</body>
</html>