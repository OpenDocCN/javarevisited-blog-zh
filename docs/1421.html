<html>
<head>
<title>Event-Driven Microservices using Spring Cloud Stream and Web Sockets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spring Cloud Stream和Web Sockets的事件驱动微服务</h1>
<blockquote>原文：<a href="https://medium.com/javarevisited/event-driven-microservices-using-spring-cloud-stream-and-web-sockets-e93fe5fbe7d4?source=collection_archive---------1-----------------------#2021-07-30">https://medium.com/javarevisited/event-driven-microservices-using-spring-cloud-stream-and-web-sockets-e93fe5fbe7d4?source=collection_archive---------1-----------------------#2021-07-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ac64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2部分:实现</p><p id="a4e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://attyuttam.medium.com/event-driven-microservices-using-spring-cloud-stream-and-web-sockets-ee7c8921aa4f" rel="noopener"> <strong class="ih hj"> <em class="je">转到第1部分</em></strong>T5】</a></p><p id="4793" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我相信您已经有时间仔细阅读了我在这两篇文章的第1部分中谈到的概念，如果没有，请查看一下！所以，事不宜迟，让我们直接进入正题。</p><p id="05ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用<strong class="ih hj"> <em class="je"> Indian-news </em> </strong>有两个相互交互的微服务。其中一个是<strong class="ih hj"> <em class="je"> news-app </em> </strong>微服务，作为后端，负责与第三方<a class="ae jd" href="https://newsapi.org/s/india-news-api" rel="noopener ugc nofollow" target="_blank"><em class="je">Google news API</em></a>对话，获取直播新闻并发送给前端微服务，即<strong class="ih hj"> <em class="je"> news-app-ui </em> </strong>微服务。</p><p id="d228" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，由于这是一个高级的spring主题，我假设您已经熟悉了<a class="ae jd" rel="noopener" href="/javarevisited/10-best-online-courses-to-learn-spring-framework-in-2020-f7f73599c2fd"> Spring </a>和<a class="ae jd" rel="noopener" href="/javarevisited/10-free-spring-boot-tutorials-and-courses-for-java-developers-53dfe084587e"> Spring Boot </a>，所以我将只讨论<strong class="ih hj"><em class="je">Spring Cloud Stream</em></strong>和<strong class="ih hj"> <em class="je"> Web Sockets </em> </strong>的概念，以及它们如何使我们能够构建一个<strong class="ih hj"> <em class="je">事件驱动架构</em> </strong>。</p><p id="4b3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看微服务的工作原理。</p><h1 id="98d0" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated"><strong class="ak">开始前</strong></h1><p id="f316" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">请确保您的系统中安装了以下应用程序:</p><ol class=""><li id="bd14" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated"><a class="ae jd" href="https://adoptopenjdk.net/" rel="noopener ugc nofollow" target="_blank"> Java 8 </a></li><li id="af07" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated"><a class="ae jd" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank"> Docker </a>(我们将在本地运行RabbitMQ和Kafka)</li><li id="5f26" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated"><a class="ae jd" href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" rel="noopener ugc nofollow" target="_blank"> Git </a>(可选)</li><li id="272a" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated"><a class="ae jd" rel="noopener" href="/javarevisited/6-free-courses-to-learn-bash-shell-scripting-in-linux-and-unix-a50461ecd4fe?source=---------6------------------"> Bash </a>(假设，尽管替代方案也可行)</li><li id="9c7b" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated"><a class="ae jd" href="https://javarevisited.blogspot.com/2018/01/top-5-nodejs-and-express-js-online-courses-for-web-developers.html" rel="noopener ugc nofollow" target="_blank"> npm </a>运行React应用程序</li></ol><h1 id="cf54" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">项目结构</h1><p id="bf9c" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">让我们检查一下项目结构</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es kw"><img src="../Images/ecf3624590d7f2ff29d2e6874442bd7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*Gh11FnxUTwt_7sxoJ7SnhA.png"/></div><p class="le lf et er es lg lh bd b be z dx translated">根项目结构</p></figure><figure class="kx ky kz la fd lb er es paragraph-image"><a href="https://javarevisited.blogspot.com/2018/08/top-5-react-js-and-redux-courses-to-learn-online.html#axzz5r06B3egD"><div class="er es li"><img src="../Images/142abf1fe0bd3e1b4447543a9325e77d.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*NfF3JYmorg7F5FiqLXyMNg.png"/></div></a><p class="le lf et er es lg lh bd b be z dx translated">新闻应用程序项目结构</p></figure><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es lj"><img src="../Images/fccd35c015a8a993cf74ba8371ea39f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*9yMcyA3Bft2oohmEvcIiUA.png"/></div><p class="le lf et er es lg lh bd b be z dx translated">新闻-应用程序-用户界面项目结构</p></figure><p id="c6da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，news-app-ui微服务有了一个使用<a class="ae jd" rel="noopener" href="/javarevisited/10-advanced-spring-boot-courses-for-experienced-java-developers-5e57606816bd?source=collection_home---4------0-----------------------"> spring boot </a>构建的后端和一个提供简单用户界面的<a class="ae jd" rel="noopener" href="/javarevisited/6-best-frontend-development-courses-for-beginners-to-learn-in-2021-f2772157864">前端</a>，为用户提供实时新闻更新。</p><p id="0114" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们也看看这两个部分的项目结构。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es lk"><img src="../Images/4c0a9c541b7795e560b3706878beff12.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*HZm0Z1gcJWOwRmZkrBe8Iw.png"/></div><p class="le lf et er es lg lh bd b be z dx translated">新闻应用程序用户界面的后端项目结构</p></figure><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es ll"><img src="../Images/90743eda2e7ac7f992f213a40093c374.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*EHtdCdp7FE7rNJ4qn7VlBw.png"/></div><p class="le lf et er es lg lh bd b be z dx translated">新闻应用用户界面的前端项目结构</p></figure><p id="27af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，在用户界面方面没有什么，我只是想显示新闻，没有什么花哨的东西，但是你可以展开你的翅膀！</p><h1 id="111d" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">运行应用程序</h1><h2 id="64db" class="lm jg hi bd jh ln lo lp jl lq lr ls jp iq lt lu jt iu lv lw jx iy lx ly kb lz bi translated">1.首先，从GitHub克隆代码库。</h2><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="ffab" class="lm jg hi mb b fi mf mg l mh mi">git clone <a class="ae jd" href="https://github.com/Attyuttam/indian-news.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Attyuttam/indian-news.git</a></span></pre><h2 id="8ff2" class="lm jg hi bd jh ln lo lp jl lq lr ls jp iq lt lu jt iu lv lw jx iy lx ly kb lz bi translated">2.启动消息服务器</h2><p id="00ff" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">转到文件夹<strong class="ih hj"> <em class="je">印度新闻</em> </strong>并运行以下命令:</p><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="19bd" class="lm jg hi mb b fi mf mg l mh mi">./start-servers.sh</span></pre><h2 id="1c72" class="lm jg hi bd jh ln lo lp jl lq lr ls jp iq lt lu jt iu lv lw jx iy lx ly kb lz bi translated">3.获取API密钥并粘贴到news-app的application.properties文件中</h2><p id="3e72" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">使用您的Gmail id登录后，您可以从<a class="ae jd" href="https://newsapi.org/s/india-news-api" rel="noopener ugc nofollow" target="_blank">谷歌新闻API </a>获取您的API密钥。</p><p id="a0c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获得API密钥后，只需用获得的API密钥替换下面提到的代码中的文本<em class="je">您的GOOGLE新闻API密钥</em>。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><h2 id="9d9c" class="lm jg hi bd jh ln lo lp jl lq lr ls jp iq lt lu jt iu lv lw jx iy lx ly kb lz bi translated">4.运行新闻应用程序获取新闻更新</h2><p id="7a33" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">转到<strong class="ih hj"> <em class="je"> news-app </em> </strong>文件夹，运行以下命令:</p><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="f86b" class="lm jg hi mb b fi mf mg l mh mi">mvn clean package spring-boot:run -DskipTests=true</span></pre><h2 id="96be" class="lm jg hi bd jh ln lo lp jl lq lr ls jp iq lt lu jt iu lv lw jx iy lx ly kb lz bi translated">5.启动前端新闻-应用程序-用户界面</h2><p id="0608" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">转到<strong class="ih hj"> <em class="je"> news-app-ui </em> </strong>文件夹，运行以下命令:</p><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="f2dd" class="lm jg hi mb b fi mf mg l mh mi">mvn clean package spring-boot:run -DskipTests=true</span></pre><p id="7a1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后进入<strong class="ih hj"><em class="je">news-app-ui/main/ui</em></strong>内部，运行以下命令:</p><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="d453" class="lm jg hi mb b fi mf mg l mh mi">npm start</span></pre><p id="699c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，如果您是第一次运行，我们必须确保安装所有必要的npm软件包。所以，在文件夹<strong class="ih hj"><em class="je">news-app-ui/main/ui</em></strong>中运行以下命令:</p><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="ea76" class="lm jg hi mb b fi mf mg l mh mi">npm install</span></pre><p id="eda8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了确保安装stomp包，使用以下命令:</p><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="fa3c" class="lm jg hi mb b fi mf mg l mh mi">npm i @stomp/stompjs</span></pre><p id="3a0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你的应用程序开始运行，在你的网络浏览器中进入<a class="ae jd" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，你可以看到这样的新闻:</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es ml"><img src="../Images/e926b13cd6ecc5bcda0f57c6238d6d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t6HoUl_owO4h69MPf54a7w.png"/></div></div><p class="le lf et er es lg lh bd b be z dx translated">印度新闻应用程序显示</p></figure><h2 id="07f7" class="lm jg hi bd jh ln lo lp jl lq lr ls jp iq lt lu jt iu lv lw jx iy lx ly kb lz bi translated">6.停止应用程序</h2><p id="556c" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">要停止服务器，仅仅关闭bash或键入Ctrl+C不起作用，您更愿意在根文件夹<strong class="ih hj"> <em class="je"> indian-news </em> </strong>中运行以下命令:</p><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="bf9a" class="lm jg hi mb b fi mf mg l mh mi">./stop-servers.sh</span></pre><h1 id="969f" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">新闻应用程序</h1><p id="e688" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">这个微服务是使用spring boot构建的，并作为应用程序的后端，该应用程序负责从第三方<a class="ae jd" href="https://newsapi.org/s/india-news-api" rel="noopener ugc nofollow" target="_blank"><em class="je">Google news API</em></a><em class="je"/>获取实时新闻，然后将它们放在由<a class="ae jd" href="https://spring.io/projects/spring-cloud-stream" rel="noopener ugc nofollow" target="_blank"><em class="je">Spring Cloud Stream</em></a>促成的<a class="ae jd" rel="noopener" href="/javarevisited/top-10-apache-kafka-online-training-courses-and-certifications-621f3c13b38c"> Kafka topic </a>上。</p><p id="9727" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">新闻应用程序从第三方API读取实时新闻，通过点击他们的服务器每小时获取最新新闻，这确保了该应用程序的用户可以全天阅读实时新闻。</p><p id="c3b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为一名程序员，如果你认为1个小时太长了，你也可以把它改成秒数。</p><h1 id="7fa1" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">新闻app是如何运作的？</h1><p id="9414" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">让我们检查一下pom.xml文件中需要的依赖项</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="c4c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您所看到的，我们正在导入<em class="je"> spring-cloud-stream </em>依赖项，并且由于我们将只使用<a class="ae jd" href="https://javarevisited.blogspot.com/2018/04/top-5-apache-kafka-course-to-learn.html#axzz6kZHuJeAZ" rel="noopener ugc nofollow" target="_blank"> Kafka </a>进行通信，我们将配置文件默认设置为Kafka，因此导入<em class="je">spring-cloud-stream-binder-Kafka</em>依赖项来执行Kafka主题上的所有操作。</p><p id="5e9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<strong class="ih hj"> <em class="je">新闻-app </em> </strong> <a class="ae jd" rel="noopener" href="/javarevisited/7-free-microservices-courses-for-java-programmers-c9b2f3a2ea7d">微服务</a>，我们使用的是春云流v2.1 — <a class="ae jd" href="https://cloud.spring.io/spring-cloud-stream/reference/html/spring-cloud-stream.html#spring_cloud_function" rel="noopener ugc nofollow" target="_blank">春云功能支持</a>。有了这个特性，让<code class="du mq mr ms mb b">NewsAppApplication</code>微服务充当<code class="du mq mr ms mb b">News</code>消息的来源所需要的就是声明一个<code class="du mq mr ms mb b">@Bean</code>，这个方法生成并返回一个<code class="du mq mr ms mb b">Supplier&lt;&gt;</code>。在这种情况下，它是一个<code class="du mq mr ms mb b">News</code>类型的<code class="du mq mr ms mb b">Supplier</code>。函数方法代码如下所示(您可以在<code class="du mq mr ms mb b">NewsProducer</code>组件中找到)</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="c95f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du mq mr ms mb b">Supplier&lt;&gt;</code>是Java函数数据类型。因为返回这个类型的<code class="du mq mr ms mb b">@Bean</code>方法只有一个，<a class="ae jd" rel="noopener" href="/javarevisited/5-best-courses-to-learn-spring-cloud-and-microservices-1ddea1af7012"> <strong class="ih hj"> <em class="je">春云流</em> </strong> </a>完全知道下一步该怎么做。默认情况下，每秒触发一次该功能，并将结果发送到默认的<code class="du mq mr ms mb b">MessageChannel</code>名为<strong class="ih hj"> <em class="je">的输出。</em> </strong></p><p id="170c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以显式地提到这个bean和<code class="du mq mr ms mb b">MessageChannel</code>(这里是它的<code class="du mq mr ms mb b">news_output</code>)，也可以像下面这样设置属性(我们的方法名是<code class="du mq mr ms mb b">supplyNews</code>):</p><pre class="kx ky kz la fd ma mb mc md aw me bi"><span id="a4c0" class="lm jg hi mb b fi mf mg l mh mi">spring.cloud.stream.function.bindings.supplyNews-out-0=news_output</span></pre><p id="aa1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您在<code class="du mq mr ms mb b">Supplier&lt;&gt; </code>中看到的<code class="du mq mr ms mb b">googleNewsService</code>是负责调用第三方<a class="ae jd" href="https://newsapi.org/s/india-news-api" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="je"> Google新闻API服务</em> </strong> </a>的<strong class="ih hj"><em class="je"/></strong>假扮客户端。</p><p id="61e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种方法的好处在于它只包含业务逻辑，因此您可以使用常规的单元测试来测试它。同样，在这种方法中，你可以在把消息放到Kafka主题之前应用你的逻辑来玩消息，因此它也在把消息放到Kafka主题之前充当中介。</p><p id="b6f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用<code class="du mq mr ms mb b">application.properties</code>文件中的<code class="du mq mr ms mb b">spring.cloud.function.definition</code>属性来明确声明我们希望将哪个功能bean绑定到绑定目的地——但是对于只定义了单个<code class="du mq mr ms mb b">@Bean</code>的情况，这是没有必要的。</p><p id="7d18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，由于默认的轮询间隔是一秒钟，但是我决定每小时轮询一次，所以我通过设置<code class="du mq mr ms mb b">application.properties</code>文件中的<code class="du mq mr ms mb b">spring.integration.poller.fixed-delay</code>属性将间隔设置为1小时。</p><p id="4560" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是<a class="ae jd" rel="noopener" href="/hackernoon/top-5-spring-boot-and-spring-cloud-books-for-java-developers-75df155dcedc?source=---------23------------------"><strong class="ih hj"><em class="je">Spring Cloud Stream</em></strong></a>的神奇之处，它基本上从你那里提取了设置消息传递环境的考虑，现在你所关心的只是业务逻辑。</p><p id="4f91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里 可以看到<strong class="ih hj"> <em class="je">新闻app </em> </strong>微服务<a class="ae jd" href="https://github.com/Attyuttam/indian-news/tree/master/news-app" rel="noopener ugc nofollow" target="_blank"> <em class="je">的完整代码。</em></a></p><h1 id="37c0" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">新闻-应用程序-界面</h1><p id="f382" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">该微服务的主要任务可分为两部分:</p><ul class=""><li id="97f6" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc mt ko kp kq bi translated">接收来自卡夫卡主题的数据</li><li id="9cc0" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc mt ko kp kq bi translated">在用户界面上实时显示</li></ul><p id="bbd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始理解第一个任务之前，请确保pom.xml文件中也有相同的依赖项(版本可能不同):</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="7017" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们试着理解第一项任务。</p><p id="fd95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们在第一个任务中需要关心的是确保我们正确地从<strong class="ih hj"> <em class="je">新闻应用</em> </strong>接收事件。为此，我们设立了一个<code class="du mq mr ms mb b">SubscribableChannel</code>，负责从源头接收事件。我们是这样做的:</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="abc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是现在你想到的一个相关问题是，应用程序如何知道这个组件负责提供通道来监听即将发生的事件。好了，注解<strong class="ih hj"><em class="je">@ enable binding</em></strong>来帮我们了。</p><p id="8fa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个<code class="du mq mr ms mb b">NewsProcessor</code>接口首先在<code class="du mq mr ms mb b">@SpringBootApplication</code>类(<code class="du mq mr ms mb b">NewsAppUiApplication.java</code>)中被引用，作为<code class="du mq mr ms mb b">@EnableBinding()</code>注释的参数，如下所示。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="d237" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，一旦设置了通道，我们还设置了另一个名为<code class="du mq mr ms mb b">NewsUpdater</code>的组件，它包含方法<code class="du mq mr ms mb b">updateNews()</code>，每当有<code class="du mq mr ms mb b">News</code>事件出现在主题上时，就会自动调用该方法。它之所以能够做到这一点，是因为在方法的顶部为<code class="du mq mr ms mb b">NewsProcessor.NEWS_OUTPUT</code>添加了<code class="du mq mr ms mb b">@StreamListener</code>注释。让我们在代码中看到它:</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="e720" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，为了理解<code class="du mq mr ms mb b">updateNews()</code>做什么，我们将不得不跳到<strong class="ih hj"> <em class="je"> news-app-ui </em> </strong>微服务做的下一个任务，即将新闻数据实时呈现到ui上。为了理解这一点，我们必须理解股票，所以查看这个两部分系列的第1部分和第34部分<strong class="ih hj">来更好地了解什么是web套接字。</strong></p><p id="3d8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看，我们如何在<a class="ae jd" rel="noopener" href="/javarevisited/7-best-webflux-and-reactive-spring-boot-courses-for-java-programmers-33b7c6fa8995"> Spring Boot </a>和<a class="ae jd" rel="noopener" href="/javarevisited/top-10-free-courses-to-learn-react-js-c14edbd3b35f"> ReactJS </a>中设置Web Socket。</p><p id="4682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为您已经确保了news-app-ui的pom.xml文件对您来说也是相同的，所以我将不深究细节，只是为了再次检查，请确保您有以下两个依赖项:</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="6e48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们创建Web套接字配置。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="58fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的类中，通过扩展<code class="du mq mr ms mb b">WebSocketMessageBrokerConfigurer</code>，我们确保在类<code class="du mq mr ms mb b">WebSocketConfiguration</code>中有两个可用的方法<code class="du mq mr ms mb b">configureMessageBroker()</code>和<code class="du mq mr ms mb b">registerStompEndpoints()</code>。</p><p id="adf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du mq mr ms mb b">configureMessageBroker()</code>首先调用<code class="du mq mr ms mb b">enableSimpleBroker() </code>方法，该方法创建一个基于内存的消息代理，将消息数据传送到以<strong class="ih hj"> <em class="je"> /topic </em> </strong>为前缀的目的地。它的另一个任务是使用<code class="du mq mr ms mb b">setApplicationDestinationPrefixes()</code>添加前缀<strong class="ih hj"> <em class="je"> /app </em> </strong>，以便服务器可以从客户端接收消息，但是在我们的例子中，我们可以删除它，因为我们不会从客户端接收任何数据。</p><p id="612b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在方法<code class="du mq mr ms mb b">registerStompEndpoints()</code>中，<code class="du mq mr ms mb b">addEndpoint()</code>负责在给定映射路径的WebSocket端点上注册STOMP端点<strong class="ih hj"> <em class="je"> /ws-message </em> </strong>。</p><p id="151c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，这就完成了后端部分，现在我们将配置前端，使其具有web套接字，以确保接收到新闻更新并将其显示在屏幕上，而无需任何刷新。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="a0cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是创建的基本UI。</p><h1 id="c1be" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">使用Docker设置消息服务器</h1><p id="b575" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">好了，现在消息服务器已经准备好了，我们需要做的就是设置消息服务器，这样消息就可以在两个<a class="ae jd" rel="noopener" href="/javarevisited/10-best-java-microservices-courses-with-spring-boot-and-spring-cloud-6d04556bdfed?source=rss-bb36d8439904------2&amp;utm_source=dlvr.it&amp;utm_medium=linkedin">微服务</a>之间通过Kafka主题很好地交换了。这是<strong class="ih hj"><em class="je">docker-compose . yml</em></strong>文件，一旦运行<strong class="ih hj"> <em class="je">就会被执行。/start-servers.sh </em> </strong></p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="3349" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，创建了三个服务:</p><ol class=""><li id="ea7c" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated"><strong class="ih hj"><em class="je">Kafdrop</em></strong>:Kafdrop是一个用于查看Kafka话题和浏览消费群体的web UI<em class="je">。</em>该工具显示代理、主题、分区、消费者等信息，并允许您查看消息。</li><li id="e03b" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated"><strong class="ih hj"> <em class="je"> Zookeeper </em> </strong> : Kafka使用Zookeeper为组成集群的Kafka代理管理服务发现。Zookeeper基本上管理集群中的整体控制器状态。它充当配置存储库，维护集群元数据，还实现集群的实际机制。</li><li id="f205" class="ki kj hi ih b ii kr im ks iq kt iu ku iy kv jc kn ko kp kq bi translated"><strong class="ih hj"> <em class="je">卡夫卡</em> </strong>:这实质上是卡夫卡集群被创建。Kafka集群包含Kafka经纪人，他们负责Kafka生产者和消费者之间的数据交换。</li></ol><p id="2369" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，当所有这些都设置好后，我们就有了一个Kafka集群，它将侦听消息并将它们传输到各自的客户端。</p><p id="e7d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，当您启动服务器时，Kafdrop会显示所有已注册主题的图片。而且你已经启动了<strong class="ih hj"> <em class="je">新闻-app </em> </strong>微服务就可以看到题目<code class="du mq mr ms mb b">news_output</code>。</p><p id="2175" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，这就是<strong class="ih hj"> <em class="je">春云流水</em> </strong>发挥的魔力。在任一微服务的代码中，没有一行特定于消息代理的代码(Apache Kafka/ Rabbit MQ/ Active MQ等),但是由于<code class="du mq mr ms mb b">spring-cloud-stream-binder-kafka</code>的依赖性，微服务已经能够与消息代理无缝交互，这使得对服务进行单元测试变得更加容易，并且如果需要，还可以在不对代码进行任何更改的情况下更改消息代理。</p><p id="d570" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只需转到<code class="du mq mr ms mb b">http://localhost:9000</code>，您将能够看到这个UI显示注册了主题的Apache Kafka集群。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mu"><img src="../Images/0a522b963e6f53c784fab8f84e52154c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Vy72GNGM-zb9eV5Y7wgew.png"/></div></div></figure><h1 id="2502" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">结论</h1><p id="e763" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">至此，我们完成了两部分系列的第二部分，我希望您能够成功地创建事件驱动的微服务并运行它们。您可以做的另一件事是使用SockJs注册STOMP端点，这可能是一个有趣的实践。如果您有任何问题，或者您有更好的实现方法，请发表评论！感谢阅读！</p></div></div>    
</body>
</html>